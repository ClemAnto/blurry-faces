import{a as zn,c as Un,d as b8,e as y8,g as w8,i as Sr,j as z8,m as kr,n as m2}from"./chunk-BMW5EEP3.js";import{i as M8,j as g2,k as Hr,m as C8,n as Vr,p as _8,u as E8}from"./chunk-FSX72U7O.js";import{$a as ie,A as Q6,Ab as A1,B as y4,Bb as Nn,C as J6,Cb as v8,Db as bn,Eb as yn,F as e8,Fb as C4,G as t8,Gb as _1,Hb as Pn,Ib as _4,Jb as v2,Ka as u8,Kb as m8,L as n8,La as m0,Lb as Er,M as r8,Ma as ee,Mb as g8,O as z1,Oa as mn,P as o8,Pa as Rn,Pb as x8,Q as p0,Qa as gn,Qb as $1,R as M1,Ra as ve,S as Pe,Sb as r1,Ta as h8,Tb as Wn,U as F1,Ub as wn,W as s1,Wa as Je,X as ye,Xa as We,Y as w4,Ya as n1,Za as f8,_a as d8,a as et,b as br,ba as a8,c as h0,ca as l1,d as Y6,da as f2,e as f0,ea as d2,eb as On,f as tt,fa as Tt,fb as Se,ga as i8,gb as rt,hb as C1,i as yr,ia as v0,ib as xn,jb as Mr,kb as fe,l as t1,la as c8,lb as M4,ma as Bn,mb as Cr,n as Z6,nb as Lt,o as L1,oa as wr,ob as Ft,p as De,pa as nt,pb as ue,q as d0,qa as P1,qb as se,r as u2,rb as we,sb as $t,tb as Kt,ua as s8,ub as p8,v as h2,va as z4,vb as _r,wa as zr,xb as p2,yb as re,za as l8,zb as ut}from"./chunk-3CSA3XQZ.js";var tc=f0(()=>{"use strict"});var rc=f0((E4,nc)=>{"use strict";nc.exports=E4=window.fetch;E4.default=window.fetch.bind(window);E4.Headers=window.Headers;E4.Request=window.Request;E4.Response=window.Response});var oc=f0(()=>{"use strict"});function u1(r,t){Nl(r)&&(r="100%");var e=Pl(r);return r=t===360?r:Math.min(t,Math.max(0,parseFloat(r))),e&&(r=parseInt(String(r*t),10)/100),Math.abs(r-t)<1e-6?1:(t===360?r=(r<0?r%t+t:r%t)/parseFloat(String(t)):r=r%t/parseFloat(String(t)),r)}function x2(r){return Math.min(1,Math.max(0,r))}function Nl(r){return typeof r=="string"&&r.indexOf(".")!==-1&&parseFloat(r)===1}function Pl(r){return typeof r=="string"&&r.indexOf("%")!==-1}function Tr(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function b2(r){return r<=1?"".concat(Number(r)*100,"%"):r}function Mn(r){return r.length===1?"0"+r:String(r)}function S8(r,t,e){return{r:u1(r,255)*255,g:u1(t,255)*255,b:u1(e,255)*255}}function x0(r,t,e){r=u1(r,255),t=u1(t,255),e=u1(e,255);var n=Math.max(r,t,e),o=Math.min(r,t,e),a=0,i=0,c=(n+o)/2;if(n===o)i=0,a=0;else{var s=n-o;switch(i=c>.5?s/(2-n-o):s/(n+o),n){case r:a=(t-e)/s+(t<e?6:0);break;case t:a=(e-r)/s+2;break;case e:a=(r-t)/s+4;break;default:break}a/=6}return{h:a,s:i,l:c}}function g0(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*(6*e):e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}function k8(r,t,e){var n,o,a;if(r=u1(r,360),t=u1(t,100),e=u1(e,100),t===0)o=e,a=e,n=e;else{var i=e<.5?e*(1+t):e+t-e*t,c=2*e-i;n=g0(c,i,r+1/3),o=g0(c,i,r),a=g0(c,i,r-1/3)}return{r:n*255,g:o*255,b:a*255}}function y2(r,t,e){r=u1(r,255),t=u1(t,255),e=u1(e,255);var n=Math.max(r,t,e),o=Math.min(r,t,e),a=0,i=n,c=n-o,s=n===0?0:c/n;if(n===o)a=0;else{switch(n){case r:a=(t-e)/c+(t<e?6:0);break;case t:a=(e-r)/c+2;break;case e:a=(r-t)/c+4;break;default:break}a/=6}return{h:a,s,v:i}}function H8(r,t,e){r=u1(r,360)*6,t=u1(t,100),e=u1(e,100);var n=Math.floor(r),o=r-n,a=e*(1-t),i=e*(1-o*t),c=e*(1-(1-o)*t),s=n%6,l=[e,i,a,a,c,e][s],u=[c,e,e,i,a,a][s],h=[a,a,c,e,e,i][s];return{r:l*255,g:u*255,b:h*255}}function w2(r,t,e,n){var o=[Mn(Math.round(r).toString(16)),Mn(Math.round(t).toString(16)),Mn(Math.round(e).toString(16))];return n&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function V8(r,t,e,n,o){var a=[Mn(Math.round(r).toString(16)),Mn(Math.round(t).toString(16)),Mn(Math.round(e).toString(16)),Mn(Wl(n))];return o&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))&&a[3].startsWith(a[3].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function Wl(r){return Math.round(parseFloat(r)*255).toString(16)}function b0(r){return K1(r)/255}function K1(r){return parseInt(r,16)}function T8(r){return{r:r>>16,g:(r&65280)>>8,b:r&255}}var z2={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function _n(r){var t={r:0,g:0,b:0},e=1,n=null,o=null,a=null,i=!1,c=!1;return typeof r=="string"&&(r=ql(r)),typeof r=="object"&&(Xt(r.r)&&Xt(r.g)&&Xt(r.b)?(t=S8(r.r,r.g,r.b),i=!0,c=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Xt(r.h)&&Xt(r.s)&&Xt(r.v)?(n=b2(r.s),o=b2(r.v),t=H8(r.h,n,o),i=!0,c="hsv"):Xt(r.h)&&Xt(r.s)&&Xt(r.l)&&(n=b2(r.s),a=b2(r.l),t=k8(r.h,n,a),i=!0,c="hsl"),Object.prototype.hasOwnProperty.call(r,"a")&&(e=r.a)),e=Tr(e),{ok:i,format:r.format||c,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}var Ul="[-\\+]?\\d+%?",Gl="[-\\+]?\\d*\\.\\d+%?",Cn="(?:".concat(Gl,")|(?:").concat(Ul,")"),y0="[\\s|\\(]+(".concat(Cn,")[,|\\s]+(").concat(Cn,")[,|\\s]+(").concat(Cn,")\\s*\\)?"),w0="[\\s|\\(]+(".concat(Cn,")[,|\\s]+(").concat(Cn,")[,|\\s]+(").concat(Cn,")[,|\\s]+(").concat(Cn,")\\s*\\)?"),mt={CSS_UNIT:new RegExp(Cn),rgb:new RegExp("rgb"+y0),rgba:new RegExp("rgba"+w0),hsl:new RegExp("hsl"+y0),hsla:new RegExp("hsla"+w0),hsv:new RegExp("hsv"+y0),hsva:new RegExp("hsva"+w0),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function ql(r){if(r=r.trim().toLowerCase(),r.length===0)return!1;var t=!1;if(z2[r])r=z2[r],t=!0;else if(r==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e=mt.rgb.exec(r);return e?{r:e[1],g:e[2],b:e[3]}:(e=mt.rgba.exec(r),e?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=mt.hsl.exec(r),e?{h:e[1],s:e[2],l:e[3]}:(e=mt.hsla.exec(r),e?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=mt.hsv.exec(r),e?{h:e[1],s:e[2],v:e[3]}:(e=mt.hsva.exec(r),e?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=mt.hex8.exec(r),e?{r:K1(e[1]),g:K1(e[2]),b:K1(e[3]),a:b0(e[4]),format:t?"name":"hex8"}:(e=mt.hex6.exec(r),e?{r:K1(e[1]),g:K1(e[2]),b:K1(e[3]),format:t?"name":"hex"}:(e=mt.hex4.exec(r),e?{r:K1(e[1]+e[1]),g:K1(e[2]+e[2]),b:K1(e[3]+e[3]),a:b0(e[4]+e[4]),format:t?"name":"hex8"}:(e=mt.hex3.exec(r),e?{r:K1(e[1]+e[1]),g:K1(e[2]+e[2]),b:K1(e[3]+e[3]),format:t?"name":"hex"}:!1)))))))))}function Xt(r){return!!mt.CSS_UNIT.exec(String(r))}var Lr=function(){function r(t,e){t===void 0&&(t=""),e===void 0&&(e={});var n;if(t instanceof r)return t;typeof t=="number"&&(t=T8(t)),this.originalInput=t;var o=_n(t);this.originalInput=t,this.r=o.r,this.g=o.g,this.b=o.b,this.a=o.a,this.roundA=Math.round(100*this.a)/100,this.format=(n=e.format)!==null&&n!==void 0?n:o.format,this.gradientType=e.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=o.ok}return r.prototype.isDark=function(){return this.getBrightness()<128},r.prototype.isLight=function(){return!this.isDark()},r.prototype.getBrightness=function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},r.prototype.getLuminance=function(){var t=this.toRgb(),e,n,o,a=t.r/255,i=t.g/255,c=t.b/255;return a<=.03928?e=a/12.92:e=Math.pow((a+.055)/1.055,2.4),i<=.03928?n=i/12.92:n=Math.pow((i+.055)/1.055,2.4),c<=.03928?o=c/12.92:o=Math.pow((c+.055)/1.055,2.4),.2126*e+.7152*n+.0722*o},r.prototype.getAlpha=function(){return this.a},r.prototype.setAlpha=function(t){return this.a=Tr(t),this.roundA=Math.round(100*this.a)/100,this},r.prototype.isMonochrome=function(){var t=this.toHsl().s;return t===0},r.prototype.toHsv=function(){var t=y2(this.r,this.g,this.b);return{h:t.h*360,s:t.s,v:t.v,a:this.a}},r.prototype.toHsvString=function(){var t=y2(this.r,this.g,this.b),e=Math.round(t.h*360),n=Math.round(t.s*100),o=Math.round(t.v*100);return this.a===1?"hsv(".concat(e,", ").concat(n,"%, ").concat(o,"%)"):"hsva(".concat(e,", ").concat(n,"%, ").concat(o,"%, ").concat(this.roundA,")")},r.prototype.toHsl=function(){var t=x0(this.r,this.g,this.b);return{h:t.h*360,s:t.s,l:t.l,a:this.a}},r.prototype.toHslString=function(){var t=x0(this.r,this.g,this.b),e=Math.round(t.h*360),n=Math.round(t.s*100),o=Math.round(t.l*100);return this.a===1?"hsl(".concat(e,", ").concat(n,"%, ").concat(o,"%)"):"hsla(".concat(e,", ").concat(n,"%, ").concat(o,"%, ").concat(this.roundA,")")},r.prototype.toHex=function(t){return t===void 0&&(t=!1),w2(this.r,this.g,this.b,t)},r.prototype.toHexString=function(t){return t===void 0&&(t=!1),"#"+this.toHex(t)},r.prototype.toHex8=function(t){return t===void 0&&(t=!1),V8(this.r,this.g,this.b,this.a,t)},r.prototype.toHex8String=function(t){return t===void 0&&(t=!1),"#"+this.toHex8(t)},r.prototype.toHexShortString=function(t){return t===void 0&&(t=!1),this.a===1?this.toHexString(t):this.toHex8String(t)},r.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},r.prototype.toRgbString=function(){var t=Math.round(this.r),e=Math.round(this.g),n=Math.round(this.b);return this.a===1?"rgb(".concat(t,", ").concat(e,", ").concat(n,")"):"rgba(".concat(t,", ").concat(e,", ").concat(n,", ").concat(this.roundA,")")},r.prototype.toPercentageRgb=function(){var t=function(e){return"".concat(Math.round(u1(e,255)*100),"%")};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},r.prototype.toPercentageRgbString=function(){var t=function(e){return Math.round(u1(e,255)*100)};return this.a===1?"rgb(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%)"):"rgba(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%, ").concat(this.roundA,")")},r.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var t="#"+w2(this.r,this.g,this.b,!1),e=0,n=Object.entries(z2);e<n.length;e++){var o=n[e],a=o[0],i=o[1];if(t===i)return a}return!1},r.prototype.toString=function(t){var e=!!t;t=t??this.format;var n=!1,o=this.a<1&&this.a>=0,a=!e&&o&&(t.startsWith("hex")||t==="name");return a?t==="name"&&this.a===0?this.toName():this.toRgbString():(t==="rgb"&&(n=this.toRgbString()),t==="prgb"&&(n=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(n=this.toHexString()),t==="hex3"&&(n=this.toHexString(!0)),t==="hex4"&&(n=this.toHex8String(!0)),t==="hex8"&&(n=this.toHex8String()),t==="name"&&(n=this.toName()),t==="hsl"&&(n=this.toHslString()),t==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},r.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},r.prototype.clone=function(){return new r(this.toString())},r.prototype.lighten=function(t){t===void 0&&(t=10);var e=this.toHsl();return e.l+=t/100,e.l=x2(e.l),new r(e)},r.prototype.brighten=function(t){t===void 0&&(t=10);var e=this.toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(t/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(t/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(t/100)))),new r(e)},r.prototype.darken=function(t){t===void 0&&(t=10);var e=this.toHsl();return e.l-=t/100,e.l=x2(e.l),new r(e)},r.prototype.tint=function(t){return t===void 0&&(t=10),this.mix("white",t)},r.prototype.shade=function(t){return t===void 0&&(t=10),this.mix("black",t)},r.prototype.desaturate=function(t){t===void 0&&(t=10);var e=this.toHsl();return e.s-=t/100,e.s=x2(e.s),new r(e)},r.prototype.saturate=function(t){t===void 0&&(t=10);var e=this.toHsl();return e.s+=t/100,e.s=x2(e.s),new r(e)},r.prototype.greyscale=function(){return this.desaturate(100)},r.prototype.spin=function(t){var e=this.toHsl(),n=(e.h+t)%360;return e.h=n<0?360+n:n,new r(e)},r.prototype.mix=function(t,e){e===void 0&&(e=50);var n=this.toRgb(),o=new r(t).toRgb(),a=e/100,i={r:(o.r-n.r)*a+n.r,g:(o.g-n.g)*a+n.g,b:(o.b-n.b)*a+n.b,a:(o.a-n.a)*a+n.a};return new r(i)},r.prototype.analogous=function(t,e){t===void 0&&(t=6),e===void 0&&(e=30);var n=this.toHsl(),o=360/e,a=[this];for(n.h=(n.h-(o*t>>1)+720)%360;--t;)n.h=(n.h+o)%360,a.push(new r(n));return a},r.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new r(t)},r.prototype.monochromatic=function(t){t===void 0&&(t=6);for(var e=this.toHsv(),n=e.h,o=e.s,a=e.v,i=[],c=1/t;t--;)i.push(new r({h:n,s:o,v:a})),a=(a+c)%1;return i},r.prototype.splitcomplement=function(){var t=this.toHsl(),e=t.h;return[this,new r({h:(e+72)%360,s:t.s,l:t.l}),new r({h:(e+216)%360,s:t.s,l:t.l})]},r.prototype.onBackground=function(t){var e=this.toRgb(),n=new r(t).toRgb(),o=e.a+n.a*(1-e.a);return new r({r:(e.r*e.a+n.r*n.a*(1-e.a))/o,g:(e.g*e.a+n.g*n.a*(1-e.a))/o,b:(e.b*e.a+n.b*n.a*(1-e.a))/o,a:o})},r.prototype.triad=function(){return this.polyad(3)},r.prototype.tetrad=function(){return this.polyad(4)},r.prototype.polyad=function(t){for(var e=this.toHsl(),n=e.h,o=[this],a=360/t,i=1;i<t;i++)o.push(new r({h:(n+i*a)%360,s:e.s,l:e.l}));return o},r.prototype.equals=function(t){return this.toRgbString()===new r(t).toRgbString()},r}();var Fr=2,L8=.16,jl=.05,$l=.05,Kl=.15,B8=5,R8=4,Xl=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function F8({r,g:t,b:e}){let n=y2(r,t,e);return{h:n.h*360,s:n.s,v:n.v}}function Ar({r,g:t,b:e}){return`#${w2(r,t,e,!1)}`}function Yl(r,t,e){let n=e/100;return{r:(t.r-r.r)*n+r.r,g:(t.g-r.g)*n+r.g,b:(t.b-r.b)*n+r.b}}function A8(r,t,e){let n;return Math.round(r.h)>=60&&Math.round(r.h)<=240?n=e?Math.round(r.h)-Fr*t:Math.round(r.h)+Fr*t:n=e?Math.round(r.h)+Fr*t:Math.round(r.h)-Fr*t,n<0?n+=360:n>=360&&(n-=360),n}function D8(r,t,e){if(r.h===0&&r.s===0)return r.s;let n;return e?n=r.s-L8*t:t===R8?n=r.s+L8:n=r.s+jl*t,n>1&&(n=1),e&&t===B8&&n>.1&&(n=.1),n<.06&&(n=.06),Number(n.toFixed(2))}function I8(r,t,e){let n;return e?n=r.v+$l*t:n=r.v-Kl*t,n>1&&(n=1),Number(n.toFixed(2))}function z0(r,t={}){let e=[],n=_n(r);for(let o=B8;o>0;o-=1){let a=F8(n),i=Ar(_n({h:A8(a,o,!0),s:D8(a,o,!0),v:I8(a,o,!0)}));e.push(i)}e.push(Ar(n));for(let o=1;o<=R8;o+=1){let a=F8(n),i=Ar(_n({h:A8(a,o),s:D8(a,o),v:I8(a,o)}));e.push(i)}return t.theme==="dark"?Xl.map(({index:o,opacity:a})=>Ar(Yl(_n(t.backgroundColor||"#141414"),_n(e[o]),a*100))):e}function M0(r){return r==null?"":typeof r=="string"?r:`${r}px`}function _0(r){return typeof r<"u"&&r!==null}function M2(r){return r instanceof mn}function Dr(r){return Wn(r,0)}function N8(r){return M0(r)}var Zl=typeof window<"u",dx=Zl&&window.mozInnerScreenX!=null;function E0(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Ql="rc-util-key";function P8({mark:r}={}){return r?r.startsWith("data-")?r:`data-${r}`:Ql}function S0(r){return r.attachTo?r.attachTo:document.querySelector("head")||document.body}function O8(r,t={}){if(!E0())return null;let e=document.createElement("style");t.cspNonce&&(e.nonce=t.cspNonce),e.innerHTML=r;let n=S0(t),{firstChild:o}=n;return t.prepend&&n.prepend?n.prepend(e):t.prepend&&o?n.insertBefore(e,o):n.appendChild(e),e}var C0=new Map;function Jl(r,t={}){let e=S0(t);return Array.from(C0.get(e)?.children||[]).find(n=>n.tagName==="STYLE"&&n.getAttribute(P8(t))===r)}function W8(r,t,e={}){let n=S0(e);if(!C0.has(n)){let i=O8("",e),{parentNode:c}=i;C0.set(n,c),c.removeChild(i)}let o=Jl(t,e);if(o)return e.cspNonce&&o.nonce!==e.cspNonce&&(o.nonce=e.cspNonce),o.innerHTML!==r&&(o.innerHTML=r),o;let a=O8(r,e);return a?.setAttribute(P8(e),t),a}function eu(r){return typeof Zone<"u"?Zone.root.run(r):r()}function U8(r,t,e){return r?new yr(n=>eu(()=>Q6(r,t,e).subscribe(n))):Z6}var tu=new F1("nz-config");var nu=`-ant-${Date.now()}-${Math.random()}`;function ru(r,t){let e={},n=(i,c)=>{let s=i.clone();return s=c?.(s)||s,s.toRgbString()},o=(i,c)=>{let s=new Lr(i),l=z0(s.toRgbString());e[`${c}-color`]=n(s),e[`${c}-color-disabled`]=l[1],e[`${c}-color-hover`]=l[4],e[`${c}-color-active`]=l[7],e[`${c}-color-outline`]=s.clone().setAlpha(.2).toRgbString(),e[`${c}-color-deprecated-bg`]=l[1],e[`${c}-color-deprecated-border`]=l[3]};if(t.primaryColor){o(t.primaryColor,"primary");let i=new Lr(t.primaryColor),c=z0(i.toRgbString());c.forEach((l,u)=>{e[`primary-${u+1}`]=l}),e["primary-color-deprecated-l-35"]=n(i,l=>l.lighten(35)),e["primary-color-deprecated-l-20"]=n(i,l=>l.lighten(20)),e["primary-color-deprecated-t-20"]=n(i,l=>l.tint(20)),e["primary-color-deprecated-t-50"]=n(i,l=>l.tint(50)),e["primary-color-deprecated-f-12"]=n(i,l=>l.setAlpha(l.getAlpha()*.12));let s=new Lr(c[0]);e["primary-color-active-deprecated-f-30"]=n(s,l=>l.setAlpha(l.getAlpha()*.3)),e["primary-color-active-deprecated-d-02"]=n(s,l=>l.darken(2))}return t.successColor&&o(t.successColor,"success"),t.warningColor&&o(t.warningColor,"warning"),t.errorColor&&o(t.errorColor,"error"),t.infoColor&&o(t.infoColor,"info"),`
  :root {
    ${Object.keys(e).map(i=>`--${r}-${i}: ${e[i]};`).join(`
`)}
  }
  `.trim()}function G8(r,t,e){let n=ru(r,t);E0()?W8(n,`${nu}-dynamic-theme`,{cspNonce:e}):m2("NzConfigService: SSR do not support dynamic theme with css variables.")}var q8=function(r){return r!==void 0},j8="ant",gt=(()=>{class r{configUpdated$=new t1;config=ye(tu,{optional:!0})||{};cspNonce=ye(zr,{optional:!0});constructor(){this.config.theme&&G8(this.getConfig().prefixCls?.prefixCls||j8,this.config.theme,this.cspNonce)}getConfig(){return this.config}getConfigForComponent(e){return this.config[e]}getConfigChangeEventForComponent(e){return this.configUpdated$.pipe(y4(n=>n===e),h2(()=>{}))}set(e,n){this.config[e]=et(et({},this.config[e]),n),e==="theme"&&this.config.theme&&G8(this.getConfig().prefixCls?.prefixCls||j8,this.config.theme,this.cspNonce),this.configUpdated$.next(e)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function D1(){return function(r,t){t.addInitializer(function(){let e=ye(gt),n=this[t.name],o,a=!1;Object.defineProperty(this,t.name,{get:()=>{let i=e.getConfigForComponent(this._nzModuleName)?.[t.name];return a?o:q8(i)?i:n},set:i=>{a=q8(i),o=i},enumerable:!0,configurable:!0})})}}var k0;try{k0=typeof Intl<"u"&&Intl.v8BreakIterator}catch{k0=!1}var _2=(()=>{class r{_platformId=ye(s8);isBrowser=this._platformId?y8(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||k0)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(n){return new(n||r)};static \u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var H0=(()=>{class r extends t1{ngOnDestroy(){this.next(),this.complete()}static \u0275fac=(()=>{let e;return function(o){return(e||(e=i8(r)))(o||r)}})();static \u0275prov=M1({token:r,factory:r.\u0275fac})}return r})();function Gn(r){"@babel/helpers - typeof";return Gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gn(r)}function $8(r,t){if(Gn(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(Gn(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function K8(r){var t=$8(r,"string");return Gn(t)=="symbol"?t:t+""}function ot(r,t,e){return(t=K8(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var v1=Math.round;function V0(r,t){let e=r.replace(/^[^(]*\((.*)/,"$1").replace(/\).*/,"").match(/\d*\.?\d+%?/g)||[],n=e.map(o=>parseFloat(o));for(let o=0;o<3;o+=1)n[o]=t(n[o]||0,e[o]||"",o);return e[3]?n[3]=e[3].includes("%")?n[3]/100:n[3]:n[3]=1,n}var X8=(r,t,e)=>e===0?r:r/100;function E2(r,t){let e=t||255;return r>e?e:r<0?0:r}var qn=class r{constructor(t){ot(this,"isValid",!0),ot(this,"r",0),ot(this,"g",0),ot(this,"b",0),ot(this,"a",1),ot(this,"_h",void 0),ot(this,"_s",void 0),ot(this,"_l",void 0),ot(this,"_v",void 0),ot(this,"_max",void 0),ot(this,"_min",void 0),ot(this,"_brightness",void 0);function e(o){return o[0]in t&&o[1]in t&&o[2]in t}if(t)if(typeof t=="string"){let a=function(i){return o.startsWith(i)};var n=a;let o=t.trim();/^#?[A-F\d]{3,8}$/i.test(o)?this.fromHexString(o):a("rgb")?this.fromRgbString(o):a("hsl")?this.fromHslString(o):(a("hsv")||a("hsb"))&&this.fromHsvString(o)}else if(t instanceof r)this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this._h=t._h,this._s=t._s,this._l=t._l,this._v=t._v;else if(e("rgb"))this.r=E2(t.r),this.g=E2(t.g),this.b=E2(t.b),this.a=typeof t.a=="number"?E2(t.a,1):1;else if(e("hsl"))this.fromHsl(t);else if(e("hsv"))this.fromHsv(t);else throw new Error("@ant-design/fast-color: unsupported input "+JSON.stringify(t))}setR(t){return this._sc("r",t)}setG(t){return this._sc("g",t)}setB(t){return this._sc("b",t)}setA(t){return this._sc("a",t,1)}setHue(t){let e=this.toHsv();return e.h=t,this._c(e)}getLuminance(){function t(a){let i=a/255;return i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}let e=t(this.r),n=t(this.g),o=t(this.b);return .2126*e+.7152*n+.0722*o}getHue(){if(typeof this._h>"u"){let t=this.getMax()-this.getMin();t===0?this._h=0:this._h=v1(60*(this.r===this.getMax()?(this.g-this.b)/t+(this.g<this.b?6:0):this.g===this.getMax()?(this.b-this.r)/t+2:(this.r-this.g)/t+4))}return this._h}getSaturation(){if(typeof this._s>"u"){let t=this.getMax()-this.getMin();t===0?this._s=0:this._s=t/this.getMax()}return this._s}getLightness(){return typeof this._l>"u"&&(this._l=(this.getMax()+this.getMin())/510),this._l}getValue(){return typeof this._v>"u"&&(this._v=this.getMax()/255),this._v}getBrightness(){return typeof this._brightness>"u"&&(this._brightness=(this.r*299+this.g*587+this.b*114)/1e3),this._brightness}darken(t=10){let e=this.getHue(),n=this.getSaturation(),o=this.getLightness()-t/100;return o<0&&(o=0),this._c({h:e,s:n,l:o,a:this.a})}lighten(t=10){let e=this.getHue(),n=this.getSaturation(),o=this.getLightness()+t/100;return o>1&&(o=1),this._c({h:e,s:n,l:o,a:this.a})}mix(t,e=50){let n=this._c(t),o=e/100,a=c=>(n[c]-this[c])*o+this[c],i={r:v1(a("r")),g:v1(a("g")),b:v1(a("b")),a:v1(a("a")*100)/100};return this._c(i)}tint(t=10){return this.mix({r:255,g:255,b:255,a:1},t)}shade(t=10){return this.mix({r:0,g:0,b:0,a:1},t)}onBackground(t){let e=this._c(t),n=this.a+e.a*(1-this.a),o=a=>v1((this[a]*this.a+e[a]*e.a*(1-this.a))/n);return this._c({r:o("r"),g:o("g"),b:o("b"),a:n})}isDark(){return this.getBrightness()<128}isLight(){return this.getBrightness()>=128}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}clone(){return this._c(this)}toHexString(){let t="#",e=(this.r||0).toString(16);t+=e.length===2?e:"0"+e;let n=(this.g||0).toString(16);t+=n.length===2?n:"0"+n;let o=(this.b||0).toString(16);if(t+=o.length===2?o:"0"+o,typeof this.a=="number"&&this.a>=0&&this.a<1){let a=v1(this.a*255).toString(16);t+=a.length===2?a:"0"+a}return t}toHsl(){return{h:this.getHue(),s:this.getSaturation(),l:this.getLightness(),a:this.a}}toHslString(){let t=this.getHue(),e=v1(this.getSaturation()*100),n=v1(this.getLightness()*100);return this.a!==1?`hsla(${t},${e}%,${n}%,${this.a})`:`hsl(${t},${e}%,${n}%)`}toHsv(){return{h:this.getHue(),s:this.getSaturation(),v:this.getValue(),a:this.a}}toRgb(){return{r:this.r,g:this.g,b:this.b,a:this.a}}toRgbString(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:`rgb(${this.r},${this.g},${this.b})`}toString(){return this.toRgbString()}_sc(t,e,n){let o=this.clone();return o[t]=E2(e,n),o}_c(t){return new this.constructor(t)}getMax(){return typeof this._max>"u"&&(this._max=Math.max(this.r,this.g,this.b)),this._max}getMin(){return typeof this._min>"u"&&(this._min=Math.min(this.r,this.g,this.b)),this._min}fromHexString(t){let e=t.replace("#","");function n(o,a){return parseInt(e[o]+e[a||o],16)}e.length<6?(this.r=n(0),this.g=n(1),this.b=n(2),this.a=e[3]?n(3)/255:1):(this.r=n(0,1),this.g=n(2,3),this.b=n(4,5),this.a=e[6]?n(6,7)/255:1)}fromHsl({h:t,s:e,l:n,a:o}){if(this._h=t%360,this._s=e,this._l=n,this.a=typeof o=="number"?o:1,e<=0){let f=v1(n*255);this.r=f,this.g=f,this.b=f}let a=0,i=0,c=0,s=t/60,l=(1-Math.abs(2*n-1))*e,u=l*(1-Math.abs(s%2-1));s>=0&&s<1?(a=l,i=u):s>=1&&s<2?(a=u,i=l):s>=2&&s<3?(i=l,c=u):s>=3&&s<4?(i=u,c=l):s>=4&&s<5?(a=u,c=l):s>=5&&s<6&&(a=l,c=u);let h=n-l/2;this.r=v1((a+h)*255),this.g=v1((i+h)*255),this.b=v1((c+h)*255)}fromHsv({h:t,s:e,v:n,a:o}){this._h=t%360,this._s=e,this._v=n,this.a=typeof o=="number"?o:1;let a=v1(n*255);if(this.r=a,this.g=a,this.b=a,e<=0)return;let i=t/60,c=Math.floor(i),s=i-c,l=v1(n*(1-e)*255),u=v1(n*(1-e*s)*255),h=v1(n*(1-e*(1-s))*255);switch(c){case 0:this.g=h,this.b=l;break;case 1:this.r=u,this.b=l;break;case 2:this.r=l,this.b=h;break;case 3:this.r=l,this.g=u;break;case 4:this.r=h,this.g=l;break;case 5:default:this.g=l,this.b=u;break}}fromHsvString(t){let e=V0(t,X8);this.fromHsv({h:e[0],s:e[1],v:e[2],a:e[3]})}fromHslString(t){let e=V0(t,X8);this.fromHsl({h:e[0],s:e[1],l:e[2],a:e[3]})}fromRgbString(t){let e=V0(t,(n,o)=>o.includes("%")?v1(n/100*255):n);this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3]}};var Ir=2,Y8=.16,au=.05,iu=.05,cu=.15,ea=5,ta=4,su=[{index:7,amount:15},{index:6,amount:25},{index:5,amount:30},{index:5,amount:45},{index:5,amount:65},{index:5,amount:85},{index:4,amount:90},{index:3,amount:95},{index:2,amount:97},{index:1,amount:98}];function Z8(r,t,e){var n;return Math.round(r.h)>=60&&Math.round(r.h)<=240?n=e?Math.round(r.h)-Ir*t:Math.round(r.h)+Ir*t:n=e?Math.round(r.h)+Ir*t:Math.round(r.h)-Ir*t,n<0?n+=360:n>=360&&(n-=360),n}function Q8(r,t,e){if(r.h===0&&r.s===0)return r.s;var n;return e?n=r.s-Y8*t:t===ta?n=r.s+Y8:n=r.s+au*t,n>1&&(n=1),e&&t===ea&&n>.1&&(n=.1),n<.06&&(n=.06),Math.round(n*100)/100}function J8(r,t,e){var n;return e?n=r.v+iu*t:n=r.v-cu*t,n=Math.max(0,Math.min(1,n)),Math.round(n*100)/100}function Br(r){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=[],n=new qn(r),o=n.toHsv(),a=ea;a>0;a-=1){var i=new qn({h:Z8(o,a,!0),s:Q8(o,a,!0),v:J8(o,a,!0)});e.push(i)}e.push(n);for(var c=1;c<=ta;c+=1){var s=new qn({h:Z8(o,c),s:Q8(o,c),v:J8(o,c)});e.push(s)}return t.theme==="dark"?su.map(function(l){var u=l.index,h=l.amount;return new qn(t.backgroundColor||"#141414").mix(e[u],h).toHexString()}):e.map(function(l){return l.toHexString()})}var na=["#fff1f0","#ffccc7","#ffa39e","#ff7875","#ff4d4f","#f5222d","#cf1322","#a8071a","#820014","#5c0011"];na.primary=na[5];var ra=["#fff2e8","#ffd8bf","#ffbb96","#ff9c6e","#ff7a45","#fa541c","#d4380d","#ad2102","#871400","#610b00"];ra.primary=ra[5];var oa=["#fff7e6","#ffe7ba","#ffd591","#ffc069","#ffa940","#fa8c16","#d46b08","#ad4e00","#873800","#612500"];oa.primary=oa[5];var aa=["#fffbe6","#fff1b8","#ffe58f","#ffd666","#ffc53d","#faad14","#d48806","#ad6800","#874d00","#613400"];aa.primary=aa[5];var ia=["#feffe6","#ffffb8","#fffb8f","#fff566","#ffec3d","#fadb14","#d4b106","#ad8b00","#876800","#614700"];ia.primary=ia[5];var ca=["#fcffe6","#f4ffb8","#eaff8f","#d3f261","#bae637","#a0d911","#7cb305","#5b8c00","#3f6600","#254000"];ca.primary=ca[5];var sa=["#f6ffed","#d9f7be","#b7eb8f","#95de64","#73d13d","#52c41a","#389e0d","#237804","#135200","#092b00"];sa.primary=sa[5];var la=["#e6fffb","#b5f5ec","#87e8de","#5cdbd3","#36cfc9","#13c2c2","#08979c","#006d75","#00474f","#002329"];la.primary=la[5];var ua=["#e6f4ff","#bae0ff","#91caff","#69b1ff","#4096ff","#1677ff","#0958d9","#003eb3","#002c8c","#001d66"];ua.primary=ua[5];var ha=["#f0f5ff","#d6e4ff","#adc6ff","#85a5ff","#597ef7","#2f54eb","#1d39c4","#10239e","#061178","#030852"];ha.primary=ha[5];var fa=["#f9f0ff","#efdbff","#d3adf7","#b37feb","#9254de","#722ed1","#531dab","#391085","#22075e","#120338"];fa.primary=fa[5];var da=["#fff0f6","#ffd6e7","#ffadd2","#ff85c0","#f759ab","#eb2f96","#c41d7f","#9e1068","#780650","#520339"];da.primary=da[5];var pa=["#a6a6a6","#999999","#8c8c8c","#808080","#737373","#666666","#404040","#1a1a1a","#000000","#000000"];pa.primary=pa[5];var va=["#2a1215","#431418","#58181c","#791a1f","#a61d24","#d32029","#e84749","#f37370","#f89f9a","#fac8c3"];va.primary=va[5];var ma=["#2b1611","#441d12","#592716","#7c3118","#aa3e19","#d84a1b","#e87040","#f3956a","#f8b692","#fad4bc"];ma.primary=ma[5];var ga=["#2b1d11","#442a11","#593815","#7c4a15","#aa6215","#d87a16","#e89a3c","#f3b765","#f8cf8d","#fae3b7"];ga.primary=ga[5];var xa=["#2b2111","#443111","#594214","#7c5914","#aa7714","#d89614","#e8b339","#f3cc62","#f8df8b","#faedb5"];xa.primary=xa[5];var ba=["#2b2611","#443b11","#595014","#7c6e14","#aa9514","#d8bd14","#e8d639","#f3ea62","#f8f48b","#fafab5"];ba.primary=ba[5];var ya=["#1f2611","#2e3c10","#3e4f13","#536d13","#6f9412","#8bbb11","#a9d134","#c9e75d","#e4f88b","#f0fab5"];ya.primary=ya[5];var wa=["#162312","#1d3712","#274916","#306317","#3c8618","#49aa19","#6abe39","#8fd460","#b2e58b","#d5f2bb"];wa.primary=wa[5];var za=["#112123","#113536","#144848","#146262","#138585","#13a8a8","#33bcb7","#58d1c9","#84e2d8","#b2f1e8"];za.primary=za[5];var Ma=["#111a2c","#112545","#15325b","#15417e","#1554ad","#1668dc","#3c89e8","#65a9f3","#8dc5f8","#b7dcfa"];Ma.primary=Ma[5];var Ca=["#131629","#161d40","#1c2755","#203175","#263ea0","#2b4acb","#5273e0","#7f9ef3","#a8c1f8","#d2e0fa"];Ca.primary=Ca[5];var _a=["#1a1325","#24163a","#301c4d","#3e2069","#51258f","#642ab5","#854eca","#ab7ae0","#cda8f0","#ebd7fa"];_a.primary=_a[5];var Ea=["#291321","#40162f","#551c3b","#75204f","#a02669","#cb2b83","#e0529c","#f37fb7","#f8a8cc","#fad2e3"];Ea.primary=Ea[5];var Sa=["#151515","#1f1f1f","#2d2d2d","#393939","#494949","#5a5a5a","#6a6a6a","#7b7b7b","#888888","#969696"];Sa.primary=Sa[5];var Yt="[@ant-design/icons-angular]:";function uu(r){console.error(`${Yt} ${r}.`)}function Va(r){x8()&&console.warn(`${Yt} ${r}.`)}function ka(r){return Br(r)[0]}function Rr(r,t){switch(t){case"fill":return`${r}-fill`;case"outline":return`${r}-o`;case"twotone":return`${r}-twotone`;case void 0:return r;default:throw new Error(`${Yt}Theme "${t}" is not a recognized theme!`)}}function hu(r,t,e,n){return`${Rr(r,t)}-${e}-${n}`}function fu(r){return r==="o"?"outline":r}function du(r){return r.endsWith("-fill")||r.endsWith("-o")||r.endsWith("-twotone")}function Ta(r){return typeof r=="object"&&typeof r.name=="string"&&(typeof r.theme=="string"||r.theme===void 0)&&typeof r.icon=="string"}function pu(r){let t=r.split("-"),e=fu(t.splice(t.length-1,1)[0]);return{name:t.join("-"),theme:e,icon:""}}function vu(r){return r.cloneNode(!0)}function mu(r){return r.replace(/['"]#333['"]/g,'"primaryColor"').replace(/['"]#E6E6E6['"]/g,'"secondaryColor"').replace(/['"]#D9D9D9['"]/g,'"secondaryColor"').replace(/['"]#D8D8D8['"]/g,'"secondaryColor"')}function Or(r){let t=r.split(":");switch(t.length){case 1:return[r,""];case 2:return[t[1],t[0]];default:throw new Error(`${Yt}The icon type ${r} is not valid!`)}}function gu(r){return Or(r)[1]!==""}function xu(){return new Error(`${Yt}Type should have a namespace. Try "namespace:${name}".`)}function Ha(r){return new Error(`${Yt}the icon ${r} does not exist or is not registered.`)}function bu(){return uu('you need to import "HttpClientModule" to use dynamic importing.'),null}function yu(r){return new Error(`${Yt}The url "${r}" is unsafe.`)}function wu(){return new Error(`${Yt}<svg> tag not found.`)}function zu(){return new Error(`${Yt}Importing timeout error.`)}var Mu="__ant_icon_load",Cu=new F1("ant_icons"),T0=(()=>{class r{set twoToneColor({primaryColor:e,secondaryColor:n}){this._twoToneColorPalette.primaryColor=e,this._twoToneColorPalette.secondaryColor=n||ka(e)}get twoToneColor(){return et({},this._twoToneColorPalette)}get _disableDynamicLoading(){return!1}constructor(e,n,o,a,i){this._rendererFactory=e,this._handler=n,this._document=o,this.sanitizer=a,this._antIcons=i,this.defaultTheme="outline",this._svgDefinitions=new Map,this._svgRenderedDefinitions=new Map,this._inProgressFetches=new Map,this._assetsUrlRoot="",this._twoToneColorPalette={primaryColor:"#333333",secondaryColor:"#E6E6E6"},this._enableJsonpLoading=!1,this._jsonpIconLoad$=new t1,this._renderer=this._rendererFactory.createRenderer(null,null),this._handler&&(this._http=new z8(this._handler)),this._antIcons&&this.addIcon(...this._antIcons)}useJsonpLoading(){this._enableJsonpLoading?Va("You are already using jsonp loading."):(this._enableJsonpLoading=!0,window[Mu]=e=>{this._jsonpIconLoad$.next(e)})}changeAssetsSource(e){this._assetsUrlRoot=e.endsWith("/")?e:e+"/"}addIcon(...e){e.forEach(n=>{this._svgDefinitions.set(Rr(n.name,n.theme),n)})}addIconLiteral(e,n){let[o,a]=Or(e);if(!a)throw xu();this.addIcon({name:e,icon:n})}clear(){this._svgDefinitions.clear(),this._svgRenderedDefinitions.clear()}getRenderedContent(e,n){let o=Ta(e)?e:this._svgDefinitions.get(e)||null;if(!o&&this._disableDynamicLoading)throw Ha(e);return(o?u2(o):this._loadIconDynamically(e)).pipe(h2(i=>{if(!i)throw Ha(e);return this._loadSVGFromCacheOrCreateNew(i,n)}))}getCachedIcons(){return this._svgDefinitions}_loadIconDynamically(e){if(!this._http&&!this._enableJsonpLoading)return u2(bu());let n=this._inProgressFetches.get(e);if(!n){let[o,a]=Or(e),i=a?{name:e,icon:""}:pu(o),c=this._enableJsonpLoading?".js":".svg",s=(a?`${this._assetsUrlRoot}assets/${a}/${o}`:`${this._assetsUrlRoot}assets/${i.theme}/${i.name}`)+c,l=this.sanitizer.sanitize(u8.URL,s);if(!l)throw yu(s);n=(this._enableJsonpLoading?this._loadIconDynamicallyWithJsonp(i,l):this._http.get(l,{responseType:"text"}).pipe(h2(h=>br(et({},i),{icon:h})))).pipe(o8(h=>this.addIcon(h)),t8(()=>this._inProgressFetches.delete(e)),J6(()=>u2(null)),n8()),this._inProgressFetches.set(e,n)}return n}_loadIconDynamicallyWithJsonp(e,n){return new yr(o=>{let a=this._document.createElement("script"),i=setTimeout(()=>{c(),o.error(zu())},6e3);a.src=n;function c(){a.parentNode.removeChild(a),clearTimeout(i)}this._document.body.appendChild(a),this._jsonpIconLoad$.pipe(y4(s=>s.name===e.name&&s.theme===e.theme),e8(1)).subscribe(s=>{o.next(s),c()})})}_loadSVGFromCacheOrCreateNew(e,n){let o,a=n||this._twoToneColorPalette.primaryColor,i=ka(a)||this._twoToneColorPalette.secondaryColor,c=e.theme==="twotone"?hu(e.name,e.theme,a,i):e.theme===void 0?e.name:Rr(e.name,e.theme),s=this._svgRenderedDefinitions.get(c);return s?o=s.icon:(o=this._setSVGAttribute(this._colorizeSVGIcon(this._createSVGElementFromString(gu(e.name)?e.icon:mu(e.icon)),e.theme==="twotone",a,i)),this._svgRenderedDefinitions.set(c,br(et({},e),{icon:o}))),vu(o)}_createSVGElementFromString(e){let n=this._document.createElement("div");n.innerHTML=e;let o=n.querySelector("svg");if(!o)throw wu;return o}_setSVGAttribute(e){return this._renderer.setAttribute(e,"width","1em"),this._renderer.setAttribute(e,"height","1em"),e}_colorizeSVGIcon(e,n,o,a){if(n){let i=e.childNodes,c=i.length;for(let s=0;s<c;s++){let l=i[s];l.getAttribute("fill")==="secondaryColor"?this._renderer.setAttribute(l,"fill",a):this._renderer.setAttribute(l,"fill",o)}}return this._renderer.setAttribute(e,"fill","currentColor"),e}static{this.\u0275fac=function(n){return new(n||r)(s1(Rn),s1(Sr,8),s1(zn,8),s1(kr),s1(Cu,8))}}static{this.\u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function _u(r,t){return r.type===t.type&&r.theme===t.theme&&r.twoToneColor===t.twoToneColor}var La=(()=>{class r{constructor(e){this._iconService=e,this._elementRef=ye(nt),this._renderer=ye(gn)}ngOnChanges(e){(e.type||e.theme||e.twoToneColor)&&this._changeIcon()}_changeIcon(){return new Promise(e=>{if(!this.type){this._clearSVGElement(),e(null);return}let n=this._getSelfRenderMeta();this._iconService.getRenderedContent(this._parseIconType(this.type,this.theme),this.twoToneColor).subscribe(o=>{let a=this._getSelfRenderMeta();_u(n,a)?(this._setSVGElement(o),e(o)):e(null)})})}_getSelfRenderMeta(){return{type:this.type,theme:this.theme,twoToneColor:this.twoToneColor}}_parseIconType(e,n){if(Ta(e))return e;{let[o,a]=Or(e);return a?e:du(o)?(n&&Va(`'type' ${o} already gets a theme inside so 'theme' ${n} would be ignored`),o):Rr(o,n||this._iconService.defaultTheme)}}_setSVGElement(e){this._clearSVGElement(),this._renderer.appendChild(this._elementRef.nativeElement,e)}_clearSVGElement(){let e=this._elementRef.nativeElement,n=e.childNodes,o=n.length;for(let a=o-1;a>=0;a--){let i=n[a];i.tagName?.toLowerCase()==="svg"&&this._renderer.removeChild(e,i)}}static{this.\u0275fac=function(n){return new(n||r)(ve(T0))}}static{this.\u0275dir=n1({type:r,selectors:[["","antIcon",""]],inputs:{type:"type",theme:"theme",twoToneColor:"twoToneColor"},features:[l1]})}}return r})();var Fa={name:"bars",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z" /></svg>'};var Aa={name:"calendar",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z" /></svg>'};var Da={name:"caret-down",theme:"fill",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z" /></svg>'};var Ia={name:"caret-up",theme:"fill",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z" /></svg>'};var Ba={name:"caret-down",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z" /></svg>'};var Ra={name:"check",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z" /></svg>'};var Oa={name:"caret-up",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z" /></svg>'},Na={name:"clock-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z" /></svg>'};var Pa={name:"close-circle",theme:"fill",icon:'<svg fill-rule="evenodd" viewBox="64 64 896 896" focusable="false"><path d="M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z" /></svg>'};var Wa={name:"close",theme:"outline",icon:'<svg fill-rule="evenodd" viewBox="64 64 896 896" focusable="false"><path d="M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z" /></svg>'},Ua={name:"close-circle",theme:"outline",icon:'<svg fill-rule="evenodd" viewBox="64 64 896 896" focusable="false"><path d="M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z" /></svg>'};var Ga={name:"check-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z" /><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /></svg>'};var qa={name:"check-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z" /></svg>'};var ja={name:"copy",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z" /></svg>'};var $a={name:"delete",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z" /></svg>'};var Ka={name:"double-left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z" /></svg>'};var Xa={name:"double-right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z" /></svg>'};var Ya={name:"down",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z" /></svg>'};var Za={name:"ellipsis",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z" /></svg>'};var Qa={name:"exclamation-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z" /></svg>'};var Ja={name:"exclamation-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z" /></svg>'},ei={name:"eye",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z" /></svg>'};var ti={name:"download",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z" /></svg>'};var ni={name:"file",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M854.6 288.7c6 6 9.4 14.1 9.4 22.6V928c0 17.7-14.3 32-32 32H192c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32h424.7c8.5 0 16.7 3.4 22.7 9.4l215.2 215.3zM790.2 326L602 137.8V326h188.2z" /></svg>'};var ri={name:"file",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z" /></svg>'};var oi={name:"filter",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M349 838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V642H349v196zm531.1-684H143.9c-24.5 0-39.8 26.7-27.5 48l221.3 376h348.8l221.3-376c12.1-21.3-3.2-48-27.7-48z" /></svg>'};var ai={name:"folder",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z" /></svg>'};var ii={name:"edit",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z" /></svg>'};var ci={name:"info-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z" /></svg>'};var si={name:"loading",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z" /></svg>'};var li={name:"left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z" /></svg>'};var ui={name:"paper-clip",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z" /></svg>'};var hi={name:"play-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z" /></svg>'};var fi={name:"question-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0130.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1080 0 40 40 0 10-80 0z" /></svg>'};var di={name:"right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z" /></svg>'};var pi={name:"rotate-right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><defs><style /></defs><path d="M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z" /><path d="M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z" /></svg>'};var vi={name:"rotate-left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><defs><style /></defs><path d="M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z" /><path d="M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z" /></svg>'};var mi={name:"search",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z" /></svg>'},gi={name:"star",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z" /></svg>'},L0={name:"star",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z" /></svg>'};var xi={name:"swap",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z" /></svg>'};var bi={name:"info-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z" /></svg>'};var yi={name:"swap-right",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z" /></svg>'};var wi={name:"up",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z" /></svg>'};var zi={name:"upload",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z" /></svg>'};var Mi={name:"vertical-align-top",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z" /></svg>'};var Ci={name:"zoom-out",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z" /></svg>'},_i={name:"zoom-in",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z" /></svg>'};var Eu=[Fa,Aa,Ia,Oa,Da,Ba,qa,Ga,Ra,Na,Ua,Pa,Wa,ja,$a,Ka,Xa,Ya,ii,Za,Ja,Qa,ei,ni,ri,oi,bi,ci,li,si,ui,fi,di,pi,vi,L0,mi,L0,zi,Mi,wi,xi,yi,_i,Ci],Si=new F1("nz_icons"),_b=new F1("nz_icon_default_twotone_color"),Ei="#1890ff",Nr=(()=>{class r extends T0{nzConfigService;platform;configUpdated$=new t1;get _disableDynamicLoading(){return!this.platform.isBrowser}iconfontCache=new Set;subscription=null;ngOnDestroy(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}normalizeSvgElement(e){e.getAttribute("viewBox")||this._renderer.setAttribute(e,"viewBox","0 0 1024 1024"),(!e.getAttribute("width")||!e.getAttribute("height"))&&(this._renderer.setAttribute(e,"width","1em"),this._renderer.setAttribute(e,"height","1em")),e.getAttribute("fill")||this._renderer.setAttribute(e,"fill","currentColor")}fetchFromIconfont(e){let{scriptUrl:n}=e;if(this._document&&!this.iconfontCache.has(n)){let o=this._renderer.createElement("script");this._renderer.setAttribute(o,"src",n),this._renderer.setAttribute(o,"data-namespace",n.replace(/^(https?|http):/g,"")),this._renderer.appendChild(this._document.body,o),this.iconfontCache.add(n)}}createIconfontIcon(e){return this._createSVGElementFromString(`<svg><use xlink:href="${e}"></svg>`)}constructor(e,n,o,a){super(e,ye(Sr,{optional:!0}),ye(zn),n,[...Eu,...ye(Si,{optional:!0})||[]]),this.nzConfigService=o,this.platform=a,this.onConfigChange(),this.configDefaultTwotoneColor(),this.configDefaultTheme()}onConfigChange(){this.subscription=this.nzConfigService.getConfigChangeEventForComponent("icon").subscribe(()=>{this.configDefaultTwotoneColor(),this.configDefaultTheme(),this.configUpdated$.next()})}configDefaultTheme(){let e=this.getConfig();this.defaultTheme=e.nzTheme||"outline"}configDefaultTwotoneColor(){let n=this.getConfig().nzTwotoneColor||Ei,o=Ei;n&&(n.startsWith("#")?o=n:m2("Twotone color must be a hex color!")),this.twoToneColor={primaryColor:o}}getConfig(){return this.nzConfigService.getConfigForComponent("icon")||{}}static \u0275fac=function(n){return new(n||r)(s1(Rn),s1(kr),s1(gt),s1(_2))};static \u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),ki=new F1("nz_icons_patch"),Hi=(()=>{class r{rootIconService;patched=!1;extraIcons=ye(ki,{self:!0});constructor(e){this.rootIconService=e}doPatch(){this.patched||(this.extraIcons.forEach(e=>this.rootIconService.addIcon(e)),this.patched=!0)}static \u0275fac=function(n){return new(n||r)(s1(Nr))};static \u0275prov=M1({token:r,factory:r.\u0275fac})}return r})(),At=(()=>{class r extends La{ngZone;changeDetectorRef;iconService;renderer;cacheClassName=null;set nzSpin(e){this.spin=e}nzRotate=0;set nzType(e){this.type=e}set nzTheme(e){this.theme=e}set nzTwotoneColor(e){this.twoToneColor=e}set nzIconfont(e){this.iconfont=e}hostClass;el;iconfont;spin=!1;destroy$=new t1;constructor(e,n,o,a){super(o),this.ngZone=e,this.changeDetectorRef=n,this.iconService=o,this.renderer=a;let i=ye(Hi,{optional:!0});i&&i.doPatch(),this.el=this._elementRef.nativeElement}ngOnChanges(e){let{nzType:n,nzTwotoneColor:o,nzSpin:a,nzTheme:i,nzRotate:c}=e;n||o||a||i?this.changeIcon2():c?this.handleRotate(this.el.firstChild):this._setSVGElement(this.iconService.createIconfontIcon(`#${this.iconfont}`))}ngAfterContentChecked(){if(!this.type){let e=this.el.children,n=e.length;if(!this.type&&e.length)for(;n--;){let o=e[n];o.tagName.toLowerCase()==="svg"&&this.iconService.normalizeSvgElement(o)}}}ngOnDestroy(){this.destroy$.next()}changeIcon2(){this.setClassName(),this.ngZone.runOutsideAngular(()=>{d0(this._changeIcon()).pipe(z1(this.destroy$)).subscribe({next:e=>{this.ngZone.run(()=>{this.changeDetectorRef.detectChanges(),e&&(this.setSVGData(e),this.handleSpin(e),this.handleRotate(e))})},error:m2})})}handleSpin(e){this.spin||this.type==="loading"?this.renderer.addClass(e,"anticon-spin"):this.renderer.removeClass(e,"anticon-spin")}handleRotate(e){this.nzRotate?this.renderer.setAttribute(e,"style",`transform: rotate(${this.nzRotate}deg)`):this.renderer.removeAttribute(e,"style")}setClassName(){this.cacheClassName&&this.renderer.removeClass(this.el,this.cacheClassName),this.cacheClassName=`anticon-${this.type}`,this.renderer.addClass(this.el,this.cacheClassName)}setSVGData(e){this.renderer.setAttribute(e,"data-icon",this.type),this.renderer.setAttribute(e,"aria-hidden","true")}static \u0275fac=function(n){return new(n||r)(ve(Bn),ve($1),ve(Nr),ve(gn))};static \u0275dir=n1({type:r,selectors:[["nz-icon"],["","nz-icon",""]],hostAttrs:[1,"anticon"],inputs:{nzSpin:[2,"nzSpin","nzSpin",r1],nzRotate:[2,"nzRotate","nzRotate",Wn],nzType:"nzType",nzTheme:"nzTheme",nzTwotoneColor:"nzTwotoneColor",nzIconfont:"nzIconfont"},exportAs:["nzIcon"],features:[f8,l1]})}return r})(),Su=r=>w4([{provide:Si,useValue:r}]),ku=r=>[Hi,{provide:ki,useValue:r}],Zt=(()=>{class r{static forRoot(e){return{ngModule:r,providers:[Su(e)]}}static forChild(e){return{ngModule:r,providers:[ku(e)]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({})}return r})();var Hu=new F1("cdk-dir-doc",{providedIn:"root",factory:Vu});function Vu(){return ye(zn)}var Tu=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Vi(r){let t=r?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?Tu.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var xt=(()=>{class r{value="ltr";change=new c8;constructor(){let e=ye(Hu,{optional:!0});if(e){let n=e.body?e.body.dir:null,o=e.documentElement?e.documentElement.dir:null;this.value=Vi(n||o||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ti=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({})}return r})();function F0(r,t){let e=!t?.manualCleanup;e&&!t?.injector&&a8(F0);let n=e?t?.injector?.get(v0)??ye(v0):null,o=Lu(t?.equal),a;t?.requireSync?a=P1({kind:0},{equal:o}):a=P1({kind:1,value:t?.initialValue},{equal:o});let i=r.subscribe({next:c=>a.set({kind:1,value:c}),error:c=>{if(t?.rejectErrors)throw c;a.set({kind:2,error:c})}});if(t?.requireSync&&a().kind===0)throw new p0(601,!1);return n?.onDestroy(i.unsubscribe.bind(i)),wn(()=>{let c=a();switch(c.kind){case 1:return c.value;case 2:throw c.error;case 0:throw new p0(601,!1)}},{equal:t?.equal})}function Lu(r=Object.is){return(t,e)=>t.kind===1&&e.kind===1&&r(t.value,e.value)}var Qt=(()=>{class r{viewContainer;templateRef;embeddedViewRef=null;context=new A0;nzStringTemplateOutletContext=null;nzStringTemplateOutlet=null;static ngTemplateContextGuard(e,n){return!0}recreateView(){this.viewContainer.clear(),M2(this.nzStringTemplateOutlet)?this.embeddedViewRef=this.viewContainer.createEmbeddedView(this.nzStringTemplateOutlet,this.nzStringTemplateOutletContext):this.embeddedViewRef=this.viewContainer.createEmbeddedView(this.templateRef,this.context)}updateContext(){let e=M2(this.nzStringTemplateOutlet)?this.nzStringTemplateOutletContext:this.context,n=this.embeddedViewRef.context;if(e)for(let o of Object.keys(e))n[o]=e[o]}constructor(e,n){this.viewContainer=e,this.templateRef=n}ngOnChanges(e){let{nzStringTemplateOutletContext:n,nzStringTemplateOutlet:o}=e,a=()=>{let c=!1;return o&&(c=o.firstChange||M2(o.previousValue)||M2(o.currentValue)),n&&(u=>{let h=Object.keys(u.previousValue||{}),f=Object.keys(u.currentValue||{});if(h.length===f.length){for(let d of f)if(h.indexOf(d)===-1)return!0;return!1}else return!0})(n)||c};o&&(this.context.$implicit=o.currentValue),a()?this.recreateView():this.updateContext()}static \u0275fac=function(n){return new(n||r)(ve(h8),ve(mn))};static \u0275dir=n1({type:r,selectors:[["","nzStringTemplateOutlet",""]],inputs:{nzStringTemplateOutletContext:"nzStringTemplateOutletContext",nzStringTemplateOutlet:"nzStringTemplateOutlet"},exportAs:["nzStringTemplateOutlet"],features:[l1]})}return r})(),A0=class{$implicit},jn=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({})}return r})();var Fi=["*"],Fu=r=>({$implicit:r});function Au(r,t){if(r&1&&_1(0),r&2){let e=re(3);Pn(e.nzSplit)}}function Du(r,t){if(r&1&&(ue(0,"span",3),ie(1,Au,1,1,"ng-template",4),se()),r&2){let e=re(),n=e.$index,o=e.$count,a=re();rt("margin-block-end",a.nzDirection==="vertical"?n===o-1?null:a.spaceSize:null,"px")("margin-inline-end",a.nzDirection==="horizontal"?n===o-1?null:a.spaceSize:null,"px"),ee(),Se("nzStringTemplateOutlet",a.nzSplit)("nzStringTemplateOutletContext",Er(6,Fu,n))}}function Iu(r,t){if(r&1&&(ue(0,"div",0),p8(1,1),se(),ie(2,Du,2,8,"span",2)),r&2){let e=t.$implicit,n=t.$index,o=t.$count,a=re();rt("margin-block-end",a.nzDirection==="vertical"?n===o-1?null:a.spaceSize:null,"px")("margin-inline-end",a.nzDirection==="horizontal"?n===o-1?null:a.spaceSize:null,"px"),ee(),Se("ngTemplateOutlet",e),ee(),fe(a.nzSplit&&n!==o-1?2:-1)}}var B0=new F1("NZ_SPACE_COMPACT_SIZE"),Ai=new F1("NZ_SPACE_COMPACT_ITEMS"),R0=new F1("NZ_SPACE_COMPACT_ITEM_TYPE"),Bu=(()=>{class r{nzBlock=wr(!1,{transform:r1});nzDirection=wr("horizontal");nzSize=wr("default");elementRef=ye(nt);static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-space-compact"]],hostAttrs:[1,"ant-space-compact"],hostVars:4,hostBindings:function(n,o){n&2&&C1("ant-space-compact-block",o.nzBlock())("ant-space-compact-vertical",o.nzDirection()==="vertical")},inputs:{nzBlock:[1,"nzBlock"],nzDirection:[1,"nzDirection"],nzSize:[1,"nzSize"]},exportAs:["nzSpaceCompact"],features:[v2([{provide:B0,useFactory:()=>ye(r).nzSize},{provide:Ai,useFactory:()=>P1([])}])],ngContentSelectors:Fi,decls:1,vars:0,template:function(n,o){n&1&&(ut(),A1(0))},encapsulation:2,changeDetection:0})}return r})(),Di=(()=>{class r{spaceCompactCmp=ye(Bu,{host:!0,optional:!0});items=ye(Ai,{host:!0,optional:!0});type=ye(R0);elementRef=ye(nt);directionality=ye(xt);dir=F0(this.directionality.change,{initialValue:this.directionality.value});get parentElement(){return this.elementRef.nativeElement?.parentElement}class=wn(()=>{if(!this.spaceCompactCmp||!this.items||this.parentElement!==this.spaceCompactCmp.elementRef.nativeElement)return null;let e=this.items(),n=this.spaceCompactCmp.nzDirection(),o=[Ru(this.type,n,this.dir()==="rtl")],a=e.indexOf(this),i=e.findIndex(c=>c);return a===i?o.push(Ou(this.type,n)):a===e.length-1&&o.push(Nu(this.type,n)),o});constructor(){!this.spaceCompactCmp||!this.items||l8(()=>{if(this.parentElement===this.spaceCompactCmp.elementRef.nativeElement){let e=Array.from(this.parentElement.children).indexOf(this.elementRef.nativeElement);this.items.update(n=>{let o=n.slice();return o.splice(e,0,this),o})}})}ngOnDestroy(){this.items?.update(e=>e.filter(n=>n!==this))}static \u0275fac=function(n){return new(n||r)};static \u0275dir=n1({type:r,hostVars:2,hostBindings:function(n,o){n&2&&Mr(o.class())},exportAs:["nzSpaceCompactItem"]})}return r})();function O0(r,t,e){return`ant-${r}-compact-${t==="vertical"?"vertical-":""}${e}`}function Ru(r,t,e){let n=e?"-rtl":"";return`${O0(r,t,"item")}${n}`}function Ou(r,t){return O0(r,t,"first-item")}function Nu(r,t){return O0(r,t,"last-item")}var Pu=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275dir=n1({type:r,selectors:[["","nzSpaceItem",""]]})}return r})(),Wu="space",Li={small:8,middle:16,large:24},oy=(()=>{let r,t=[],e=[];return class I0{static{let o=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;r=[D1()],L1(null,null,r,{kind:"field",name:"nzSize",static:!1,private:!1,access:{has:a=>"nzSize"in a,get:a=>a.nzSize,set:(a,i)=>{a.nzSize=i}},metadata:o},t,e),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}nzConfigService;cdr;_nzModuleName=Wu;nzDirection="horizontal";nzAlign;nzSplit=null;nzWrap=!1;nzSize=De(this,t,"small");items=De(this,e);mergedAlign;spaceSize=Li.small;destroy$=new t1;constructor(o,a){this.nzConfigService=o,this.cdr=a}updateSpaceItems(){let o=typeof this.nzSize=="string"?Li[this.nzSize]:this.nzSize;this.spaceSize=o/(this.nzSplit?2:1),this.cdr.markForCheck()}ngOnChanges(){this.updateSpaceItems(),this.mergedAlign=this.nzAlign===void 0&&this.nzDirection==="horizontal"?"center":this.nzAlign}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}ngAfterContentInit(){this.updateSpaceItems(),this.items.changes.pipe(z1(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}static \u0275fac=function(a){return new(a||I0)(ve(gt),ve($1))};static \u0275cmp=Je({type:I0,selectors:[["nz-space"],["","nz-space",""]],contentQueries:function(a,i,c){if(a&1&&Nn(c,Pu,4,mn),a&2){let s;bn(s=yn())&&(i.items=s)}},hostAttrs:[1,"ant-space"],hostVars:14,hostBindings:function(a,i){a&2&&(rt("flex-wrap",i.nzWrap?"wrap":null),C1("ant-space-horizontal",i.nzDirection==="horizontal")("ant-space-vertical",i.nzDirection==="vertical")("ant-space-align-start",i.mergedAlign==="start")("ant-space-align-end",i.mergedAlign==="end")("ant-space-align-center",i.mergedAlign==="center")("ant-space-align-baseline",i.mergedAlign==="baseline"))},inputs:{nzDirection:"nzDirection",nzAlign:"nzAlign",nzSplit:"nzSplit",nzWrap:[2,"nzWrap","nzWrap",r1],nzSize:"nzSize"},exportAs:["nzSpace"],features:[l1],ngContentSelectors:Fi,decls:3,vars:0,consts:[[1,"ant-space-item"],[3,"ngTemplateOutlet"],[1,"ant-space-split",3,"margin-block-end","margin-inline-end"],[1,"ant-space-split"],[3,"nzStringTemplateOutlet","nzStringTemplateOutletContext"]],template:function(a,i){a&1&&(ut(),A1(0),Lt(1,Iu,3,6,null,null,Cr)),a&2&&(ee(),Ft(i.items))},dependencies:[Un,Qt],encapsulation:2,changeDetection:0})}})();var Ii=(()=>{class r{elementRef;renderer;hidden=null;setHiddenAttribute(){this.hidden?typeof this.hidden=="string"?this.renderer.setAttribute(this.elementRef.nativeElement,"hidden",this.hidden):this.renderer.setAttribute(this.elementRef.nativeElement,"hidden",""):this.renderer.removeAttribute(this.elementRef.nativeElement,"hidden")}constructor(e,n){this.elementRef=e,this.renderer=n,this.renderer.setAttribute(this.elementRef.nativeElement,"hidden","")}ngOnChanges(){this.setHiddenAttribute()}ngAfterViewInit(){this.setHiddenAttribute()}static \u0275fac=function(n){return new(n||r)(ve(nt),ve(gn))};static \u0275dir=n1({type:r,selectors:[["","nz-button",""],["nz-button-group"],["","nz-icon",""],["nz-icon"],["","nz-menu-item",""],["","nz-submenu",""],["nz-select-top-control"],["nz-select-placeholder"],["nz-input-group"]],inputs:{hidden:"hidden"},features:[l1]})}return r})(),Bi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({})}return r})();var qu=(()=>{class r extends Vr{constructor(e,n,o){super(e,n,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||r)(s1(zn),s1(g2),s1(Hr))};static \u0275prov=M1({token:r,factory:r.\u0275fac})}return r})();function ju(){return new C8}function $u(r,t,e){return new E8(r,t,e)}var Ri=[{provide:Hr,useFactory:ju},{provide:Vr,useClass:qu},{provide:Rn,useFactory:$u,deps:[w8,Vr,Bn]}],py=[{provide:g2,useClass:M8},{provide:z4,useValue:"NoopAnimations"},...Ri],vy=[{provide:g2,useFactory:()=>new _8},{provide:z4,useFactory:()=>"BrowserAnimations"},...Ri];var N0=class{triggerElement;ngZone;insertExtraNode;platform;cspNonce;waveTransitionDuration=400;styleForPseudo=null;extraNode=null;lastTime=0;clickHandler;get waveAttributeName(){return this.insertExtraNode?"ant-click-animating":"ant-click-animating-without-extra-node"}constructor(t,e,n,o,a){this.triggerElement=t,this.ngZone=e,this.insertExtraNode=n,this.platform=o,this.cspNonce=a,this.clickHandler=this.onClick.bind(this),this.bindTriggerEvent()}onClick=t=>{!this.triggerElement||!this.triggerElement.getAttribute||this.triggerElement.getAttribute("disabled")||t.target.tagName==="INPUT"||this.triggerElement.className.indexOf("disabled")>=0||this.fadeOutWave()};bindTriggerEvent(){this.platform.isBrowser&&this.ngZone.runOutsideAngular(()=>{this.removeTriggerEvent(),this.triggerElement&&this.triggerElement.addEventListener("click",this.clickHandler,!0)})}removeTriggerEvent(){this.triggerElement&&this.triggerElement.removeEventListener("click",this.clickHandler,!0)}removeStyleAndExtraNode(){this.styleForPseudo&&document.body.contains(this.styleForPseudo)&&(document.body.removeChild(this.styleForPseudo),this.styleForPseudo=null),this.insertExtraNode&&this.triggerElement.contains(this.extraNode)&&this.triggerElement.removeChild(this.extraNode)}destroy(){this.removeTriggerEvent(),this.removeStyleAndExtraNode()}fadeOutWave(){let t=this.triggerElement,e=this.getWaveColor(t);t.setAttribute(this.waveAttributeName,"true"),!(Date.now()<this.lastTime+this.waveTransitionDuration)&&(this.isValidColor(e)&&(this.styleForPseudo||(this.styleForPseudo=document.createElement("style"),this.cspNonce&&(this.styleForPseudo.nonce=this.cspNonce)),this.styleForPseudo.innerHTML=`
      [ant-click-animating-without-extra-node='true']::after, .ant-click-animating-node {
        --antd-wave-shadow-color: ${e};
      }`,document.body.appendChild(this.styleForPseudo)),this.insertExtraNode&&(this.extraNode||(this.extraNode=document.createElement("div")),this.extraNode.className="ant-click-animating-node",t.appendChild(this.extraNode)),this.lastTime=Date.now(),this.runTimeoutOutsideZone(()=>{t.removeAttribute(this.waveAttributeName),this.removeStyleAndExtraNode()},this.waveTransitionDuration))}isValidColor(t){return!!t&&t!=="#ffffff"&&t!=="rgb(255, 255, 255)"&&this.isNotGrey(t)&&!/rgba\(\d*, \d*, \d*, 0\)/.test(t)&&t!=="transparent"}isNotGrey(t){let e=t.match(/rgba?\((\d*), (\d*), (\d*)(, [.\d]*)?\)/);return e&&e[1]&&e[2]&&e[3]?!(e[1]===e[2]&&e[2]===e[3]):!0}getWaveColor(t){let e=getComputedStyle(t);return e.getPropertyValue("border-top-color")||e.getPropertyValue("border-color")||e.getPropertyValue("background-color")}runTimeoutOutsideZone(t,e){this.ngZone.runOutsideAngular(()=>setTimeout(t,e))}},Ku={disabled:!1},Oi=new F1("nz-wave-global-options");function Xu(r){return w4([{provide:Oi,useValue:r}])}var Ni=(()=>{class r{ngZone;elementRef;nzWaveExtraNode=!1;waveRenderer;waveDisabled=!1;get disabled(){return this.waveDisabled}get rendererRef(){return this.waveRenderer}cspNonce=ye(zr,{optional:!0});platform=ye(_2);config=ye(Oi,{optional:!0});animationType=ye(z4,{optional:!0});constructor(e,n){this.ngZone=e,this.elementRef=n,this.waveDisabled=this.isConfigDisabled()}isConfigDisabled(){let e=!1;return this.config&&typeof this.config.disabled=="boolean"&&(e=this.config.disabled),this.animationType==="NoopAnimations"&&(e=!0),e}ngOnDestroy(){this.waveRenderer&&this.waveRenderer.destroy()}ngOnInit(){this.renderWaveIfEnabled()}renderWaveIfEnabled(){!this.waveDisabled&&this.elementRef.nativeElement&&(this.waveRenderer=new N0(this.elementRef.nativeElement,this.ngZone,this.nzWaveExtraNode,this.platform,this.cspNonce))}disable(){this.waveDisabled=!0,this.waveRenderer&&(this.waveRenderer.removeTriggerEvent(),this.waveRenderer.removeStyleAndExtraNode())}enable(){this.waveDisabled=this.isConfigDisabled()||!1,this.waveRenderer&&this.waveRenderer.bindTriggerEvent()}static \u0275fac=function(n){return new(n||r)(ve(Bn),ve(nt))};static \u0275dir=n1({type:r,selectors:[["","nz-wave",""],["button","nz-button","",3,"nzType","link",3,"nzType","text"]],inputs:{nzWaveExtraNode:"nzWaveExtraNode"},exportAs:["nzWave"]})}return r})(),Pi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({providers:[Xu(Ku)]})}return r})();var Zu=["nz-button",""],Qu=["*"];function Ju(r,t){r&1&&we(0,"nz-icon",0)}var Wi="button",W0=(()=>{let r,t=[],e=[];return class P0{static{let o=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;r=[D1()],L1(null,null,r,{kind:"field",name:"nzSize",static:!1,private:!1,access:{has:a=>"nzSize"in a,get:a=>a.nzSize,set:(a,i)=>{a.nzSize=i}},metadata:o},t,e),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}elementRef;cdr;renderer;nzConfigService;directionality;_nzModuleName=Wi;nzIconDirectiveElement;nzBlock=!1;nzGhost=!1;nzSearch=!1;nzLoading=!1;nzDanger=!1;disabled=!1;tabIndex=null;nzType=null;nzShape=null;nzSize=De(this,t,"default");dir=(De(this,e),"ltr");finalSize=wn(()=>this.compactSize?this.compactSize():this.size());size=P1(this.nzSize);compactSize=ye(B0,{optional:!0});destroy$=ye(H0);loading$=new t1;insertSpan(o,a){o.forEach(i=>{if(i.nodeName==="#text"){let c=a.createElement("span"),s=a.parentNode(i);a.insertBefore(s,c,i),a.appendChild(c,i)}})}get iconOnly(){let o=Array.from(this.elementRef?.nativeElement?.childNodes||[]),a=o.every(c=>c.nodeName!=="#text"),i=o.filter(c=>!(c.nodeName==="#comment"||c?.classList?.contains("anticon"))).length==0;return!!this.nzIconDirectiveElement&&i&&a}constructor(o,a,i,c,s){this.elementRef=o,this.cdr=a,this.renderer=i,this.nzConfigService=c,this.directionality=s}ngOnInit(){this.size.set(this.nzSize),this.nzConfigService.getConfigChangeEventForComponent(Wi).pipe(z1(this.destroy$)).subscribe(()=>{this.size.set(this.nzSize),this.cdr.markForCheck()}),this.directionality.change?.pipe(z1(this.destroy$)).subscribe(o=>{this.dir=o,this.cdr.detectChanges()}),this.dir=this.directionality.value,U8(this.elementRef.nativeElement,"click",{capture:!0}).pipe(z1(this.destroy$)).subscribe(o=>{(this.disabled&&o.target?.tagName==="A"||this.nzLoading)&&(o.preventDefault(),o.stopImmediatePropagation())})}ngOnChanges({nzLoading:o,nzSize:a}){o&&this.loading$.next(this.nzLoading),a&&this.size.set(a.currentValue)}ngAfterViewInit(){this.insertSpan(this.elementRef.nativeElement.childNodes,this.renderer)}ngAfterContentInit(){this.loading$.pipe(r8(this.nzLoading),y4(()=>!!this.nzIconDirectiveElement),z1(this.destroy$)).subscribe(o=>{let a=this.nzIconDirectiveElement.nativeElement;o?this.renderer.setStyle(a,"display","none"):this.renderer.removeStyle(a,"display")})}static \u0275fac=function(a){return new(a||P0)(ve(nt),ve($1),ve(gn),ve(gt),ve(xt))};static \u0275cmp=Je({type:P0,selectors:[["button","nz-button",""],["a","nz-button",""]],contentQueries:function(a,i,c){if(a&1&&Nn(c,At,5,nt),a&2){let s;bn(s=yn())&&(i.nzIconDirectiveElement=s.first)}},hostAttrs:[1,"ant-btn"],hostVars:34,hostBindings:function(a,i){a&2&&(On("tabindex",i.disabled?-1:i.tabIndex===null?null:i.tabIndex)("disabled",i.disabled||null),C1("ant-btn-default",i.nzType==="default")("ant-btn-primary",i.nzType==="primary")("ant-btn-dashed",i.nzType==="dashed")("ant-btn-link",i.nzType==="link")("ant-btn-text",i.nzType==="text")("ant-btn-circle",i.nzShape==="circle")("ant-btn-round",i.nzShape==="round")("ant-btn-lg",i.finalSize()==="large")("ant-btn-sm",i.finalSize()==="small")("ant-btn-dangerous",i.nzDanger)("ant-btn-loading",i.nzLoading)("ant-btn-background-ghost",i.nzGhost)("ant-btn-block",i.nzBlock)("ant-input-search-button",i.nzSearch)("ant-btn-rtl",i.dir==="rtl")("ant-btn-icon-only",i.iconOnly))},inputs:{nzBlock:[2,"nzBlock","nzBlock",r1],nzGhost:[2,"nzGhost","nzGhost",r1],nzSearch:[2,"nzSearch","nzSearch",r1],nzLoading:[2,"nzLoading","nzLoading",r1],nzDanger:[2,"nzDanger","nzDanger",r1],disabled:[2,"disabled","disabled",r1],tabIndex:"tabIndex",nzType:"nzType",nzShape:"nzShape",nzSize:"nzSize"},exportAs:["nzButton"],features:[v2([H0,{provide:R0,useValue:"btn"}]),d8([Di]),l1],attrs:Zu,ngContentSelectors:Qu,decls:2,vars:1,consts:[["nzType","loading"]],template:function(a,i){a&1&&(ut(),ie(0,Ju,1,0,"nz-icon",0),A1(1)),a&2&&fe(i.nzLoading?0:-1)},dependencies:[Zt,At],encapsulation:2,changeDetection:0})}})();var Ui=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({imports:[W0,Bi,Pi]})}return r})();var t9=["nzType","avatar"];var n9=["*"];function r9(r,t){if(r&1&&(ue(0,"div",0),we(1,"nz-skeleton-element",4),se()),r&2){let e=re(2);ee(),Se("nzSize",e.avatar.size||"default")("nzShape",e.avatar.shape||"circle")}}function o9(r,t){if(r&1&&we(0,"h3",5),r&2){let e=re(2);rt("width",e.toCSSUnit(e.title.width))}}function a9(r,t){if(r&1&&we(0,"li"),r&2){let e=t.$index,n=re(3);rt("width",n.toCSSUnit(n.widthList[e]))}}function i9(r,t){if(r&1&&(ue(0,"ul",3),Lt(1,a9,1,2,"li",6,Cr),se()),r&2){let e=re(2);ee(),Ft(e.rowsList)}}function c9(r,t){if(r&1&&(ie(0,r9,2,2,"div",0),ue(1,"div",1),ie(2,o9,1,2,"h3",2)(3,i9,3,0,"ul",3),se()),r&2){let e=re();fe(e.nzAvatar?0:-1),ee(2),fe(e.nzTitle?2:-1),ee(),fe(e.nzParagraph?3:-1)}}function s9(r,t){r&1&&A1(0)}var l9=(()=>{class r{nzActive=!1;nzType;nzBlock=!1;static \u0275fac=function(n){return new(n||r)};static \u0275dir=n1({type:r,selectors:[["nz-skeleton-element"]],hostAttrs:[1,"ant-skeleton","ant-skeleton-element"],hostVars:4,hostBindings:function(n,o){n&2&&C1("ant-skeleton-active",o.nzActive)("ant-skeleton-block",o.nzBlock)},inputs:{nzActive:[2,"nzActive","nzActive",r1],nzType:"nzType",nzBlock:[2,"nzBlock","nzBlock",r1]}})}return r})();var u9=(()=>{class r{nzShape="circle";nzSize="default";styleMap={};ngOnChanges(e){if(e.nzSize&&typeof this.nzSize=="number"){let n=`${this.nzSize}px`;this.styleMap={width:n,height:n,"line-height":n}}else this.styleMap={}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-skeleton-element","nzType","avatar"]],inputs:{nzShape:"nzShape",nzSize:"nzSize"},features:[l1],attrs:t9,decls:1,vars:10,consts:[[1,"ant-skeleton-avatar"]],template:function(n,o){n&1&&we(0,"span",0),n&2&&(xn(o.styleMap),C1("ant-skeleton-avatar-square",o.nzShape==="square")("ant-skeleton-avatar-circle",o.nzShape==="circle")("ant-skeleton-avatar-lg",o.nzSize==="large")("ant-skeleton-avatar-sm",o.nzSize==="small"))},encapsulation:2,changeDetection:0})}return r})();var Gi=(()=>{class r{cdr;nzActive=!1;nzLoading=!0;nzRound=!1;nzTitle=!0;nzAvatar=!1;nzParagraph=!0;title;avatar;paragraph;rowsList=[];widthList=[];constructor(e){this.cdr=e}toCSSUnit(e=""){return N8(e)}getTitleProps(){let e=!!this.nzAvatar,n=!!this.nzParagraph,o="";return!e&&n?o="38%":e&&n&&(o="50%"),et({width:o},this.getProps(this.nzTitle))}getAvatarProps(){let e=this.nzTitle&&!this.nzParagraph?"square":"circle";return et({shape:e,size:"large"},this.getProps(this.nzAvatar))}getParagraphProps(){let e=!!this.nzAvatar,n=!!this.nzTitle,o={};return(!e||!n)&&(o.width="61%"),!e&&n?o.rows=3:o.rows=2,et(et({},o),this.getProps(this.nzParagraph))}getProps(e){return e&&typeof e=="object"?e:{}}getWidthList(){let{width:e,rows:n}=this.paragraph,o=[];return e&&Array.isArray(e)?o=e:e&&!Array.isArray(e)&&(o=[],o[n-1]=e),o}updateProps(){this.title=this.getTitleProps(),this.avatar=this.getAvatarProps(),this.paragraph=this.getParagraphProps(),this.rowsList=[...Array(this.paragraph.rows)],this.widthList=this.getWidthList(),this.cdr.markForCheck()}ngOnInit(){this.updateProps()}ngOnChanges(e){(e.nzTitle||e.nzAvatar||e.nzParagraph)&&this.updateProps()}static \u0275fac=function(n){return new(n||r)(ve($1))};static \u0275cmp=Je({type:r,selectors:[["nz-skeleton"]],hostAttrs:[1,"ant-skeleton"],hostVars:6,hostBindings:function(n,o){n&2&&C1("ant-skeleton-with-avatar",!!o.nzAvatar)("ant-skeleton-active",o.nzActive)("ant-skeleton-round",!!o.nzRound)},inputs:{nzActive:"nzActive",nzLoading:"nzLoading",nzRound:"nzRound",nzTitle:"nzTitle",nzAvatar:"nzAvatar",nzParagraph:"nzParagraph"},exportAs:["nzSkeleton"],features:[l1],ngContentSelectors:n9,decls:2,vars:1,consts:[[1,"ant-skeleton-header"],[1,"ant-skeleton-content"],[1,"ant-skeleton-title",3,"width"],[1,"ant-skeleton-paragraph"],["nzType","avatar",3,"nzSize","nzShape"],[1,"ant-skeleton-title"],[3,"width"]],template:function(n,o){n&1&&(ut(),ie(0,c9,4,3)(1,s9,1,0)),n&2&&fe(o.nzLoading?0:1)},dependencies:[l9,u9],encapsulation:2,changeDetection:0})}return r})(),qi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({})}return r})();function f9(r,t){}function d9(r,t){if(r&1&&(ue(0,"div",0),ie(1,f9,0,0,"ng-template",2),se()),r&2){let e=re();ee(),Se("ngTemplateOutlet",e.nzAvatar)}}function p9(r,t){if(r&1&&($t(0),_1(1),Kt()),r&2){let e=re(3);ee(),Pn(e.nzTitle)}}function v9(r,t){if(r&1&&(ue(0,"div",3),ie(1,p9,2,1,"ng-container",5),se()),r&2){let e=re(2);ee(),Se("nzStringTemplateOutlet",e.nzTitle)}}function m9(r,t){if(r&1&&($t(0),_1(1),Kt()),r&2){let e=re(3);ee(),Pn(e.nzDescription)}}function g9(r,t){if(r&1&&(ue(0,"div",4),ie(1,m9,2,1,"ng-container",5),se()),r&2){let e=re(2);ee(),Se("nzStringTemplateOutlet",e.nzDescription)}}function x9(r,t){if(r&1&&(ue(0,"div",1),ie(1,v9,2,1,"div",3)(2,g9,2,1,"div",4),se()),r&2){let e=re();ee(),fe(e.nzTitle?1:-1),ee(),fe(e.nzDescription?2:-1)}}var $i=["*"];function b9(r,t){r&1&&A1(0)}var y9=()=>({rows:4});function w9(r,t){if(r&1&&($t(0),_1(1),Kt()),r&2){let e=re(3);ee(),Pn(e.nzTitle)}}function z9(r,t){if(r&1&&(ue(0,"div",6),ie(1,w9,2,1,"ng-container",9),se()),r&2){let e=re(2);ee(),Se("nzStringTemplateOutlet",e.nzTitle)}}function M9(r,t){if(r&1&&($t(0),_1(1),Kt()),r&2){let e=re(3);ee(),Pn(e.nzExtra)}}function C9(r,t){if(r&1&&(ue(0,"div",7),ie(1,M9,2,1,"ng-container",9),se()),r&2){let e=re(2);ee(),Se("nzStringTemplateOutlet",e.nzExtra)}}function _9(r,t){}function E9(r,t){if(r&1&&ie(0,_9,0,0,"ng-template",8),r&2){let e=re(2);Se("ngTemplateOutlet",e.listOfNzCardTabComponent.template)}}function S9(r,t){if(r&1&&(ue(0,"div",0)(1,"div",5),ie(2,z9,2,1,"div",6)(3,C9,2,1,"div",7),se(),ie(4,E9,1,1,null,8),se()),r&2){let e=re();ee(2),fe(e.nzTitle?2:-1),ee(),fe(e.nzExtra?3:-1),ee(),fe(e.listOfNzCardTabComponent?4:-1)}}function k9(r,t){}function H9(r,t){if(r&1&&(ue(0,"div",1),ie(1,k9,0,0,"ng-template",8),se()),r&2){let e=re();ee(),Se("ngTemplateOutlet",e.nzCover)}}function V9(r,t){r&1&&we(0,"nz-skeleton",3),r&2&&Se("nzActive",!0)("nzTitle",!1)("nzParagraph",m8(3,y9))}function T9(r,t){r&1&&A1(0)}function L9(r,t){}function F9(r,t){if(r&1&&(ue(0,"li")(1,"span"),ie(2,L9,0,0,"ng-template",8),se()()),r&2){let e=t.$implicit,n=re(2);rt("width",100/n.nzActions.length,"%"),ee(2),Se("ngTemplateOutlet",e)}}function A9(r,t){if(r&1&&(ue(0,"ul",4),Lt(1,F9,3,3,"li",10,M4),se()),r&2){let e=re();ee(),Ft(e.nzActions)}}var D9=(()=>{class r{nzHoverable=!0;static \u0275fac=function(n){return new(n||r)};static \u0275dir=n1({type:r,selectors:[["","nz-card-grid",""]],hostAttrs:[1,"ant-card-grid"],hostVars:2,hostBindings:function(n,o){n&2&&C1("ant-card-hoverable",o.nzHoverable)},inputs:{nzHoverable:[2,"nzHoverable","nzHoverable",r1]},exportAs:["nzCardGrid"]})}return r})(),I9=(()=>{class r{nzTitle=null;nzDescription=null;nzAvatar=null;static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-card-meta"]],hostAttrs:[1,"ant-card-meta"],inputs:{nzTitle:"nzTitle",nzDescription:"nzDescription",nzAvatar:"nzAvatar"},exportAs:["nzCardMeta"],decls:2,vars:2,consts:[[1,"ant-card-meta-avatar"],[1,"ant-card-meta-detail"],[3,"ngTemplateOutlet"],[1,"ant-card-meta-title"],[1,"ant-card-meta-description"],[4,"nzStringTemplateOutlet"]],template:function(n,o){n&1&&ie(0,d9,2,1,"div",0)(1,x9,3,2,"div",1),n&2&&(fe(o.nzAvatar?0:-1),ee(),fe(o.nzTitle||o.nzDescription?1:-1))},dependencies:[Un,jn,Qt],encapsulation:2,changeDetection:0})}return r})(),B9=(()=>{class r{template;static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-card-tab"]],viewQuery:function(n,o){if(n&1&&v8(mn,7),n&2){let a;bn(a=yn())&&(o.template=a.first)}},exportAs:["nzCardTab"],ngContentSelectors:$i,decls:1,vars:0,template:function(n,o){n&1&&(ut(),ie(0,b9,1,0,"ng-template"))},encapsulation:2,changeDetection:0})}return r})(),ji="card",G0=(()=>{let r,t=[],e=[],n,o=[],a=[],i,c=[],s=[];return class U0{static{let u=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;r=[D1()],n=[D1()],i=[D1()],L1(null,null,r,{kind:"field",name:"nzBordered",static:!1,private:!1,access:{has:h=>"nzBordered"in h,get:h=>h.nzBordered,set:(h,f)=>{h.nzBordered=f}},metadata:u},t,e),L1(null,null,n,{kind:"field",name:"nzHoverable",static:!1,private:!1,access:{has:h=>"nzHoverable"in h,get:h=>h.nzHoverable,set:(h,f)=>{h.nzHoverable=f}},metadata:u},o,a),L1(null,null,i,{kind:"field",name:"nzSize",static:!1,private:!1,access:{has:h=>"nzSize"in h,get:h=>h.nzSize,set:(h,f)=>{h.nzSize=f}},metadata:u},c,s),u&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})}nzConfigService;cdr;directionality;_nzModuleName=ji;nzBordered=De(this,t,!0);nzLoading=(De(this,e),!1);nzHoverable=De(this,o,!1);nzBodyStyle=(De(this,a),null);nzCover;nzActions=[];nzType=null;nzSize=De(this,c,"default");nzTitle=De(this,s);nzExtra;listOfNzCardTabComponent;listOfNzCardGridDirective;dir="ltr";destroy$=new t1;constructor(u,h,f){this.nzConfigService=u,this.cdr=h,this.directionality=f,this.nzConfigService.getConfigChangeEventForComponent(ji).pipe(z1(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}ngOnInit(){this.directionality.change?.pipe(z1(this.destroy$)).subscribe(u=>{this.dir=u,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}static \u0275fac=function(h){return new(h||U0)(ve(gt),ve($1),ve(xt))};static \u0275cmp=Je({type:U0,selectors:[["nz-card"]],contentQueries:function(h,f,d){if(h&1&&(Nn(d,B9,5),Nn(d,D9,4)),h&2){let p;bn(p=yn())&&(f.listOfNzCardTabComponent=p.first),bn(p=yn())&&(f.listOfNzCardGridDirective=p)}},hostAttrs:[1,"ant-card"],hostVars:16,hostBindings:function(h,f){h&2&&C1("ant-card-loading",f.nzLoading)("ant-card-bordered",f.nzBordered)("ant-card-hoverable",f.nzHoverable)("ant-card-small",f.nzSize==="small")("ant-card-contain-grid",f.listOfNzCardGridDirective&&f.listOfNzCardGridDirective.length)("ant-card-type-inner",f.nzType==="inner")("ant-card-contain-tabs",!!f.listOfNzCardTabComponent)("ant-card-rtl",f.dir==="rtl")},inputs:{nzBordered:[2,"nzBordered","nzBordered",r1],nzLoading:[2,"nzLoading","nzLoading",r1],nzHoverable:[2,"nzHoverable","nzHoverable",r1],nzBodyStyle:"nzBodyStyle",nzCover:"nzCover",nzActions:"nzActions",nzType:"nzType",nzSize:"nzSize",nzTitle:"nzTitle",nzExtra:"nzExtra"},exportAs:["nzCard"],ngContentSelectors:$i,decls:6,vars:6,consts:[[1,"ant-card-head"],[1,"ant-card-cover"],[1,"ant-card-body"],[3,"nzActive","nzTitle","nzParagraph"],[1,"ant-card-actions"],[1,"ant-card-head-wrapper"],[1,"ant-card-head-title"],[1,"ant-card-extra"],[3,"ngTemplateOutlet"],[4,"nzStringTemplateOutlet"],[3,"width"]],template:function(h,f){h&1&&(ut(),ie(0,S9,5,3,"div",0)(1,H9,2,1,"div",1),ue(2,"div",2),ie(3,V9,1,4,"nz-skeleton",3)(4,T9,1,0),se(),ie(5,A9,3,0,"ul",4)),h&2&&(fe(f.nzTitle||f.nzExtra||f.listOfNzCardTabComponent?0:-1),ee(),fe(f.nzCover?1:-1),ee(),xn(f.nzBodyStyle),ee(),fe(f.nzLoading?3:4),ee(2),fe(f.nzActions.length?5:-1))},dependencies:[jn,Qt,Un,qi,Gi],encapsulation:2,changeDetection:0})}})(),Ki=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({imports:[G0,I9,Ti]})}return r})();var O9=[[["nz-result-content"],["","nz-result-content",""]],[["","nz-result-icon",""]],[["div","nz-result-title",""]],[["div","nz-result-subtitle",""]],[["div","nz-result-extra",""]]],N9=["nz-result-content, [nz-result-content]","[nz-result-icon]","div[nz-result-title]","div[nz-result-subtitle]","div[nz-result-extra]"];function P9(r,t){if(r&1&&($t(0),we(1,"nz-icon",5),Kt()),r&2){let e=t.$implicit;ee(),Se("nzType",e)}}function W9(r,t){if(r&1&&ie(0,P9,2,1,"ng-container",4),r&2){let e=re(2);Se("nzStringTemplateOutlet",e.icon)}}function U9(r,t){r&1&&A1(0,1)}function G9(r,t){if(r&1&&ie(0,W9,1,1,"ng-container")(1,U9,1,0),r&2){let e=re();fe(e.icon?0:1)}}function q9(r,t){r&1&&we(0,"nz-result-not-found")}function j9(r,t){r&1&&we(0,"nz-result-server-error")}function $9(r,t){r&1&&we(0,"nz-result-unauthorized")}function K9(r,t){if(r&1&&ie(0,q9,1,0,"nz-result-not-found")(1,j9,1,0,"nz-result-server-error")(2,$9,1,0,"nz-result-unauthorized"),r&2){let e,n=re();fe((e=n.nzStatus)==="404"?0:e==="500"?1:e==="403"?2:-1)}}function X9(r,t){if(r&1&&(ue(0,"div",1),_1(1),se()),r&2){let e=re(2);ee(),_4(" ",e.nzTitle," ")}}function Y9(r,t){if(r&1&&ie(0,X9,2,1,"div",6),r&2){let e=re();Se("nzStringTemplateOutlet",e.nzTitle)}}function Z9(r,t){r&1&&A1(0,2)}function Q9(r,t){if(r&1&&(ue(0,"div",2),_1(1),se()),r&2){let e=re(2);ee(),_4(" ",e.nzSubTitle," ")}}function J9(r,t){if(r&1&&ie(0,Q9,2,1,"div",7),r&2){let e=re();Se("nzStringTemplateOutlet",e.nzSubTitle)}}function eh(r,t){r&1&&A1(0,3)}function th(r,t){if(r&1&&(ue(0,"div",3),_1(1),se()),r&2){let e=re(2);ee(),_4(" ",e.nzExtra," ")}}function nh(r,t){if(r&1&&ie(0,th,2,1,"div",8),r&2){let e=re();Se("nzStringTemplateOutlet",e.nzExtra)}}function rh(r,t){r&1&&A1(0,4)}var oh=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-result-not-found"]],exportAs:["nzResultNotFound"],decls:62,vars:0,consts:[["width","252","height","294"],["d","M0 .387h251.772v251.772H0z"],["fill","none","fillRule","evenodd"],["transform","translate(0 .012)"],["fill","#fff"],["d","M0 127.32v-2.095C0 56.279 55.892.387 124.838.387h2.096c68.946 0 124.838 55.892 124.838 124.838v2.096c0 68.946-55.892 124.838-124.838 124.838h-2.096C55.892 252.16 0 196.267 0 127.321","fill","#E4EBF7","mask","url(#b)"],["d","M39.755 130.84a8.276 8.276 0 1 1-16.468-1.66 8.276 8.276 0 0 1 16.468 1.66","fill","#FFF"],["d","M36.975 134.297l10.482 5.943M48.373 146.508l-12.648 10.788","stroke","#FFF","strokeWidth","2"],["d","M39.875 159.352a5.667 5.667 0 1 1-11.277-1.136 5.667 5.667 0 0 1 11.277 1.136M57.588 143.247a5.708 5.708 0 1 1-11.358-1.145 5.708 5.708 0 0 1 11.358 1.145M99.018 26.875l29.82-.014a4.587 4.587 0 1 0-.003-9.175l-29.82.013a4.587 4.587 0 1 0 .003 9.176M110.424 45.211l29.82-.013a4.588 4.588 0 0 0-.004-9.175l-29.82.013a4.587 4.587 0 1 0 .004 9.175","fill","#FFF"],["d","M112.798 26.861v-.002l15.784-.006a4.588 4.588 0 1 0 .003 9.175l-15.783.007v-.002a4.586 4.586 0 0 0-.004-9.172M184.523 135.668c-.553 5.485-5.447 9.483-10.931 8.93-5.485-.553-9.483-5.448-8.93-10.932.552-5.485 5.447-9.483 10.932-8.93 5.485.553 9.483 5.447 8.93 10.932","fill","#FFF"],["d","M179.26 141.75l12.64 7.167M193.006 156.477l-15.255 13.011","par","","stroke","#FFF","strokeWidth","2"],["d","M184.668 170.057a6.835 6.835 0 1 1-13.6-1.372 6.835 6.835 0 0 1 13.6 1.372M203.34 153.325a6.885 6.885 0 1 1-13.7-1.382 6.885 6.885 0 0 1 13.7 1.382","fill","#FFF"],["d","M151.931 192.324a2.222 2.222 0 1 1-4.444 0 2.222 2.222 0 0 1 4.444 0zM225.27 116.056a2.222 2.222 0 1 1-4.445 0 2.222 2.222 0 0 1 4.444 0zM216.38 151.08a2.223 2.223 0 1 1-4.446-.001 2.223 2.223 0 0 1 4.446 0zM176.917 107.636a2.223 2.223 0 1 1-4.445 0 2.223 2.223 0 0 1 4.445 0zM195.291 92.165a2.223 2.223 0 1 1-4.445 0 2.223 2.223 0 0 1 4.445 0zM202.058 180.711a2.223 2.223 0 1 1-4.446 0 2.223 2.223 0 0 1 4.446 0z","stroke","#FFF","strokeWidth","2"],["stroke","#FFF","strokeWidth","2","d","M214.404 153.302l-1.912 20.184-10.928 5.99M173.661 174.792l-6.356 9.814h-11.36l-4.508 6.484M174.941 125.168v-15.804M220.824 117.25l-12.84 7.901-15.31-7.902V94.39"],["d","M166.588 65.936h-3.951a4.756 4.756 0 0 1-4.743-4.742 4.756 4.756 0 0 1 4.743-4.743h3.951a4.756 4.756 0 0 1 4.743 4.743 4.756 4.756 0 0 1-4.743 4.742","fill","#FFF"],["d","M174.823 30.03c0-16.281 13.198-29.48 29.48-29.48 16.28 0 29.48 13.199 29.48 29.48 0 16.28-13.2 29.48-29.48 29.48-16.282 0-29.48-13.2-29.48-29.48","fill","#1890FF"],["d","M205.952 38.387c.5.5.785 1.142.785 1.928s-.286 1.465-.785 1.964c-.572.5-1.214.75-2 .75-.785 0-1.429-.285-1.929-.785-.572-.5-.82-1.143-.82-1.929s.248-1.428.82-1.928c.5-.5 1.144-.75 1.93-.75.785 0 1.462.25 1.999.75m4.285-19.463c1.428 1.249 2.143 2.963 2.143 5.142 0 1.712-.427 3.13-1.219 4.25-.067.096-.137.18-.218.265-.416.429-1.41 1.346-2.956 2.699a5.07 5.07 0 0 0-1.428 1.75 5.207 5.207 0 0 0-.536 2.357v.5h-4.107v-.5c0-1.357.215-2.536.714-3.5.464-.964 1.857-2.464 4.178-4.536l.43-.5c.643-.785.964-1.643.964-2.535 0-1.18-.358-2.108-1-2.785-.678-.68-1.643-1.001-2.858-1.001-1.536 0-2.642.464-3.357 1.43-.37.5-.621 1.135-.76 1.904a1.999 1.999 0 0 1-1.971 1.63h-.004c-1.277 0-2.257-1.183-1.98-2.43.337-1.518 1.02-2.78 2.073-3.784 1.536-1.5 3.607-2.25 6.25-2.25 2.32 0 4.214.607 5.642 1.894","fill","#FFF"],["d","M52.04 76.131s21.81 5.36 27.307 15.945c5.575 10.74-6.352 9.26-15.73 4.935-10.86-5.008-24.7-11.822-11.577-20.88","fill","#FFB594"],["d","M90.483 67.504l-.449 2.893c-.753.49-4.748-2.663-4.748-2.663l-1.645.748-1.346-5.684s6.815-4.589 8.917-5.018c2.452-.501 9.884.94 10.7 2.278 0 0 1.32.486-2.227.69-3.548.203-5.043.447-6.79 3.132-1.747 2.686-2.412 3.624-2.412 3.624","fill","#FFC6A0"],["d","M128.055 111.367c-2.627-7.724-6.15-13.18-8.917-15.478-3.5-2.906-9.34-2.225-11.366-4.187-1.27-1.231-3.215-1.197-3.215-1.197s-14.98-3.158-16.828-3.479c-2.37-.41-2.124-.714-6.054-1.405-1.57-1.907-2.917-1.122-2.917-1.122l-7.11-1.383c-.853-1.472-2.423-1.023-2.423-1.023l-2.468-.897c-1.645 9.976-7.74 13.796-7.74 13.796 1.795 1.122 15.703 8.3 15.703 8.3l5.107 37.11s-3.321 5.694 1.346 9.109c0 0 19.883-3.743 34.921-.329 0 0 3.047-2.546.972-8.806.523-3.01 1.394-8.263 1.736-11.622.385.772 2.019 1.918 3.14 3.477 0 0 9.407-7.365 11.052-14.012-.832-.723-1.598-1.585-2.267-2.453-.567-.736-.358-2.056-.765-2.717-.669-1.084-1.804-1.378-1.907-1.682","fill","#FFF"],["d","M101.09 289.998s4.295 2.041 7.354 1.021c2.821-.94 4.53.668 7.08 1.178 2.55.51 6.874 1.1 11.686-1.26-.103-5.51-6.889-3.98-11.96-6.713-2.563-1.38-3.784-4.722-3.598-8.799h-9.402s-1.392 10.52-1.16 14.573","fill","#CBD1D1"],["d","M101.067 289.826s2.428 1.271 6.759.653c3.058-.437 3.712.481 7.423 1.031 3.712.55 10.724-.069 11.823-.894.413 1.1-.343 2.063-.343 2.063s-1.512.603-4.812.824c-2.03.136-5.8.291-7.607-.503-1.787-1.375-5.247-1.903-5.728-.241-3.918.95-7.355-.286-7.355-.286l-.16-2.647z","fill","#2B0849"],["d","M108.341 276.044h3.094s-.103 6.702 4.536 8.558c-4.64.618-8.558-2.303-7.63-8.558","fill","#A4AABA"],["d","M57.542 272.401s-2.107 7.416-4.485 12.306c-1.798 3.695-4.225 7.492 5.465 7.492 6.648 0 8.953-.48 7.423-6.599-1.53-6.12.266-13.199.266-13.199h-8.669z","fill","#CBD1D1"],["d","M51.476 289.793s2.097 1.169 6.633 1.169c6.083 0 8.249-1.65 8.249-1.65s.602 1.114-.619 2.165c-.993.855-3.597 1.591-7.39 1.546-4.145-.048-5.832-.566-6.736-1.168-.825-.55-.687-1.58-.137-2.062","fill","#2B0849"],["d","M58.419 274.304s.033 1.519-.314 2.93c-.349 1.42-1.078 3.104-1.13 4.139-.058 1.151 4.537 1.58 5.155.034.62-1.547 1.294-6.427 1.913-7.252.619-.825-4.903-2.119-5.624.15","fill","#A4AABA"],["d","M99.66 278.514l13.378.092s1.298-54.52 1.853-64.403c.554-9.882 3.776-43.364 1.002-63.128l-12.547-.644-22.849.78s-.434 3.966-1.195 9.976c-.063.496-.682.843-.749 1.365-.075.585.423 1.354.32 1.966-2.364 14.08-6.377 33.104-8.744 46.677-.116.666-1.234 1.009-1.458 2.691-.04.302.211 1.525.112 1.795-6.873 18.744-10.949 47.842-14.277 61.885l14.607-.014s2.197-8.57 4.03-16.97c2.811-12.886 23.111-85.01 23.111-85.01l3.016-.521 1.043 46.35s-.224 1.234.337 2.02c.56.785-.56 1.123-.392 2.244l.392 1.794s-.449 7.178-.898 11.89c-.448 4.71-.092 39.165-.092 39.165","fill","#7BB2F9"],["d","M76.085 221.626c1.153.094 4.038-2.019 6.955-4.935M106.36 225.142s2.774-1.11 6.103-3.883","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M107.275 222.1s2.773-1.11 6.102-3.884","stroke","#648BD8","strokeLinecap","round","strokeLinejoin","round"],["d","M74.74 224.767s2.622-.591 6.505-3.365M86.03 151.634c-.27 3.106.3 8.525-4.336 9.123M103.625 149.88s.11 14.012-1.293 15.065c-2.219 1.664-2.99 1.944-2.99 1.944M99.79 150.438s.035 12.88-1.196 24.377M93.673 175.911s7.212-1.664 9.431-1.664M74.31 205.861a212.013 212.013 0 0 1-.979 4.56s-1.458 1.832-1.009 3.776c.449 1.944-.947 2.045-4.985 15.355-1.696 5.59-4.49 18.591-6.348 27.597l-.231 1.12M75.689 197.807a320.934 320.934 0 0 1-.882 4.754M82.591 152.233L81.395 162.7s-1.097.15-.5 2.244c.113 1.346-2.674 15.775-5.18 30.43M56.12 274.418h13.31","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M116.241 148.22s-17.047-3.104-35.893.2c.158 2.514-.003 4.15-.003 4.15s14.687-2.818 35.67-.312c.252-2.355.226-4.038.226-4.038","fill","#192064"],["d","M106.322 151.165l.003-4.911a.81.81 0 0 0-.778-.815c-2.44-.091-5.066-.108-7.836-.014a.818.818 0 0 0-.789.815l-.003 4.906a.81.81 0 0 0 .831.813c2.385-.06 4.973-.064 7.73.017a.815.815 0 0 0 .842-.81","fill","#FFF"],["d","M105.207 150.233l.002-3.076a.642.642 0 0 0-.619-.646 94.321 94.321 0 0 0-5.866-.01.65.65 0 0 0-.63.647v3.072a.64.64 0 0 0 .654.644 121.12 121.12 0 0 1 5.794.011c.362.01.665-.28.665-.642","fill","#192064"],["d","M100.263 275.415h12.338M101.436 270.53c.006 3.387.042 5.79.111 6.506M101.451 264.548a915.75 915.75 0 0 0-.015 4.337M100.986 174.965l.898 44.642s.673 1.57-.225 2.692c-.897 1.122 2.468.673.898 2.243-1.57 1.57.897 1.122 0 3.365-.596 1.489-.994 21.1-1.096 35.146","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M46.876 83.427s-.516 6.045 7.223 5.552c11.2-.712 9.218-9.345 31.54-21.655-.786-2.708-2.447-4.744-2.447-4.744s-11.068 3.11-22.584 8.046c-6.766 2.9-13.395 6.352-13.732 12.801M104.46 91.057l.941-5.372-8.884-11.43-5.037 5.372-1.74 7.834a.321.321 0 0 0 .108.32c.965.8 6.5 5.013 14.347 3.544a.332.332 0 0 0 .264-.268","fill","#FFC6A0"],["d","M93.942 79.387s-4.533-2.853-2.432-6.855c1.623-3.09 4.513 1.133 4.513 1.133s.52-3.642 3.121-3.642c.52-1.04 1.561-4.162 1.561-4.162s11.445 2.601 13.526 3.121c0 5.203-2.304 19.424-7.84 19.861-8.892.703-12.449-9.456-12.449-9.456","fill","#FFC6A0"],["d","M113.874 73.446c2.601-2.081 3.47-9.722 3.47-9.722s-2.479-.49-6.64-2.05c-4.683-2.081-12.798-4.747-17.48.976-9.668 3.223-2.05 19.823-2.05 19.823l2.713-3.021s-3.935-3.287-2.08-6.243c2.17-3.462 3.92 1.073 3.92 1.073s.637-2.387 3.581-3.342c.355-.71 1.036-2.674 1.432-3.85a1.073 1.073 0 0 1 1.263-.704c2.4.558 8.677 2.019 11.356 2.662.522.125.871.615.82 1.15l-.305 3.248z","fill","#520038"],["d","M104.977 76.064c-.103.61-.582 1.038-1.07.956-.489-.083-.801-.644-.698-1.254.103-.61.582-1.038 1.07-.956.488.082.8.644.698 1.254M112.132 77.694c-.103.61-.582 1.038-1.07.956-.488-.083-.8-.644-.698-1.254.103-.61.582-1.038 1.07-.956.488.082.8.643.698 1.254","fill","#552950"],["stroke","#DB836E","strokeWidth","1.118","strokeLinecap","round","strokeLinejoin","round","d","M110.13 74.84l-.896 1.61-.298 4.357h-2.228"],["d","M110.846 74.481s1.79-.716 2.506.537","stroke","#5C2552","strokeWidth","1.118","strokeLinecap","round","strokeLinejoin","round"],["d","M92.386 74.282s.477-1.114 1.113-.716c.637.398 1.274 1.433.558 1.99-.717.556.159 1.67.159 1.67","stroke","#DB836E","strokeWidth","1.118","strokeLinecap","round","strokeLinejoin","round"],["d","M103.287 72.93s1.83 1.113 4.137.954","stroke","#5C2552","strokeWidth","1.118","strokeLinecap","round","strokeLinejoin","round"],["d","M103.685 81.762s2.227 1.193 4.376 1.193M104.64 84.308s.954.398 1.511.318M94.693 81.205s2.308 7.4 10.424 7.639","stroke","#DB836E","strokeWidth","1.118","strokeLinecap","round","strokeLinejoin","round"],["d","M81.45 89.384s.45 5.647-4.935 12.787M69 82.654s-.726 9.282-8.204 14.206","stroke","#E4EBF7","strokeWidth","1.101","strokeLinecap","round","strokeLinejoin","round"],["d","M129.405 122.865s-5.272 7.403-9.422 10.768","stroke","#E4EBF7","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M119.306 107.329s.452 4.366-2.127 32.062","stroke","#E4EBF7","strokeWidth","1.101","strokeLinecap","round","strokeLinejoin","round"],["d","M150.028 151.232h-49.837a1.01 1.01 0 0 1-1.01-1.01v-31.688c0-.557.452-1.01 1.01-1.01h49.837c.558 0 1.01.453 1.01 1.01v31.688a1.01 1.01 0 0 1-1.01 1.01","fill","#F2D7AD"],["d","M150.29 151.232h-19.863v-33.707h20.784v32.786a.92.92 0 0 1-.92.92","fill","#F4D19D"],["d","M123.554 127.896H92.917a.518.518 0 0 1-.425-.816l6.38-9.113c.193-.277.51-.442.85-.442h31.092l-7.26 10.371z","fill","#F2D7AD"],["fill","#CC9B6E","d","M123.689 128.447H99.25v-.519h24.169l7.183-10.26.424.298z"],["d","M158.298 127.896h-18.669a2.073 2.073 0 0 1-1.659-.83l-7.156-9.541h19.965c.49 0 .95.23 1.244.622l6.69 8.92a.519.519 0 0 1-.415.83","fill","#F4D19D"],["fill","#CC9B6E","d","M157.847 128.479h-19.384l-7.857-10.475.415-.31 7.7 10.266h19.126zM130.554 150.685l-.032-8.177.519-.002.032 8.177z"],["fill","#CC9B6E","d","M130.511 139.783l-.08-21.414.519-.002.08 21.414zM111.876 140.932l-.498-.143 1.479-5.167.498.143zM108.437 141.06l-2.679-2.935 2.665-3.434.41.318-2.397 3.089 2.384 2.612zM116.607 141.06l-.383-.35 2.383-2.612-2.397-3.089.41-.318 2.665 3.434z"],["d","M154.316 131.892l-3.114-1.96.038 3.514-1.043.092c-1.682.115-3.634.23-4.789.23-1.902 0-2.693 2.258 2.23 2.648l-2.645-.596s-2.168 1.317.504 2.3c0 0-1.58 1.217.561 2.58-.584 3.504 5.247 4.058 7.122 3.59 1.876-.47 4.233-2.359 4.487-5.16.28-3.085-.89-5.432-3.35-7.238","fill","#FFC6A0"],["d","M153.686 133.577s-6.522.47-8.36.372c-1.836-.098-1.904 2.19 2.359 2.264 3.739.15 5.451-.044 5.451-.044","stroke","#DB836E","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M145.16 135.877c-1.85 1.346.561 2.355.561 2.355s3.478.898 6.73.617","stroke","#DB836E","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M151.89 141.71s-6.28.111-6.73-2.132c-.223-1.346.45-1.402.45-1.402M146.114 140.868s-1.103 3.16 5.44 3.533M151.202 129.932v3.477M52.838 89.286c3.533-.337 8.423-1.248 13.582-7.754","stroke","#DB836E","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M168.567 248.318a6.647 6.647 0 0 1-6.647-6.647v-66.466a6.647 6.647 0 1 1 13.294 0v66.466a6.647 6.647 0 0 1-6.647 6.647","fill","#5BA02E"],["d","M176.543 247.653a6.647 6.647 0 0 1-6.646-6.647v-33.232a6.647 6.647 0 1 1 13.293 0v33.232a6.647 6.647 0 0 1-6.647 6.647","fill","#92C110"],["d","M186.443 293.613H158.92a3.187 3.187 0 0 1-3.187-3.187v-46.134a3.187 3.187 0 0 1 3.187-3.187h27.524a3.187 3.187 0 0 1 3.187 3.187v46.134a3.187 3.187 0 0 1-3.187 3.187","fill","#F2D7AD"],["d","M88.979 89.48s7.776 5.384 16.6 2.842","stroke","#E4EBF7","strokeWidth","1.101","strokeLinecap","round","strokeLinejoin","round"]],template:function(n,o){n&1&&(Tt(),ue(0,"svg",0)(1,"defs"),we(2,"path",1),se(),ue(3,"g",2)(4,"g",3),we(5,"mask",4)(6,"path",5),se(),we(7,"path",6)(8,"path",7)(9,"path",8)(10,"path",9)(11,"path",10)(12,"path",11)(13,"path",12)(14,"path",13)(15,"path",14)(16,"path",15)(17,"path",16)(18,"path",17)(19,"path",18)(20,"path",19)(21,"path",20)(22,"path",21)(23,"path",22)(24,"path",23)(25,"path",24)(26,"path",25)(27,"path",26)(28,"path",27)(29,"path",28)(30,"path",29)(31,"path",30)(32,"path",31)(33,"path",32)(34,"path",33)(35,"path",34)(36,"path",35)(37,"path",36)(38,"path",37)(39,"path",38)(40,"path",39)(41,"path",40)(42,"path",41)(43,"path",42)(44,"path",43)(45,"path",44)(46,"path",45)(47,"path",46)(48,"path",47)(49,"path",48)(50,"path",49)(51,"path",50)(52,"path",51)(53,"path",52)(54,"path",53)(55,"path",54)(56,"path",55)(57,"path",56)(58,"path",57)(59,"path",58)(60,"path",59)(61,"path",60),se()())},encapsulation:2,changeDetection:0})}return r})(),ah=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-result-server-error"]],exportAs:["nzResultServerError"],decls:69,vars:0,consts:[["width","254","height","294"],["d","M0 .335h253.49v253.49H0z"],["d","M0 293.665h253.49V.401H0z"],["fill","none","fillRule","evenodd"],["transform","translate(0 .067)"],["fill","#fff"],["d","M0 128.134v-2.11C0 56.608 56.273.334 125.69.334h2.11c69.416 0 125.69 56.274 125.69 125.69v2.11c0 69.417-56.274 125.69-125.69 125.69h-2.11C56.273 253.824 0 197.551 0 128.134","fill","#E4EBF7","mask","url(#b)"],["d","M39.989 132.108a8.332 8.332 0 1 1-16.581-1.671 8.332 8.332 0 0 1 16.58 1.671","fill","#FFF"],["d","M37.19 135.59l10.553 5.983M48.665 147.884l-12.734 10.861","stroke","#FFF","strokeWidth","2"],["d","M40.11 160.816a5.706 5.706 0 1 1-11.354-1.145 5.706 5.706 0 0 1 11.354 1.145M57.943 144.6a5.747 5.747 0 1 1-11.436-1.152 5.747 5.747 0 0 1 11.436 1.153M99.656 27.434l30.024-.013a4.619 4.619 0 1 0-.004-9.238l-30.024.013a4.62 4.62 0 0 0 .004 9.238M111.14 45.896l30.023-.013a4.62 4.62 0 1 0-.004-9.238l-30.024.013a4.619 4.619 0 1 0 .004 9.238","fill","#FFF"],["d","M113.53 27.421v-.002l15.89-.007a4.619 4.619 0 1 0 .005 9.238l-15.892.007v-.002a4.618 4.618 0 0 0-.004-9.234M150.167 70.091h-3.979a4.789 4.789 0 0 1-4.774-4.775 4.788 4.788 0 0 1 4.774-4.774h3.979a4.789 4.789 0 0 1 4.775 4.774 4.789 4.789 0 0 1-4.775 4.775","fill","#FFF"],["d","M171.687 30.234c0-16.392 13.289-29.68 29.681-29.68 16.392 0 29.68 13.288 29.68 29.68 0 16.393-13.288 29.681-29.68 29.681s-29.68-13.288-29.68-29.68","fill","#FF603B"],["d","M203.557 19.435l-.676 15.035a1.514 1.514 0 0 1-3.026 0l-.675-15.035a2.19 2.19 0 1 1 4.377 0m-.264 19.378c.513.477.77 1.1.77 1.87s-.257 1.393-.77 1.907c-.55.476-1.21.733-1.943.733a2.545 2.545 0 0 1-1.87-.77c-.55-.514-.806-1.136-.806-1.87 0-.77.256-1.393.806-1.87.513-.513 1.137-.733 1.87-.733.77 0 1.43.22 1.943.733","fill","#FFF"],["d","M119.3 133.275c4.426-.598 3.612-1.204 4.079-4.778.675-5.18-3.108-16.935-8.262-25.118-1.088-10.72-12.598-11.24-12.598-11.24s4.312 4.895 4.196 16.199c1.398 5.243.804 14.45.804 14.45s5.255 11.369 11.78 10.487","fill","#FFB594"],["d","M100.944 91.61s1.463-.583 3.211.582c8.08 1.398 10.368 6.706 11.3 11.368 1.864 1.282 1.864 2.33 1.864 3.496.365.777 1.515 3.03 1.515 3.03s-7.225 1.748-10.954 6.758c-1.399-6.41-6.936-25.235-6.936-25.235","fill","#FFF"],["d","M94.008 90.5l1.019-5.815-9.23-11.874-5.233 5.581-2.593 9.863s8.39 5.128 16.037 2.246","fill","#FFB594"],["d","M82.931 78.216s-4.557-2.868-2.445-6.892c1.632-3.107 4.537 1.139 4.537 1.139s.524-3.662 3.139-3.662c.523-1.046 1.569-4.184 1.569-4.184s11.507 2.615 13.6 3.138c-.001 5.23-2.317 19.529-7.884 19.969-8.94.706-12.516-9.508-12.516-9.508","fill","#FFC6A0"],["d","M102.971 72.243c2.616-2.093 3.489-9.775 3.489-9.775s-2.492-.492-6.676-2.062c-4.708-2.092-12.867-4.771-17.575.982-9.54 4.41-2.062 19.93-2.062 19.93l2.729-3.037s-3.956-3.304-2.092-6.277c2.183-3.48 3.943 1.08 3.943 1.08s.64-2.4 3.6-3.36c.356-.714 1.04-2.69 1.44-3.872a1.08 1.08 0 0 1 1.27-.707c2.41.56 8.723 2.03 11.417 2.676.524.126.876.619.825 1.156l-.308 3.266z","fill","#520038"],["d","M101.22 76.514c-.104.613-.585 1.044-1.076.96-.49-.082-.805-.646-.702-1.26.104-.613.585-1.044 1.076-.961.491.083.805.647.702 1.26M94.26 75.074c-.104.613-.585 1.044-1.076.96-.49-.082-.805-.646-.702-1.26.104-.613.585-1.044 1.076-.96.491.082.805.646.702 1.26","fill","#552950"],["stroke","#DB836E","strokeWidth","1.063","strokeLinecap","round","strokeLinejoin","round","d","M99.206 73.644l-.9 1.62-.3 4.38h-2.24"],["d","M99.926 73.284s1.8-.72 2.52.54","stroke","#5C2552","strokeWidth","1.117","strokeLinecap","round","strokeLinejoin","round"],["d","M81.367 73.084s.48-1.12 1.12-.72c.64.4 1.28 1.44.56 2s.16 1.68.16 1.68","stroke","#DB836E","strokeWidth","1.117","strokeLinecap","round","strokeLinejoin","round"],["d","M92.326 71.724s1.84 1.12 4.16.96","stroke","#5C2552","strokeWidth","1.117","strokeLinecap","round","strokeLinejoin","round"],["d","M92.726 80.604s2.24 1.2 4.4 1.2M93.686 83.164s.96.4 1.52.32M83.687 80.044s1.786 6.547 9.262 7.954","stroke","#DB836E","strokeWidth","1.063","strokeLinecap","round","strokeLinejoin","round"],["d","M95.548 91.663s-1.068 2.821-8.298 2.105c-7.23-.717-10.29-5.044-10.29-5.044","stroke","#E4EBF7","strokeWidth","1.136","strokeLinecap","round","strokeLinejoin","round"],["d","M78.126 87.478s6.526 4.972 16.47 2.486c0 0 9.577 1.02 11.536 5.322 5.36 11.77.543 36.835 0 39.962 3.496 4.055-.466 8.483-.466 8.483-15.624-3.548-35.81-.6-35.81-.6-4.849-3.546-1.223-9.044-1.223-9.044L62.38 110.32c-2.485-15.227.833-19.803 3.549-20.743 3.03-1.049 8.04-1.282 8.04-1.282.496-.058 1.08-.076 1.37-.233 2.36-1.282 2.787-.583 2.787-.583","fill","#FFF"],["d","M65.828 89.81s-6.875.465-7.59 8.156c-.466 8.857 3.03 10.954 3.03 10.954s6.075 22.102 16.796 22.957c8.39-2.176 4.758-6.702 4.661-11.42-.233-11.304-7.108-16.897-7.108-16.897s-4.212-13.75-9.789-13.75","fill","#FFC6A0"],["d","M71.716 124.225s.855 11.264 9.828 6.486c4.765-2.536 7.581-13.828 9.789-22.568 1.456-5.768 2.58-12.197 2.58-12.197l-4.973-1.709s-2.408 5.516-7.769 12.275c-4.335 5.467-9.144 11.11-9.455 17.713","fill","#FFC6A0"],["d","M108.463 105.191s1.747 2.724-2.331 30.535c2.376 2.216 1.053 6.012-.233 7.51","stroke","#E4EBF7","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M123.262 131.527s-.427 2.732-11.77 1.981c-15.187-1.006-25.326-3.25-25.326-3.25l.933-5.8s.723.215 9.71-.068c11.887-.373 18.714-6.07 24.964-1.022 4.039 3.263 1.489 8.16 1.489 8.16","fill","#FFC6A0"],["d","M70.24 90.974s-5.593-4.739-11.054 2.68c-3.318 7.223.517 15.284 2.664 19.578-.31 3.729 2.33 4.311 2.33 4.311s.108.895 1.516 2.68c4.078-7.03 6.72-9.166 13.711-12.546-.328-.656-1.877-3.265-1.825-3.767.175-1.69-1.282-2.623-1.282-2.623s-.286-.156-1.165-2.738c-.788-2.313-2.036-5.177-4.895-7.575","fill","#FFF"],["d","M90.232 288.027s4.855 2.308 8.313 1.155c3.188-1.063 5.12.755 8.002 1.331 2.881.577 7.769 1.243 13.207-1.424-.117-6.228-7.786-4.499-13.518-7.588-2.895-1.56-4.276-5.336-4.066-9.944H91.544s-1.573 11.89-1.312 16.47","fill","#CBD1D1"],["d","M90.207 287.833s2.745 1.437 7.639.738c3.456-.494 3.223.66 7.418 1.282 4.195.621 13.092-.194 14.334-1.126.466 1.242-.388 2.33-.388 2.33s-1.709.682-5.438.932c-2.295.154-8.098.276-10.14-.621-2.02-1.554-4.894-1.515-6.06-.234-4.427 1.075-7.184-.31-7.184-.31l-.181-2.991z","fill","#2B0849"],["d","M98.429 272.257h3.496s-.117 7.574 5.127 9.671c-5.244.7-9.672-2.602-8.623-9.671","fill","#A4AABA"],["d","M44.425 272.046s-2.208 7.774-4.702 12.899c-1.884 3.874-4.428 7.854 5.729 7.854 6.97 0 9.385-.503 7.782-6.917-1.604-6.415.279-13.836.279-13.836h-9.088z","fill","#CBD1D1"],["d","M38.066 290.277s2.198 1.225 6.954 1.225c6.376 0 8.646-1.73 8.646-1.73s.63 1.168-.649 2.27c-1.04.897-3.77 1.668-7.745 1.621-4.347-.05-6.115-.593-7.062-1.224-.864-.577-.72-1.657-.144-2.162","fill","#2B0849"],["d","M45.344 274.041s.035 1.592-.329 3.07c-.365 1.49-1.13 3.255-1.184 4.34-.061 1.206 4.755 1.657 5.403.036.65-1.622 1.357-6.737 2.006-7.602.648-.865-5.14-2.222-5.896.156","fill","#A4AABA"],["d","M89.476 277.57l13.899.095s1.349-56.643 1.925-66.909c.576-10.267 3.923-45.052 1.042-65.585l-13.037-.669-23.737.81s-.452 4.12-1.243 10.365c-.065.515-.708.874-.777 1.417-.078.608.439 1.407.332 2.044-2.455 14.627-5.797 32.736-8.256 46.837-.121.693-1.282 1.048-1.515 2.796-.042.314.22 1.584.116 1.865-7.14 19.473-12.202 52.601-15.66 67.19l15.176-.015s2.282-10.145 4.185-18.871c2.922-13.389 24.012-88.32 24.012-88.32l3.133-.954-.158 48.568s-.233 1.282.35 2.098c.583.815-.581 1.167-.408 2.331l.408 1.864s-.466 7.458-.932 12.352c-.467 4.895 1.145 40.69 1.145 40.69","fill","#7BB2F9"],["d","M64.57 218.881c1.197.099 4.195-2.097 7.225-5.127M96.024 222.534s2.881-1.152 6.34-4.034","stroke","#648BD8","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M96.973 219.373s2.882-1.153 6.34-4.034","stroke","#648BD8","strokeWidth","1.032","strokeLinecap","round","strokeLinejoin","round"],["d","M63.172 222.144s2.724-.614 6.759-3.496M74.903 146.166c-.281 3.226.31 8.856-4.506 9.478M93.182 144.344s.115 14.557-1.344 15.65c-2.305 1.73-3.107 2.02-3.107 2.02M89.197 144.923s.269 13.144-1.01 25.088M83.525 170.71s6.81-1.051 9.116-1.051M46.026 270.045l-.892 4.538M46.937 263.289l-.815 4.157M62.725 202.503c-.33 1.618-.102 1.904-.449 3.438 0 0-2.756 1.903-2.29 3.923.466 2.02-.31 3.424-4.505 17.252-1.762 5.807-4.233 18.922-6.165 28.278-.03.144-.521 2.646-1.14 5.8M64.158 194.136c-.295 1.658-.6 3.31-.917 4.938M71.33 146.787l-1.244 10.877s-1.14.155-.519 2.33c.117 1.399-2.778 16.39-5.382 31.615M44.242 273.727H58.07","stroke","#648BD8","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M106.18 142.117c-3.028-.489-18.825-2.744-36.219.2a.625.625 0 0 0-.518.644c.063 1.307.044 2.343.015 2.995a.617.617 0 0 0 .716.636c3.303-.534 17.037-2.412 35.664-.266.347.04.66-.214.692-.56.124-1.347.16-2.425.17-3.029a.616.616 0 0 0-.52-.62","fill","#192064"],["d","M96.398 145.264l.003-5.102a.843.843 0 0 0-.809-.847 114.104 114.104 0 0 0-8.141-.014.85.85 0 0 0-.82.847l-.003 5.097c0 .476.388.857.864.845 2.478-.064 5.166-.067 8.03.017a.848.848 0 0 0 .876-.843","fill","#FFF"],["d","M95.239 144.296l.002-3.195a.667.667 0 0 0-.643-.672c-1.9-.061-3.941-.073-6.094-.01a.675.675 0 0 0-.654.672l-.002 3.192c0 .376.305.677.68.669 1.859-.042 3.874-.043 6.02.012.376.01.69-.291.691-.668","fill","#192064"],["d","M90.102 273.522h12.819M91.216 269.761c.006 3.519-.072 5.55 0 6.292M90.923 263.474c-.009 1.599-.016 2.558-.016 4.505M90.44 170.404l.932 46.38s.7 1.631-.233 2.796c-.932 1.166 2.564.7.932 2.33-1.63 1.633.933 1.166 0 3.497-.618 1.546-1.031 21.921-1.138 36.513","stroke","#648BD8","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M73.736 98.665l2.214 4.312s2.098.816 1.865 2.68l.816 2.214M64.297 116.611c.233-.932 2.176-7.147 12.585-10.488M77.598 90.042s7.691 6.137 16.547 2.72","stroke","#E4EBF7","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M91.974 86.954s5.476-.816 7.574-4.545c1.297-.345.72 2.212-.33 3.671-.7.971-1.01 1.554-1.01 1.554s.194.31.155.816c-.053.697-.175.653-.272 1.048-.081.335.108.657 0 1.049-.046.17-.198.5-.382.878-.12.249-.072.687-.2.948-.231.469-1.562 1.87-2.622 2.855-3.826 3.554-5.018 1.644-6.001-.408-.894-1.865-.661-5.127-.874-6.875-.35-2.914-2.622-3.03-1.923-4.429.343-.685 2.87.69 3.263 1.748.757 2.04 2.952 1.807 2.622 1.69","fill","#FFC6A0"],["d","M99.8 82.429c-.465.077-.35.272-.97 1.243-.622.971-4.817 2.932-6.39 3.224-2.589.48-2.278-1.56-4.254-2.855-1.69-1.107-3.562-.638-1.398 1.398.99.932.932 1.107 1.398 3.205.335 1.506-.64 3.67.7 5.593","stroke","#DB836E","strokeWidth",".774","strokeLinecap","round","strokeLinejoin","round"],["d","M79.543 108.673c-2.1 2.926-4.266 6.175-5.557 8.762","stroke","#E59788","strokeWidth",".774","strokeLinecap","round","strokeLinejoin","round"],["d","M87.72 124.768s-2.098-1.942-5.127-2.719c-3.03-.777-3.574-.155-5.516.078-1.942.233-3.885-.932-3.652.7.233 1.63 5.05 1.01 5.206 2.097.155 1.087-6.37 2.796-8.313 2.175-.777.777.466 1.864 2.02 2.175.233 1.554 2.253 1.554 2.253 1.554s.699 1.01 2.641 1.088c2.486 1.32 8.934-.7 10.954-1.554 2.02-.855-.466-5.594-.466-5.594","fill","#FFC6A0"],["d","M73.425 122.826s.66 1.127 3.167 1.418c2.315.27 2.563.583 2.563.583s-2.545 2.894-9.07 2.272M72.416 129.274s3.826.097 4.933-.718M74.98 130.75s1.961.136 3.36-.505M77.232 131.916s1.748.019 2.914-.505M73.328 122.321s-.595-1.032 1.262-.427c1.671.544 2.833.055 5.128.155 1.389.061 3.067-.297 3.982.15 1.606.784 3.632 2.181 3.632 2.181s10.526 1.204 19.033-1.127M78.864 108.104s-8.39 2.758-13.168 12.12","stroke","#E59788","strokeWidth",".774","strokeLinecap","round","strokeLinejoin","round"],["d","M109.278 112.533s3.38-3.613 7.575-4.662","stroke","#E4EBF7","strokeWidth","1.085","strokeLinecap","round","strokeLinejoin","round"],["d","M107.375 123.006s9.697-2.745 11.445-.88","stroke","#E59788","strokeWidth",".774","strokeLinecap","round","strokeLinejoin","round"],["d","M194.605 83.656l3.971-3.886M187.166 90.933l3.736-3.655M191.752 84.207l-4.462-4.56M198.453 91.057l-4.133-4.225M129.256 163.074l3.718-3.718M122.291 170.039l3.498-3.498M126.561 163.626l-4.27-4.27M132.975 170.039l-3.955-3.955","stroke","#BFCDDD","strokeWidth","2","strokeLinecap","round","strokeLinejoin","round"],["d","M190.156 211.779h-1.604a4.023 4.023 0 0 1-4.011-4.011V175.68a4.023 4.023 0 0 1 4.01-4.01h1.605a4.023 4.023 0 0 1 4.011 4.01v32.088a4.023 4.023 0 0 1-4.01 4.01","fill","#A3B4C6"],["d","M237.824 212.977a4.813 4.813 0 0 1-4.813 4.813h-86.636a4.813 4.813 0 0 1 0-9.626h86.636a4.813 4.813 0 0 1 4.813 4.813","fill","#A3B4C6"],["fill","#A3B4C6","mask","url(#d)","d","M154.098 190.096h70.513v-84.617h-70.513z"],["d","M224.928 190.096H153.78a3.219 3.219 0 0 1-3.208-3.209V167.92a3.219 3.219 0 0 1 3.208-3.21h71.148a3.219 3.219 0 0 1 3.209 3.21v18.967a3.219 3.219 0 0 1-3.21 3.209M224.928 130.832H153.78a3.218 3.218 0 0 1-3.208-3.208v-18.968a3.219 3.219 0 0 1 3.208-3.209h71.148a3.219 3.219 0 0 1 3.209 3.21v18.967a3.218 3.218 0 0 1-3.21 3.208","fill","#BFCDDD","mask","url(#d)"],["d","M159.563 120.546a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M166.98 120.546a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M174.397 120.546a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M222.539 120.546h-22.461a.802.802 0 0 1-.802-.802v-3.208c0-.443.359-.803.802-.803h22.46c.444 0 .803.36.803.803v3.208c0 .443-.36.802-.802.802","fill","#FFF","mask","url(#d)"],["d","M224.928 160.464H153.78a3.218 3.218 0 0 1-3.208-3.209v-18.967a3.219 3.219 0 0 1 3.208-3.209h71.148a3.219 3.219 0 0 1 3.209 3.209v18.967a3.218 3.218 0 0 1-3.21 3.209","fill","#BFCDDD","mask","url(#d)"],["d","M173.455 130.832h49.301M164.984 130.832h6.089M155.952 130.832h6.75M173.837 160.613h49.3M165.365 160.613h6.089M155.57 160.613h6.751","stroke","#7C90A5","strokeWidth","1.124","strokeLinecap","round","strokeLinejoin","round","mask","url(#d)"],["d","M159.563 151.038a2.407 2.407 0 1 1 0-4.814 2.407 2.407 0 0 1 0 4.814M166.98 151.038a2.407 2.407 0 1 1 0-4.814 2.407 2.407 0 0 1 0 4.814M174.397 151.038a2.407 2.407 0 1 1 .001-4.814 2.407 2.407 0 0 1 0 4.814M222.539 151.038h-22.461a.802.802 0 0 1-.802-.802v-3.209c0-.443.359-.802.802-.802h22.46c.444 0 .803.36.803.802v3.209c0 .443-.36.802-.802.802M159.563 179.987a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M166.98 179.987a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M174.397 179.987a2.407 2.407 0 1 1 0-4.813 2.407 2.407 0 0 1 0 4.813M222.539 179.987h-22.461a.802.802 0 0 1-.802-.802v-3.209c0-.443.359-.802.802-.802h22.46c.444 0 .803.36.803.802v3.209c0 .443-.36.802-.802.802","fill","#FFF","mask","url(#d)"],["d","M203.04 221.108h-27.372a2.413 2.413 0 0 1-2.406-2.407v-11.448a2.414 2.414 0 0 1 2.406-2.407h27.372a2.414 2.414 0 0 1 2.407 2.407V218.7a2.413 2.413 0 0 1-2.407 2.407","fill","#BFCDDD","mask","url(#d)"],["d","M177.259 207.217v11.52M201.05 207.217v11.52","stroke","#A3B4C6","strokeWidth","1.124","strokeLinecap","round","strokeLinejoin","round","mask","url(#d)"],["d","M162.873 267.894a9.422 9.422 0 0 1-9.422-9.422v-14.82a9.423 9.423 0 0 1 18.845 0v14.82a9.423 9.423 0 0 1-9.423 9.422","fill","#5BA02E","mask","url(#d)"],["d","M171.22 267.83a9.422 9.422 0 0 1-9.422-9.423v-3.438a9.423 9.423 0 0 1 18.845 0v3.438a9.423 9.423 0 0 1-9.422 9.423","fill","#92C110","mask","url(#d)"],["d","M181.31 293.666h-27.712a3.209 3.209 0 0 1-3.209-3.21V269.79a3.209 3.209 0 0 1 3.209-3.21h27.711a3.209 3.209 0 0 1 3.209 3.21v20.668a3.209 3.209 0 0 1-3.209 3.209","fill","#F2D7AD","mask","url(#d)"]],template:function(n,o){n&1&&(Tt(),ue(0,"svg",0)(1,"defs"),we(2,"path",1)(3,"path",2),se(),ue(4,"g",3)(5,"g",4),we(6,"mask",5)(7,"path",6),se(),we(8,"path",7)(9,"path",8)(10,"path",9)(11,"path",10)(12,"path",11)(13,"path",12)(14,"path",13)(15,"path",14)(16,"path",15)(17,"path",16)(18,"path",17)(19,"path",18)(20,"path",19)(21,"path",20)(22,"path",21)(23,"path",22)(24,"path",23)(25,"path",24)(26,"path",25)(27,"path",26)(28,"path",27)(29,"path",28)(30,"path",29)(31,"path",30)(32,"path",31)(33,"path",32)(34,"path",33)(35,"path",34)(36,"path",35)(37,"path",36)(38,"path",37)(39,"path",38)(40,"path",39)(41,"path",40)(42,"path",41)(43,"path",42)(44,"path",43)(45,"path",44)(46,"path",45)(47,"path",46)(48,"path",47)(49,"path",48)(50,"path",49)(51,"path",50)(52,"path",51)(53,"path",52)(54,"path",53)(55,"path",54)(56,"path",55)(57,"mask",5)(58,"path",56)(59,"path",57)(60,"path",58)(61,"path",59)(62,"path",60)(63,"path",61)(64,"path",62)(65,"path",63)(66,"path",64)(67,"path",65)(68,"path",66),se()())},encapsulation:2,changeDetection:0})}return r})(),ih=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Je({type:r,selectors:[["nz-result-unauthorized"]],exportAs:["nzResultUnauthorized"],decls:56,vars:0,consts:[["width","251","height","294"],["fill","none","fillRule","evenodd"],["d","M0 129.023v-2.084C0 58.364 55.591 2.774 124.165 2.774h2.085c68.574 0 124.165 55.59 124.165 124.165v2.084c0 68.575-55.59 124.166-124.165 124.166h-2.085C55.591 253.189 0 197.598 0 129.023","fill","#E4EBF7"],["d","M41.417 132.92a8.231 8.231 0 1 1-16.38-1.65 8.231 8.231 0 0 1 16.38 1.65","fill","#FFF"],["d","M38.652 136.36l10.425 5.91M49.989 148.505l-12.58 10.73","stroke","#FFF","strokeWidth","2"],["d","M41.536 161.28a5.636 5.636 0 1 1-11.216-1.13 5.636 5.636 0 0 1 11.216 1.13M59.154 145.261a5.677 5.677 0 1 1-11.297-1.138 5.677 5.677 0 0 1 11.297 1.138M100.36 29.516l29.66-.013a4.562 4.562 0 1 0-.004-9.126l-29.66.013a4.563 4.563 0 0 0 .005 9.126M111.705 47.754l29.659-.013a4.563 4.563 0 1 0-.004-9.126l-29.66.013a4.563 4.563 0 1 0 .005 9.126","fill","#FFF"],["d","M114.066 29.503V29.5l15.698-.007a4.563 4.563 0 1 0 .004 9.126l-15.698.007v-.002a4.562 4.562 0 0 0-.004-9.122M185.405 137.723c-.55 5.455-5.418 9.432-10.873 8.882-5.456-.55-9.432-5.418-8.882-10.873.55-5.455 5.418-9.432 10.873-8.882 5.455.55 9.432 5.418 8.882 10.873","fill","#FFF"],["d","M180.17 143.772l12.572 7.129M193.841 158.42L178.67 171.36","stroke","#FFF","strokeWidth","2"],["d","M185.55 171.926a6.798 6.798 0 1 1-13.528-1.363 6.798 6.798 0 0 1 13.527 1.363M204.12 155.285a6.848 6.848 0 1 1-13.627-1.375 6.848 6.848 0 0 1 13.626 1.375","fill","#FFF"],["d","M152.988 194.074a2.21 2.21 0 1 1-4.42 0 2.21 2.21 0 0 1 4.42 0zM225.931 118.217a2.21 2.21 0 1 1-4.421 0 2.21 2.21 0 0 1 4.421 0zM217.09 153.051a2.21 2.21 0 1 1-4.421 0 2.21 2.21 0 0 1 4.42 0zM177.84 109.842a2.21 2.21 0 1 1-4.422 0 2.21 2.21 0 0 1 4.421 0zM196.114 94.454a2.21 2.21 0 1 1-4.421 0 2.21 2.21 0 0 1 4.421 0zM202.844 182.523a2.21 2.21 0 1 1-4.42 0 2.21 2.21 0 0 1 4.42 0z","stroke","#FFF","strokeWidth","2"],["stroke","#FFF","strokeWidth","2","d","M215.125 155.262l-1.902 20.075-10.87 5.958M174.601 176.636l-6.322 9.761H156.98l-4.484 6.449M175.874 127.28V111.56M221.51 119.404l-12.77 7.859-15.228-7.86V96.668"],["d","M180.68 29.32C180.68 13.128 193.806 0 210 0c16.193 0 29.32 13.127 29.32 29.32 0 16.194-13.127 29.322-29.32 29.322-16.193 0-29.32-13.128-29.32-29.321","fill","#A26EF4"],["d","M221.45 41.706l-21.563-.125a1.744 1.744 0 0 1-1.734-1.754l.071-12.23a1.744 1.744 0 0 1 1.754-1.734l21.562.125c.964.006 1.74.791 1.735 1.755l-.071 12.229a1.744 1.744 0 0 1-1.754 1.734","fill","#FFF"],["d","M215.106 29.192c-.015 2.577-2.049 4.654-4.543 4.64-2.494-.014-4.504-2.115-4.489-4.693l.04-6.925c.016-2.577 2.05-4.654 4.543-4.64 2.494.015 4.504 2.116 4.49 4.693l-.04 6.925zm-4.53-14.074a6.877 6.877 0 0 0-6.916 6.837l-.043 7.368a6.877 6.877 0 0 0 13.754.08l.042-7.368a6.878 6.878 0 0 0-6.837-6.917zM167.566 68.367h-3.93a4.73 4.73 0 0 1-4.717-4.717 4.73 4.73 0 0 1 4.717-4.717h3.93a4.73 4.73 0 0 1 4.717 4.717 4.73 4.73 0 0 1-4.717 4.717","fill","#FFF"],["d","M168.214 248.838a6.611 6.611 0 0 1-6.61-6.611v-66.108a6.611 6.611 0 0 1 13.221 0v66.108a6.611 6.611 0 0 1-6.61 6.61","fill","#5BA02E"],["d","M176.147 248.176a6.611 6.611 0 0 1-6.61-6.61v-33.054a6.611 6.611 0 1 1 13.221 0v33.053a6.611 6.611 0 0 1-6.61 6.611","fill","#92C110"],["d","M185.994 293.89h-27.376a3.17 3.17 0 0 1-3.17-3.17v-45.887a3.17 3.17 0 0 1 3.17-3.17h27.376a3.17 3.17 0 0 1 3.17 3.17v45.886a3.17 3.17 0 0 1-3.17 3.17","fill","#F2D7AD"],["d","M81.972 147.673s6.377-.927 17.566-1.28c11.729-.371 17.57 1.086 17.57 1.086s3.697-3.855.968-8.424c1.278-12.077 5.982-32.827.335-48.273-1.116-1.339-3.743-1.512-7.536-.62-1.337.315-7.147-.149-7.983-.1l-15.311-.347s-3.487-.17-8.035-.508c-1.512-.113-4.227-1.683-5.458-.338-.406.443-2.425 5.669-1.97 16.077l8.635 35.642s-3.141 3.61 1.219 7.085","fill","#FFF"],["d","M75.768 73.325l-.9-6.397 11.982-6.52s7.302-.118 8.038 1.205c.737 1.324-5.616.993-5.616.993s-1.836 1.388-2.615 2.5c-1.654 2.363-.986 6.471-8.318 5.986-1.708.284-2.57 2.233-2.57 2.233","fill","#FFC6A0"],["d","M52.44 77.672s14.217 9.406 24.973 14.444c1.061.497-2.094 16.183-11.892 11.811-7.436-3.318-20.162-8.44-21.482-14.496-.71-3.258 2.543-7.643 8.401-11.76M141.862 80.113s-6.693 2.999-13.844 6.876c-3.894 2.11-10.137 4.704-12.33 7.988-6.224 9.314 3.536 11.22 12.947 7.503 6.71-2.651 28.999-12.127 13.227-22.367","fill","#FFB594"],["d","M76.166 66.36l3.06 3.881s-2.783 2.67-6.31 5.747c-7.103 6.195-12.803 14.296-15.995 16.44-3.966 2.662-9.754 3.314-12.177-.118-3.553-5.032.464-14.628 31.422-25.95","fill","#FFC6A0"],["d","M64.674 85.116s-2.34 8.413-8.912 14.447c.652.548 18.586 10.51 22.144 10.056 5.238-.669 6.417-18.968 1.145-20.531-.702-.208-5.901-1.286-8.853-2.167-.87-.26-1.611-1.71-3.545-.936l-1.98-.869zM128.362 85.826s5.318 1.956 7.325 13.734c-.546.274-17.55 12.35-21.829 7.805-6.534-6.94-.766-17.393 4.275-18.61 4.646-1.121 5.03-1.37 10.23-2.929","fill","#FFF"],["d","M78.18 94.656s.911 7.41-4.914 13.078","stroke","#E4EBF7","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M87.397 94.68s3.124 2.572 10.263 2.572c7.14 0 9.074-3.437 9.074-3.437","stroke","#E4EBF7","strokeWidth",".932","strokeLinecap","round","strokeLinejoin","round"],["d","M117.184 68.639l-6.781-6.177s-5.355-4.314-9.223-.893c-3.867 3.422 4.463 2.083 5.653 4.165 1.19 2.082.848 1.143-2.083.446-5.603-1.331-2.082.893 2.975 5.355 2.091 1.845 6.992.955 6.992.955l2.467-3.851z","fill","#FFC6A0"],["d","M105.282 91.315l-.297-10.937-15.918-.027-.53 10.45c-.026.403.17.788.515.999 2.049 1.251 9.387 5.093 15.799.424.287-.21.443-.554.431-.91","fill","#FFB594"],["d","M107.573 74.24c.817-1.147.982-9.118 1.015-11.928a1.046 1.046 0 0 0-.965-1.055l-4.62-.365c-7.71-1.044-17.071.624-18.253 6.346-5.482 5.813-.421 13.244-.421 13.244s1.963 3.566 4.305 6.791c.756 1.041.398-3.731 3.04-5.929 5.524-4.594 15.899-7.103 15.899-7.103","fill","#5C2552"],["d","M88.426 83.206s2.685 6.202 11.602 6.522c7.82.28 8.973-7.008 7.434-17.505l-.909-5.483c-6.118-2.897-15.478.54-15.478.54s-.576 2.044-.19 5.504c-2.276 2.066-1.824 5.618-1.824 5.618s-.905-1.922-1.98-2.321c-.86-.32-1.897.089-2.322 1.98-1.04 4.632 3.667 5.145 3.667 5.145","fill","#FFC6A0"],["stroke","#DB836E","strokeWidth","1.145","strokeLinecap","round","strokeLinejoin","round","d","M100.843 77.099l1.701-.928-1.015-4.324.674-1.406"],["d","M105.546 74.092c-.022.713-.452 1.279-.96 1.263-.51-.016-.904-.607-.882-1.32.021-.713.452-1.278.96-1.263.51.016.904.607.882 1.32M97.592 74.349c-.022.713-.452 1.278-.961 1.263-.509-.016-.904-.607-.882-1.32.022-.713.452-1.279.961-1.263.51.016.904.606.882 1.32","fill","#552950"],["d","M91.132 86.786s5.269 4.957 12.679 2.327","stroke","#DB836E","strokeWidth","1.145","strokeLinecap","round","strokeLinejoin","round"],["d","M99.776 81.903s-3.592.232-1.44-2.79c1.59-1.496 4.897-.46 4.897-.46s1.156 3.906-3.457 3.25","fill","#DB836E"],["d","M102.88 70.6s2.483.84 3.402.715M93.883 71.975s2.492-1.144 4.778-1.073","stroke","#5C2552","strokeWidth","1.526","strokeLinecap","round","strokeLinejoin","round"],["d","M86.32 77.374s.961.879 1.458 2.106c-.377.48-1.033 1.152-.236 1.809M99.337 83.719s1.911.151 2.509-.254","stroke","#DB836E","strokeWidth","1.145","strokeLinecap","round","strokeLinejoin","round"],["d","M87.782 115.821l15.73-3.012M100.165 115.821l10.04-2.008","stroke","#E4EBF7","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M66.508 86.763s-1.598 8.83-6.697 14.078","stroke","#E4EBF7","strokeWidth","1.114","strokeLinecap","round","strokeLinejoin","round"],["d","M128.31 87.934s3.013 4.121 4.06 11.785","stroke","#E4EBF7","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M64.09 84.816s-6.03 9.912-13.607 9.903","stroke","#DB836E","strokeWidth",".795","strokeLinecap","round","strokeLinejoin","round"],["d","M112.366 65.909l-.142 5.32s5.993 4.472 11.945 9.202c4.482 3.562 8.888 7.455 10.985 8.662 4.804 2.766 8.9 3.355 11.076 1.808 4.071-2.894 4.373-9.878-8.136-15.263-4.271-1.838-16.144-6.36-25.728-9.73","fill","#FFC6A0"],["d","M130.532 85.488s4.588 5.757 11.619 6.214","stroke","#DB836E","strokeWidth",".75","strokeLinecap","round","strokeLinejoin","round"],["d","M121.708 105.73s-.393 8.564-1.34 13.612","stroke","#E4EBF7","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M115.784 161.512s-3.57-1.488-2.678-7.14","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M101.52 290.246s4.326 2.057 7.408 1.03c2.842-.948 4.564.673 7.132 1.186 2.57.514 6.925 1.108 11.772-1.269-.104-5.551-6.939-4.01-12.048-6.763-2.582-1.39-3.812-4.757-3.625-8.863h-9.471s-1.402 10.596-1.169 14.68","fill","#CBD1D1"],["d","M101.496 290.073s2.447 1.281 6.809.658c3.081-.44 3.74.485 7.479 1.039 3.739.554 10.802-.07 11.91-.9.415 1.108-.347 2.077-.347 2.077s-1.523.608-4.847.831c-2.045.137-5.843.293-7.663-.507-1.8-1.385-5.286-1.917-5.77-.243-3.947.958-7.41-.288-7.41-.288l-.16-2.667z","fill","#2B0849"],["d","M108.824 276.19h3.116s-.103 6.751 4.57 8.62c-4.673.624-8.62-2.32-7.686-8.62","fill","#A4AABA"],["d","M57.65 272.52s-2.122 7.47-4.518 12.396c-1.811 3.724-4.255 7.548 5.505 7.548 6.698 0 9.02-.483 7.479-6.648-1.541-6.164.268-13.296.268-13.296H57.65z","fill","#CBD1D1"],["d","M51.54 290.04s2.111 1.178 6.682 1.178c6.128 0 8.31-1.662 8.31-1.662s.605 1.122-.624 2.18c-1 .862-3.624 1.603-7.444 1.559-4.177-.049-5.876-.57-6.786-1.177-.831-.554-.692-1.593-.138-2.078","fill","#2B0849"],["d","M58.533 274.438s.034 1.529-.315 2.95c-.352 1.431-1.087 3.127-1.139 4.17-.058 1.16 4.57 1.592 5.194.035.623-1.559 1.303-6.475 1.927-7.306.622-.831-4.94-2.135-5.667.15","fill","#A4AABA"],["d","M100.885 277.015l13.306.092s1.291-54.228 1.843-64.056c.552-9.828 3.756-43.13.997-62.788l-12.48-.64-22.725.776s-.433 3.944-1.19 9.921c-.062.493-.677.838-.744 1.358-.075.582.42 1.347.318 1.956-2.35 14.003-6.343 32.926-8.697 46.425-.116.663-1.227 1.004-1.45 2.677-.04.3.21 1.516.112 1.785-6.836 18.643-10.89 47.584-14.2 61.551l14.528-.014s2.185-8.524 4.008-16.878c2.796-12.817 22.987-84.553 22.987-84.553l3-.517 1.037 46.1s-.223 1.228.334 2.008c.558.782-.556 1.117-.39 2.233l.39 1.784s-.446 7.14-.892 11.826c-.446 4.685-.092 38.954-.092 38.954","fill","#7BB2F9"],["d","M77.438 220.434c1.146.094 4.016-2.008 6.916-4.91M107.55 223.931s2.758-1.103 6.069-3.862","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M108.459 220.905s2.759-1.104 6.07-3.863","stroke","#648BD8","strokeLinecap","round","strokeLinejoin","round"],["d","M76.099 223.557s2.608-.587 6.47-3.346M87.33 150.82c-.27 3.088.297 8.478-4.315 9.073M104.829 149.075s.11 13.936-1.286 14.983c-2.207 1.655-2.975 1.934-2.975 1.934M101.014 149.63s.035 12.81-1.19 24.245M94.93 174.965s7.174-1.655 9.38-1.655M75.671 204.754c-.316 1.55-.64 3.067-.973 4.535 0 0-1.45 1.822-1.003 3.756.446 1.934-.943 2.034-4.96 15.273-1.686 5.559-4.464 18.49-6.313 27.447-.078.38-4.018 18.06-4.093 18.423M77.043 196.743a313.269 313.269 0 0 1-.877 4.729M83.908 151.414l-1.19 10.413s-1.091.148-.496 2.23c.111 1.34-2.66 15.692-5.153 30.267M57.58 272.94h13.238","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"],["d","M117.377 147.423s-16.955-3.087-35.7.199c.157 2.501-.002 4.128-.002 4.128s14.607-2.802 35.476-.31c.251-2.342.226-4.017.226-4.017","fill","#192064"],["d","M107.511 150.353l.004-4.885a.807.807 0 0 0-.774-.81c-2.428-.092-5.04-.108-7.795-.014a.814.814 0 0 0-.784.81l-.003 4.88c0 .456.371.82.827.808a140.76 140.76 0 0 1 7.688.017.81.81 0 0 0 .837-.806","fill","#FFF"],["d","M106.402 149.426l.002-3.06a.64.64 0 0 0-.616-.643 94.135 94.135 0 0 0-5.834-.009.647.647 0 0 0-.626.643l-.001 3.056c0 .36.291.648.651.64 1.78-.04 3.708-.041 5.762.012.36.009.662-.279.662-.64","fill","#192064"],["d","M101.485 273.933h12.272M102.652 269.075c.006 3.368.04 5.759.11 6.47M102.667 263.125c-.009 1.53-.015 2.98-.016 4.313M102.204 174.024l.893 44.402s.669 1.561-.224 2.677c-.892 1.116 2.455.67.893 2.231-1.562 1.562.893 1.116 0 3.347-.592 1.48-.988 20.987-1.09 34.956","stroke","#648BD8","strokeWidth","1.051","strokeLinecap","round","strokeLinejoin","round"]],template:function(n,o){n&1&&(Tt(),ue(0,"svg",0)(1,"g",1),we(2,"path",2)(3,"path",3)(4,"path",4)(5,"path",5)(6,"path",6)(7,"path",7)(8,"path",8)(9,"path",9)(10,"path",10)(11,"path",11)(12,"path",12)(13,"path",13)(14,"path",14)(15,"path",15)(16,"path",16)(17,"path",17)(18,"path",18)(19,"path",19)(20,"path",20)(21,"path",21)(22,"path",22)(23,"path",23)(24,"path",24)(25,"path",25)(26,"path",26)(27,"path",27)(28,"path",28)(29,"path",29)(30,"path",30)(31,"path",31)(32,"path",32)(33,"path",33)(34,"path",34)(35,"path",35)(36,"path",36)(37,"path",37)(38,"path",38)(39,"path",39)(40,"path",40)(41,"path",41)(42,"path",42)(43,"path",43)(44,"path",44)(45,"path",45)(46,"path",46)(47,"path",47)(48,"path",48)(49,"path",49)(50,"path",50)(51,"path",51)(52,"path",52)(53,"path",53)(54,"path",54)(55,"path",55),se()())},encapsulation:2,changeDetection:0})}return r})();var Yi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275dir=n1({type:r,selectors:[["div","nz-result-extra",""]],hostAttrs:[1,"ant-result-extra"],exportAs:["nzResultExtra"]})}return r})(),Xi={success:"check-circle",error:"close-circle",info:"exclamation-circle",warning:"warning"},ch=["404","500","403"],q0=(()=>{class r{cdr;directionality;nzIcon;nzTitle;nzStatus="info";nzSubTitle;nzExtra;icon;isException=!1;dir="ltr";destroy$=new t1;constructor(e,n){this.cdr=e,this.directionality=n}ngOnInit(){this.directionality.change?.pipe(z1(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnChanges(){this.setStatusIcon()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setStatusIcon(){let e=this.nzIcon;this.isException=ch.indexOf(this.nzStatus)!==-1,this.icon=e?typeof e=="string"&&Xi[e]||e:this.isException?void 0:Xi[this.nzStatus]}static \u0275fac=function(n){return new(n||r)(ve($1),ve(xt))};static \u0275cmp=Je({type:r,selectors:[["nz-result"]],hostAttrs:[1,"ant-result"],hostVars:10,hostBindings:function(n,o){n&2&&C1("ant-result-success",o.nzStatus==="success")("ant-result-error",o.nzStatus==="error")("ant-result-info",o.nzStatus==="info")("ant-result-warning",o.nzStatus==="warning")("ant-result-rtl",o.dir==="rtl")},inputs:{nzIcon:"nzIcon",nzTitle:"nzTitle",nzStatus:"nzStatus",nzSubTitle:"nzSubTitle",nzExtra:"nzExtra"},exportAs:["nzResult"],features:[l1],ngContentSelectors:N9,decls:10,vars:4,consts:[[1,"ant-result-icon"],[1,"ant-result-title"],[1,"ant-result-subtitle"],[1,"ant-result-extra"],[4,"nzStringTemplateOutlet"],["nzTheme","fill",3,"nzType"],["class","ant-result-title",4,"nzStringTemplateOutlet"],["class","ant-result-subtitle",4,"nzStringTemplateOutlet"],["class","ant-result-extra",4,"nzStringTemplateOutlet"]],template:function(n,o){n&1&&(ut(O9),ue(0,"div",0),ie(1,G9,2,1)(2,K9,3,1),se(),ie(3,Y9,1,1,"div",1)(4,Z9,1,0)(5,J9,1,1,"div",2)(6,eh,1,0),A1(7),ie(8,nh,1,1,"div",3)(9,rh,1,0)),n&2&&(ee(),fe(o.isException?2:1),ee(2),fe(o.nzTitle?3:4),ee(2),fe(o.nzSubTitle?5:6),ee(3),fe(o.nzExtra?8:9))},dependencies:[jn,Qt,Zt,At,oh,ah,ih],encapsulation:2,changeDetection:0})}return r})();var Zi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({imports:[q0]})}return r})();var lh=r=>({$implicit:r});function uh(r,t){if(r&1&&we(0,"nz-icon",3),r&2){let e=re(3);Se("nzType",e.icon)}}function hh(r,t){if(r&1&&($t(0),_1(1),Kt()),r&2){let e=t.$implicit,n=re(4);ee(),_4(" ",e(n.nzPercent)," ")}}function fh(r,t){if(r&1&&ie(0,hh,2,1,"ng-container",4),r&2){let e=re(3);Se("nzStringTemplateOutlet",e.formatter)("nzStringTemplateOutletContext",Er(2,lh,e.nzPercent))}}function dh(r,t){if(r&1&&(ue(0,"span",2),ie(1,uh,1,1,"nz-icon",3)(2,fh,1,4,"ng-container"),se()),r&2){let e=re(2);ee(),fe((e.status==="exception"||e.status==="success")&&!e.nzFormat?1:2)}}function ph(r,t){if(r&1&&ie(0,dh,3,1,"span",2),r&2){let e=re();fe(e.nzShowInfo?0:-1)}}function vh(r,t){if(r&1&&we(0,"div",8),r&2){let e=t.$implicit;xn(e)}}function mh(r,t){}function gh(r,t){if(r&1&&(ue(0,"div",5),Lt(1,vh,1,2,"div",6,M4),ie(3,mh,0,0,"ng-template",7),se()),r&2){let e=re(2),n=C4(1);ee(),Ft(e.steps),ee(2),Se("ngTemplateOutlet",n)}}function xh(r,t){if(r&1&&we(0,"div",13),r&2){let e=re(3);rt("width",e.nzSuccessPercent,"%")("border-radius",e.nzStrokeLinecap==="round"?"100px":"0")("height",e.strokeWidth,"px")}}function bh(r,t){}function yh(r,t){if(r&1&&(ue(0,"div",9)(1,"div",10),we(2,"div",11),ie(3,xh,1,6,"div",12),se()(),ie(4,bh,0,0,"ng-template",7)),r&2){let e=re(2),n=C4(1);ee(2),rt("width",e.nzPercent,"%")("border-radius",e.nzStrokeLinecap==="round"?"100px":"0")("background",e.isGradient?null:e.nzStrokeColor)("background-image",e.isGradient?e.lineGradient:null)("height",e.strokeWidth,"px"),ee(),fe(e.nzSuccessPercent||e.nzSuccessPercent===0?3:-1),ee(),Se("ngTemplateOutlet",n)}}function wh(r,t){if(r&1&&(ue(0,"div"),ie(1,gh,4,1,"div",5)(2,yh,5,12),se()),r&2){let e=re();ee(),fe(e.isSteps?1:2)}}function zh(r,t){if(r&1&&(Tt(),we(0,"stop")),r&2){let e=t.$implicit;On("offset",e.offset)("stop-color",e.color)}}function Mh(r,t){if(r&1&&(Tt(),ue(0,"defs")(1,"linearGradient",17),Lt(2,zh,1,2,":svg:stop",null,M4),se()()),r&2){let e=re(2);ee(),Se("id","gradient-"+e.gradientId),ee(),Ft(e.circleGradient)}}function Ch(r,t){if(r&1&&(Tt(),we(0,"path",18)),r&2){let e=t.$implicit,n=re(2);xn(e.strokePathStyle),On("d",n.pathString)("stroke-linecap",n.nzStrokeLinecap)("stroke",e.stroke)("stroke-width",n.nzPercent?n.strokeWidth:0)}}function _h(r,t){}function Eh(r,t){if(r&1&&(ue(0,"div",10),Tt(),ue(1,"svg",14),ie(2,Mh,4,1,":svg:defs"),we(3,"path",15),Lt(4,Ch,1,6,":svg:path",16,M4),se(),ie(6,_h,0,0,"ng-template",7),se()),r&2){let e=re(),n=C4(1);rt("width",e.nzWidth,"px")("height",e.nzWidth,"px")("font-size",e.nzWidth*.15+6,"px"),C1("ant-progress-circle-gradient",e.isGradient),ee(2),fe(e.isGradient?2:-1),ee(),xn(e.trailPathStyle),On("stroke-width",e.strokeWidth)("d",e.pathString),ee(),Ft(e.progressCirclePath),ee(2),Se("ngTemplateOutlet",n)}}function Sh(r){return+r.replace("%","")}var Ji=r=>{let t=[];return Object.keys(r).forEach(e=>{let n=r[e],o=Sh(e);isNaN(o)||t.push({key:o,value:n})}),t=t.sort((e,n)=>e.key-n.key),t},kh=r=>Ji(r).map(({key:t,value:e})=>({offset:`${t}%`,color:e})),Hh=r=>{let a=r,{from:t="#1890ff",to:e="#1890ff",direction:n="to right"}=a,o=Y6(a,["from","to","direction"]);if(Object.keys(o).length!==0){let i=Ji(o).map(({key:c,value:s})=>`${s} ${c}%`).join(", ");return`linear-gradient(${n}, ${i})`}return`linear-gradient(${n}, ${t}, ${e})`},Vh=0,Qi="progress",Th=new Map([["success","check"],["exception","close"]]),Lh=new Map([["normal","#108ee9"],["exception","#ff5500"],["success","#87d068"]]),Fh=r=>`${r}%`,$0=(()=>{let r,t=[],e=[],n,o=[],a=[],i,c=[],s=[],l,u=[],h=[],f,d=[],p=[],v,m=[],g=[],b,y=[],x=[];return class j0{static{let z=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;r=[D1()],n=[D1()],i=[D1()],l=[D1()],f=[D1()],v=[D1()],b=[D1()],L1(null,null,r,{kind:"field",name:"nzShowInfo",static:!1,private:!1,access:{has:M=>"nzShowInfo"in M,get:M=>M.nzShowInfo,set:(M,_)=>{M.nzShowInfo=_}},metadata:z},t,e),L1(null,null,n,{kind:"field",name:"nzStrokeColor",static:!1,private:!1,access:{has:M=>"nzStrokeColor"in M,get:M=>M.nzStrokeColor,set:(M,_)=>{M.nzStrokeColor=_}},metadata:z},o,a),L1(null,null,i,{kind:"field",name:"nzSize",static:!1,private:!1,access:{has:M=>"nzSize"in M,get:M=>M.nzSize,set:(M,_)=>{M.nzSize=_}},metadata:z},c,s),L1(null,null,l,{kind:"field",name:"nzStrokeWidth",static:!1,private:!1,access:{has:M=>"nzStrokeWidth"in M,get:M=>M.nzStrokeWidth,set:(M,_)=>{M.nzStrokeWidth=_}},metadata:z},u,h),L1(null,null,f,{kind:"field",name:"nzGapDegree",static:!1,private:!1,access:{has:M=>"nzGapDegree"in M,get:M=>M.nzGapDegree,set:(M,_)=>{M.nzGapDegree=_}},metadata:z},d,p),L1(null,null,v,{kind:"field",name:"nzGapPosition",static:!1,private:!1,access:{has:M=>"nzGapPosition"in M,get:M=>M.nzGapPosition,set:(M,_)=>{M.nzGapPosition=_}},metadata:z},m,g),L1(null,null,b,{kind:"field",name:"nzStrokeLinecap",static:!1,private:!1,access:{has:M=>"nzStrokeLinecap"in M,get:M=>M.nzStrokeLinecap,set:(M,_)=>{M.nzStrokeLinecap=_}},metadata:z},y,x),z&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:z})}cdr;nzConfigService;directionality;_nzModuleName=Qi;nzShowInfo=De(this,t,!0);nzWidth=(De(this,e),132);nzStrokeColor=De(this,o,void 0);nzSize=(De(this,a),De(this,c,"default"));nzFormat=De(this,s);nzSuccessPercent;nzPercent=0;nzStrokeWidth=De(this,u,void 0);nzGapDegree=(De(this,h),De(this,d,void 0));nzStatus=De(this,p);nzType="line";nzGapPosition=De(this,m,"top");nzStrokeLinecap=(De(this,g),De(this,y,"round"));nzSteps=(De(this,x),0);steps=[];lineGradient=null;isGradient=!1;isSteps=!1;gradientId=Vh++;progressCirclePath=[];circleGradient;trailPathStyle=null;pathString;icon;dir="ltr";get formatter(){return this.nzFormat||Fh}get status(){return this.nzStatus||this.inferredStatus}get strokeWidth(){return this.nzStrokeWidth||(this.nzType==="line"&&this.nzSize!=="small"?8:6)}get isCircleStyle(){return this.nzType==="circle"||this.nzType==="dashboard"}cachedStatus="normal";inferredStatus="normal";destroy$=new t1;constructor(z,M,_){this.cdr=z,this.nzConfigService=M,this.directionality=_}ngOnChanges(z){let{nzSteps:M,nzGapPosition:_,nzStrokeLinecap:S,nzStrokeColor:k,nzGapDegree:L,nzType:V,nzStatus:I,nzPercent:D,nzSuccessPercent:R,nzStrokeWidth:P}=z;I&&(this.cachedStatus=this.nzStatus||this.cachedStatus),(D||R)&&(parseInt(this.nzPercent.toString(),10)>=100?(_0(this.nzSuccessPercent)&&this.nzSuccessPercent>=100||this.nzSuccessPercent===void 0)&&(this.inferredStatus="success"):this.inferredStatus=this.cachedStatus),(I||D||R||k)&&this.updateIcon(),k&&this.setStrokeColor(),(_||S||L||V||D||k||k)&&this.getCirclePaths(),(D||M||P)&&(this.isSteps=this.nzSteps>0,this.isSteps&&this.getSteps())}ngOnInit(){this.nzConfigService.getConfigChangeEventForComponent(Qi).pipe(z1(this.destroy$)).subscribe(()=>{this.updateIcon(),this.setStrokeColor(),this.getCirclePaths()}),this.directionality.change?.pipe(z1(this.destroy$)).subscribe(z=>{this.dir=z,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateIcon(){let z=Th.get(this.status);this.icon=z?z+(this.isCircleStyle?"-o":"-circle-fill"):""}getSteps(){let z=Math.floor(this.nzSteps*(this.nzPercent/100)),M=this.nzSize==="small"?2:14,_=[];for(let S=0;S<this.nzSteps;S++){let k;S<=z-1&&(k=this.nzStrokeColor);let L={backgroundColor:`${k}`,width:`${M}px`,height:`${this.strokeWidth}px`};_.push(L)}this.steps=_}getCirclePaths(){if(!this.isCircleStyle)return;let z=_0(this.nzSuccessPercent)?[this.nzSuccessPercent,this.nzPercent]:[this.nzPercent],M=50-this.strokeWidth/2,_=this.nzGapPosition||(this.nzType==="circle"?"top":"bottom"),S=Math.PI*2*M,k=this.nzGapDegree||(this.nzType==="circle"?0:75),L=0,V=-M,I=0,D=M*-2;switch(_){case"left":L=-M,V=0,I=M*2,D=0;break;case"right":L=M,V=0,I=M*-2,D=0;break;case"bottom":V=M,D=M*2;break;default:}this.pathString=`M 50,50 m ${L},${V}
       a ${M},${M} 0 1 1 ${I},${-D}
       a ${M},${M} 0 1 1 ${-I},${D}`,this.trailPathStyle={strokeDasharray:`${S-k}px ${S}px`,strokeDashoffset:`-${k/2}px`,transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s"},this.progressCirclePath=z.map((R,P)=>{let N=z.length===2&&P===0;return{stroke:this.isGradient&&!N?`url(#gradient-${this.gradientId})`:null,strokePathStyle:{stroke:this.isGradient?null:N?Lh.get("success"):this.nzStrokeColor,transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s",strokeDasharray:`${(R||0)/100*(S-k)}px ${S}px`,strokeDashoffset:`-${k/2}px`}}}).reverse()}setStrokeColor(){let z=this.nzStrokeColor,M=this.isGradient=!!z&&typeof z!="string";M&&!this.isCircleStyle?this.lineGradient=Hh(z):M&&this.isCircleStyle?this.circleGradient=kh(this.nzStrokeColor):(this.lineGradient=null,this.circleGradient=[])}static \u0275fac=function(M){return new(M||j0)(ve($1),ve(gt),ve(xt))};static \u0275cmp=Je({type:j0,selectors:[["nz-progress"]],inputs:{nzShowInfo:"nzShowInfo",nzWidth:"nzWidth",nzStrokeColor:"nzStrokeColor",nzSize:"nzSize",nzFormat:"nzFormat",nzSuccessPercent:[2,"nzSuccessPercent","nzSuccessPercent",Dr],nzPercent:[2,"nzPercent","nzPercent",Wn],nzStrokeWidth:[2,"nzStrokeWidth","nzStrokeWidth",Dr],nzGapDegree:[2,"nzGapDegree","nzGapDegree",Dr],nzStatus:"nzStatus",nzType:"nzType",nzGapPosition:"nzGapPosition",nzStrokeLinecap:"nzStrokeLinecap",nzSteps:[2,"nzSteps","nzSteps",Wn]},exportAs:["nzProgress"],features:[l1],decls:5,vars:18,consts:[["progressInfoTemplate",""],[1,"ant-progress-inner",3,"width","height","fontSize","ant-progress-circle-gradient"],[1,"ant-progress-text"],[3,"nzType"],[4,"nzStringTemplateOutlet","nzStringTemplateOutletContext"],[1,"ant-progress-steps-outer"],[1,"ant-progress-steps-item",3,"style"],[3,"ngTemplateOutlet"],[1,"ant-progress-steps-item"],[1,"ant-progress-outer"],[1,"ant-progress-inner"],[1,"ant-progress-bg"],[1,"ant-progress-success-bg",3,"width","border-radius","height"],[1,"ant-progress-success-bg"],["viewBox","0 0 100 100",1,"ant-progress-circle"],["stroke","#f3f3f3","fill-opacity","0",1,"ant-progress-circle-trail"],["fill-opacity","0",1,"ant-progress-circle-path",3,"style"],["x1","100%","y1","0%","x2","0%","y2","0%",3,"id"],["fill-opacity","0",1,"ant-progress-circle-path"]],template:function(M,_){M&1&&(ie(0,ph,1,1,"ng-template",null,0,g8),ue(2,"div"),ie(3,wh,3,1,"div")(4,Eh,7,14,"div",1),se()),M&2&&(ee(2),Mr("ant-progress ant-progress-status-"+_.status),C1("ant-progress-line",_.nzType==="line")("ant-progress-small",_.nzSize==="small")("ant-progress-default",_.nzSize==="default")("ant-progress-show-info",_.nzShowInfo)("ant-progress-circle",_.isCircleStyle)("ant-progress-steps",_.isSteps)("ant-progress-rtl",_.dir==="rtl"),ee(),fe(_.nzType==="line"?3:-1),ee(),fe(_.isCircleStyle?4:-1))},dependencies:[Zt,At,jn,Qt,Un],encapsulation:2,changeDetection:0})}})(),ec=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=We({type:r});static \u0275inj=Pe({imports:[$0]})}return r})();var Dh=[ai,gi,hi,ti],Wr=class r{constructor(t){this.Icons=t;this.Icons.addIcon(...Dh)}static \u0275fac=function(e){return new(e||r)(s1(Nr))};static \u0275mod=We({type:r});static \u0275inj=Pe({imports:[Zt,Zt]})};var Wc=function(r,t){return(Wc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])})(r,t)};function zt(r,t){function e(){this.constructor=r}Wc(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Q(r,t,e,n){return new(e||(e=Promise))(function(o,a){function i(l){try{s(n.next(l))}catch(u){a(u)}}function c(l){try{s(n.throw(l))}catch(u){a(u)}}function s(l){l.done?o(l.value):new e(function(u){u(l.value)}).then(i,c)}s((n=n.apply(r,t||[])).next())})}function J(r,t){var e,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(u[0]===6&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(r,i)}catch(h){u=[6,h],n=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([s,l])}}}var Ih=function(){function r(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},r.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},r.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},r.prototype.getNumber=function(t){return this.get(t)},r.prototype.getBool=function(t){return this.get(t)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},r.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},r.prototype.setFlags=function(t){this.flags=Object.assign({},t)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,n,o=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var i=[],c=1;c<arguments.length;c++)i[c-1]=arguments[c];return Bh(n,i[0],i[1]),i.join("=")}),n);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(a){var i=a.split(":"),c=i[0],s=i[1];t.urlFlags[c]=function(l,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+l+".")}(c,s)})}},r}();function Bh(r,t,e){r[decodeURIComponent(t)]=decodeURIComponent(e||"")}function B(){return Uc}var Uc=null,a3=new Map,mo=new Map;function Gc(r,t){var e=jc(r,t);return a3.get(e)}function Rh(r){return mo.get(r)}function ac(r){for(var t=a3.entries(),e=[];;){var n=t.next(),o=n.done,a=n.value;if(o)break;var i=a[0],c=a[1];i.split("_")[0]===r&&e.push(c)}return e}function qc(r){var t=r.kernelName,e=r.backendName,n=jc(t,e);if(a3.has(n))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");a3.set(n,r)}function Oh(r){var t=r.kernelName;mo.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),mo.set(t,r)}function jc(r,t){return t+"_"+r}function ic(r){for(var t=r.length,e=0,n=0;t>0;)n=Math.random()*t|0,e=r[--t],r[t]=r[n],r[n]=e}function i3(r,t,e){return Math.max(r,Math.min(t,e))}function Bo(r){return r%2==0?r:r+1}function $c(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t}function E(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function He(r,t,e){e===void 0&&(e=""),E(o1(r,t),function(){return e+" Shapes "+r+" and "+t+" must match"})}function a4(r){E(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function rn(r,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(r)||k1(r)&&!e)for(var n=0;n<r.length;++n)rn(r[n],t,e);else t.push(r);return t}function te(r){if(r.length===0)return 1;for(var t=r[0],e=1;e<r.length;e++)t*=r[e];return t}function o1(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function Ke(r){return r%1==0}function Kc(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var t=Math.exp(2*r);return(t-1)/(t+1)}function c3(r){var t=Math.ceil(Math.sqrt(r));return[t,Math.ceil(r/t)]}function Jn(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function go(r,t,e){return t===void 0&&(t=function(n){return 0}),new Promise(function(n,o){var a=0,i=function(){if(r())n();else{a++;var c=t(a);e!=null&&a>=e?o():setTimeout(i,c)}};i()})}function Xc(r,t){for(var e=1,n=-1,o=0;o<r.length;++o)if(r[o]>=0)e*=r[o];else if(r[o]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+o);n=o}else if(r[o]<0)throw Error("Shapes can not be < 0. Found "+r[o]+" at dim "+o);if(n===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+r);return r}if(e===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var a=r.slice();return a[n]=t/e,a}function i1(r,t){var e=t.length;return E((r=r==null?t.map(function(n,o){return o}):[].concat(r)).every(function(n){return n>=-e&&n<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r}),E(r.every(function(n){return Ke(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?e+n:n})}function En(r,t){for(var e=[],n=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:i1(t,r).sort(),i=0,c=0;c<r.length;++c){if(a!=null){if(a[i]===c&&r[c]!==1)throw new Error("Can't squeeze axis "+c+" since its dim '"+r[c]+"' is not 1");(a[i]==null||a[i]>c)&&r[c]===1&&(e.push(r[c]),n.push(c)),a[i]<=c&&i++}r[c]!==1&&(e.push(r[c]),n.push(c))}return{newShape:e,keptDims:n}}function R4(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else{if(r!=="bool")throw new Error("Unknown data type "+r);e=new Uint8Array(t)}return e}function B2(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else if(r==="bool")e=new Uint8Array(t);else{if(r!=="string")throw new Error("Unknown data type "+r);e=new Array(t)}return e}function Yc(r,t){for(var e=0;e<r.length;e++){var n=r[e];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+t+" being uploaded contains "+n+".")}}function Zc(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Qc(r,t){return t!=="complex64"&&(t!=="float32"||r==="complex64")&&(t!=="int32"||r==="float32"||r==="complex64")&&(t!=="bool"||r!=="bool")}function k1(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function Ro(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Jc(r){if(r==null)return 0;var t=0;return r.forEach(function(e){return t+=e.length}),t}function Sn(r){return typeof r=="string"||r instanceof String}function es(r){return typeof r=="boolean"}function ts(r){return typeof r=="number"}function N4(r){return Array.isArray(r)?N4(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":ts(r)?"float32":Sn(r)?"string":es(r)?"bool":"float32"}function s3(r){return!!(r&&r.constructor&&r.call&&r.apply)}function l3(r,t){for(var e=t;e<r;++e)if(r%e==0)return e;return r}function yt(r){var t=r.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=r[t-1];for(var n=t-3;n>=0;--n)e[n]=e[n+1]*r[n+1];return e}function Oo(r,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=rn(r)),e&&Yc(r,t),function(a,i){return a instanceof Float32Array&&i==="float32"||a instanceof Int32Array&&i==="int32"||a instanceof Uint8Array&&i==="bool"}(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){for(var n=new Uint8Array(r.length),o=0;o<n.length;++o)Math.round(r[o])!==0&&(n[o]=1);return n}throw new Error("Unknown data type "+t)}function xo(r,t){if(r.length===0)return t[0];var e=r.reduce(function(n,o){return n*o});if(e===0)return[];if(e!==t.length)throw new Error("["+r+"] does not match the input size.");return function n(o,a,i){var c=new Array;if(a.length===1)for(var s=a[0],l=0;l<s;l++)c[l]=i[o+l];else{s=a[0];var u=a.slice(1),h=u.reduce(function(f,d){return f*d});for(l=0;l<s;l++)c[l]=n(o+l*h,u,i)}return c}(0,r,t)}function No(r,t){for(var e=P4(r,t),n=0;n<e.length;n++)e[n]=1;return e}function P4(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+t)}function bt(){return B().platform.now()}function Po(r){r.forEach(function(t){E(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function ns(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",B().platform.encode(r,t)}function R2(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",B().platform.decode(r,t)}function bo(r,t,e){if(t===0)return 0;if(t===1)return r[0];for(var n=r[r.length-1],o=0;o<r.length-1;++o)n+=e[o]*r[o];return n}function rs(r,t,e){if(t===0)return[];if(t===1)return[r];for(var n=new Array(t),o=0;o<n.length-1;++o)n[o]=Math.floor(r/e[o]),r-=n[o]*e[o];return n[n.length-1]=r,n}var Ww=Object.freeze({shuffle:ic,clamp:i3,nearestLargerEven:Bo,sum:$c,randUniform:function(r,t){var e=Math.random();return t*e+(1-e)*r},distSquared:function(r,t){for(var e=0,n=0;n<r.length;n++){var o=Number(r[n])-Number(t[n]);e+=o*o}return e},assert:E,assertShapesMatch:He,assertNonNull:a4,flatten:rn,sizeFromShape:te,isScalarShape:function(r){return r.length===0},arraysEqual:o1,isInt:Ke,tanh:Kc,sizeToSquarishShape:c3,createShuffledIndices:function(r){for(var t=new Uint32Array(r),e=0;e<r;++e)t[e]=e;return ic(t),t},rightPad:Jn,repeatedTry:go,inferFromImplicitShape:Xc,parseAxisParam:i1,squeezeShape:En,getTypedArrayFromDType:R4,getArrayFromDType:B2,checkConversionForErrors:Yc,isValidDtype:Zc,hasEncodingLoss:Qc,isTypedArray:k1,bytesPerElement:Ro,bytesFromStringArray:Jc,isString:Sn,isBoolean:es,isNumber:ts,inferDtype:N4,isFunction:s3,nearestDivisor:l3,computeStrides:yt,toTypedArray:Oo,toNestedArray:xo,makeOnesTypedArray:No,makeZerosTypedArray:P4,now:bt,assertNonNegativeIntegerDimensions:Po,fetch:function(r,t){return B().platform.fetch(r,t)},encodeString:ns,decodeString:R2,locToIndex:bo,indexToLoc:rs}),Nh=function(){function r(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new Ph)}return r.prototype.profileKernel=function(t,e,n){var o,a=this,i=this.backendTimer.time(function(){o=n()});return o.forEach(function(c){c.data().then(function(s){(function(l,u,h){if(u!=="float32")return!1;for(var f=0;f<l.length;f++){var d=l[f];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+h+"'"),!0}})(s,c.dtype,t),i.then(function(l){var u="";l.getExtraProfileInfo!=null&&(u=l.getExtraProfileInfo()),a.logger.logKernelProfile(t,c,s,l.kernelMs,e,u)})})}),o},r}(),Ph=function(){function r(){}return r.prototype.logKernelProfile=function(t,e,n,o,a,i){var c=typeof o=="number"?Jn(o+"ms",9):o.error,s=Jn(t,25),l=e.rank,u=e.size,h=Jn(e.shape.toString(),14),f="";for(var d in a){var p=a[d].shape||e.shape,v=p.length;f+=d+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+s+"	%c"+c+"	%c"+l+"D "+h+"	%c"+u+"	%c"+f+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),cc=20,k2=3,K0=7;function Wh(r,t,e,n){var o=yt(t),a=function(l,u,h,f){var d=te(u),p=f[f.length-1],v=new Array(p).fill(0),m=u.length,g=h==="complex64"?V2(l):l;if(m>1)for(var b=0;b<d/p;b++)for(var y=b*p,x=0;x<p;x++)v[x]=Math.max(v[x],H2(g[y+x],0,h).length);return v}(r,t,e,o),i=t.length,c=function l(u,h,f,d,p,v){v===void 0&&(v=!0);var m=f==="complex64"?2:1,g=h[0],b=h.length;if(b===0)return f==="complex64"?[H2(V2(u)[0],0,f)]:f==="bool"?[os(u[0])]:[u[0].toString()];if(b===1){if(g>cc){var y=k2*m,x=Array.from(u.slice(0,y)),w=Array.from(u.slice((g-k2)*m,g*m));return f==="complex64"&&(x=V2(x),w=V2(w)),["["+x.map(function(R,P){return H2(R,p[P],f)}).join(", ")+", ..., "+w.map(function(R,P){return H2(R,p[g-k2+P],f)}).join(", ")+"]"]}return["["+(f==="complex64"?V2(u):Array.from(u)).map(function(R,P){return H2(R,p[P],f)}).join(", ")+"]"]}var z=h.slice(1),M=d.slice(1),_=d[0]*m,S=[];if(g>cc){for(var k=0;k<k2;k++){var L=(V=k*_)+_;S.push.apply(S,l(u.slice(V,L),z,f,M,p,!1))}for(S.push("..."),k=g-k2;k<g;k++)L=(V=k*_)+_,S.push.apply(S,l(u.slice(V,L),z,f,M,p,k===g-1))}else for(k=0;k<g;k++){var V;L=(V=k*_)+_,S.push.apply(S,l(u.slice(V,L),z,f,M,p,k===g-1))}var I=b===2?",":"";for(S[0]="["+S[0]+I,k=1;k<S.length-1;k++)S[k]=" "+S[k]+I;var D=`,
`;for(k=2;k<b;k++)D+=`
`;return S[S.length-1]=" "+S[S.length-1]+"]"+(v?"":D),S}(r,t,e,o,a),s=["Tensor"];return n&&(s.push("  dtype: "+e),s.push("  rank: "+i),s.push("  shape: ["+t+"]"),s.push("  values:")),s.push(c.map(function(l){return"    "+l}).join(`
`)),s.join(`
`)}function H2(r,t,e){return Jn(Array.isArray(r)?parseFloat(r[0].toFixed(K0))+" + "+parseFloat(r[1].toFixed(K0))+"j":Sn(r)?"'"+r+"'":e==="bool"?os(r):parseFloat(r.toFixed(K0)).toString(),t)}function os(r){return r===0?"false":"true"}function V2(r){for(var t=[],e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);return t}var O2=function(){function r(t,e,n){var o=this;if(this.dtype=e,this.shape=t.slice(),this.size=te(t),n!=null){var a=n.length;E(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+o.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||B2(e,this.size),this.strides=yt(t)}return r.prototype.set=function(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];n.length===0&&(n=[0]),E(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var a=this.locToIndex(n);this.values[a]=t},r.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var n=0,o=0,a=t;o<a.length;o++){var i=a[o];if(i<0||i>=this.shape[n]){var c="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(c)}n++}for(var s=t[t.length-1],l=0;l<t.length-1;++l)s+=this.strides[l]*t[l];return this.values[s]},r.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},r.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return Dt().makeTensor(this.values,this.shape,this.dtype)},r}(),Dt=null,A=null,as=null,Ie=function(){function r(t,e,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=te(t),this.strides=yt(t),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},r.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},r.prototype.as4D=function(t,e,n,o){return this.throwIfDisposed(),this.reshape([t,e,n,o])},r.prototype.as5D=function(t,e,n,o,a){return this.throwIfDisposed(),this.reshape([t,e,n,o,a])},r.prototype.asType=function(t){return this.throwIfDisposed(),A.cast(this,t)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Q(this,void 0,void 0,function(){var t;return J(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,A.buffer(this.shape,this.dtype,t)]}})})},r.prototype.bufferSync=function(){return A.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Q(this,void 0,void 0,function(){var t;return J(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,xo(this.shape,t)]}})})},r.prototype.arraySync=function(){return xo(this.shape,this.dataSync())},r.prototype.data=function(){return Q(this,void 0,void 0,function(){var t,e;return J(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=Dt().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(o){return R2(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var t=Dt().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(e){return R2(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},r.prototype.bytes=function(){return Q(this,void 0,void 0,function(){var t;return J(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,Dt().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(Dt().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(t){return t===void 0&&(t=!1),A.print(this,t)},r.prototype.reshape=function(t){return this.throwIfDisposed(),A.reshape(this,t)},r.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},r.prototype.expandDims=function(t){return t===void 0&&(t=0),A.expandDims(this,t)},r.prototype.cumsum=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1),A.cumsum(this,t,e,n)},r.prototype.squeeze=function(t){return this.throwIfDisposed(),A.squeeze(this,t)},r.prototype.clone=function(){return this.throwIfDisposed(),A.clone(this)},r.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),A.oneHot(this,t,e,n)},r.prototype.toString=function(t){return t===void 0&&(t=!1),Wh(this.dataSync(),this.shape,this.dtype,t)},r.prototype.tile=function(t){return this.throwIfDisposed(),A.tile(this,t)},r.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),A.gather(this,t,e)},r.prototype.matMul=function(t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!1),this.throwIfDisposed(),A.matMul(this,t,e,n)},r.prototype.dot=function(t){return this.throwIfDisposed(),A.dot(this,t)},r.prototype.norm=function(t,e,n){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),A.norm(this,t,e,n)},r.prototype.slice=function(t,e){return this.throwIfDisposed(),A.slice(this,t,e)},r.prototype.reverse=function(t){return this.throwIfDisposed(),A.reverse(this,t)},r.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof r&&(t=[t]),A.concat([this].concat(t),e)},r.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),A.split(this,t,e)},r.prototype.stack=function(t,e){return e===void 0&&(e=0),A.stack([this,t],e)},r.prototype.unstack=function(t){return t===void 0&&(t=0),A.unstack(this,t)},r.prototype.pad=function(t,e){return e===void 0&&(e=0),A.pad(this,t,e)},r.prototype.batchNormalization=function(t,e,n,o,a){return n===void 0&&(n=.001),as("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,a,o,n)},r.prototype.batchNorm=function(t,e,n,o,a){return a===void 0&&(a=.001),this.throwIfDisposed(),A.batchNorm(this,t,e,n,o,a)},r.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.all(this,t,e)},r.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.any(this,t,e)},r.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.logSumExp(this,t,e)},r.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.sum(this,t,e)},r.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.prod(this,t,e)},r.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.mean(this,t,e)},r.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.min(this,t,e)},r.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),A.max(this,t,e)},r.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),A.argMin(this,t)},r.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),A.argMax(this,t)},r.prototype.cast=function(t){return this.throwIfDisposed(),A.cast(this,t)},r.prototype.add=function(t){return this.throwIfDisposed(),A.add(this,t)},r.prototype.addStrict=function(t){return this.throwIfDisposed(),A.addStrict(this,t)},r.prototype.atan2=function(t){return this.throwIfDisposed(),A.atan2(this,t)},r.prototype.sub=function(t){return this.throwIfDisposed(),A.sub(this,t)},r.prototype.subStrict=function(t){return this.throwIfDisposed(),A.subStrict(this,t)},r.prototype.pow=function(t){return this.throwIfDisposed(),A.pow(this,t)},r.prototype.powStrict=function(t){return this.throwIfDisposed(),A.powStrict(this,t)},r.prototype.mul=function(t){return this.throwIfDisposed(),A.mul(this,t)},r.prototype.mulStrict=function(t){return this.throwIfDisposed(),A.mulStrict(this,t)},r.prototype.div=function(t){return this.throwIfDisposed(),A.div(this,t)},r.prototype.divNoNan=function(t){return this.throwIfDisposed(),A.divNoNan(this,t)},r.prototype.floorDiv=function(t){return this.throwIfDisposed(),A.floorDiv(this,t)},r.prototype.divStrict=function(t){return this.throwIfDisposed(),A.divStrict(this,t)},r.prototype.minimum=function(t){return this.throwIfDisposed(),A.minimum(this,t)},r.prototype.minimumStrict=function(t){return this.throwIfDisposed(),A.minimumStrict(this,t)},r.prototype.maximum=function(t){return this.throwIfDisposed(),A.maximum(this,t)},r.prototype.maximumStrict=function(t){return this.throwIfDisposed(),A.maximumStrict(this,t)},r.prototype.mod=function(t){return this.throwIfDisposed(),A.mod(this,t)},r.prototype.modStrict=function(t){return this.throwIfDisposed(),A.modStrict(this,t)},r.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),A.squaredDifferenceStrict(this,t)},r.prototype.transpose=function(t){return this.throwIfDisposed(),A.transpose(this,t)},r.prototype.notEqual=function(t){return this.throwIfDisposed(),A.notEqual(this,t)},r.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),A.notEqualStrict(this,t)},r.prototype.less=function(t){return this.throwIfDisposed(),A.less(this,t)},r.prototype.lessStrict=function(t){return this.throwIfDisposed(),A.lessStrict(this,t)},r.prototype.equal=function(t){return this.throwIfDisposed(),A.equal(this,t)},r.prototype.equalStrict=function(t){return this.throwIfDisposed(),A.equalStrict(this,t)},r.prototype.lessEqual=function(t){return this.throwIfDisposed(),A.lessEqual(this,t)},r.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),A.lessEqualStrict(this,t)},r.prototype.greater=function(t){return this.throwIfDisposed(),A.greater(this,t)},r.prototype.greaterStrict=function(t){return this.throwIfDisposed(),A.greaterStrict(this,t)},r.prototype.greaterEqual=function(t){return this.throwIfDisposed(),A.greaterEqual(this,t)},r.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),A.greaterEqualStrict(this,t)},r.prototype.logicalAnd=function(t){return this.throwIfDisposed(),A.logicalAnd(this,t)},r.prototype.logicalOr=function(t){return this.throwIfDisposed(),A.logicalOr(this,t)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),A.logicalNot(this)},r.prototype.logicalXor=function(t){return this.throwIfDisposed(),A.logicalXor(this,t)},r.prototype.where=function(t,e){return this.throwIfDisposed(),A.where(t,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),A.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),A.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),A.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),A.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),A.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),A.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),A.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),A.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),A.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),A.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),A.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),A.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),A.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),A.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),A.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),A.abs(this)},r.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),A.clipByValue(this,t,e)},r.prototype.relu=function(){return this.throwIfDisposed(),A.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),A.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),A.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),A.selu(this)},r.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),A.leakyRelu(this,t)},r.prototype.prelu=function(t){return this.throwIfDisposed(),A.prelu(this,t)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),A.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),A.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),A.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),A.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),A.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),A.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),A.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),A.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),A.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),A.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),A.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),A.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),A.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),A.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),A.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),A.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),A.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),A.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),A.round(this)},r.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),A.step(this,t)},r.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),A.softmax(this,t)},r.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),A.logSoftmax(this,t)},r.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),A.image.resizeBilinear(this,t,e)},r.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),A.image.resizeNearestNeighbor(this,t,e)},r.prototype.conv1d=function(t,e,n,o,a,i){return o===void 0&&(o="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),A.conv1d(this,t,e,n,o,a,i)},r.prototype.conv2d=function(t,e,n,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),A.conv2d(this,t,e,n,o,a,i)},r.prototype.conv2dTranspose=function(t,e,n,o,a){return this.throwIfDisposed(),A.conv2dTranspose(this,t,e,n,o,a)},r.prototype.depthwiseConv2D=function(t,e,n,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),A.depthwiseConv2d(this,t,e,n,o,a,i)},r.prototype.separableConv2d=function(t,e,n,o,a,i){return a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),A.separableConv2d(this,t,e,n,o,a,i)},r.prototype.avgPool=function(t,e,n,o){return this.throwIfDisposed(),A.avgPool(this,t,e,n,o)},r.prototype.maxPool=function(t,e,n,o){return this.throwIfDisposed(),A.maxPool(this,t,e,n,o)},r.prototype.localResponseNormalization=function(t,e,n,o){return t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=.5),A.localResponseNormalization(this,t,e,n,o)},r.prototype.pool=function(t,e,n,o,a){return this.throwIfDisposed(),A.pool(this,t,e,n,o,a)},r.prototype.variable=function(t,e,n){return t===void 0&&(t=!0),this.throwIfDisposed(),Dt().makeVariable(this,t,e,n)},r.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),A.unsortedSegmentSum(this,t,e)},r.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),A.batchToSpaceND(this,t,e)},r.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),A.spaceToBatchND(this,t,e)},r.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),A.topk(this,t,e)},r.prototype.stridedSlice=function(t,e,n,o,a,i,c,s){return o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),c===void 0&&(c=0),s===void 0&&(s=0),this.throwIfDisposed(),A.stridedSlice(this,t,e,n,o,a,i,c,s)},r.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),A.depthToSpace(this,t,e)},r.prototype.fft=function(){return this.throwIfDisposed(),A.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),A.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),A.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),A.spectral.irfft(this)},r}();Object.defineProperty(Ie,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var sc,yo,wo,zo,Mo,t4=function(r){function t(e,n,o,a){var i=r.call(this,e.shape,e.dtype,e.dataId,a)||this;return i.trainable=n,i.name=o,i}return zt(t,r),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!o1(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Dt().disposeTensor(this),this.dataId=e.dataId,Dt().incRef(this,null)},t.prototype.dispose=function(){Dt().disposeVariable(this),this.isDisposedInternal=!0},t}(Ie);Object.defineProperty(t4,Symbol.hasInstance,{value:function(r){return r instanceof Ie&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(sc||(sc={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(yo||(yo={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(wo||(wo={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(zo||(zo={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Mo||(Mo={}));var Uh={float32:zo,int32:yo,bool:wo,complex64:Mo};function m1(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error("Can not upcast "+r+" with "+t)}return Uh[r][t]}function X0(r){return m1(r,"int32")}function Ge(r,t){if(r.dtype===t.dtype)return[r,t];var e=m1(r.dtype,t.dtype);return[r.cast(e),t.cast(e)]}function is(r,t){E(r.dtype===t.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+t.dtype+") input must match"})}function Wo(r){var t=[];return function e(n,o,a){if(n!=null){if(n instanceof Ie)return void o.push(n);if(i=n,!(!Array.isArray(i)&&typeof i!="object")){var i,c=n;for(var s in c){var l=c[s];a.has(l)||(a.add(l),e(l,o,a))}}}}(r,t,new Set),t}var Y0,Uw=Object.freeze({makeTypesMatch:Ge,assertTypesMatch:is,isTensorInList:function(r,t){return t.some(function(e){return e.id===r.id})},getTensorsInContainer:Wo}),lc=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},r}(),Gh=function(){function r(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new lc}return r.prototype.ready=function(){return Q(this,void 0,void 0,function(){var t,e,n;return J(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,o.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(n)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},r.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},r.prototype.registerBackend=function(t,e,n){return n===void 0&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},r.prototype.setBackend=function(t){return Q(this,void 0,void 0,function(){var e,n,o;return J(this,function(a){switch(a.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return o=a.sent(),[3,3];case 2:o=n,a.label=3;case 3:if(!o)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Nh(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var t=this;ac(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)})},r.prototype.disposeRegisteredKernels=function(t){var e=this;ac(t).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(e.registry[t])})},r.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(n==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=n.factory();if(Promise.resolve(o)===o){var a=++this.pendingBackendInitId,i=o.then(function(c){return!(a<e.pendingBackendInitId)&&(e.registry[t]=c,e.pendingBackendInit=null,!0)}).catch(function(c){return!(a<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(c.stack||c.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(c){return console.warn("Initialization of backend "+t+" failed"),console.warn(c.stack||c.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],o=this.initializeBackend(n),a=o.success,i=o.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),o=n.backend,a=this.readSync(e);o.disposeData(e),n.backend=t,t.move(e,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(t,e){var n,o=this,a=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=t}return this.scopedRun(function(){return o.startScope(a)},function(){return o.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(t,e,n){t();try{var o=n();return e(),o}catch(a){throw e(),a}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},r.prototype.runKernel=function(t,e,n,o,a){return this.runKernelFunc(null,e,null,t,n,o,a)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(t,e,n){var o=this.backend.numDataIds(),a=0;n.forEach(function(s){a+=s.dtype==="complex64"?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],c=o-e-a-i;if(c>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+c+" data ids) after running '"+t+"'")},r.prototype.runKernelFunc=function(t,e,n,o,a,i,c){var s,l=this;i===void 0&&(i=[]),c===void 0&&(c=[]);var u=[],h=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var f,d=function(b){h&&(u=b.map(function(y){return l.keep(l.clone(y))}))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=Gc(o,this.backendName);return f=g!=null?function(){var b=l.backend.numDataIds();m=g.kernelFunc({inputs:e,attrs:a,backend:l.backend});var y=Array.isArray(m)?m:[m];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,b,y);var x=y.map(function(z){var M=z.dataId,_=z.shape,S=z.dtype;return l.makeTensorFromDataId(M,_,S)}),w=x.filter(function(z,M){return c[M]});return d((i||[]).slice().concat(w)),x}:function(){var b=l.backend.numDataIds();m=l.tidy(function(){return t(l.backend,d)});var y=Array.isArray(m)?m:[m];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,b,y),y},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){s=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,e,function(){return f()}):f()}),h&&this.addTapeNode(o,e,s,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:s.map(function(b){return b.shape})}),Array.isArray(m)?s:s[0]},r.prototype.makeTensor=function(t,e,n,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",o=o||this.backend;var a=t;n==="string"&&Sn(t[0])&&(a=t.map(function(u){return ns(u)}));var i=o.write(a,e,n),c=new Ie(e,n,i,this.nextTensorId());if(this.incRef(c,o),n==="string"){var s=this.state.tensorInfo.get(i),l=Jc(a);this.state.numBytes+=l-s.bytes,s.bytes=l}return c},r.prototype.makeTensorFromDataId=function(t,e,n,o){var a=new Ie(e,n=n||"float32",t,this.nextTensorId());return this.incRef(a,o),a},r.prototype.makeVariable=function(t,e,n,o){e===void 0&&(e=!0),n=n||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var a=new t4(t,e,n,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},r.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*Ro(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof t4||this.track(t)},r.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},r.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},r.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},r.prototype.profile=function(t){return Q(this,void 0,void 0,function(){var e,n;return J(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(t,e,n,o,a){var i=this,c={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:a},s=Rh(t);s!=null&&(o=s.gradFunc),o!=null&&(c.gradient=function(l){return l=l.map(function(u,h){if(u==null){var f=n[h],d=P4(f.size,f.dtype);return i.makeTensor(d,f.shape,f.dtype)}return u}),o(l.length>1?l:l[0],a)}),this.state.activeTape.push(c)},r.prototype.keep=function(t){return t.kept=!0,t},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},r.prototype.endScope=function(t){for(var e=this,n=Wo(t),o=new Set(n.map(function(s){return s.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||o.has(i.id)||i.dispose()}var c=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(s){s.kept||s.scopeId!==c.id||e.track(s)})},r.prototype.gradients=function(t,e,n,o){var a=this;if(o===void 0&&(o=!1),E(e.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",t)});E(i instanceof Ie,function(){return"The result y returned by f() must be a tensor."});var c=function(s,l,u){for(var h={},f={},d=0;d<l.length;d++)h[l[d].id]=!0;for(d=0;d<s.length;d++){var p=(z=s[d]).inputs;for(var v in p){for(var m=p[v],g=!1,b=0;b<l.length;b++)if(h[m.id]){z.outputs.forEach(function(k){return h[k.id]=!0}),g=!0,f[z.id]=!0;break}if(g)break}}var y={};y[u.id]=!0;var x={};for(d=s.length-1;d>=0;d--)for(p=(z=s[d]).inputs,b=0;b<z.outputs.length;b++)if(y[z.outputs[b].id]){for(var v in p)y[p[v].id]=!0,x[z.id]=!0;break}var w=[];for(d=0;d<s.length;d++){var z;if(f[(z=s[d]).id]&&x[z.id]){var M={};for(var v in z.inputs){var _=z.inputs[v];h[_.id]&&(M[v]=_)}var S=Object.assign({},z);S.inputs=M,S.outputs=z.outputs,w.push(S)}}return w}(this.state.activeTape,e,i);if(!o&&c.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var s,l,u={};u[i.id]=n??(s=i.shape,l=No(te(s),"float32"),T.makeTensor(l,s,"float32")),function(f,d,p){for(var v=function(g){var b=d[g],y=[];if(b.outputs.forEach(function(M){var _=f[M.id];_!=null?y.push(_):y.push(null)}),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var x=b.gradient(y),w=function(M){if(!(M in x))throw new Error("Cannot backprop through input "+M+". Available gradients found: "+Object.keys(x)+".");var _=p(function(){return x[M]()});if(_.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+M+" must have 'float32' dtype, but has '"+_.dtype+"'");var S=b.inputs[M];if(!o1(_.shape,S.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+M+"' has shape '"+_.shape+"', which does not match the shape of the input '"+S.shape+"'");if(f[S.id]==null)f[S.id]=_;else{var k=f[S.id];f[S.id]=k.add(_),k.dispose()}};for(var z in b.inputs)w(z)},m=d.length-1;m>=0;m--)v(m)}(u,c,function(f){return a.tidy(f)});var h=e.map(function(f){return u[f.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(f){for(var d=0,p=f.saved;d<p.length;d++)p[d].dispose()}),a.state.activeTape=null),{value:i,grads:h}})},r.prototype.customGrad=function(t){var e=this;return E(s3(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];E(o.every(function(c){return c instanceof Ie}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return o.forEach(function(c,s){i[s]=c}),e.runKernelFunc(function(c,s){return E((n=t.apply(void 0,o.concat([s]))).value instanceof Ie,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),E(s3(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(c,s){var l=n.gradFunc(c,s),u=Array.isArray(l)?l:[l];E(u.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),E(u.every(function(f){return f instanceof Ie}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return u.forEach(function(f,d){h[d]=function(){return f}}),h})}},r.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},r.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},r.prototype.time=function(t){return Q(this,void 0,void 0,function(){var e,n;return J(this,function(o){switch(o.label){case 0:return e=bt(),[4,this.backend.time(t)];case 1:return(n=o.sent()).wallMs=bt()-e,[2,n]}})})},r.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new lc,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),T=function(){var r=function(){if(Y0==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}Y0=e}return Y0}();if(r._tfengine==null){var t=new Ih(r);r._tfengine=new Gh(t)}return function(e){Uc=e}(r._tfengine.ENV),Dt=function(){return r._tfengine},r._tfengine}();function cs(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Jt=B();Jt.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Jt.registerFlag("IS_BROWSER",function(){return cs()}),Jt.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Jt.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Jt.registerFlag("PROD",function(){return!1}),Jt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Jt.getBool("DEBUG")}),Jt.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Jt.registerFlag("IS_TEST",function(){return!1});var N2,it,at,Xn={},Z0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ss(r,t){Xn[r]=t}function Ot(r){r in Xn||(Xn[r]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return n.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete Xn[e]},!1),e===1?n.getContext("webgl",Z0)||n.getContext("experimental-webgl",Z0):n.getContext("webgl2",Z0)}(r));var t=Xn[r];return t.isContextLost()?(delete Xn[r],Ot(r)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Xn[r])}function w3(r,t){return[t,r]}function D2(r){var t=te(r);return c3(Math.ceil(t/4))}function $2(r,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(r/2))]}function Uo(r,t){var e,n,o,a,i,c,s,l,u,h=r;return B().getNumber("WEBGL_VERSION")===2?(e=h.R32F,n=h.R16F,o=h.RGBA16F,a=h.RGBA32F,i=h.RED,c=4,s=1,l=h.HALF_FLOAT,u=h.FLOAT):(e=r.RGBA,n=r.RGBA,o=r.RGBA,a=h.RGBA,i=r.RGBA,c=4,s=4,l=t!=null?t.HALF_FLOAT_OES:null,u=r.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:c,defaultNumChannels:s,textureTypeHalfFloat:l,textureTypeFloat:u}}function Z(r,t,e){var n=e();return t&&function(o){var a=o.getError();if(a!==o.NO_ERROR)throw new Error("WebGL Error: "+us(o,a))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(N2||(N2={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(it||(it={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(at||(at={}));var qh=596e-10,jh=65504;function ls(r){return!!(B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||qh<Math.abs(r)&&Math.abs(r)<jh)}function us(r,t){switch(t){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function L2(r,t,e){return on(r,t,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function hs(r,t,e){var n=on(r,t,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Z(r,t,function(){return r.shaderSource(n,e)}),Z(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function fs(r,t,e){var n=on(r,t,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Z(r,t,function(){return r.shaderSource(n,e)}),Z(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(o,a){var i=$h.exec(a);if(i==null)return console.log("Couldn't parse line number in error: "+a),void console.log(o);for(var c=+i[1],s=o.split(`
`),l=s.length.toString().length+2,u=s.map(function(m,g){return Jn((g+1).toString(),l)+m}),h=0,f=0;f<u.length;f++)h=Math.max(u[f].length,h);var d=u.slice(0,c-1),p=u.slice(c-1,c),v=u.slice(c);console.log(d.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Jn(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(e,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Qr,Jr,$h=/ERROR: [0-9]+:([0-9]+):/g;function ds(r,t){return on(r,t,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function ps(r,t,e){if(Z(r,t,function(){return r.linkProgram(e)}),r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function e3(r,t,e){if(Z(r,t,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function vs(r,t,e){var n=on(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Z(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Z(r,t,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function ms(r,t,e){var n=on(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Z(r,t,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Z(r,t,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function gs(r,t){return on(r,t,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function xs(r,t){var e=B().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||t<=0){var n="["+r+"x"+t+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>e||t>e)throw n="["+r+"x"+t+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function bs(r,t){return on(r,t,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Co(r,t,e,n,o,a,i,c){var s=r.getAttribLocation(e,n);return s!==-1&&(Z(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,o)}),Z(r,t,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,c)}),Z(r,t,function(){return r.enableVertexAttribArray(s)}),!0)}function ys(r,t,e,n){_s(r,n),Z(r,t,function(){return r.activeTexture(r.TEXTURE0+n)}),Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function ws(r,t,e,n){return on(r,t,function(){return r.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function zs(r,t,e){return r.getUniformLocation(t,e)}function Ms(r,t,e,n,o,a){Z(r,t,function(){return ys(r,t,n,a)}),Z(r,t,function(){return r.uniform1i(o,a)})}function t3(r,t,e,n){Z(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Z(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function _o(r,t,e){Z(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Z(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function F2(r){var t=r.checkFramebufferStatus(r.FRAMEBUFFER);if(t!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Cs(r,t))}function Cs(r,t){switch(t){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function on(r,t,e,n){var o=Z(r,t,function(){return e()});if(o==null)throw new Error(n);return o}function _s(r,t){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=t+r.TEXTURE0;if(n<r.TEXTURE0||n>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function P2(r,t){return t===void 0&&(t=2),te(r.slice(0,r.length-t))}function W2(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function n3(r){var t=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(t=[P2(r)].concat(W2(r))),t}function Es(r,t){var e;t===void 0&&(t=!1);var n=B().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,(r=r.map(function(l,u){return u>=r.length-2?Bo(r[u]):r[u]})).length===1&&(r=[2,r[0]])),r.length!==2){var o=En(r);r=o.newShape}var a=te(r);if(r.length<=1&&a<=n)return[1,a];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(t){var i=P2(r),c=2,s=2;return r.length&&(c=(e=W2(r))[0],s=e[1]),c3(a=i*(c/2)*(s/2)).map(function(l){return 2*l})}return c3(a)}function Ur(r){return r%2==0}function A2(r,t){if(o1(r=r.slice(-2),t=t.slice(-2))||!r.length||!t.length||r[0]===0||r[1]===0||t[0]===0||t[1]===0)return!0;if(r.length!==t.length){var e=r.slice(-1)[0],n=t.slice(-1)[0];if(e===n||Ur(e)&&Ur(n)&&(r[0]===1||t[0]===1))return!0}return r[1]===t[1]&&Ur(r[0])&&Ur(t[0])}function Ss(r){if(Qr==null){var t=Ot(r);Qr=t.getParameter(t.MAX_TEXTURE_SIZE)}return Qr}function ks(r){if(Jr==null){var t=Ot(r);Jr=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jr)}function Hs(r){if(r===0)return 0;var t=Ot(r);return ct(t,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ct(t,"EXT_disjoint_timer_query")?1:0}function ct(r,t){return r.getExtension(t)!=null}function Eo(r){try{if(Ot(r)!=null)return!0}catch{return!1}return!1}function Vs(r){if(r===0)return!1;var t=Ot(r);if(r===1){if(!ct(t,"OES_texture_float"))return!1}else if(!ct(t,"EXT_color_buffer_float"))return!1;return So(t)}function Ts(r){if(r===0)return!1;var t=Ot(r);if(r!==1){if(ct(t,"EXT_color_buffer_float"))return So(t);if(ct(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(n,o){var a=Uo(n,o),i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var c=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,c),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(i),n.deleteFramebuffer(c),s}(t,e)}return!1}return!!ct(t,"OES_texture_float")&&!!ct(t,"WEBGL_color_buffer_float")&&So(t)}function So(r){var t=Uo(r),e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(e),r.deleteFramebuffer(n),o}function Ls(r){return r===2&&Ot(r).fenceSync!=null}var Kh=Object.freeze({callAndCheck:Z,canBeRepresented:ls,getWebGLErrorMessage:us,getExtensionOrThrow:L2,createVertexShader:hs,createFragmentShader:fs,createProgram:ds,linkProgram:ps,validateProgram:e3,createStaticVertexBuffer:vs,createStaticIndexBuffer:ms,getNumChannels:function(){return B().getNumber("WEBGL_VERSION")===2?1:4},createTexture:gs,validateTextureSize:xs,createFramebuffer:bs,bindVertexBufferToProgramAttribute:Co,bindTextureUnit:ys,unbindTextureUnit:function(r,t,e){_s(r,e),Z(r,t,function(){return r.activeTexture(r.TEXTURE0+e)}),Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:ws,getProgramUniformLocation:zs,bindTextureToProgramUniformSampler:Ms,bindCanvasToFramebuffer:function(r,t){Z(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Z(r,t,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Z(r,t,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:t3,unbindColorTextureFromFramebuffer:_o,validateFramebuffer:F2,getFramebufferErrorMessage:Cs,getBatchDim:P2,getRowsCols:W2,getShapeAs3D:n3,getTextureShapeFromLogicalShape:Es,isReshapeFree:A2,getWebGLMaxTextureSize:Ss,resetMaxTextureSize:function(){Qr=null},resetMaxTexturesInShader:function(){Jr=null},getMaxTexturesInShader:ks,getWebGLDisjointQueryTimerVersion:Hs,hasExtension:ct,isWebGLVersionEnabled:Eo,isCapableOfRenderingToFloatTexture:Vs,isDownloadFloatTextureEnabled:Ts,isWebGLFenceEnabled:Ls}),le=B();function Fs(r){B().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function U(r,t){return T.tidy(r,t)}function Z1(r){Wo(r).forEach(function(t){return t.dispose()})}function Xh(r){return T.keep(r)}function u3(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];B().getBool("IS_TEST")||console.warn.apply(console,r)}function Rt(r,t){var e=r;if(k1(r))return t==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(e)||k1(e)&&t!=="string";)n.push(e.length),e=e[0];return Array.isArray(r)&&B().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(a,i,c){if(c=c||[],!Array.isArray(a)&&!k1(a))return void E(i.length===0,function(){return"Element arr["+c.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"});E(i.length>0,function(){return"Element arr["+c.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),E(a.length===i[0],function(){return"Element arr["+c.join("][")+"] should have "+i[0]+" elements, but has "+a.length+" elements"});for(var s=i.slice(1),l=0;l<a.length;++l)o(a[l],s,c.concat(l))}(r,n,[]),n}function uc(r,t,e,n){if(r!=null&&(r!=="numeric"&&r!==t||r==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+n+"' must be "+r+" tensor, but got "+t+" tensor")}function C(r,t,e,n){if(n===void 0&&(n="numeric"),r instanceof Ie)return uc(n,r.dtype,t,e),r;var o=N4(r);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),uc(n,o,t,e),r==null||!k1(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var a=r==null?"null":r.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=Rt(r,o);k1(r)||Array.isArray(r)||(r=[r]);var c=o!=="string"?Oo(r,o,B().getBool("DEBUG")):rn(r,[],!0);return T.makeTensor(c,i,o)}function h3(r,t,e,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(o,a){return C(o,t+"["+a+"]",e)},n)}function Go(r,t){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==t-1-e)return!1;return!0}function As(r,t,e){for(var n=r.length+t.length,o=[],a=0,i=0,c=0;c<n;c++)e.indexOf(c)===-1?o.push(r[a++]):o.push(t[i++]);return o}function S1(r,t){for(var e=[],n=r.length,o=0;o<n;o++)t.indexOf(o)===-1&&e.push(r[o]);return[e,t.map(function(a){return r[a]})]}function W1(r,t){return As(r,t.map(function(e){return 1}),t)}function X1(r,t,e){E(Go(t,e),function(){return r+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function Mt(r,t){if(Go(r,t))return null;for(var e=[],n=0;n<t;++n)r.indexOf(n)===-1&&e.push(n);return r.forEach(function(o){return e.push(o)}),e}function z3(r){return r.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Ct(r,t){for(var e=[],n=t-r;n<t;++n)e.push(n);return e}function Ds(r,t){var e=r[0].length;r.forEach(function(o,a){E(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+e+")"})}),E(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var n=r[0];r.forEach(function(o,a){for(var i=0;i<e;i++)E(i===t||o[i]===n[i],function(){return"Error in concat"+e+"D: Shape of tensors["+a+"] ("+o+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+a+"."})})}function n4(r,t){for(var e=r[0].slice(),n=1;n<r.length;n++)e[t]+=r[n][t];return e}function H(r){var t=Object.keys(r);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],n=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];T.startScope(e);try{var c=n.apply(void 0,a);return c instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),T.endScope(c),c}catch(s){throw T.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}le.registerFlag("HAS_WEBGL",function(){return le.getNumber("WEBGL_VERSION")>0}),le.registerFlag("WEBGL_VERSION",function(){return Eo(2)?2:Eo(1)?1:0}),le.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return le.get("WEBGL_VERSION")===2}),le.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),le.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),le.registerFlag("WEBGL_PACK",function(){return le.getBool("HAS_WEBGL")}),le.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_CLIP",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),le.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_REDUCE",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_LAZILY_UNPACK",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_CONV_IM2COL",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Ss(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return ks(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=le.getNumber("WEBGL_VERSION");return r===0?0:Hs(r)}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return le.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),le.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Vs(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!le.getBool("WEBGL_FORCE_F16_TEXTURES")&&le.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),le.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Ts(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ls(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return le.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),as=Fs;var E1=H({complex_:function(r,t){var e=C(r,"real","complex"),n=C(t,"imag","complex");return He(e.shape,n.shape,"real and imag shapes, "+e.shape+" and "+n.shape+", must match in call to tf.complex()."),T.runKernelFunc(function(o){return o.complex(e,n)},{$real:e,$imag:n})}}),ht=H({real_:function(r){var t=C(r,"input","real");return T.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),It=H({imag_:function(r){var t=C(r,"input","imag");return T.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function g1(r,t,e){return Vn(r,t,Rt(r,e),e)}function Vn(r,t,e,n){if(n==null&&(n=N4(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!k1(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Po(t);var o=te(t),a=te(e);E(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<e.length;++i){var c=e[i],s=i!==e.length-1||c!==te(t.slice(i));E(e[i]===t[i]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return k1(r)||Array.isArray(r)||(r=[r]),t=t||e,r=n!=="string"?Oo(r,n,B().getBool("DEBUG")):rn(r,[],!0),T.makeTensor(r,t,n)}function K(r,t){if((k1(r)&&t!=="string"||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&k1(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Vn(r,[],[],t)}function Re(r,t){a4(r);var e=Rt(r,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Vn(r,null,e,t)}function Bt(r,t,e){if(a4(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Rt(r,e);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Vn(r,t,n,e)}function M3(r,t,e){if(a4(r),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Rt(r,e);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Vn(r,t,n,e)}function f1(r,t,e){if(a4(r),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Rt(r,e);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Vn(r,t,n,e)}function Yh(r,t,e){if(a4(r),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Rt(r,e);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Vn(r,t,n,e)}function Zh(r,t,e){if(a4(r),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Rt(r,e);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Vn(r,t=t||n,n,e)}function Qh(r,t,e,n){return t===void 0&&(t=!0),T.makeVariable(r,t,e,n)}function W4(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=W4(r,"float32"),n=Oe(r,"float32");return E1(e,n)}var o=No(te(r),t);return T.makeTensor(o,r,t)}function Oe(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=Oe(r,"float32"),n=Oe(r,"float32");return E1(e,n)}var o=P4(te(r),t);return T.makeTensor(o,r,t)}function lt(r,t,e){return T.runKernelFunc(function(n){return n.fill(r,t,e)},{})}function Jh(r,t,e){if(e<=0)throw new Error("The number of values should be positive.");return T.runKernelFunc(function(n){return n.linspace(r,t,e)},{})}function f3(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e===0)throw new Error("Cannot have a step of zero");if(r===t||r<t&&e<0||t<r&&e>1)return Oe([0],n);var o=P4(Math.abs(Math.ceil((t-r)/e)),n);t<r&&e===1&&(e=-1),o[0]=r;for(var a=1;a<o.length;a++)o[a]=o[a-1]+e;return Re(o,n)}var Is=H({onesLike_:function(r){var t=C(r,"x","onesLike");if(t.dtype==="complex64"){var e=Is(ht(t)),n=Ee(It(t));return E1(e,n)}return T.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,a){return{$x:function(){return Ee(o)}}})}}),Ee=H({zerosLike_:function(r){var t=C(r,"x","zerosLike");return T.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,n){return{$x:function(){return Ee(e)}}})}}),Ue=H({concat_:function(r,t){t===void 0&&(t=0),E(r.length>=1,function(){return"Pass at least one tensor to concat"});var e=h3(r,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(c){if(c.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+c.dtype+". ")}),t=i1(t,e[0].shape)[0];var n=n4(e.map(function(c){return c.shape}),t);if(te(n)===0)return g1([],n);if((e=e.filter(function(c){return c.size>0})).length===1)return e[0];var o=e.map(function(c){return c.shape});Ds(o,t);var a=e,i={axis:t};return T.runKernelFunc(function(c){return c.concat(e,t)},a,function(c){var s=o.map(function(l){return l[t]});return qo(c,s,t).map(function(l){return function(){return l}})},"Concat",i)}}),ef=H({concat1d_:function(r){return Ue(r,0)}}),tf=H({concat2d_:function(r,t){return Ue(r,t)}}),nf=H({concat3d_:function(r,t){return Ue(r,t)}}),rf=H({concat4d_:function(r,t){return Ue(r,t)}}),qo=H({split_:function(r,t,e){e===void 0&&(e=0);var n,o=C(r,"x","split");return e=i1(e,o.shape)[0],typeof t=="number"?(E(o.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(t).fill(o.shape[e]/t)):(E(o.shape[e]===t.reduce(function(a,i){return a+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=t),T.runKernelFunc(function(a){return a.split(o,n,e)},{$x:o},function(a){return{$x:function(){return Ue(a,e)}}})}});function i4(r,t){return r(t={exports:{}},t.exports),t.exports}var of=i4(function(r){(function(t,e,n){function o(c){var s,l=this,u=(s=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var d=.02519603282416938*(s+=h.charCodeAt(f));d-=s=d>>>0,s=(d*=s)>>>0,s+=4294967296*(d-=s)}return 23283064365386963e-26*(s>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(c),l.s0<0&&(l.s0+=1),l.s1-=u(c),l.s1<0&&(l.s1+=1),l.s2-=u(c),l.s2<0&&(l.s2+=1),u=null}function a(c,s){return s.c=c.c,s.s0=c.s0,s.s1=c.s1,s.s2=c.s2,s}function i(c,s){var l=new o(c),u=s&&s.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,u&&(typeof u=="object"&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.alea=i})(0,r,!1)}),af=i4(function(r){(function(t,e,n){function o(c){var s=this,l="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var h=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^h^h>>>8},c===(0|c)?s.x=c:l+=c;for(var u=0;u<l.length+64;u++)s.x^=0|l.charCodeAt(u),s.next()}function a(c,s){return s.x=c.x,s.y=c.y,s.z=c.z,s.w=c.w,s}function i(c,s){var l=new o(c),u=s&&s.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.xor128=i})(0,r,!1)}),cf=i4(function(r){(function(t,e,n){function o(c){var s=this,l="";s.next=function(){var h=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^h^h<<1)|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,c===(0|c)?s.x=c:l+=c;for(var u=0;u<l.length+64;u++)s.x^=0|l.charCodeAt(u),u==l.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(c,s){return s.x=c.x,s.y=c.y,s.z=c.z,s.w=c.w,s.v=c.v,s.d=c.d,s}function i(c,s){var l=new o(c),u=s&&s.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.xorwow=i})(0,r,!1)}),sf=i4(function(r){(function(t,e,n){function o(c){var s=this;s.next=function(){var l,u,h=s.x,f=s.i;return l=h[f],u=(l^=l>>>7)^l<<24,u^=(l=h[f+1&7])^l>>>10,u^=(l=h[f+3&7])^l>>>3,u^=(l=h[f+4&7])^l<<7,l=h[f+7&7],u^=(l^=l<<13)^l<<9,h[f]=u,s.i=f+1&7,u},function(l,u){var h,f=[];if(u===(0|u))f[0]=u;else for(u=""+u,h=0;h<u.length;++h)f[7&h]=f[7&h]<<15^u.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()}(s,c)}function a(c,s){return s.x=c.x.slice(),s.i=c.i,s}function i(c,s){c==null&&(c=+new Date);var l=new o(c),u=s&&s.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,u&&(u.x&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.xorshift7=i})(0,r,!1)}),lf=i4(function(r){(function(t,e,n){function o(c){var s=this;s.next=function(){var l,u,h=s.w,f=s.X,d=s.i;return s.w=h=h+1640531527|0,u=f[d+34&127],l=f[d=d+1&127],u^=u<<13,l^=l<<17,u^=u>>>15,l^=l>>>12,u=f[d]=u^l,s.i=d,u+(h^h>>>16)|0},function(l,u){var h,f,d,p,v,m=[],g=128;for(u===(0|u)?(f=u,u=null):(u+="\0",f=0,g=Math.max(g,u.length)),d=0,p=-32;p<g;++p)u&&(f^=u.charCodeAt((p+32)%u.length)),p===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(v=v+1640531527|0,d=(h=m[127&p]^=f+v)==0?d+1:0);for(d>=128&&(m[127&(u&&u.length||0)]=-1),d=127,p=512;p>0;--p)f=m[d+34&127],h=m[d=d+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,m[d]=f^h;l.w=v,l.X=m,l.i=d}(s,c)}function a(c,s){return s.i=c.i,s.w=c.w,s.X=c.X.slice(),s}function i(c,s){c==null&&(c=+new Date);var l=new o(c),u=s&&s.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,u&&(u.X&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.xor4096=i})(0,r,!1)}),uf=i4(function(r){(function(t,e,n){function o(c){var s=this,l="";s.next=function(){var h=s.b,f=s.c,d=s.d,p=s.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,s.b=h=h<<20^h>>>12^f,s.c=f=f-d|0,s.d=d<<16^f>>>16^p,s.a=p-h|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,c===Math.floor(c)?(s.a=c/4294967296|0,s.b=0|c):l+=c;for(var u=0;u<l.length+20;u++)s.b^=0|l.charCodeAt(u),s.next()}function a(c,s){return s.a=c.a,s.b=c.b,s.c=c.c,s.d=c.d,s}function i(c,s){var l=new o(c),u=s&&s.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&a(u,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:n&&n.amd?n(function(){return i}):this.tychei=i})(0,r,!1)}),Yn=i4(function(r){(function(t,e){var n,o=this,a=256,i=6,c="random",s=e.pow(a,i),l=e.pow(2,52),u=2*l,h=a-1;function f(g,b,y){var x=[],w=v(function _(S,k){var L,V=[],I=typeof S;if(k&&I=="object")for(L in S)try{V.push(_(S[L],k-1))}catch{}return V.length?V:I=="string"?S:S+"\0"}((b=b==1?{entropy:!0}:b||{}).entropy?[g,m(t)]:g??function(){try{var _;return n&&(_=n.randomBytes)?_=_(a):(_=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(_)),m(_)}catch{var S=o.navigator,k=S&&S.plugins;return[+new Date,o,k,o.screen,m(t)]}}(),3),x),z=new d(x),M=function(){for(var _=z.g(i),S=s,k=0;_<l;)_=(_+k)*a,S*=a,k=z.g(1);for(;_>=u;)_/=2,S/=2,k>>>=1;return(_+k)/S};return M.int32=function(){return 0|z.g(4)},M.quick=function(){return z.g(4)/4294967296},M.double=M,v(m(z.S),t),(b.pass||y||function(_,S,k,L){return L&&(L.S&&p(L,z),_.state=function(){return p(z,{})}),k?(e[c]=_,S):_})(M,w,"global"in b?b.global:this==e,b.state)}function d(g){var b,y=g.length,x=this,w=0,z=x.i=x.j=0,M=x.S=[];for(y||(g=[y++]);w<a;)M[w]=w++;for(w=0;w<a;w++)M[w]=M[z=h&z+g[w%y]+(b=M[w])],M[z]=b;(x.g=function(_){for(var S,k=0,L=x.i,V=x.j,I=x.S;_--;)S=I[L=h&L+1],k=k*a+I[h&(I[L]=I[V=h&V+S])+(I[V]=S)];return x.i=L,x.j=V,k})(a)}function p(g,b){return b.i=g.i,b.j=g.j,b.S=g.S.slice(),b}function v(g,b){for(var y,x=g+"",w=0;w<x.length;)b[h&w]=h&(y^=19*b[h&w])+x.charCodeAt(w++);return m(b)}function m(g){return String.fromCharCode.apply(0,g)}if(e["seed"+c]=f,v(e.random(),t),r.exports){r.exports=f;try{n=tc()}catch{}}})([],Math)});Yn.alea=of,Yn.xor128=af,Yn.xorwow=cf,Yn.xorshift7=sf,Yn.xor4096=lf,Yn.tychei=uf;var C3=Yn.alea,jo=function(){function r(t,e,n,o,a){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=C3(i.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,o=!1;!o;){var a=void 0,i=void 0,c=void 0;do c=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i;while(c>=1||c===0);var s=Math.sqrt(-2*Math.log(c)/c);e=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},r.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},r.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},r}(),hf=function(){function r(t,e,n,o){this.alpha=t,this.beta=1/e,this.dtype=n;var a=o||Math.random();this.randu=C3(a.toString()),this.randn=new jo(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var t,e,n,o,a,i;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,e=1-.331*(t=o*o)*t,n=.5*t+this.d*(1-i+Math.log(i)),(a=this.randu())<e||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},r.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},r}(),ff=function(){function r(t,e,n,o){var a=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=C3(o)}return r.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function he(r,t,e){return t===void 0&&(t="float32"),t=t||"float32",Po(r),new O2(r,t,e)}function df(r,t){t===void 0&&(t=!1),console.log(r.toString(t))}var Bs=H({batchToSpaceND_:function(r,t,e){var n=C(r,"x","batchToSpaceND"),o=t.reduce(function(a,i){return a*i});return E(n.rank>=1+t.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+t.length}),E(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),E(n.shape[0]%o==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),T.runKernelFunc(function(a){return a.batchToSpaceND(n,t,e)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(t,e)}}})}}),pf=H({broadcastTo_:function(r,t){var e=C(r,"broadcastTo","x"),n=e.shape;if(t.some(function(s){return!(s>0)||s%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var o=e.shape.slice();o.length<t.length;)o.unshift(1);e=e.reshape(o)}for(var a=Array.from(t),i=t.length-1;i>=0;i--)if(e.shape[i]===t[i])a[i]=1;else if(e.shape[i]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+t+"].");var c=a.map(function(s,l){return s>1?l:-1}).filter(function(s){return s>=0});return c.length===0?e.clone():T.runKernelFunc(function(s){return s.tile(e,a)},{input:e},function(s){return{input:function(){return s.sum(c,!0)}}})}}),vf=H({cast_:function(r,t){var e=C(r,"x","cast");if(!Zc(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:t};return T.runKernelFunc(function(o){return o.cast(e,t)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",n)}}),mf=H({clone_:function(r){var t=C(r,"x","clone",null);return T.runKernelFunc(function(){return T.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),gf=H({cumsum_:function(r,t,e,n){t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1);var o=C(r,"x","cumsum"),a=Mt([t|=0],o.rank),i=o;a!=null&&(i=o.transpose(a));var c=Ct(1,o.rank)[0],s=T.runKernelFunc(function(l){return l.cumsum(i,c,e,n)},{permutedX:i},function(l){return{permutedX:function(){return l.cumsum(t,e,!n)}}});return a!=null&&(s=s.transpose(a)),s}}),xf=H({depthToSpace_:function(r,t,e){e===void 0&&(e="NHWC");var n=C(r,"x","depthToSpace"),o=e==="NHWC"?n.shape[1]:n.shape[2],a=e==="NHWC"?n.shape[2]:n.shape[3],i=e==="NHWC"?n.shape[3]:n.shape[1];return E(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+n.shape}),E(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+` for depthToSpace with input shape
          `+n.shape}),E(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+n.shape}),T.runKernelFunc(function(c){return c.depthToSpace(n,t,e)},{$x:n})}}),I1=H({expandDims_:function(r,t){t===void 0&&(t=0);var e=C(r,"x","expandDims",null);E(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var n=e.shape.slice();return t<0&&(E(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),n.splice(t,0,1),G1(e,n)}}),Rs=H({eye_:function(r,t,e,n){n===void 0&&(n="float32"),t==null&&(t=r);for(var o=he([r,t],n),a=r<=t?r:t,i=0;i<a;++i)o.set(1,i,i);var c=o.toTensor().as2D(r,t);if(e==null)return c;if(e.length===1)return e4(I1(c,0),[e[0],1,1]);if(e.length===2)return e4(I1(I1(c,0),0),[e[0],e[1],1,1]);if(e.length===3)return e4(I1(I1(I1(c,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),bf=H({multinomial_:function(r,t,e,n){n===void 0&&(n=!1);var o=C(r,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);e=e||Math.random();var c=i===1?o.as2D(1,-1):o,s=T.runKernelFunc(function(l){return l.multinomial(c,n,t,e)},{logits2D:c});return i===1?s.as1D():s}}),ko=H({oneHot_:function(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=C(r,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),T.runKernelFunc(function(i){return i.oneHot(o,t,e,n)},{$indices:o},function(i){return{$indices:function(){return Oe(o.shape,"float32")}}}).reshape(a)}}),an=H({pad_:function(r,t,e){e===void 0&&(e=0);var n=C(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:e};return T.runKernelFunc(function(a){return a.pad(n,t,e)},{x:n},function(a){var i=t.map(function(c){return c[0]});return{x:function(){return a.slice(i,n.shape)}}},"PadV2",o)}}),yf=H({pad1d_:function(r,t,e){return e===void 0&&(e=0),E(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),an(r,[t],e)}}),wf=H({pad2d_:function(r,t,e){return e===void 0&&(e=0),E(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),an(r,t,e)}}),zf=H({pad3d_:function(r,t,e){return e===void 0&&(e=0),E(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),an(r,t,e)}}),Mf=H({pad4d_:function(r,t,e){return e===void 0&&(e=0),E(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),an(r,t,e)}}),Cf=H({rand_:function(r,t,e){var n=te(r),o=null;if(e==null||e==="float32")o=new Float32Array(n);else if(e==="int32")o=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);o=new Uint8Array(n)}for(var a=0;a<n;a++)o[a]=t();return T.makeTensor(o,r,e)}}),_f=H({randomNormal_:function(r,t,e,n,o){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new jo(t,e,n,!1,o),i=he(r,n),c=0;c<i.values.length;c++)i.values[c]=a.nextValue();return i.toTensor()}}),Ef=H({randomGamma_:function(r,t,e,n,o){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e==null&&(e=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var a=new hf(t,e,n,o),i=he(r,n),c=0;c<i.values.length;c++)i.values[c]=a.nextValue();return i.toTensor()}}),Os=H({randomUniform_:function(r,t,e,n,o){t===void 0&&(t=0),e===void 0&&(e=1),n===void 0&&(n="float32");for(var a=he(r,n),i=new ff(t,e,null,o),c=0;c<a.values.length;c++)a.values[c]=i.nextValue();return a.toTensor()}}),G1=H({reshape_:function(r,t){var e=C(r,"x","reshape",null);t=Xc(t,e.size),E(e.size===te(t),function(){return"new shape and old shape must have the same number of elements."});var n={shape:t};return T.runKernelFunc(function(o){return o.reshape(e,t)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",n)}}),Ns=H({spaceToBatchND_:function(r,t,e){var n=C(r,"x","spaceToBatchND");return E(n.rank>=1+t.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+t.length}),E(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),E(n.shape.reduce(function(o,a,i){return i>0&&i<=t.length?o&&(a+e[i-1][0]+e[i-1][1])%t[i-1]==0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),T.runKernelFunc(function(o){return o.spaceToBatchND(n,t,e)},{$x:n},function(o){return{$x:function(){return o.batchToSpaceND(t,e)}}})}}),Ps=H({squeeze_:function(r,t){var e=C(r,"x","squeeze");return G1(e,En(e.shape,t).newShape)}}),H1=H({stack_:function(r,t){t===void 0&&(t=0);var e=h3(r,"tensors","stack");if(E(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var n=e[0].rank,o=e[0].shape,a=e[0].dtype;E(t<=n,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(c){He(o,c.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(c){E(a===c.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=e.map(function(c){return c.expandDims(t)});return Ue(i,t)}}),e4=H({tile_:function(r,t){var e=C(r,"x","tile",null);E(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."});var n=[e],o={reps:t};return T.runKernelFunc(function(a,i){var c=a.tile(e,t);return i([e]),c},{x:e},function(a,i){var c=i[0];return{x:function(){var s=Ee(c);if(c.rank===1)for(var l=0;l<t[0];++l)s=s.add(a.slice([l*c.shape[0]],[c.shape[0]]));else if(c.rank===2)for(l=0;l<t[0];++l)for(var u=0;u<t[1];++u)s=s.add(a.slice([l*c.shape[0],u*c.shape[1]],[c.shape[0],c.shape[1]]));else if(c.rank===3)for(l=0;l<t[0];++l)for(u=0;u<t[1];++u)for(var h=0;h<t[2];++h)s=s.add(a.slice([l*c.shape[0],u*c.shape[1],h*c.shape[2]],[c.shape[0],c.shape[1],c.shape[2]]));else{if(c.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+c.rank+" tensors yet.");for(l=0;l<t[0];++l)for(u=0;u<t[1];++u)for(h=0;h<t[2];++h)for(var f=0;f<t[3];++f)s=s.add(a.slice([l*c.shape[0],u*c.shape[1],h*c.shape[2],f*c.shape[3]],[c.shape[0],c.shape[1],c.shape[2],c.shape[3]]))}return s}}},"Tile",o,n)}}),Sf=H({truncatedNormal_:function(r,t,e,n,o){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new jo(t,e,n,!0,o),i=he(r,n),c=0;c<i.values.length;c++)i.values[c]=a.nextValue();return i.toTensor()}}),Le=H({unstack_:function(r,t){t===void 0&&(t=0),t=t||0;var e=C(r,"x","unstack");E(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length);var n={axis:t};return T.runKernelFunc(function(o){return o.unstack(e,t)},{x:e},function(o){return{x:function(){return H1(o,t)}}},"Unpack",n)}}),kf=function(r,t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c,s,l,u,h;return J(this,function(f){switch(f.label){case 0:return e=C(r,"x","setdiff1d"),n=C(t,"y","setdiff1d"),E(e.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+n.dtype+")."}),E(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),E(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,n.data()];case 2:for(a=f.sent(),i=new Set(a),c=0,u=0;u<o.length;u++)i.has(o[u])||c++;for(s=new O2([c],e.dtype),l=new O2([c],"int32"),u=0,h=0;u<o.length;u++)i.has(o[u])||(s.values[h]=o[u],l.values[h]=u,h++);return[2,[s.toTensor(),l.toTensor()]]}})})};function d3(r,t,e,n){n===void 0&&(n=!0);var o=[];if(n)(o=o.concat(t.slice(0))).push(r[0]/e),o=o.concat(r.slice(1));else{o=o.concat(r[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([r[i+1]/t[i],t[i]]);o=o.concat(r.slice(a+1))}return o}function p3(r,t,e){e===void 0&&(e=!0);var n=[];if(e){n.push(t);for(var o=t+1;o<r;++o)o<=2*t?(n.push(o),n.push(o-(t+1))):n.push(o)}else{var a=[],i=[];for(o=1;o<r;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function v3(r,t,e,n){n===void 0&&(n=!0);var o=[];n?o.push(r[0]/e):o.push(r[0]*e);for(var a=1;a<r.length;++a)a<=t.length?n?o.push(t[a-1]*r[a]):o.push(r[a]/t[a-1]):o.push(r[a]);return o}function Ws(r,t){for(var e=[0],n=0;n<t;++n)e.push(r[n][0]);return e}function Us(r,t,e){for(var n=r.slice(0,1),o=0;o<e;++o)n.push(r[o+1]-t[o][0]-t[o][1]);return n}function $o(r,t){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=t.shape,n=e[e.length-1],o=1,a=0;a<e.length-1;++a)o*=e[a];var i=r.shape,c=e.slice();c.pop();var s=1;for(a=n;a<r.rank;++a)s*=i[a],c.push(i[a]);var l=yt(r.shape).map(function(u){return u/s}).concat([1]).slice(0,n);return[c,o,s,l]}var Gw=Object.freeze({prepareAndValidate:$o}),Ko=30;function r3(r){return r<=Ko?r:l3(r,Math.floor(Math.sqrt(r)))}function Gs(r,t,e){var n=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+o+".";if(e.rank<o)throw new Error(a+" update.rank < "+o+". ");if(r.length<n+(e.rank-o))throw new Error(a+" Output shape length < "+(n+(e.rank-o)));if(e.rank!==o+r.length-n)throw new Error(a+" update.rank != "+(o+r.length-n));for(var i=0;i<o;++i)if(e.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+e.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<e.rank-o;++i)if(e.shape[i+o]!==r[i+n])throw new Error(a+" updates.shape["+(i+o)+"] ("+e.shape[i+o]+") != shape["+(i+o)+"] ("+r[i+o]+")")}function qs(r,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}Gs(e,t,r)}function U2(r,t,e){for(var n=t.shape.length,o=n>1?t.shape[n-1]:1,a=e.length,i=1,c=o;c<a;++c)i*=e[c];var s=o<1?1:o;return{sliceRank:o,numUpdates:te(t.shape)/s,sliceSize:i,strides:yt(e.slice(0,o)).concat([1]),outputSize:te(e)}}var qw=Object.freeze({validateUpdateShape:Gs,validateInput:qs,calculateShapes:U2});function js(r,t,e){E(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+t+" must match the rank of the array ("+r.rank+")."}),E(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var n=function(a){E(t[a]+e[a]<=r.shape[a],function(){return"Error in slice"+r.rank+"D: begin["+a+"] + size["+a+"] ("+(t[a]+e[a])+") would overflow input.shape["+a+"] ("+r.shape[a]+")"})},o=0;o<r.rank;++o)n(o)}function Ho(r){for(var t=[],e=0;r>0;)1&r&&t.push(e),r/=2,e++;return t}function _3(r,t,e){for(var n=[],o=0;o<r.length;o++)n[o]=Math.ceil((t[o]-r[o])/e[o]);return n}function $s(r,t,e,n,o){var a=t[o],i=e[o]||1;(r&1<<o||a==null)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var c=n[o];return a<0&&(a+=c),a=i3(0,a,c-1)}function Ks(r,t,e,n,o){var a=t[o],i=e[o]||1;(r&1<<o||a==null)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var c=n[o];return a<0&&(a+=c),a=i>0?i3(0,a,c):i3(-1,a,c-1)}function Xo(r,t,e){for(var n=e.length,o=0;o<e.length;o++)if(e[o]>1){n=o;break}for(o=n+1;o<e.length;o++)if(t[o]>0||e[o]!==r[o])return!1;return!0}function Yo(r,t){for(var e=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)e+=r[n]*t[n];return e}var jw=Object.freeze({assertParamsValid:js,maskToAxes:Ho,computeOutShape:_3,startForAxis:$s,stopForAxis:Ks,isSliceContinous:Xo,computeFlatOffset:Yo});function Hf(r,t){E(s3(r),function(){return"The f passed in variableGrads(f) must be a function"}),E(t==null||Array.isArray(t)&&t.every(function(u){return u instanceof t4}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=t!=null;if(!e)for(var n in t=[],T.registeredVariables)t.push(T.registeredVariables[n]);var o=e?t.filter(function(u){return!u.trainable}):null,a=t.length;E((t=t.filter(function(u){return u.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=T.gradients(r,t,null,!0),c=i.value,s=i.grads;E(s.some(function(u){return u!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),E(c.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+c.rank+" tensor"});var l={};return t.forEach(function(u,h){s[h]!=null&&(l[u.name]=s[h])}),o?.forEach(function(u){return l[u.name]=null}),{value:c,grads:l}}function E3(r){return T.customGrad(r)}var q1=H({softmax_:function(r,t){t===void 0&&(t=-1);var e=C(r,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return T.runKernelFunc(function(n,o){var a=n.softmax(e,t);return o([a]),a},{logits:e},function(n,o){var a=o[0],i=n.mul(a);return{logits:function(){return i.sub(i.sum([t],!0).mul(a))}}},"Softmax",{dim:t},[],[!0])}}),Vf=H({logSoftmax_:function(r,t){t===void 0&&(t=-1);var e=C(r,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return E3(function(n,o){var a=n.max(t,!0),i=n.sub(a),c=i.toFloat().sub(i.exp().sum(t,!0).log());return o([c]),{value:c,gradFunc:function(s,l){var u=l[0].exp();return s.sub(s.sum(t,!0).mul(u))}}})(e)}}),Xs=function(){function r(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},r.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},r.prototype.has=function(t){return this.data.has(t)},r.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Ys=function(){function r(){}return r.prototype.time=function(t){return F("time")},r.prototype.read=function(t){return F("read")},r.prototype.readSync=function(t){return F("readSync")},r.prototype.numDataIds=function(){return F("numDataIds")},r.prototype.disposeData=function(t){return F("disposeData")},r.prototype.write=function(t,e,n){return F("write")},r.prototype.move=function(t,e,n,o){return F("move")},r.prototype.memory=function(){return F("memory")},r.prototype.floatPrecision=function(){return F("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(t,e,n,o){return F("batchMatMul")},r.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,F("fusedBatchMatMul")},r.prototype.slice=function(t,e,n){return F("slice")},r.prototype.stridedSlice=function(t,e,n,o){return F("stridedSlice")},r.prototype.unstack=function(t,e){return F("unstack")},r.prototype.reverse=function(t,e){return F("reverse")},r.prototype.concat=function(t,e){return F("concat")},r.prototype.neg=function(t){return F("neg")},r.prototype.add=function(t,e){return F("add")},r.prototype.addN=function(t){return F("addN")},r.prototype.subtract=function(t,e){return F("subtract")},r.prototype.multiply=function(t,e){return F("multiply")},r.prototype.realDivide=function(t,e){return F("realDivide")},r.prototype.floorDiv=function(t,e){return F("floorDiv")},r.prototype.sum=function(t,e){return F("sum")},r.prototype.prod=function(t,e){return F("prod")},r.prototype.unsortedSegmentSum=function(t,e,n){return F("unsortedSegmentSum")},r.prototype.argMin=function(t,e){return F("argMin")},r.prototype.argMax=function(t,e){return F("argMax")},r.prototype.equal=function(t,e){return F("equal")},r.prototype.notEqual=function(t,e){return F("notEqual")},r.prototype.less=function(t,e){return F("less")},r.prototype.lessEqual=function(t,e){return F("lessEqual")},r.prototype.greater=function(t,e){return F("greater")},r.prototype.greaterEqual=function(t,e){return F("greaterEqual")},r.prototype.logicalNot=function(t){return F("logicalNot")},r.prototype.logicalAnd=function(t,e){return F("logicalAnd")},r.prototype.logicalOr=function(t,e){return F("logicalOr")},r.prototype.where=function(t){return F("where")},r.prototype.select=function(t,e,n){return F("select")},r.prototype.topk=function(t,e,n){return F("topk")},r.prototype.min=function(t,e){return F("min")},r.prototype.minimum=function(t,e){return F("minimum")},r.prototype.mod=function(t,e){return F("mod")},r.prototype.max=function(t,e){return F("max")},r.prototype.maximum=function(t,e){return F("maximum")},r.prototype.all=function(t,e){return F("all")},r.prototype.any=function(t,e){return F("any")},r.prototype.squaredDifference=function(t,e){return F("squaredDifference")},r.prototype.ceil=function(t){return F("ceil")},r.prototype.floor=function(t){return F("floor")},r.prototype.round=function(t){return F("round")},r.prototype.sign=function(t){return F("sign")},r.prototype.isNaN=function(t){return F("isNaN")},r.prototype.isInf=function(t){return F("isInf")},r.prototype.isFinite=function(t){return F("isFinite")},r.prototype.pow=function(t,e){return F("pow")},r.prototype.exp=function(t){return F("exp")},r.prototype.expm1=function(t){return F("expm1")},r.prototype.softmax=function(t,e){return F("softmax")},r.prototype.log=function(t){return F("log")},r.prototype.log1p=function(t){return F("log1p")},r.prototype.sqrt=function(t){return F("sqrt")},r.prototype.rsqrt=function(t){return F("rsqrt")},r.prototype.square=function(t){return F("square")},r.prototype.reciprocal=function(t){return F("reciprocal")},r.prototype.relu=function(t){return F("relu")},r.prototype.relu6=function(t){return F("relu6")},r.prototype.prelu=function(t,e){return F("prelu")},r.prototype.elu=function(t){return F("elu")},r.prototype.eluDer=function(t,e){return F("eluDer")},r.prototype.selu=function(t){return F("selu")},r.prototype.int=function(t){return F("int")},r.prototype.clip=function(t,e,n){return F("clip")},r.prototype.abs=function(t){return F("abs")},r.prototype.complexAbs=function(t){return F("complexAbs")},r.prototype.sigmoid=function(t){return F("sigmoid")},r.prototype.softplus=function(t){return F("softplus")},r.prototype.sin=function(t){return F("sin")},r.prototype.cos=function(t){return F("cos")},r.prototype.tan=function(t){return F("tan")},r.prototype.asin=function(t){return F("asin")},r.prototype.acos=function(t){return F("acos")},r.prototype.atan=function(t){return F("atan")},r.prototype.atan2=function(t,e){return F("atan2")},r.prototype.sinh=function(t){return F("sinh")},r.prototype.cosh=function(t){return F("cosh")},r.prototype.tanh=function(t){return F("tanh")},r.prototype.asinh=function(t){return F("asinh")},r.prototype.acosh=function(t){return F("acosh")},r.prototype.atanh=function(t){return F("atanh")},r.prototype.erf=function(t){return F("erf")},r.prototype.step=function(t,e){return F("step")},r.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,F("fusedConv2d")},r.prototype.conv2d=function(t,e,n){return F("conv2d")},r.prototype.conv2dDerInput=function(t,e,n){return F("conv2dDerInput")},r.prototype.conv2dDerFilter=function(t,e,n){return F("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,F("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(t,e,n){return F("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(t,e,n){return F("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(t,e,n){return F("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(t,e,n){return F("conv3d")},r.prototype.conv3dDerInput=function(t,e,n){return F("conv3dDerInput")},r.prototype.conv3dDerFilter=function(t,e,n){return F("conv3dDerFilter")},r.prototype.maxPool=function(t,e){return F("maxPool")},r.prototype.maxPoolBackprop=function(t,e,n,o){return F("maxPoolBackprop")},r.prototype.avgPool=function(t,e){return F("avgPool")},r.prototype.avgPoolBackprop=function(t,e,n){return F("avgPoolBackprop")},r.prototype.avgPool3d=function(t,e){return F("avgPool3d")},r.prototype.avgPool3dBackprop=function(t,e,n){return F("avgPool3dBackprop")},r.prototype.maxPool3d=function(t,e){return F("maxPool3d")},r.prototype.maxPool3dBackprop=function(t,e,n,o){return F("maxPool3dBackprop")},r.prototype.reshape=function(t,e){return F("reshape")},r.prototype.cast=function(t,e){return F("cast")},r.prototype.tile=function(t,e){return F("tile")},r.prototype.pad=function(t,e,n){return F("pad")},r.prototype.transpose=function(t,e){return F("transpose")},r.prototype.gather=function(t,e,n){return F("gather")},r.prototype.gatherND=function(t,e){return F("gatherND")},r.prototype.scatterND=function(t,e,n){return F("scatterND")},r.prototype.batchToSpaceND=function(t,e,n){return F("batchToSpaceND")},r.prototype.spaceToBatchND=function(t,e,n){return F("spaceToBatchND")},r.prototype.resizeBilinear=function(t,e,n,o){return F("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(t,e,n){return F("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(t,e,n,o){return F("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(t,e,n){return F("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(t,e,n,o,a,i){return F("batchNormalization")},r.prototype.localResponseNormalization4D=function(t,e,n,o,a){return F("localResponseNormalization4D")},r.prototype.LRNGrad=function(t,e,n,o,a,i,c){return F("LRNGrad")},r.prototype.multinomial=function(t,e,n,o){return F("multinomial")},r.prototype.oneHot=function(t,e,n,o){return F("oneHot")},r.prototype.cumsum=function(t,e,n,o){return F("cumsum")},r.prototype.nonMaxSuppression=function(t,e,n,o,a){return F("nonMaxSuppression")},r.prototype.fft=function(t){return F("fft")},r.prototype.ifft=function(t){return F("ifft")},r.prototype.complex=function(t,e){return F("complex")},r.prototype.real=function(t){return F("real")},r.prototype.imag=function(t){return F("imag")},r.prototype.cropAndResize=function(t,e,n,o,a,i){return F("cropAndResize")},r.prototype.depthToSpace=function(t,e,n){return F("depthToSpace")},r.prototype.split=function(t,e,n){return F("split")},r.prototype.sparseToDense=function(t,e,n,o){return F("sparseToDense")},r.prototype.diag=function(t){return F("diag")},r.prototype.fill=function(t,e,n){return F("fill")},r.prototype.onesLike=function(t){return F("onesLike")},r.prototype.zerosLike=function(t){return F("zerosLike")},r.prototype.linspace=function(t,e,n){return F("linspace")},r.prototype.dispose=function(){return F("dispose")},r}();function F(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function nn(r,t){for(var e=r.length,n=[],o=0;o<e;o++){var a=e-1-o,i=r[a]||1;(t[t.length-1-o]||1)>1&&i===1&&n.unshift(a)}return n}function a1(r,t){for(var e=[],n=0;n<t.length;n++){var o=r[r.length-n-1],a=t.length-n-1,i=t[a];(o==null||o===1&&i>1)&&e.unshift(a)}return e}function xe(r,t){for(var e=[],n=Math.max(r.length,t.length),o=0;o<n;o++){var a=r[r.length-o-1];a==null&&(a=1);var i=t[t.length-o-1];if(i==null&&(i=1),a===1)e.unshift(i);else if(i===1)e.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+r+" and "+t+".");e.unshift(a)}}return e}function O4(r,t,e,n,o,a,i){i===void 0&&(i="channelsLast");var c,s=m3(t),l=s[0],u=s[1];if(i==="channelsLast")c=[l,u,r[3],r[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);c=[l,u,r[1],r[1]]}return Tn(r,c,e,n,o,a,!1,i)}function G2(r,t,e,n,o,a,i){i===void 0&&(i="NDHWC");var c,s,l=Vo(t),u=l[0],h=l[1],f=l[2];if(i==="NDHWC")s="channelsLast",c=[u,h,f,r[4],r[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);s="channelsFirst",c=[u,h,f,r[1],r[1]]}return q2(r,c,e,n,o,!1,s,a)}function Tn(r,t,e,n,o,a,i,c){i===void 0&&(i=!1),c===void 0&&(c="channelsLast");var s=[-1,-1,-1,-1],l=s[0],u=s[1],h=s[2],f=s[3];if(c==="channelsLast")l=r[0],u=r[1],h=r[2],f=r[3];else{if(c!=="channelsFirst")throw new Error("Unknown dataFormat "+c);l=r[0],f=r[1],u=r[2],h=r[3]}var d,p=t[0],v=t[1],m=t[3],g=m3(e),b=g[0],y=g[1],x=m3(n),w=x[0],z=x[1],M=A4(p,w),_=A4(v,z),S=function(D,R,P,N,O,G,q,Y){var ne,ae,me;if(typeof D=="number"){ne={top:D,bottom:D,left:D,right:D,type:D===0?"VALID":"NUMBER"};var ge=function(Me,Ae,ke,Ye,qe){Ye==null&&(Ye=Zo(Me,Ae,ke));var je=Me[0],kt=Me[1],Ht=I2((je-Ae+2*Ye)/ke+1,qe);E(Ke(Ht),function(){return"The output # of rows ("+Ht+") must be an integer. Change the stride and/or zero pad parameters"});var J1=I2((kt-Ae+2*Ye)/ke+1,qe);return E(Ke(J1),function(){return"The output # of columns ("+J1+") must be an integer. Change the stride and/or zero pad parameters"}),[Ht,J1]}([R,P],G,N,D,Y);ae=ge[0],me=ge[1]}else if(D==="same"){ae=Math.ceil(R/N),me=Math.ceil(P/O);var be=Math.max(0,(ae-1)*N+G-R),Ce=Math.max(0,(me-1)*O+q-P),ze=Math.floor(be/2),_e=be-ze,Qe=Math.floor(Ce/2);ne={top:ze,bottom:_e,left:Qe,right:Ce-Qe,type:"SAME"}}else{if(D!=="valid")throw Error("Unknown padding parameter: "+D);ne={top:0,bottom:0,left:0,right:0,type:"VALID"},ae=Math.ceil((R-G+1)/N),me=Math.ceil((P-q+1)/O)}return{padInfo:ne,outHeight:ae,outWidth:me}}(o,u,h,b,y,M,_,a),k=S.padInfo,L=S.outHeight,V=S.outWidth,I=i?m*f:m;return c==="channelsFirst"?d=[l,I,L,V]:c==="channelsLast"&&(d=[l,L,V,I]),{batchSize:l,dataFormat:c,inHeight:u,inWidth:h,inChannels:f,outHeight:L,outWidth:V,outChannels:I,padInfo:k,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:v,effectiveFilterHeight:M,effectiveFilterWidth:_,dilationHeight:w,dilationWidth:z,inShape:r,outShape:d,filterShape:t}}function q2(r,t,e,n,o,a,i,c){a===void 0&&(a=!1),i===void 0&&(i="channelsLast");var s=[-1,-1,-1,-1,-1],l=s[0],u=s[1],h=s[2],f=s[3],d=s[4];if(i==="channelsLast")l=r[0],u=r[1],h=r[2],f=r[3],d=r[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);l=r[0],d=r[1],u=r[2],h=r[3],f=r[4]}var p,v=t[0],m=t[1],g=t[2],b=t[4],y=Vo(e),x=y[0],w=y[1],z=y[2],M=Vo(n),_=M[0],S=M[1],k=M[2],L=A4(v,_),V=A4(m,S),I=A4(g,k),D=function(q,Y,ne,ae,me,ge,be,Ce,ze,_e,Qe){var Me,Ae,ke,Ye;if(typeof q=="number"){Me={top:q,bottom:q,left:q,right:q,front:q,back:q,type:q===0?"VALID":"NUMBER"};var qe=function(x4,jt,i0,b4,Vt,c0){Vt==null&&(Vt=Zo(x4,jt,b4));var Bl=x4[0],Rl=x4[1],Ol=x4[2],s0=I2((Bl-jt+2*Vt)/b4+1,c0);E(Ke(s0),function(){return"The output # of depths ("+s0+") must be an integer. Change the stride and/or zero pad parameters"});var l0=I2((Rl-jt+2*Vt)/b4+1,c0);E(Ke(l0),function(){return"The output # of rows ("+l0+") must be an integer. Change the stride and/or zero pad parameters"});var u0=I2((Ol-jt+2*Vt)/b4+1,c0);return E(Ke(u0),function(){return"The output # of columns ("+u0+") must be an integer. Change the stride and/or zero pad parameters"}),[s0,l0,u0,i0]}([Y,ne,ae,1],Ce,1,me,q,Qe);Ae=qe[0],ke=qe[1],Ye=qe[2]}else if(q==="same"){Ae=Math.ceil(Y/me),ke=Math.ceil(ne/ge),Ye=Math.ceil(ae/be);var je=(Ae-1)*me+Ce-Y,kt=(ke-1)*ge+ze-ne,Ht=(Ye-1)*be+_e-ae,J1=Math.floor(je/2),g4=je-J1,Gt=Math.floor(kt/2),vn=kt-Gt,qt=Math.floor(Ht/2);Me={top:Gt,bottom:vn,left:qt,right:Ht-qt,front:J1,back:g4,type:"SAME"}}else{if(q!=="valid")throw Error("Unknown padding parameter: "+q);Me={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ae=Math.ceil((Y-Ce+1)/me),ke=Math.ceil((ne-ze+1)/ge),Ye=Math.ceil((ae-_e+1)/be)}return{padInfo:Me,outDepth:Ae,outHeight:ke,outWidth:Ye}}(o,u,h,f,x,w,z,L,V,I,c),R=D.padInfo,P=D.outDepth,N=D.outHeight,O=D.outWidth,G=a?b*d:b;return i==="channelsFirst"?p=[l,G,P,N,O]:i==="channelsLast"&&(p=[l,P,N,O,G]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:h,inWidth:f,inChannels:d,outDepth:P,outHeight:N,outWidth:O,outChannels:G,padInfo:R,strideDepth:x,strideHeight:w,strideWidth:z,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:L,effectiveFilterHeight:V,effectiveFilterWidth:I,dilationDepth:_,dilationHeight:S,dilationWidth:k,inShape:r,outShape:p,filterShape:t}}function Zo(r,t,e,n){n===void 0&&(n=1);var o=A4(t,n);return Math.floor((r[0]*(e-1)-e+o)/2)}function m3(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Vo(r){return typeof r=="number"?[r,r,r]:r}function A4(r,t){return t<=1?r:r+(r-1)*(t-1)}function I2(r,t){if(!t)return r;switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+t)}}function r4(r){var t=m3(r),e=t[0],n=t[1],o=t[2];return e===1&&n===1&&o===1}function U1(r,t){return r4(r)||r4(t)}function S3(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Qo(r,t,e){if(t==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Oe(r.shape),o=r.toFloat(),a=e.complex(o,n);return n.dispose(),o.dispose(),a}if(!Qc(r.dtype,t))return T.makeTensorFromDataId(r.dataId,r.shape,t);if(r.dtype==="complex64"){var i=e.real(r);return a=i.cast(t),i.dispose(),a}if(t==="int32")return e.int(r);if(t==="bool"){var c=K(0,r.dtype);return a=e.notEqual(r,c),c.dispose(),a}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+t)}function g3(r,t){return T.makeTensorFromDataId(r.dataId,t,r.dtype)}function Jo(r,t,e){var n=(t-r)/(e-1),o=P4(e,"float32");o[0]=r;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Re(o,"float32")}var $w=Object.freeze({castTensor:Qo,reshapeTensor:g3,linspaceImpl:Jo,upcastType:m1,axesAreInnerMostDims:Go,combineLocations:As,computeOutAndReduceShapes:S1,expandShapeToKeepDim:W1,assertAxesAreInnerMostDims:X1,getAxesPermutation:Mt,getUndoAxesPermutation:z3,getInnerMostAxes:Ct,getBroadcastDims:nn,getReductionAxes:a1,assertAndGetBroadcastShape:xe,assertParamsConsistent:Ds,computeOutShape:n4,computePool2DInfo:O4,computePool3DInfo:G2,computeConv2DInfo:Tn,computeConv3DInfo:q2,computeDefaultPad:Zo,tupleValuesAreOne:r4,eitherStridesOrDilationsAreOne:U1,convertConv2DDataFormat:S3,PARALLELIZE_THRESHOLD:Ko,computeOptimalWindowSize:r3});function To(r,t){if(r.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+t.length+".");for(var e=new Float32Array(2*r.length),n=0;n<e.length;n+=2)e[n]=r[n/2],e[n+1]=t[n/2];return e}function hc(r,t){return{real:r[2*t],imag:r[2*t+1]}}function Tf(r,t,e,n){r[2*n]=t,r[2*n+1]=e}function Lf(r,t,e){var n=(e?2:-2)*Math.PI*(r/t);return{real:Math.cos(n),imag:Math.sin(n)}}function Ff(r,t,e){var n=function(a,i,c){return function(s,l,u){for(var h=0,f=s.length,d=0,p=!1;h<f;){var v=u(l,s[d=h+(f-h>>>1)]);v>0?h=d+1:(f=d,p=!v)}return p?h:-h-1}(a,i,c||Af)}(r,t,e),o=n<0?-(n+1):n;r.splice(o,0,t)}function Af(r,t){return r>t?1:r<t?-1:0}function e6(r,t,e,n,o){return Zs(r,t,e,n,o,0).selectedIndices}function t6(r,t,e,n,o,a){var i=Zs(r,t,e,n,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function Zs(r,t,e,n,o,a,i,c){i===void 0&&(i=!1),c===void 0&&(c=!1);for(var s=Array.from(t).map(function(x,w){return{score:x,boxIndex:w,suppressBeginIndex:0}}).filter(function(x){return x.score>o}).sort(fc),l=a>0?-.5/a:0,u=[],h=[];u.length<e&&s.length>0;){var f=s.pop(),d=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(d<o)break;for(var m=!1,g=u.length-1;g>=v;--g){var b=Df(r,p,u[g]);if(b>=n){m=!0;break}if(f.score=f.score*If(n,l,b),f.score<=o)break}f.suppressBeginIndex=u.length,m||(f.score===d?(u.push(p),h.push(f.score)):f.score>o&&Ff(s,f,fc))}var y=u.length;return c&&(u.fill(0,y),h.fill(0,y)),{selectedIndices:Re(u,"int32"),selectedScores:Re(h,"float32"),numValidOutputs:K(y,"int32")}}function Df(r,t,e){var n=r.subarray(4*t,4*t+4),o=r.subarray(4*e,4*e+4),a=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),c=Math.max(n[0],n[2]),s=Math.max(n[1],n[3]),l=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(c-a)*(s-i),p=(h-l)*(f-u);if(d<=0||p<=0)return 0;var v=Math.max(a,l),m=Math.max(i,u),g=Math.min(c,h),b=Math.min(s,f),y=Math.max(g-v,0)*Math.max(b-m,0);return y/(d+p-y)}function If(r,t,e){var n=Math.exp(t*e*e);return e<=r?n:0}function fc(r,t){return r.score-t.score||r.score===t.score&&t.boxIndex-r.boxIndex}function Qs(r,t,e){var n=new Array(r.rank).fill(0),o=r.shape.slice();return t.map(function(a){o[e]=a;var i=r.slice(n,o);return n[e]+=a,i})}function Js(r,t){for(var e=new Array(r.rank),n=0;n<e.length;n++)e[n]=r.shape[n]*t[n];var o=he(e,r.dtype);for(n=0;n<o.values.length;++n){for(var a=o.indexToLoc(n),i=new Array(r.rank),c=0;c<i.length;c++)i[c]=a[c]%r.shape[c];var s=r.locToIndex(i);o.values[n]=r.values[s]}return o.toTensor()}function e5(r,t,e,n,o){for(var a=t[t.length-1],i=[r.length/a,a],c=i[0],s=i[1],l=R4(e,c*n),u=R4("int32",c*n),h=0;h<c;h++){for(var f=h*s,d=r.subarray(f,f+s),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(x,w){return w.value-x.value});var m=h*n,g=l.subarray(m,m+n),b=u.subarray(m,m+n);for(v=0;v<n;v++)g[v]=p[v].value,b[v]=p[v].index}var y=t.slice();return y[y.length-1]=n,[g1(l,y,e),g1(u,y,"int32")]}function n6(r,t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(n);var o=he(r,"int32"),a=he([e.length,r.length],"int32");for(n=0;n<e.length;n++){var i=o.indexToLoc(e[n]),c=n*r.length;a.values.set(i,c)}return a.toTensor()}var Bf=function(r,t){this.outputShape=[],this.outputShape=r,this.variableNames=t.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var n=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},Rf=function(r,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=t.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var n=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},Of=function(r,t,e){this.variableNames=["A"];var n=r.windowSize,o=r.batchSize,a=r.inSize,i=Math.ceil(a/n);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var c=t==="max"?">":"<",s=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+s+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+c+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function t5(r,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return r+"."+e})}function Y1(r,t){return t===1?[r]:t5(r,t)}function B1(){var r,t,e,n,o,a,i,c,s,l;return B().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",t="in",e="out",n="in",o="texture",a="outputColor",i="out vec4 outputColor;",c=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,s="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",t="attribute",e="varying",n="varying",o="texture2D",a="gl_FragColor",i="",c=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,s=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:t,varyingVs:e,varyingFs:n,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:c,defineSpecialInf:s,defineRound:l}}function Zn(r,t,e){e===void 0&&(e="index");var n=yt(t);return n.map(function(o,a){return"int "+r[a]+" = "+e+" / "+o+"; "+(a===n.length-1?"int "+r[a+1]+" = "+e+" - "+r[a]+" * "+o:"index -= "+r[a]+" * "+o)+";"}).join("")}function r6(r){var t=yt(r).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var n5=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Nf(r,t,e,n){var o=[];r.forEach(function(d){var p=te(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?o.push("uniform float "+d.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+d.name+";"),o.push("uniform int offset"+d.name+";"))});var a,i,c=o.join(`
`),s=r.map(function(d){return function(p,v,m){m===void 0&&(m=!1);var g="";g+=m?r5(p):V4(p);var b=p.shapeInfo.logicalShape,y=v.logicalShape;return b.length<=y.length&&(g+=m?function(x,w){var z,M=x.name,_=M.charAt(0).toUpperCase()+M.slice(1),S="get"+_+"AtOutCoords",k=x.shapeInfo.logicalShape.length,L=w.logicalShape.length,V=nn(x.shapeInfo.logicalShape,w.logicalShape),I=Ne(L),D=L-k,R=["x","y","z","w","u","v"];z=k===0?"":L<2&&V.length>=1?"coords = 0;":V.map(function(ne){return"coords."+R[ne+D]+" = 0;"}).join(`
`);var P="";P=L<2&&k>0?"coords":x.shapeInfo.logicalShape.map(function(ne,ae){return"coords."+R[ae+D]}).join(", ");var N="return outputValue;",O=te(x.shapeInfo.logicalShape)===1,G=te(w.logicalShape)===1;if(k!==1||O||G){if(O&&!G)N=L===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(V.length){var q=k-2,Y=k-1;V.indexOf(q)>-1&&V.indexOf(Y)>-1?N="return vec4(outputValue.x);":V.indexOf(q)>-1?N="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":V.indexOf(Y)>-1&&(N="return vec4(outputValue.xx, outputValue.zz);")}}else N=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+S+`() {
      `+I+` coords = getOutputCoords();
      `+z+`
      vec4 outputValue = get`+_+"("+P+`);
      `+N+`
    }
  `}(p,v):function(x,w){var z=x.name,M=z.charAt(0).toUpperCase()+z.slice(1),_="get"+M+"AtOutCoords",S=w.texShape,k=x.shapeInfo.texShape,L=x.shapeInfo.logicalShape.length,V=w.logicalShape.length;if(!x.shapeInfo.isUniform&&L===V&&x.shapeInfo.flatOffset==null&&o1(k,S))return`
      float `+_+`() {
        return sampleTexture(`+z+`, resultUV);
      }
    `;var I,D=Ne(V),R=nn(x.shapeInfo.logicalShape,w.logicalShape),P=V-L,N=["x","y","z","w","u","v"];I=L===0?"":V<2&&R.length>=1?"coords = 0;":R.map(function(G){return"coords."+N[G+P]+" = 0;"}).join(`
`);var O="";return O=V<2&&L>0?"coords":x.shapeInfo.logicalShape.map(function(G,q){return"coords."+N[q+P]}).join(", "),`
    float `+_+`() {
      `+D+` coords = getOutputCoords();
      `+I+`
      return get`+M+"("+O+`);
    }
  `}(p,v)),g}(d,t,n)}).join(`
`),l=t.texShape,u=B1(),h=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(u),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Pf+`
    `+Wf+`
    `+Uf+`
  `}(u);return t.isPacked?(a=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(x,w){var z=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];return z[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+z[1]+`.0);
      }
    `:z[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+z[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));
      return 2 * (resTexRC.x * `+z[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(x,w){var z=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];if(o1(x,w))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+z[0]+", "+z[1]+`));
      }
    `;var M=Math.ceil(x[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));

      int index = resTexRC.x * `+z[1]+` + resTexRC.y;
      int r = 2 * (index / `+M+`);
      int c = imod(index, `+M+`) * 2;

      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=d,m=p,g=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],b=Math.ceil(v[2]/2),y=b*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+y+`;
      index -= b * `+y+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(x,w){for(var z=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],M=Math.ceil(x[x.length-1]/2),_=M*Math.ceil(x[x.length-2]/2),S=_,k="",L="b, r, c",V=2;V<x.length-1;V++)S*=x[x.length-V-1],k=`
      int b`+V+" = index / "+S+`;
      index -= b`+V+" * "+S+`;
    `+k,L="b"+V+", "+L;return`
    ivec`+x.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+z[0]+", "+z[1]+`));
      int index = resTexRC.x * `+z[1]+` + resTexRC.y;

      `+k+`

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+M+`);
      int c = imod(index, `+M+`) * 2;

      return ivec`+x.length+"("+L+`);
    }
  `}(d,p)}var v,m,g,b,y}(t.logicalShape,l),i=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(u)):(a=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(g,b){return o1(g,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=p,m=Zn(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,b){var y=Zn(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+y+`
      return ivec4(r, c, d, d2);
    }
  `}(d,p);case 5:return function(g,b){var y=Zn(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+y+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,p);case 6:return function(g,b){var y=Zn(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+y+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,p);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,m}(t.logicalShape,l),i=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(u)),n&&(f+=Gf),[f,h,i,c,a,s,e].join(`
`)}function V4(r){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+n+";}";var a=e.shapeInfo.texShape,i=a[0],c=a[1];if(i===1&&c===1)return`
      float `+o+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var s=e.shapeInfo.texShape,l=s[0],u=s[1],h=$n(n);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+u+", "+h+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(e){var n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+S4(e)+`
      }
    `;var a=e.shapeInfo.texShape,i=a[0],c=a[1];if(c===1&&i===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var s=$n(n);return c===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+s+") + 0.5) / "+i+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:i===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+s+") + 0.5) / "+c+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+c+", index + "+s+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(e){var n=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=e.shapeInfo.texShape;if(i!=null&&o1(n,i)){var c=i[0],s=i[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+s+".0, "+c+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=En(n),u=l.newShape,h=l.keptDims,f=u;if(f.length<n.length){var d=T4(e,f);return`
      `+V4(d)+`
      float `+a+`(int row, int col) {
        return `+a+"("+L4(["row","col"],h)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+S4(e)+`
      }
    `;var p=i[0],v=i[1],m=$n(o);return v===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(r);case 3:return function(e){var n=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=n[1]*n[2],c=n[2],s=En(n),l=s.newShape,u=s.keptDims,h=l;if(h.length<n.length){var f=T4(e,h);return`
        `+V4(f)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+L4(["row","col","depth"],u)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+c+`, 1)));
        `+S4(e)+`
      }
    `;var d=e.shapeInfo.texShape,p=d[0],v=d[1],m=e.shapeInfo.flatOffset;if(v===i&&m==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+c+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(v===c&&m==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var g=$n(o);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+c+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(r);case 4:return function(e){var n=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=n[3],c=n[2]*i,s=n[1]*c,l=En(n),u=l.newShape,h=l.keptDims;if(u.length<n.length){var f=T4(e,u);return`
      `+V4(f)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+L4(["row","col","depth","depth2"],h)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+s+", "+c+", "+i+`, 1)));
        `+S4(e)+`
      }
    `;var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&d==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+c+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===i&&d==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=$n(o);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+c+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+g+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);case 5:return function(e){var n=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=n[4],c=n[3]*i,s=n[2]*c,l=n[1]*s,u=En(n),h=u.newShape,f=u.keptDims;if(h.length<n.length){var d=T4(e,h);return`
      `+V4(d)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+L4(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+s+", "+c+", "+i+`)) +
          depth3;
        `+S4(e)+`
      }
    `;var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===l&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+s+", "+c+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===i&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=$n(o);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+s+" + depth * "+c+` +
          depth2 * `+i+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);case 6:return function(e){var n=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=En(n),c=i.newShape,s=i.keptDims;if(c.length<n.length){var l=T4(e,c);return`
      `+V4(l)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+L4(["row","col","depth","depth2","depth3","depth4"],s)+`);
      }
    `}var u=n[5],h=n[4]*u,f=n[3]*h,d=n[2]*f,p=n[1]*d;if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+u+`, 1)));
        `+S4(e)+`
      }
    `;var v=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],b=m[1];if(b===p&&v==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+h+", "+u+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===u&&v==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var y=$n(o);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+d+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+u+" + depth4 + "+y+`;
      vec2 uv = uvFromFlat(`+g+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function r5(r){var t,e,n;switch(r.shapeInfo.logicalShape.length){case 0:return t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),n=B1(),`
    vec4 `+e+`() {
      return `+n.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var a=o.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),c=o.shapeInfo.texShape,s=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],l=B1();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+s[0]+", "+s[1]+`, index);
      return `+l.texture2D+"("+a+`, uv);
    }
  `}(r);case 2:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,c="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,l=s[0],u=s[1],h=B1();if(s!=null&&o1(a,s))return`
      vec4 `+c+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+l+`.0);

        return `+h.texture2D+"("+i+`, uv);
      }
    `;var f=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],d=Math.ceil(a[1]/2);return`
    vec4 `+c+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+i+`, uv);
    }
  `}(r);case 3:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,c="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(a[0]===1){var u=a.slice(1),h=T4(o,u);return`
        `+r5(h)+`
        vec4 `+c+`(int b, int row, int col) {
          return `+c+"("+L4(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],p=Math.ceil(a[2]/2),v=p*Math.ceil(a[1]/2),m=B1();return`
    vec4 `+c+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+v+", "+p+`, b, row, col);
      return `+m.texture2D+"("+i+`, uv);
    }
  `}(r);default:return function(o){for(var a=o.shapeInfo.logicalShape,i=a.length,c=o.name,s="get"+c.charAt(0).toUpperCase()+c.slice(1),l=o.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=u[0],f=u[1],d=Math.ceil(a[i-1]/2),p=d*Math.ceil(a[i-2]/2),v="int b, int row, int col",m="b * "+p+" + (row / 2) * "+d+" + (col / 2)",g=2;g<i-1;g++)v="int b"+g+", "+v,p*=a[i-g-1],m="b"+g+" * "+p+" + "+m;var b=B1();return`
    vec4 `+s+"("+v+`) {
      int index = `+m+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+b.texture2D+"("+c+`, uv);
    }
  `}(r)}}var Pf=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Wf=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Uf=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Gf=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function $n(r){return"offset"+r}function S4(r){var t=r.name,e=te(r.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Ne(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function T4(r,t){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=t,e}function L4(r,t){return t.map(function(e){return r[e]}).join(", ")}var qf=function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(r.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=r[r.length-1],a=Math.ceil(o/t);this.outputShape=r.slice(0,-1),a>1&&this.outputShape.push(a),n||this.variableNames.push("bestIndicesA");var i,c,s=this.outputShape,l=s.length,u=Ne(l),h=Y1("coords",l);if(a===1){var f=Ne(c=l+1);i=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else c=l,i=`
        `+u+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+u+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+u+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+u+` sourceLocB = coords;
        --`+h[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,c),p="."+d[c-1],v=d.map(function(_){return"int "+_}),m=Y1("sourceLocR",c-1).concat("inIdx.r"),g=Y1("sourceLocG",c-1).concat("inIdx.g"),b=Y1("sourceLocB",c-1).concat("inIdx.b"),y=Y1("sourceLocA",c-1).concat("inIdx.a"),x=e==="max"?"greaterThan":"lessThan",w=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+y.join()+")));",z=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+y.join()+") : 0.)",M=n?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+M+`
      void main() {
        `+u+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(s[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(s[l-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+z+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+w+`
          vec4 candidate = `+z+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},jf=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,i=r.dilationWidth,c=r.effectiveFilterHeight,s=r.effectiveFilterWidth,l=c-1-r.padInfo.top,u=s-1-r.padInfo.left,h=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+u+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+s+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},$f=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,c=r.dilationDepth,s=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=u-1-r.padInfo.front,p=h-1-r.padInfo.top,v=f-1-r.padInfo.left,m=1/(t*e*n);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+c+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+s+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Kf=function(r,t,e,n,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],xe(r,t),xe(r,e);var i="0.0";n!=null&&(xe(r,n),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var c="1.0";o!=null&&(xe(r,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+c+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Xf=function(r,t,e,n,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xe(r,t),xe(r,e);var i="vec4(0.0)";n!=null&&(xe(r,n),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var c="vec4(1.0)";o!=null&&(xe(r,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+c+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Yf="return areal * breal - aimag * bimag;",Zf="return areal * bimag + aimag * breal;",dc=function(r,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xe(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Q0="return a + b;",J0="return a - b;",pc="return a * b;",o5="return (a < 0.) ? b * a : a;",Ze=function(r,t,e){this.variableNames=["A","B"],this.outputShape=xe(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},a5=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,en=function(r,t,e,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe(t,e);var o=this.outputShape.length,a="";if(n)if(o===0||te(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+Ne(o)+` coords = getOutputCoords();
        `,o===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=Y1("coords",o);a+=`
            bool nextRowOutOfBounds =
              (`+i[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+i[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},Qf=function(){function r(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(o,a){n.minLoc==null&&(n.minLoc=o.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(n.minLoc,t),o.gl.uniform1f(n.maxLoc,e)}},r}(),Jf=function(){function r(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(o,a){n.minLoc==null&&(n.minLoc=o.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(n.minLoc,t),o.gl.uniform1f(n.maxLoc,e)}},r}(),ed=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},td=function(r){this.outputShape=[],this.outputShape=n4(r,1),this.variableNames=r.map(function(c,s){return"T"+s});var t=new Array(r.length-1);t[0]=r[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+r[e][1];var n=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var o=t[e-1];n.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];n.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},nd=function(r,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=n4(r,t);var e=this.outputShape,n=e.length,o=Ne(n),a=Y1("coords",n),i=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(m,g){return"T"+g});var c=new Array(r.length-1);c[0]=r[0][t];for(var s=1;s<c.length;s++)c[s]=c[s-1]+r[s][t];var l=i[t],u=i.slice(-2),h=i.join(),f="if ("+l+" < "+c[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+u.join()+`));
        }`;for(s=1;s<c.length;s++){var d=c[s-1];f+=`
        if (`+l+" < "+c[s]+"  && "+l+" >= "+c[s-1]+`) {
          return getChannel(
            getT`+s+"("+Gr(i,l,d)+`),
            vec2(`+Gr(u,l,d)+`));
        }`}var p=c.length,v=c[c.length-1];f+=`
        return getChannel(
          getT`+p+"("+Gr(i,l,v)+`),
          vec2(`+Gr(u,l,v)+"));",this.userCode=`
      float getValue(`+i.map(function(m){return"int "+m})+`) {
        `+f+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[n-1]+" = "+a[n-1]+` + 1;
        if (`+a[n-1]+" < "+e[n-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[n-2]+" = "+a[n-2]+` + 1;
        if (`+a[n-2]+" < "+e[n-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[n-1]+" = "+a[n-1]+` - 1;
        if (`+a[n-2]+" < "+e[n-2]+` &&
            `+a[n-1]+" < "+e[n-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Gr(r,t,e){var n=r.indexOf(t);return r.map(function(o,a){return a===n?o+" - "+e:o}).join()}var rd=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,o=r.padInfo.left,a=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},od=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,o=r.strideWidth,a=r.dataFormat==="channelsLast",i=t-1-r.padInfo.top,c=e-1-r.padInfo.left,s=a?1:2,l=a?2:3,u=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+c+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+u+`];

        ivec2 dyCorner = ivec2(coords[`+s+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},ad=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,o=r.padInfo.front,a=r.padInfo.top,i=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+a+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+i+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},id=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,c=t-1-r.padInfo.front,s=e-1-r.padInfo.top,l=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+s+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},cd=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,o=r.padInfo.left,a=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},sd=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,o=r.strideWidth,a=t-1-r.padInfo.top,i=e-1-r.padInfo.left,c=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+c+`; dm++) {
              int d2 = d1 * `+c+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},vc=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.padInfo.top,a=r.padInfo.left,i=r.strideHeight,c=r.strideWidth,s=r.dilationHeight,l=r.dilationWidth,u=r.filterHeight,h=r.filterWidth,f=4*Math.floor(r.inChannels/4),d=r.inChannels%4,p=r.dataFormat==="channelsLast",v=p?1:2,m=p?2:3,g=p?3:1,b="",y="";e&&(b=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,y="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+i+", "+c+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`; wR++) {
          int xR = xRCorner + wR * `+s+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+x+`
        `+y+`
        setOutput(result);
      }
    `},ld=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.padInfo.front,e=r.padInfo.top,n=r.padInfo.left,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,c=r.dilationDepth,s=r.dilationHeight,l=r.dilationWidth,u=r.filterDepth,h=r.filterHeight,f=r.filterWidth,d=4*Math.floor(r.inChannels/4),p=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+u+`; wF++) {
          int xF = xFCorner + wF * `+c+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+s+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},mc=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.inHeight,a=r.inWidth,i=r.padInfo.top,c=r.padInfo.left,s=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,d=r.filterWidth,p=r.outChannels/r.inChannels,v="",m="";e&&(v=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+s+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+c+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+m+`
        setOutput(result);
      }
    `},gc=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var o=r.inHeight,a=r.inWidth,i=r.padInfo.top,c=r.padInfo.left,s=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,d=r.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var g=0;g<d;g++)v+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<f;m++)for(var b=0;b<p;b++){if(v+=`
          xR = xRCorner + `+m*u+`;
          xC = xCCorner + `+(g=2*b)*h+`;
        `,l===1){if(g<d&&(v+=c%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+m+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<d)){var y=c%2==0?Bo(h):h;h%2==0&&c%2==1||h%2!=0&&c%2!=1?(v+=`
                  xCOffset = xC + `+c%2+" + "+y+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+y+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<d&&(v+=`
              if(xR >= 0 && xR < `+o+`) {
            `,c%2==1?(v+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<d&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<d&&(v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),v+="}");g<d&&(v+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<d&&(v+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<f;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var x="",w="";e&&(x=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,w="result = activation(result);");var z=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+s+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+c+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+z+`
        `+w+`
        setOutput(result);
      }
    `},ud=function(r,t,e,n,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=r[0],i=r[1],c=r[2],s=r[3],l=t[0],u=e[0],h=e[1];this.outputShape=[l,u,h,s];var f=n==="bilinear"?1:0,d=[i-1+".0",c-1+".0"],p=d[0],v=d[1],m=u>1?[""+(i-1)/(u-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],b=m[1],y=m[2],x=h>1?[""+(c-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],z=x[1],M=x[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+w+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+z+`;

        float in_y = `+y+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+M+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},hd=function(r,t,e){this.variableNames=["x"],this.outputShape=r;var n=r.length,o=r[r.length-1],a=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ne(n)+` coords = getOutputCoords();
        int end = `+xc(n,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+xc(n,"coords")+` = idx;
          val += getX(`+function(i,c){if(i===1)return""+c;if(i===2)return c+".x, "+c+".y";if(i===3)return c+".x, "+c+".y, "+c+".z";if(i===4)return c+".x, "+c+".y, "+c+".z, "+c+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function xc(r,t){if(r===1)return""+t;if(r===2)return t+".y";if(r===3)return t+".z";if(r===4)return t+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var fd=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=N2.DENSE;var t=D2(r),e=B1();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Zn(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},dd=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=N2.DENSE;var t=D2(r),e=B1();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Zn(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},pd=function(){function r(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),vd=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},md=function(r){this.variableNames=["A"],this.outTexUsage=it.DOWNLOAD;var t=B1();this.outputShape=r,this.userCode=`
      `+n5+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},gd=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=it.DOWNLOAD;var t=B1();this.outputShape=r,this.userCode=`
      `+n5+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},xd=function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var n=B1(),o=t[0],a=t[1];this.outputShape=r;var i="result";e&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+r6(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},bd=function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=B1(),o=t[0],a=t[1];this.outputShape=r;var i="",c="result";e&&(c="floor(result * 255. + 0.5)");for(var s=0;s<=1;s++)for(var l=0;l<=1;l++){var u=2*s+l;i+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+r[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+s+" < "+r[1]+`) {
              localCoords[1] += `+s+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+u+`] = values[0];
              } else if(offset == 1) {
                result[`+u+`] = values[1];
              } else if(offset == 2) {
                result[`+u+`] = values[2];
              } else {
                result[`+u+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+r6(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+n.output+" = "+c+`;
      }
    `},yd="return real * expR - imag * expI;",wd="return real * expI + imag * expR;",bc=function(r,t,e){this.variableNames=["real","imag"];var n=t[1];this.outputShape=t;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=e?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},zd=function(){function r(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,o){e.valueLoc==null&&(e.valueLoc=n.getUniformLocationNoThrow(o,"value")),n.gl.uniform1f(e.valueLoc,t)}},r}(),Md=function(r,t,e){this.variableNames=["A","indices"];var n=r.slice();n[e]=t,this.outputShape=n,this.rank=n.length;var o=Ne(this.rank),a=function(i,c){var s=i.length;if(s>4)throw Error("Gather for rank "+s+" is not yet supported");if(s===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],h=0;h<i.length;h++)h===c?u.push("int(getIndices("+l[h]+"))"):u.push(""+l[h]);return u.join()}(r,e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Cd=function(r,t,e){this.sliceDim=r,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var n=Ne(t.length),o=Ne(e.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function i5(r,t){var e=B1();return hs(r,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function c5(r,t){return vs(r,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function s5(r,t){return ms(r,t,new Uint16Array([0,1,2,2,1,3]))}function K2(r,t,e,n,o,a,i){xs(e,n);var c=gs(r,t),s=r.TEXTURE_2D;return Z(r,t,function(){return r.bindTexture(s,c)}),Z(r,t,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Z(r,t,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Z(r,t,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Z(r,t,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Z(r,t,function(){return r.texImage2D(s,0,o,e,n,0,a,i,null)}),Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)}),c}function l5(r,t,e,n,o){var a=w3(e,n);return K2(r,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,r.FLOAT)}function u5(r,t,e,n,o){var a=w3(e,n);return K2(r,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function h5(r,t,e,n,o){var a=w3(e,n);return K2(r,t,a[0],a[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function f5(r,t,e,n,o){var a=$2(e,n);return K2(r,t,a[0],a[1],o.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function d5(r,t,e,n,o){var a=$2(e,n);return K2(r,t,a[0],a[1],o.internalFormatPackedHalfFloat,r.RGBA,o.textureTypeHalfFloat)}function p5(r,t,e,n){return Z(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Co(r,t,e,"clipSpacePos",n,3,20,0)&&Co(r,t,e,"uv",n,2,20,12)}function v5(r,t,e,n,o,a,i){var c,s,l;Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),a instanceof Uint8Array?(c=new Uint8Array(n*o*4),s=r.UNSIGNED_BYTE,l=r.RGBA):(c=new Float32Array(n*o*4),s=r.FLOAT,l=i.internalFormatPackedFloat),c.set(a),Z(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,l,n,o,0,r.RGBA,s,c)}),Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function m5(r,t,e,n){Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),n.data instanceof Uint8Array?Z(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):Z(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Z(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function g5(r,t,e,n,o){var a=r.createBuffer();Z(r,t,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=16*e*n;return Z(r,t,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,i,r.STREAM_READ)}),Z(r,t,function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,0)}),Z(r,t,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function x5(r,t,e){var n=r,o=new Float32Array(e);return n.bindBuffer(n.PIXEL_PACK_BUFFER,t),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function b5(r,t,e,n,o){var a=w3(e,n),i=a[0],c=a[1],s=new Uint8Array(e*n*4);return Z(r,t,function(){return r.readPixels(0,0,i,c,o.downloadTextureFormat,r.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function y5(r,t,e,n,o,a,i,c){var s=r,l=new Float32Array(function(u,h){var f=$2(u,h);return f[0]*f[1]*4}(a,i));return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,l),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),l}function w5(r,t,e,n){var o=new Float32Array(e*n*4);return Z(r,t,function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,o)}),o}var _d=Object.freeze({createVertexShader:i5,createVertexBuffer:c5,createIndexBuffer:s5,createFloat32MatrixTexture:l5,createFloat16MatrixTexture:u5,createUnsignedBytesMatrixTexture:h5,createPackedMatrixTexture:f5,createFloat16PackedMatrixTexture:d5,bindVertexProgramAttributeStreams:p5,uploadDenseMatrixToTexture:v5,uploadPixelDataToTexture:m5,createBufferFromOutputTexture:g5,downloadFloat32MatrixFromBuffer:x5,downloadByteEncodedFloatMatrixFromOutputTexture:b5,downloadPackedMatrixFromBuffer:y5,downloadMatrixFromPackedOutputTexture:w5}),z5=function(){function r(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=B().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,ss(e,t)):this.gl=Ot(e);var n="WEBGL_color_buffer_float";if(B().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=L2(this.gl,this.debug,"OES_texture_float"),ct(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=L2(this.gl,this.debug,"OES_texture_half_float");else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ct(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=L2(this.gl,this.debug,"EXT_color_buffer_half_float");else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ct(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ct(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=c5(this.gl,this.debug),this.indexBuffer=s5(this.gl,this.debug),this.framebuffer=bs(this.gl,this.debug),this.textureConfig=Uo(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return B().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Z(e,this.debug,function(){return e.finish()}),Z(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Z(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Z(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Z(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Z(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),l5(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),u5(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),h5(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),m5(this.gl,this.debug,t,e)},r.prototype.uploadDenseMatrixToTexture=function(t,e,n,o){this.throwIfDisposed(),v5(this.gl,this.debug,t,e,n,o,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),d5(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),f5(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(_o(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Z(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var o=this;return this.downloadMatrixDriver(t,function(){return b5(o.gl,o.debug,e,n,o.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,o,a,i){return y5(this.gl,t,0,0,0,a,i,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return x5(this.gl,t,e)},r.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var o=g5(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},r.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},r.prototype.createFence=function(t){var e,n,o=this;if(B().getBool("WEBGL_FENCE_API_ENABLED")){var a=t,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var c=a.clientWaitSync(i,0,0);return c===a.ALREADY_SIGNALED||c===a.CONDITION_SATISFIED},e=i}else B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return o.isQueryAvailable(e,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var o=this;return this.downloadMatrixDriver(t,function(){return w5(o.gl,o.debug,e,n)})},r.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=fs(e,this.debug,t),o=i5(e,this.debug),a=ds(e,this.debug);return Z(e,this.debug,function(){return e.attachShader(a,o)}),Z(e,this.debug,function(){return e.attachShader(a,n)}),ps(e,this.debug,a),this.debug&&e3(e,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=p5(e,this.debug,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&Z(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},r.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&e3(this.gl,this.debug,this.program),Z(this.gl,this.debug,function(){return e.gl.useProgram(t)})},r.prototype.getUniformLocation=function(t,e,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?ws(this.gl,this.debug,t,e):zs(this.gl,t,e)},r.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Z(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},r.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},r.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),Ms(this.gl,this.debug,this.program,t,e,n)},r.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},r.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var o=$2(e,n),a=o[0],i=o[1];this.setOutputMatrixTextureDriver(t,a,i)},r.prototype.setOutputMatrixWriteRegion=function(t,e,n,o){this.setOutputMatrixWriteRegionDriver(n,t,o,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&e3(this.gl,this.debug,this.program),F2(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Z(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Z(this.gl,this.debug,function(){return t.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=L2(this.gl,this.debug,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var o=this.getQueryTimerExtensionWebGL1(),a=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),a},r.prototype.endQuery=function(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(t){return Q(this,void 0,void 0,function(){var e=this;return J(this,function(n){switch(n.label){case 0:return[4,go(function(){return e.disposed||e.isQueryAvailable(t,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var n=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint},r.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var t=function(n){for(var o=0;o<n.length&&n[o]();++o);return o-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},r.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||go(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),t3(this.gl,this.debug,t,this.framebuffer),this.debug&&F2(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(t3(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&F2(this.gl)):_o(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var o=this.gl;t3(o,this.debug,t,this.framebuffer),this.debug&&F2(o),this.outputTexture=t,Z(o,this.debug,function(){return o.viewport(0,0,e,n)}),Z(o,this.debug,function(){return o.scissor(0,0,e,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,o){var a=this;this.throwIfDisposed(),Z(this.gl,this.debug,function(){return a.gl.scissor(t,e,n,o)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function yc(r,t){if(r.length!==t.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+t.length+" inputs");r.forEach(function(e,n){var o=e.logicalShape,a=t[n],i=a.shape;if(!o1(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var c=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!o1(c,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+c+" and "+s+" must match")}})}var Ed=function(r,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=e.filterWidth,o=e.inChannels,a=e.strideWidth,i=e.strideHeight,c=e.padInfo,s=e.outWidth,l=e.dilationWidth,u=e.dilationHeight,h=e.dataFormat,f=c.left,d=c.top,p=o*n,v=B1(),m=h==="channelsLast",g=m?0:1,b=m?1:2,y="",x=0;x<=1;x++)for(var w=0;w<=1;w++)y+=`
          blockIndex = rc.y + `+w+`;
          pos = rc.x + `+x+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+s+")) * "+i+" - "+d+`;
            d0 = offsetY + `+u+" * (pos / "+p+`);

            if(d0 < `+t[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+s+".) * "+a+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+t[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*x+w)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*x+w)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+y+`

        `+v.output+` = result;
      }
    `},Sd=function(r,t,e,n,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,c=r[3]-1;this.outputShape=r;var s="float("+e+") + float("+n+") * sum";a=o===.5?"inversesqrt("+s+")":o===1?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+c+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},kd=function(r,t,e,n,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=t,this.bias=e,this.alpha=n,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Hd=function(r,t,e,n,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,c=r[3]-1;this.outputShape=r;var s="float("+e+") + float("+n+") * sum";a=o===.5?"inversesqrt("+s+")":o===1?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+c+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},Vd=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideHeight,e=r.strideWidth,n=r.dilationHeight,o=r.effectiveFilterHeight,a=r.effectiveFilterWidth,i=o-1-r.padInfo.top,c=a-1-r.padInfo.left,s=o*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+c+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+s+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},Td=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,o=r.dilationDepth,a=r.dilationHeight,i=r.dilationWidth,c=r.effectiveFilterDepth,s=r.effectiveFilterHeight,l=r.effectiveFilterWidth,u=c-1-r.padInfo.front,h=s-1-r.padInfo.top,f=l-1-r.padInfo.left,d=c*s*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+s+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+s+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},eo=function(r,t,e,n,o,a,i){e===void 0&&(e=!1),n===void 0&&(n=!1),o===void 0&&(o=!1),a===void 0&&(a=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var c=e?r[1]:r[2],s=Math.ceil(c/2),l=e?"i * 2, rc.y":"rc.y, i * 2",u=n?"rc.z, i * 2":"i * 2, rc.z",h=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";a&&(d=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+s+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+s+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+u+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},Ld=function(){function r(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,o){e.seedLoc==null&&(e.seedLoc=n.getUniformLocation(o,"seed")),n.gl.uniform1f(e.seedLoc,t)}},r}(),Fd=function(r,t,e,n){this.variableNames=["indices"],this.outputShape=[r,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},Ad=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var t=r.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Y1("rc",t),n=Ne(t),o=function(c,s,l){if(c===1)return"rc > "+s[0];for(var u="",h=c-2;h<c;h++)u+=l[h]+" >= "+s[h],h<c-1&&(u+="||");return u}(t,r,e),a=function(c,s,l,u){if(c===1)return"";var h=u.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+s+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,r[r.length-1],r[r.length-2],e),i=function(c,s){var l=c.length,u=function(h,f){for(var d=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var m=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<h;g++)m=f[f.length-1-g]+","+m;d.push(m)}return d}(l,s);return l===1?`getA(rc),
            rc + 1 >= `+c[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+u[0]+`),
          cEdge ? 0. : getA(`+u[1]+`),
          rEdge ? 0. : getA(`+u[2]+`),
          rEdge || cEdge ? 0. : getA(`+u[3]+")"}(r,e);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},Dd=function(r,t,e){this.variableNames=["x"],this.outputShape=t.map(function(s,l){return s[0]+r[l]+s[1]});var n=r.length,o=Ne(n),a=t.map(function(s){return s[0]}).join(","),i=t.map(function(s,l){return s[0]+r[l]}).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+o+" start = "+o+"("+a+`);
      `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+c+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},Id=function(r,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,g){return m[0]+r[g]+m[1]});for(var n=r.length,o=Ne(n),a=t.map(function(m){return m[0]}).join(","),i=t.map(function(m,g){return m[0]+r[g]}).join(","),c=Y1("rc",n),s=Y1("source",n),l=c[n-1]+" < "+this.outputShape[n-1],u=n===1?"source":"vec2("+s.slice(-2).join()+")",h=[o+" rc = outputLoc;",c[n-1]+` += 1;
       if(`+l+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+c[n-2]+` += 1;
       if(`+c[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+c[n-1]+` += 1;
         if(`+l+") {"],f=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=n===1?2:4;p<v;p++)d+=`
        `+h[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+e+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+s.join()+"), "+u+`);
        }
      `;d+=n===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+a+`);
      const `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},to=function(r,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,o=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,c=r.dilationWidth,s=r.effectiveFilterHeight,l=r.effectiveFilterWidth,u=r.padInfo.top,h=r.padInfo.left;this.outputShape=r.outShape;var f=t==="avg",d="0.0";if(f||(d="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+a+`);
        const ivec2 pads = ivec2(`+u+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+s+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+c+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(p="avgValue / count");var v=4*Math.floor(n/4),m=n%4,g=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+u+", "+h+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+c+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              getValue(batch, xR, xC + 3 * `+c+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+p+`);
      }
    `}},no=function(r,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,c=r.dilationDepth,s=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.front,p=r.padInfo.top,v=r.padInfo.left;this.outputShape=r.outShape;var m=t==="avg",g="0.0";if(m||(g="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+a+", "+i+`);
        const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+u+`;
              wD += `+c+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+s+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(b="avgValue / count");var y=4*Math.floor(n/4),x=n%4,w=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+c+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+y+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+w+`
            }

            int xC = xCCorner + `+y+`;
            if (`+(x===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(x===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(x===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+w+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},Bd=function(r,t){this.variableNames=["x"];var e=r.windowSize,n=r.batchSize,o=r.inSize,a=Math.ceil(o/e);this.outputShape=[n,a];var i="0.0",c="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",c="min"):t==="max"&&(i="-1.0 / 1e-20",c="max");var s=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?s="sumValue":t==="prod"?s="prodValue":t==="all"?s="allValue":t==="any"&&(s="anyValue");var l=4*Math.floor(e/4),u=e%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+c+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(i="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(i="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";o%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(u===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(u===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(u===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+s+`);
      }
    `},Rd=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e="",n=0;n<4;n++){var o="thisRC = rc;";n%2==1&&(o+="thisRC.z += 1;"),n>1&&(o+="thisRC.y += 1;"),e+=`
        `+o+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Zn(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+r6(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+e+`

        setOutput(result);
      }
    `},Od=function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,o=n[1],a=n[2],i=r.shape,c=i[1],s=i[2],l=[e&&c>1?o-1:o,e&&s>1?a-1:a],u=[e&&c>1?c-1:c,e&&s>1?s-1:s],h=l[0]/u[0],f=l[1]/u[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+c+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+s+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Nd=function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var o=r[0],a=r[1],i=r[2],c=r[3];this.outputShape=[o,t,e,c];var s=[n&&t>1?a-1:a,n&&e>1?i-1:i],l=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+s[0]/l[0]+`,
          `+s[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},Pd=function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=r[0],a=r[1],i=r[2],c=r[3];this.outputShape=[o,t,e,c];var s=[n&&t>1?a-1:a,n&&e>1?i-1:i],l=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+s[0]/l[0]+`,
          `+s[1]/l[1]+`,
          `+s[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(c-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Wd=function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,o=n[1],a=n[2],i=r.shape,c=i[1],s=i[2],l=[e&&c>1?o-1:o,e&&s>1?a-1:a],u=[e&&c>1?c-1:c,e&&s>1?s-1:s],h=l[0]/u[0],f=l[1]/u[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+c+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+s+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+u[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+u[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Ud=function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var o=r[0],a=r[1],i=r[2],c=r[3];this.outputShape=[o,t,e,c];var s=[n&&t>1?a-1:a,n&&e>1?i-1:i],l=[n&&t>1?t-1:t,n&&e>1?e-1:e],u=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+s[0]/l[0]+`,
          `+s[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+u+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Gd=function(r,t){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,e!==1){var n=r.map(function(a,i){return function(c){return t.indexOf(c)!==-1&&r[c]!==1?r[c]+" - coords["+c+"] - 1":"coords["+c+"]"}(i)}).join(","),o=Ne(e);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},qd=function(r,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var n=Y1("rc",e),o=n[e-1]+" + 1 < "+this.outputShape[e-1],a=n[e-2]+" + 1 < "+this.outputShape[e-2],i=Ne(e);function c(s){var l=r.map(function(u,h){return function(f,d){return t.indexOf(f)!==-1&&r[f]!==1?r[f]+" - "+d[f]+" - 1":""+d[f]}(h,s)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(s){return c(s)}(n.slice())+`;
          if(`+o+`){
            result.g = `+function(s){return s[e-1]="("+s[e-1]+" + 1)",c(s)}(n.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(s){return s[e-2]="("+s[e-2]+" + 1)",c(s)}(n.slice())+`;
            if(`+o+`) {
              result.a = `+function(s){return s[e-1]="("+s[e-1]+" + 1)",s[e-2]="("+s[e-2]+" + 1)",c(s)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},wc=function(r,t,e,n,o,a,i){i===void 0&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var c=Ne(o.length),s=Ne(a.length),l="";e===1?l="i":e===2&&(l="i, j");var u="getIndices("+l+")",h="";n===1?h="i":n===2&&(h="i, coords[1]");var f="getUpdates("+h+")",d=t>1?"strides[j]":"strides";this.userCode=`
        `+c+" strides = "+c+"("+o+`);

        void main() {
          `+s+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+u+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},jd=function(r,t){this.variableNames=["x","segmentIds"];var e=r.windowSize,n=r.batchSize,o=r.inSize,a=r.numSegments,i=a*Math.ceil(o/e);this.outputShape=[n,i];var c=4*Math.floor(e/4),s=e%4,l=`
        sumValue += dot(values, segFilter);
    `,u="";o%e>0&&(u=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var h="";o%e>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+u+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(s===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(s===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(s===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},$d=function(r,t,e){var n,o;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)o="resRC",n="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],c=[],s=0;s<t.length;s++)c.push(""+a[s]),s<r&&i.push(""+a[s]);n=i.join(),o=c.join()}var l=Ne(e);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},Kd=function(){function r(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=Ne(this.rank),o="uniform int start["+this.rank+"];",a=function(i){if(i===1)return"sourceLoc";if(i<=6)return ro.slice(0,i).map(function(c){return"sourceLoc."+c}).join(",");throw Error("Slicing for rank "+i+" is not yet supported")}(this.rank);e=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+t.map(function(i,c){return"sourceLoc."+ro[c]+" = start["+c+"] + coords."+ro[c]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+e+`
        setOutput(getSource(`+a+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,o){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r}(),ro=["x","y","z","w","u","v"],Xd=function(){function r(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Ne(this.rank),n=Y1("coords",this.rank),o=Y1("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+a+")",c=`
      result.x = `+i+`;
      if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+i+`;
        --`+o[this.rank-1]+`;
      }
    `,s=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(u,h){return"start["+h+"]"}).join()+");":t.map(function(u,h){return o[h]+" = "+n[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+c+`
        `+s+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,o){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r}(),Yd=function(r,t,e){this.variableNames=["x"],this.outputShape=e;var n=e.length,o=Ne(e.length),a=Ne(e.length),i="";if(n===1)i="coords * strides + begin";else{var c=0;i=e.map(function(s,l){return c++,e.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(c-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+r+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},Zd=function(){function r(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(t,e,n){var o,a=zc(e,n),i=Mc(t,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var c=this.freeTextures[i].shift();return this.usedTextures[i].push(c),c}return this.numUsedTextures++,this.log(),a===at.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):a===at.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):a===at.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):a===at.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):a===at.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),o},r.prototype.releaseTexture=function(t,e,n,o){if(this.freeTextures!=null){var a=Mc(e,zc(n,o),o);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],c=i.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(c,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(n){t.gpgpu.deleteMatrixTexture(n)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function zc(r,t){if(r===it.UPLOAD)return at.PACKED_2X2_FLOAT32;if(r===it.RENDER||r==null)return function(e){return B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?at.PACKED_2X2_FLOAT32:at.UNPACKED_FLOAT32:e?at.PACKED_2X2_FLOAT16:at.UNPACKED_FLOAT16}(t);if(r===it.DOWNLOAD||r===it.PIXELS)return at.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function Mc(r,t,e){return r[0]+"_"+r[1]+"_"+t+"_"+e}var Qd=function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[n]*t[n];this.outputShape=e,this.rank=e.length;var o=Ne(this.rank),a=function(i){var c=i.length;if(c>5)throw Error("Tile for rank "+c+" is not yet supported");if(c===1)return"imod(resRC, "+i[0]+")";for(var s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],u=0;u<i.length;u++)l.push("imod("+s[u]+", "+i[u]+")");return l.join()}(r);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Jd=function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];this.outputShape=e,this.rank=e.length;var o=Ne(this.rank),a=function(i){var c=i.length;if(c>6)throw Error("Transpose for rank "+c+" is not yet supported");for(var s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(c),u=0;u<i.length;u++)l[i[u]]=s[u];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},ep=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Ne(this.rank),a=t5("rc",this.rank),i=new Array(this.rank);for(n=0;n<t.length;n++)i[t[n]]=a[n];var c="vec2("+i.slice(-2).join()+")",s="++"+a[this.rank-1]+" < "+e[this.rank-1],l="getChannel(getA("+i.join()+"), "+c+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+s+`) {
        result[1] = `+l+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+s+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},o6=1.7580993408473768,a6=1.0507009873554805,de=function(r,t){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},_t="if (isnan(x)) return x;",tp="return x;",Cc="return abs(x);",M5=_t+`
  return (x < 0.0) ? 0.0 : x;
`,C5=_t+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,_5="return (x >= 0.0) ? x : (exp(x) - 1.0);",np=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+o6+`;
  float scale = `+a6+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,_c="return -x;",Ec="return ceil(x);",Sc="return floor(x);",kc="return exp(x);",Hc="return exp(x) - 1.0;",rp=_t+`
  return sin(x);
`,op=_t+`
  return cos(x);
`,ap=_t+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,ip=_t+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,cp=_t+`
  return atan(x);
`,sp=_t+"return log(x + sqrt(x * x + 1.0));",lp=_t+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,up=_t+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,qr="return x;",hp="return x;",E5=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,S5=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,k5=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,T2=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},fp=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var t=r.length,e=Y1("rc",t),n=Ne(t),o=function(c,s){if(c===1)return"rc";for(var l="",u=0;u<c;u++)l+=s[u],u<c-1&&(l+=",");return l}(t,e),a=e.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},jr={};function $r(r,t){if(t===void 0&&(t=!1),r==="linear")return t?hp:tp;if(r==="relu")return t?E5:M5;if(r==="elu")return t?k5:_5;if(r==="relu6")return t?S5:C5;if(r==="prelu")return t?a5:o5;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var dp=600,H5=function(r){function t(e){var n,o=r.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!B().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var a=Ot(B().getNumber("WEBGL_VERSION"));o.binaryCache=((n=B().getNumber("WEBGL_VERSION"))in jr||(jr[n]={}),jr[n]),o.gpgpu=new z5(a),o.canvas=a.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new Zd(o.gpgpu),o.numMBBeforeWarning=B().global.screen==null?1024:B().global.screen.height*B().global.screen.width*window.devicePixelRatio*dp/1024/1024,o.texData=new Xs(o,T),o}return zt(t,r),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,n,o){if(B().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:n,dtype:o,values:e,usage:it.UPLOAD}),a},t.prototype.move=function(e,n,o,a){if(B().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:a,values:n,usage:it.UPLOAD})},t.prototype.readSync=function(e){var n=this.texData.get(e),o=n.values,a=n.dtype,i=n.complexTensors,c=n.slice,s=n.shape,l=n.isPacked;if(c!=null){var u=void 0;u=l?new T2(s,qr):new de(s,qr);var h=this.runWebGLProgram(u,[{dataId:e,shape:s,dtype:a}],a),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(o!=null)return this.convertAndCacheOnCPU(e);if(a==="string")return o;var d,p,v=this.activeTimers!=null;return v&&(d=bt()),a==="complex64"?p=To(i.real.dataSync(),i.imag.dataSync()):p=this.getValuesFromTexture(e),v&&(this.downloadWaitMs+=bt()-d),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return Q(this,void 0,void 0,function(){var n,o,a,i,c,s,l,u,h,f,d,p,v,m,g,b,y,x,w,z,M,_;return J(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise(function(k){return n.push(k)})];if(o=this.texData.get(e),a=o.values,i=o.shape,c=o.slice,s=o.dtype,l=o.complexTensors,u=o.isPacked,c!=null)return h=void 0,h=u?new T2(i,qr):new de(i,qr),f=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:s}],s),d=this.read(f.dataId),this.disposeData(f.dataId),[2,d];if(a!=null)return[2,this.convertAndCacheOnCPU(e)];if(!B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&B().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,s!=="complex64"&&B().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(e),m=this.texData.get(v.dataId),p=(_=this.gpgpu).createBufferFromTexture.apply(_,[m.texture].concat(D2(i)))),this.pendingRead.set(e,[]),s==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return s!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return b=S.sent(),y=b[0],x=b[1],g=To(y,x),[3,5];case 4:p==null?g=this.getValuesFromTexture(e):(w=te(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),S.label=5;case 5:return v!=null&&this.disposeData(v.dataId),z=this.convertAndCacheOnCPU(e,g),M=this.pendingRead.get(e),this.pendingRead.delete(e),M.forEach(function(k){return k(z)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,z]}})})},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var n=0;n<e.length;n++){var o=e[n];if(!ls(o))throw B().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var n,o=this.texData.get(e),a=o.shape,i=o.dtype,c=o.isPacked,s=te(a);if(B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),u=this.texData.get(l.dataId),h=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[u.texture].concat(D2(a))).subarray(0,s);return this.disposeData(l.dataId),h}var f=B().getBool("WEBGL_PACK")&&c===!0,d=f?n3(a):a,p=f?new gd(d):new md(d),v=this.runWebGLProgram(p,[{shape:d,dtype:i,dataId:e}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,s);return this.disposeData(v.dataId),g},t.prototype.time=function(e){return Q(this,void 0,void 0,function(){var n,o,a,i,c,s,l;return J(this,function(u){switch(u.label){case 0:return n=this.activeTimers,o=[],a=!1,this.programTimersStack==null?(this.programTimersStack=o,a=!0):this.activeTimers.push(o),this.activeTimers=o,e(),i=rn(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),c=rn(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=n,a&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return l=u.sent(),s.kernelMs=$c(l),s.getExtraProfileInfo=function(){return l.map(function(h,f){return{name:c[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:s.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:bt(),endMs:null}},t.prototype.endTimer=function(e){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=bt(),e)},t.prototype.getQueryTime=function(e){return Q(this,void 0,void 0,function(){var n;return J(this,function(o){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(n=e).endMs-n.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var n=this.texData.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var n=this.texData.get(e),o=n.texture,a=n.dtype,i=n.texShape,c=n.usage,s=n.isPacked,l=n.slice,u=l&&l.origDataId||e,h=this.dataRefCount.get(u);h>1?this.dataRefCount.set(u,h-1):(this.dataRefCount.delete(u),o!=null&&(this.numBytesInGPU-=this.computeBytes(i,a),this.textureManager.releaseTexture(o,i,c,s)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return B().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=T.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,n){var o=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&e.every(function(a){return o.texData.get(a.dataId).texture==null&&a.size<n})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,n){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:T.keep(e.clone()),imag:T.keep(n.clone())},o},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,n,o);if(te(o)===0)return g1([],o,e.dtype);var a=this.texData.get(e.dataId).isPacked,i=Xo(e.shape,n,o);if(a||!i){var c=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xd(o):new Kd(o),s=c.getCustomSetupFunc(n);return this.compileAndRun(c,[e],null,s)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,n,o)},t.prototype.shallowSlice=function(e,n,o){var a=this.texData.get(e.dataId),i=this.makeOutput(o,e.dtype),c=this.texData.get(i.dataId);Object.assign(c,a),c.shape=o,c.dtype=e.dtype;var s=Yo(n,e.strides);a.slice&&(s+=a.slice.flatOffset),c.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var l=this.dataRefCount.get(c.slice.origDataId)||1;return this.dataRefCount.set(c.slice.origDataId,l+1),i},t.prototype.stridedSlice=function(e,n,o,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,n,o,a);var i=_3(n,o,a);if(i.some(function(s){return s===0}))return g1([],i);var c=new Yd(n,a,i);return this.compileAndRun(c,[e])},t.prototype.reverse=function(e,n){var o=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qd(e.shape,n):new Gd(e.shape,n);return this.compileAndRun(o,[e])},t.prototype.concat=function(e,n){if(e[0].dtype==="complex64"){var o=e.map(function(d){return ht(d)}),a=e.map(function(d){return It(d)});return E1(this.concat(o,n),this.concat(a,n))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,n);if(e.length===1)return e[0];if(e.length>B().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),c=this.concat(e.slice(0,i),n),s=this.concat(e.slice(i),n);return this.concat([c,s],n)}if(B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var l=new nd(e.map(function(d){return d.shape}),n);return this.compileAndRun(l,e)}var u=n4(e.map(function(d){return d.shape}),n),h=e.map(function(d){return d.as2D(-1,te(d.shape.slice(n)))}),f=new td(h.map(function(d){return d.shape}));return this.compileAndRun(f,h).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_c,e.dtype);var n=new de(e.shape,_c);return this.compileAndRun(n,[e])},t.prototype.batchMatMul=function(e,n,o,a){var i=o?e.shape[2]:e.shape[1],c=a?n.shape[1]:n.shape[2],s=o?e.shape[1]:e.shape[2],l=e.shape[0];if((i===1||c===1)&&s>1e3){o&&(e=e.transpose([0,2,1])),a&&(n=n.transpose([0,2,1]));var u=c===1?e:e.as3D(l,s,1),h=c===1?2:1,f=c===1?n.as3D(l,1,s):n;return this.multiply(u,f).sum(h,!0)}var d=m1(e.dtype,n.dtype),p=new eo(e.shape,[l,i,c],o,a);return this.compileAndRun(p,[e,n],d)},t.prototype.fusedBatchMatMul=function(e){var n=e.a,o=e.b,a=e.transposeA,i=e.transposeB,c=e.bias,s=e.activation,l=e.preluActivationWeights,u=a?n.shape[2]:n.shape[1],h=i?o.shape[1]:o.shape[2],f=n.shape[0],d=m1(n.dtype,o.dtype),p=c!=null,v=l!=null,m=s?$r(s,!0):null,g=new eo(n.shape,[f,u,h],a,i,p,m,v),b=[n,o];return c&&b.push(c),l&&b.push(l),this.compileAndRun(g,b,d)},t.prototype.multiply=function(e,n){if(e.dtype==="complex64"){var o=this.texData.get(e.dataId),a=this.texData.get(n.dataId),i=new dc(Yf,e.shape,n.shape),c=new dc(Zf,e.shape,n.shape),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],l=this.compileAndRun(i,s),u=this.compileAndRun(c,s),h=this.complex(l,u);return l.dispose(),u.dispose(),h}if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.multiply(e,n);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,pc,e.dtype);var f=new Ze(pc,e.shape,n.shape);return this.compileAndRun(f,[e,n],e.dtype)},t.prototype.batchNormalization=function(e,n,o,a,i,c){var s=[e,n,o],l=null;c!=null&&(l=c.shape,s.push(c));var u=null;if(i!=null&&(u=i.shape,s.push(i)),B().getBool("WEBGL_PACK_NORMALIZATION")){var h=new Xf(e.shape,n.shape,o.shape,l,u,a);return this.compileAndRun(h,s)}var f=new Kf(e.shape,n.shape,o.shape,l,u,a);return this.compileAndRun(f,s)},t.prototype.localResponseNormalization4D=function(e,n,o,a,i){var c=B().getBool("WEBGL_PACK_NORMALIZATION")?new Hd(e.shape,n,o,a,i):new Sd(e.shape,n,o,a,i);return this.compileAndRun(c,[e])},t.prototype.LRNGrad=function(e,n,o,a,i,c,s){var l=new kd(n.shape,a,i,c,s);return this.compileAndRun(l,[n,o,e])},t.prototype.tile=function(e,n){if(e.dtype==="string"){var o=this.readSync(e.dataId).map(function(i){return R2(i)});return Js(he(e.shape,e.dtype,o),n)}var a=new Qd(e.shape,n);return this.compileAndRun(a,[e])},t.prototype.pad=function(e,n,o){var a=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Id(e.shape,n,o):new Dd(e.shape,n,o);return this.compileAndRun(a,[e])},t.prototype.transpose=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,n);var o=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ep(e.shape,n):new Jd(e.shape,n);return this.compileAndRun(o,[e])},t.prototype.gather=function(e,n,o){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.gather(e,n,o);var a=new Md(e.shape,n.size,o);return this.compileAndRun(a,[e,n])},t.prototype.batchToSpaceND=function(e,n,o){E(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(h,f){return h*f}),i=d3(e.shape,n,a),c=p3(i.length,n.length),s=v3(e.shape,n,a),l=Ws(o,n.length),u=Us(s,o,n.length);return e.reshape(i).transpose(c).reshape(s).slice(l,u)},t.prototype.spaceToBatchND=function(e,n,o){E(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,o);for(var c=1+n.length;c<e.shape.length;++c)i.push([0,0]);var s=e.pad(i),l=d3(s.shape,n,a,!1),u=p3(l.length,n.length,!1),h=v3(s.shape,n,a,!1);return s.reshape(l).transpose(u).reshape(h)},t.prototype.reduce=function(e,n,o){var a=e.shape[0],i=e.shape[1],c=r3(i),s=new Bd({windowSize:c,inSize:i,batchSize:a},n),l=this.compileAndRun(s,[e],o);return l.shape[1]===1?l:this.reduce(l,n,o)},t.prototype.argReduce=function(e,n,o){o===void 0&&(o=null);var a=e.shape[0],i=e.shape[1];o!=null&&(a=o.shape[0],i=o.shape[1]);var c=r3(i),s=new Of({windowSize:c,inSize:i,batchSize:a},n,o==null),l=[e];o!=null&&l.push(o);var u=this.compileAndRun(s,l,"int32");return u.shape[1]===1?u:this.argReduce(e,n,u)},t.prototype.argReducePacked=function(e,n,o){o===void 0&&(o=null);var a=o!=null?o.shape:e.shape,i=r3(a[a.length-1]),c=new qf(a,i,n,o==null),s=o==null?[e]:[e,o],l=this.compileAndRun(c,s,"int32");return l.rank===e.rank?this.argReducePacked(e,n,l):l},t.prototype.sum=function(e,n){X1("sum",n,e.rank);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i),s=X0(e.dtype);return this.reduce(c,"sum",s).reshape(a)},t.prototype.prod=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,n);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i),s=X0(e.dtype);return this.reduce(c,"prod",s).reshape(a)},t.prototype.unsortedSegmentSum=function(e,n,o){var a=0,i=Mt([a],e.rank),c=e;i!=null&&(c=e.transpose(i),a=Ct(1,e.rank)[0]);var s=function(d,p,v){for(var m=[],g=d.length,b=0;b<g;b++)b!==p?m.push(d[b]):m.push(v);return m}(c.shape,a,o),l=te([c.shape[a]]),u=c.as2D(-1,l),h=X0(e.dtype),f=this.segOpCompute(u,"unsortedSegmentSum",n,h,o).reshape(s);return i!=null&&(f=f.transpose(z3(i))),f},t.prototype.segOpCompute=function(e,n,o,a,i){var c=e.shape[0],s=e.shape[1],l=function(f,d){var p,v=!1;for(f<=Ko?(p=f,v=!0):p=l3(f,Math.floor(Math.sqrt(f)));!v;)p>d||p===f?v=!0:p=l3(f,p+1);return p}(s,i),u=new jd({windowSize:l,inSize:s,batchSize:c,numSegments:i},n),h=this.compileAndRun(u,[e,o],a);return h.shape[1]===i?h:(o=f3(0,i).tile([s/l]),this.segOpCompute(h,n,o,a,i))},t.prototype.argMinMaxReduce=function(e,n,o){var a=[n];if(X1("arg"+o.charAt(0).toUpperCase()+o.slice(1),a,e.rank),!B().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=S1(e.shape,a),c=i[0],s=te(i[1]),l=e.as2D(-1,s);return this.argReduce(l,o).reshape(c)}return this.argReducePacked(e,o)},t.prototype.argMin=function(e,n){return this.argMinMaxReduce(e,n,"min")},t.prototype.argMax=function(e,n){return this.argMinMaxReduce(e,n,"max")},t.prototype.cumsum=function(e,n,o,a){if(n!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+n);var i=new hd(e.shape,o,a);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(equal(a, b));
`,"bool");var o=new Ze("return float(a == b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.notEqual=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(notEqual(a, b));
`,"bool");var o=new Ze("return float(a != b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.less=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.less(e,n);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThan(a, b));
`,"bool");var o=new Ze("return float(a < b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.lessEqual=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new Ze("return float(a <= b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.greater=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.greater(e,n);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new Ze("return float(a > b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.greaterEqual=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new Ze("return float(a >= b);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.logicalNot=function(e){var n=new de(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[e])},t.prototype.logicalAnd=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new Ze("return float(a >= 1.0 && b >= 1.0);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.logicalOr=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new Ze("return float(a >= 1.0 || b >= 1.0);",e.shape,n.shape);return this.compileAndRun(o,[e,n],"bool")},t.prototype.select=function(e,n,o){var a=new $d(e.rank,n.shape,n.rank);return this.compileAndRun(a,[e,n,o],m1(n.dtype,o.dtype))},t.prototype.where=function(e){u3("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=e.dataSync();return n6(e.shape,n)},t.prototype.topk=function(e,n,o){return e5(e.dataSync(),e.shape,e.dtype,n)},t.prototype.min=function(e,n){X1("min",n,e.rank);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i);return this.reduce(c,"min",c.dtype).reshape(a)},t.prototype.minimum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.minimum(e,n);var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new Ze(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.mod=function(e,n){var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new Ze(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.max=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,n);X1("max",n,e.rank);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i);return this.reduce(c,"max",c.dtype).reshape(a)},t.prototype.maximum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.maximum(e,n);var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new Ze(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.all=function(e,n){X1("all",n,e.rank);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i);return this.reduce(c,"all",c.dtype).reshape(a)},t.prototype.any=function(e,n){X1("any",n,e.rank);var o=S1(e.shape,n),a=o[0],i=te(o[1]),c=e.as2D(-1,i);return this.reduce(c,"any",c.dtype).reshape(a)},t.prototype.realDivide=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new Ze(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,n.shape);return this.compileAndRun(o,[e,n],"float32")},t.prototype.floorDiv=function(e,n){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new Ze(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,n.shape);return this.compileAndRun(o,[e,n],"int32")},t.prototype.add=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,Q0);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.add(e,n);var o=m1(e.dtype,n.dtype);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,Q0,o);var a=new Ze(Q0,e.shape,n.shape);return this.compileAndRun(a,[e,n],o)},t.prototype.packedUnaryOp=function(e,n,o){var a=new T2(e.shape,n);return this.compileAndRun(a,[e],o)},t.prototype.packedBinaryOp=function(e,n,o,a,i){i===void 0&&(i=!1);var c=new en(o,e.shape,n.shape,i);return this.compileAndRun(c,[e,n],a)},t.prototype.complexSeparableBinaryOp=function(e,n,o){var a=this,i=this.texData.get(e.dataId),c=this.texData.get(n.dataId),s=[[i.complexTensors.real,c.complexTensors.real],[i.complexTensors.imag,c.complexTensors.imag]].map(function(f){var d=f[0],p=f[1],v=a.makeComplexComponentTensorInfo(e,d),m=a.makeComplexComponentTensorInfo(n,p),g=new Ze(o,e.shape,n.shape);return a.compileAndRun(g,[v,m],m1(d.dtype,p.dtype))}),l=s[0],u=s[1],h=this.complex(l,u);return l.dispose(),u.dispose(),h},t.prototype.makeComplexComponentTensorInfo=function(e,n){return{dataId:n.dataId,dtype:n.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>B().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),o=this.addN(e.slice(0,n)),a=this.addN(e.slice(n));return this.addN([o,a])}var i=e.map(function(l){return l.dtype}).reduce(function(l,u){return m1(l,u)}),c=e.map(function(l){return l.shape}),s=B().getBool("WEBGL_PACK")?new Rf(e[0].shape,c):new Bf(e[0].shape,c);return this.compileAndRun(s,e,i)},t.prototype.subtract=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,J0);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.subtract(e,n);var o=m1(e.dtype,n.dtype);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,J0,e.dtype);var a=new Ze(J0,e.shape,n.shape);return this.compileAndRun(a,[e,n],o)},t.prototype.pow=function(e,n){var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new Ze(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,n.shape),a=m1(e.dtype,n.dtype);return this.compileAndRun(o,[e,n],a)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ec,e.dtype);var n=new de(e.shape,Ec);return this.compileAndRun(n,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Sc,e.dtype);var n=new de(e.shape,Sc);return this.compileAndRun(n,[e])},t.prototype.sign=function(e){var n=new de(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[e])},t.prototype.isNaN=function(e){var n=new de(e.shape,"return float(isnan(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isInf=function(e){var n=new de(e.shape,"return float(isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isFinite=function(e){var n=new de(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.round=function(e){var n=new de(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kc,e.dtype);var n=new de(e.shape,kc);return this.compileAndRun(n,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Hc,e.dtype);var n=new de(e.shape,Hc);return this.compileAndRun(n,[e])},t.prototype.softmax=function(e,n){var o=i1([n],e.shape),a=this.max(e,o),i=W1(a.shape,o),c=this.subtract(e,a.reshape(i)),s=this.exp(c),l=this.sum(s,o).reshape(i);return this.realDivide(s,l)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var n=new de(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[e])},t.prototype.log1p=function(e){var n=new de(e.shape,"return log(1.0 + x);");return this.compileAndRun(n,[e])},t.prototype.sqrt=function(e){var n=new de(e.shape,"return sqrt(x);");return this.compileAndRun(n,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var n=new de(e.shape,"return inversesqrt(x);");return this.compileAndRun(n,[e])},t.prototype.reciprocal=function(e){var n=new de(e.shape,"return 1.0 / x;");return this.compileAndRun(n,[e])},t.prototype.relu=function(e){var n;return n=B().getBool("WEBGL_PACK")?new T2(e.shape,E5):new de(e.shape,M5),this.compileAndRun(n,[e])},t.prototype.relu6=function(e){var n;return n=B().getBool("WEBGL_PACK")?new T2(e.shape,S5):new de(e.shape,C5),this.compileAndRun(n,[e])},t.prototype.prelu=function(e,n){var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(a5,e.shape,n.shape):new Ze(o5,e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.elu=function(e){if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,k5,e.dtype);var n=new de(e.shape,_5);return this.compileAndRun(n,[e])},t.prototype.eluDer=function(e,n){var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,n.shape):new Ze("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.selu=function(e){var n=new de(e.shape,np);return this.compileAndRun(n,[e])},t.prototype.int=function(e){var n=new de(e.shape,"return float(int(x));");return this.compileAndRun(n,[e],"int32")},t.prototype.clip=function(e,n,o){var a,i=(a=B().getBool("WEBGL_PACK_CLIP")?new Jf(e.shape):new Qf(e.shape)).getCustomSetupFunc(n,o);return this.compileAndRun(a,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Cc,e.dtype);var n=new de(e.shape,Cc);return this.compileAndRun(n,[e])},t.prototype.complexAbs=function(e){var n=this.texData.get(e.dataId),o=new ed(e.shape),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)];return this.compileAndRun(o,a)},t.prototype.sigmoid=function(e){var n=new de(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[e])},t.prototype.softplus=function(e){var n=new de(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[e])},t.prototype.sin=function(e){var n=new de(e.shape,rp);return this.compileAndRun(n,[e])},t.prototype.cos=function(e){var n=new de(e.shape,op);return this.compileAndRun(n,[e])},t.prototype.tan=function(e){var n=new de(e.shape,"return tan(x);");return this.compileAndRun(n,[e])},t.prototype.asin=function(e){var n=new de(e.shape,ap);return this.compileAndRun(n,[e])},t.prototype.acos=function(e){var n=new de(e.shape,ip);return this.compileAndRun(n,[e])},t.prototype.atan=function(e){var n=new de(e.shape,cp);return this.compileAndRun(n,[e])},t.prototype.atan2=function(e,n){var o=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new Ze(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,n.shape);return this.compileAndRun(o,[e,n])},t.prototype.sinh=function(e){var n=new de(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.cosh=function(e){var n=new de(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.tanh=function(e){var n=new de(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[e])},t.prototype.asinh=function(e){var n=new de(e.shape,sp);return this.compileAndRun(n,[e])},t.prototype.acosh=function(e){var n=new de(e.shape,lp);return this.compileAndRun(n,[e])},t.prototype.atanh=function(e){var n=new de(e.shape,up);return this.compileAndRun(n,[e])},t.prototype.erf=function(e){var n=new de(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[e])},t.prototype.step=function(e,n){var o=new de(e.shape,function(a){return a===void 0&&(a=0),_t+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(n));return this.compileAndRun(o,[e])},t.prototype.conv2dByMatMul=function(e,n,o,a,i,c){var s=e.shape,l=this.texData.get(e.dataId),u=o.inChannels,h=s[0]*s[1]*s[2],f=o.outChannels,d=o.dataFormat==="channelsLast",p=(h===1||f===1)&&u>1e3,v=s[2]%2!=0&&!!l.isPacked;if(p||!B().getBool("WEBGL_LAZILY_UNPACK")||!B().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=d?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],g=this.reshape(e,[1,m,o.inChannels]),b=this.reshape(n,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:c}),o.outShape)}var y=d?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),x={dataId:e.dataId,shape:[1,y,o.inChannels],dtype:e.dtype},w=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,E(A2(l.shape,x.shape),function(){return"packed reshape "+l.shape+" to "+x.shape+" isn't free"});var z=this.reshape(n,[1,o.inChannels,o.outChannels]),M=this.fusedBatchMatMul({a:x,b:z,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:c}),_=this.texData.get(M.dataId);return E(_.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=w,_.shape=o.outShape,T.makeTensorFromDataId(M.dataId,o.outShape,M.dtype)},t.prototype.conv2dWithIm2Row=function(e,n,o,a,i,c){var s=o.filterWidth,l=o.filterHeight,u=o.inChannels,h=o.outWidth,f=o.outHeight,d=o.dataFormat==="channelsLast",p=s*l*u,v=f*h,m=[p,v],g=e.squeeze([0]),b=n.reshape([1,p,-1]),y=new Ed(m,g.shape,o),x=this.compileAndRun(y,[g]).reshape([1,m[0],m[1]]),w=a!=null,z=c!=null,M=i?$r(i,!0):null,_=new eo(x.shape,[1,v,o.outChannels],!0,!1,w,M,z),S=[x,b];a&&S.push(a),z&&S.push(c);var k=this.compileAndRun(_,S);return d?k.reshape([1,f,h,o.outChannels]):k.reshape([1,o.outChannels,f,h])},t.prototype.fusedConv2d=function(e){var n=e.input,o=e.filter,a=e.convInfo,i=e.bias,c=e.activation,s=e.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,o,a,i,c,s);if(B().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,o,a,i,c,s);var l=i!=null,u=s!=null,h=c?$r(c,!1):null,f=new vc(a,l,h,u),d=[n,o];return i&&d.push(i),s&&d.push(s),this.compileAndRun(f,d)},t.prototype.conv2d=function(e,n,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(e,n,o);if(B().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,n,o);var a=new vc(o);return this.compileAndRun(a,[e,n])},t.prototype.conv2dDerInput=function(e,n,o){var a=new od(o);return this.compileAndRun(a,[e,n])},t.prototype.conv2dDerFilter=function(e,n,o){var a=new rd(o);return this.compileAndRun(a,[e,n])},t.prototype.fusedDepthwiseConv2D=function(e){var n,o=e.input,a=e.filter,i=e.convInfo,c=e.bias,s=e.activation,l=e.preluActivationWeights,u=B().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,h=s?$r(s,u):null,f=[o,a],d=c!=null,p=l!=null;return d&&f.push(c),p&&f.push(l),u?(n=new gc(i,d,h,p),this.compileAndRun(n,f)):(n=new mc(i,d,h,p),this.compileAndRun(n,f))},t.prototype.depthwiseConv2D=function(e,n,o){var a;return B().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(a=new gc(o),this.compileAndRun(a,[e,n])):(a=new mc(o),this.compileAndRun(a,[e,n]))},t.prototype.depthwiseConv2DDerInput=function(e,n,o){var a=new sd(o);return this.compileAndRun(a,[e,n])},t.prototype.depthwiseConv2DDerFilter=function(e,n,o){var a=new cd(o);return this.compileAndRun(a,[e,n])},t.prototype.conv3d=function(e,n,o){var a=new ld(o);return this.compileAndRun(a,[e,n])},t.prototype.conv3dDerInput=function(e,n,o){var a=new id(o);return this.compileAndRun(a,[e,n])},t.prototype.conv3dDerFilter=function(e,n,o){var a=new ad(o);return this.compileAndRun(a,[e,n])},t.prototype.maxPool=function(e,n){var o=new to(n,"max",!1);return this.compileAndRun(o,[e])},t.prototype.avgPool=function(e,n){var o=new to(n,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPoolBackprop=function(e,n,o,a){var i=new to(a,"max",!0),c=this.compileAndRun(i,[n]),s=new Vd(a),l=this.compileAndRun(s,[e,c],n.dtype);return c.dispose(),l},t.prototype.avgPoolBackprop=function(e,n,o){var a=new jf(o);return this.compileAndRun(a,[e],n.dtype)},t.prototype.cast=function(e,n){return Qo(e,n,this)},t.prototype.unstack=function(e,n){for(var o=e.shape[n],a=new Array(e.rank-1),i=0,c=0;c<e.rank;c++)c!==n&&(a[i++]=e.shape[c]);var s=new Array(e.rank).fill(0),l=e.shape.slice();l[n]=1;var u=new Array(o);for(c=0;c<u.length;c++)s[n]=c,u[c]=this.slice(e,s,l).reshape(a);return u},t.prototype.avgPool3d=function(e,n){var o=new no(n,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,n,o){var a=new $f(o);return this.compileAndRun(a,[e],n.dtype)},t.prototype.maxPool3d=function(e,n){var o=new no(n,"max",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,n,o,a){var i=new no(a,"max",!0),c=this.compileAndRun(i,[n]),s=new Td(a),l=this.compileAndRun(s,[e,c],n.dtype);return c.dispose(),l},t.prototype.reshape=function(e,n){var o=this.texData.get(e.dataId);if(o.isPacked&&!A2(e.shape,n)&&(o.texture===null||!A2(o.shape,n))){var a=this.packedReshape(e,n);return T.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return g3(e,n)},t.prototype.resizeBilinear=function(e,n,o,a){var i=B().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Pd(e.shape,n,o,a):new Nd(e.shape,n,o,a);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,n,o){var a=new Od(e,n,o);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighbor=function(e,n,o,a){var i=new Ud(e.shape,n,o,a);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,n,o){var a=new Wd(e,n,o);return this.compileAndRun(a,[e])},t.prototype.multinomial=function(e,n,o,a){var i=n?e:q1(e),c=i.shape[0],s=i.shape[1],l=new Ld(c,s,o),u=l.getCustomSetupFunc(a);return this.compileAndRun(l,[i],"int32",u)},t.prototype.oneHot=function(e,n,o,a){var i=new Fd(e.size,n,o,a);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var n=new vd(e.size);return this.compileAndRun(n,[e])},t.prototype.nonMaxSuppression=function(e,n,o,a,i){return u3("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),e6(e.dataSync(),n.dataSync(),o,a,i)},t.prototype.cropAndResize=function(e,n,o,a,i,c){var s=new ud(e.shape,n.shape,a,i,c);return this.compileAndRun(s,[e,n,o],"float32")},t.prototype.depthToSpace=function(e,n,o){E(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var a=e.shape[0],i=o==="NHWC"?e.shape[1]:e.shape[2],c=o==="NHWC"?e.shape[2]:e.shape[3],s=o==="NHWC"?e.shape[3]:e.shape[1],l=i*n,u=c*n,h=s/(n*n),f=new pd(o==="NHWC"?[a,l,u,h]:[a,h,l,u],n,o);return this.compileAndRun(f,[e])},t.prototype.split=function(e,n,o){return Qs(e,n,o)},t.prototype.scatterND=function(e,n,o){var a=U2(0,e,o),i=a.sliceRank,c=a.numUpdates,s=a.sliceSize,l=a.strides,u=a.outputSize,h=[u/s,s],f=e.reshape([c,i]),d=n.reshape([c,s]);if(u===0)return g3(g1([]),o);var p=K(0),v=new wc(c,i,f.rank,d.rank,l,h);return this.compileAndRun(v,[d,f,p]).reshape(o)},t.prototype.sparseToDense=function(e,n,o,a){var i=U2(0,e,o),c=i.sliceRank,s=i.numUpdates,l=i.strides,u=i.outputSize,h=new wc(s,c,e.rank,n.rank,l,[u,1],!1);return this.compileAndRun(h,[n,e,a]).reshape(o)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,n){var o=this.texData.get(e.dataId),a=new bc(yd,e.shape,n),i=new bc(wd,e.shape,n),c=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],s=this.compileAndRun(a,c),l=this.compileAndRun(i,c),u=this.complex(s,l).as2D(e.shape[0],e.shape[1]);return s.dispose(),l.dispose(),u},t.prototype.gatherND=function(e,n){var o=n.shape,a=o[o.length-1],i=$o(e,n),c=i[0],s=i[1],l=i[2],u=i[3],h=n.reshape([s,a]),f=e.reshape([e.size/l,l]),d=new Cd(a,u,[s,l]);return this.compileAndRun(d,[f,h]).reshape(c)},t.prototype.fill=function(e,n,o){if((o=o||N4(n))==="string"){var a=B2(o,te(e));return a.fill(n),T.makeTensor(a,e,o,this)}var i=new zd(e,n),c=i.getCustomSetupFunc(n);return this.compileAndRun(i,[],o,c)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,n,o){return Jo(e,n,o)},t.prototype.makeTensorInfo=function(e,n){var o=this.write(null,e,n);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:n}},t.prototype.makeOutput=function(e,n){var o=this.makeTensorInfo(e,n).dataId;return T.makeTensorFromDataId(o,e,n,this)},t.prototype.unpackTensor=function(e){var n=new fp(e.shape);return this.runWebGLProgram(n,[e],e.dtype)},t.prototype.packTensor=function(e){var n=new Ad(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,n){var o=[P2(e.shape)].concat(W2(e.shape)),a={dtype:e.dtype,shape:o,dataId:e.dataId},i=[P2(n)].concat(W2(n)),c=new Rd(i,o),s=this.runWebGLProgram(c,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:n,dtype:s.dtype}},t.prototype.decode=function(e){var n,o=this.texData.get(e),a=o.isPacked,i=o.shape,c=o.dtype,s=n3(i);return n=a?new dd(s):new fd(s),{dtype:c,shape:i,dataId:this.runWebGLProgram(n,[{shape:s,dtype:c,dataId:e}],c,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,n,o,a,i){var c=this;i===void 0&&(i=!1);var s=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(s.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===N2.DENSE){var u=D2(e.outputShape);l.texShape=u.map(function(y){return 2*y})}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),te(s.shape)===0)return l.values=R4(s.dtype,0),s;var h=[],f=n.map(function(y){if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var x=c.texData.get(y.dataId);if(x.texture==null){if(!e.packedInputs&&te(y.shape)<=B().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=y.shape)}else if(!!x.isPacked!=!!e.packedInputs)y=x.isPacked?c.unpackTensor(y):c.packTensor(y),h.push(y),x=c.texData.get(y.dataId);else if(x.isPacked&&!A2(x.shape,y.shape)){var w=y,z=y.shape;y.shape=x.shape,y=c.packedReshape(y,z),h.push(y),x=c.texData.get(y.dataId),w.shape=z}return c.uploadToGPU(y.dataId),{shape:y.shape,texData:x,isUniform:!1}});this.uploadToGPU(s.dataId);var d,p={shape:s.shape,texData:l,isUniform:!1},v=function(y,x,w){var z="";x.concat(w).forEach(function(S){var k=S.texData!=null&&S.texData.slice!=null&&S.texData.slice.flatOffset>0,L=S.isUniform?"uniform":S.texData.texShape;z+=S.shape+"_"+L+"_"+k});var M=y.userCode,_=y.constructor.name;return _+="_"+z+"_"+M}(e,f,p),m=this.getAndSaveBinary(v,function(){return function(y,x,w,z){var M=x.userCode,_=w.map(function(O,G){var q={logicalShape:O.shape,texShape:O.isUniform?null:O.texData.texShape,isUniform:O.isUniform,isPacked:!O.isUniform&&O.texData.isPacked,flatOffset:null};return O.texData!=null&&O.texData.slice!=null&&O.texData.slice.flatOffset>0&&(q.flatOffset=O.texData.slice.flatOffset),{name:x.variableNames[G],shapeInfo:q}}),S=_.map(function(O){return O.shapeInfo}),k={logicalShape:z.shape,texShape:z.texData.texShape,isUniform:!1,isPacked:z.texData.isPacked,flatOffset:null},L=Nf(_,k,M,x.packedInputs),V=y.createProgram(L),I=null,D=y.getUniformLocation(V,"NAN",!1);B().getNumber("WEBGL_VERSION")===1&&(I=y.getUniformLocation(V,"INFINITY",!1));for(var R={},P=0;P<x.variableNames.length;P++){var N=x.variableNames[P];R[N]=y.getUniformLocation(V,N,!1),R["offset"+N]=y.getUniformLocation(V,"offset"+N,!1)}return{program:x,source:L,webGLProgram:V,uniformLocations:R,inShapeInfos:S,outShapeInfo:k,infLoc:I,nanLoc:D}}(c.gpgpu,e,f,p)}),g=this.activeTimers!=null;if(g&&(d=this.startTimer()),function(y,x,w,z,M){yc(x.inShapeInfos,w),yc([x.outShapeInfo],[z]);var _=z.texData.texture,S=z.texData.texShape;z.texData.isPacked?y.setOutputPackedMatrixTexture(_,S[0],S[1]):y.setOutputMatrixTexture(_,S[0],S[1]),y.setProgram(x.webGLProgram),B().getNumber("WEBGL_VERSION")===1&&x.infLoc!==null&&y.gl.uniform1f(x.infLoc,1/0),x.nanLoc!==null&&y.gl.uniform1f(x.nanLoc,NaN),w.forEach(function(k,L){var V=x.program.variableNames[L],I=x.uniformLocations[V],D=x.uniformLocations["offset"+V];if(I!=null)if(k.isUniform)if(te(k.shape)<2)y.gl.uniform1f(I,k.uniformValues[0]);else{var R=k.uniformValues;R instanceof Float32Array||(R=new Float32Array(R)),y.gl.uniform1fv(I,R)}else k.texData.slice!=null&&D!=null&&y.gl.uniform1i(D,k.texData.slice.flatOffset),y.setInputMatrixTexture(k.texData.texture,I,L)}),M?.(y,x.webGLProgram),y.executeProgram()}(this.gpgpu,m,f,p,a),h.forEach(function(y){return c.disposeData(y.dataId)}),g&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!B().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){var b=this.unpackTensor(s);return this.disposeData(s.dataId),b}return s},t.prototype.compileAndRun=function(e,n,o,a,i){i===void 0&&(i=!1),o=o||n[0].dtype;var c=this.runWebGLProgram(e,n,o,a,i);return T.makeTensorFromDataId(c.dataId,c.shape,c.dtype)},t.prototype.getAndSaveBinary=function(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(B().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(n){e.gpgpu.deleteProgram(e.binaryCache[n].webGLProgram),delete e.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=U(function(){if(!B().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=B().getBool("DEBUG");B().set("DEBUG",!1);var o=e.abs(K(1e-8)).dataSync()[0];if(B().set("DEBUG",n),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var n,o=this.texData.get(e),a=o.shape,i=o.dtype,c=o.values,s=o.texture,l=o.usage,u=o.isPacked;if(s==null){var h,f=this.activeTimers!=null;f&&(h=bt());var d=o.texShape;if(d==null&&(d=Es(a,u),o.texShape=d),c!=null){var p=n3(a),v=void 0,m=d[1],g=d[0],b=c instanceof Uint8Array;u?(m=(n=$2(d[0],d[1]))[0],g=n[1],v=new bd(p,[g,m],b)):v=new xd(p,[g,m],b);var y=this.makeTensorInfo([g,m],i);this.texData.get(y.dataId).usage=b?it.PIXELS:it.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,g,c);var x=this.runWebGLProgram(v,[y],i,null,!0),w=this.texData.get(x.dataId);o.texture=w.texture,o.texShape=w.texShape,o.isPacked=w.isPacked,o.usage=w.usage,this.disposeData(y.dataId),this.texData.delete(x.dataId),o.values=null,f&&(this.uploadWaitMs+=bt()-h)}else{var z=this.acquireTexture(d,l,i,u);o.texture=z}}},t.prototype.convertAndCacheOnCPU=function(e,n){var o=this.texData.get(e),a=o.dtype;return this.releaseGPUData(e),n!=null&&(o.values=function(i,c){if(c==="float32"||c==="complex64")return i;if(c==="int32"||c==="bool"){for(var s=c==="int32"?new Int32Array(i.length):new Uint8Array(i.length),l=0;l<s.length;++l)s[l]=Math.round(i[l]);return s}throw new Error("Unknown dtype "+c)}(n,a)),o.values},t.prototype.acquireTexture=function(e,n,o,a){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,n,a)},t.prototype.computeBytes=function(e,n){return e[0]*e[1]*Ro(n)},t}(Ys);cs()&&T.registerBackend("webgl",function(){return new H5},2);var pp=H({square_:function(r){var t=C(r,"x","square"),e=[t];return T.runKernelFunc(function(n,o){return o([t]),n.square(t)},{x:t},null,"Square",{},e,[])}}),j2="SquaredDifference",V5=H({squaredDifference_:function(r,t){var e,n=C(r,"a","squaredDifference"),o=C(t,"b","squaredDifference");e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape);var a={a:n,b:o},i=[n,o];return T.runKernelFunc(function(c,s){var l=c.squaredDifference(n,o);return s([n,o]),l},a,function(c,s){var l=s[0],u=s[1],h=K(2);return{a:function(){return c.mul(l.sub(u).mul(h))},b:function(){return c.mul(u.sub(l).mul(h))}}},j2,{},i,[])}}),vp=H({abs_:function(r){var t=C(r,"x","abs");return t.dtype==="complex64"?T.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):T.runKernelFunc(function(e,n){var o=e.abs(t);return n([t]),o},{x:t},function(e,n){var o=n[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),mp=H({acos_:function(r){var t=C(r,"x","acos");return T.runKernelFunc(function(e,n){var o=e.acos(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.divStrict(K(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),gp=H({acosh_:function(r){var t=C(r,"x","acosh");return T.runKernelFunc(function(e,n){var o=e.acosh(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),xp=H({asin_:function(r){var t=C(r,"x","asin");return T.runKernelFunc(function(e,n){var o=e.asin(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.divStrict(K(1).sub(o.toFloat().square()).sqrt())}}})}}),bp=H({asinh_:function(r){var t=C(r,"x","asinh");return T.runKernelFunc(function(e,n){var o=e.asinh(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.divStrict(K(1).add(o.toFloat().square()).sqrt())}}})}}),yp=H({atan_:function(r){var t=C(r,"x","atan");return T.runKernelFunc(function(e,n){var o=e.atan(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),wp=H({atanh_:function(r){var t=C(r,"x","atanh");return T.runKernelFunc(function(e,n){var o=e.atanh(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(K(1).sub(o.toFloat().square()))}}})}}),zp=H({ceil_:function(r){var t=C(r,"x","ceil");return T.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),X2=H({clipByValue_:function(r,t,e){var n=C(r,"x","clipByValue");E(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."});var o=[n],a={min:t,max:e};return T.runKernelFunc(function(i,c){var s=i.clip(n,t,e);return c([n]),s},{x:n},function(i,c){var s=c[0];return{x:function(){return i.where(s.greaterEqual(t).logicalAnd(s.lessEqual(e)),Ee(i))}}},"ClipByValue",a,o)}}),Mp=H({cos_:function(r){var t=C(r,"x","cos"),e=[t];return T.runKernelFunc(function(n,o){var a=n.cos(t);return o([t]),a},{x:t},function(n,o){var a=o[0];return{x:function(){return a.toFloat().sin().neg().mul(n)}}},"Cos",{},e)}}),Cp=H({cosh_:function(r){var t=C(r,"x","cosh");return T.runKernelFunc(function(e,n){var o=e.cosh(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),_p=H({erf_:function(r){var t=C(r,"x","erf");return E(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),T.runKernelFunc(function(e,n){var o=e.erf(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),k3=H({exp_:function(r){var t=C(r,"x","exp");return T.runKernelFunc(function(e,n){var o=e.exp(t);return n([o]),o},{x:t},function(e,n){return{x:function(){return e.mulStrict(n[0])}}},"Exp",{},[],[!0])}}),Ep=H({expm1_:function(r){var t=C(r,"x","expm1");return T.runKernelFunc(function(e,n){var o=e.expm1(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.mul(o.exp())}}})}}),Sp=H({floor_:function(r){var t=C(r,"x","floor");return T.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),kp=H({log_:function(r){var t=C(r,"x","log"),e=[t];return T.runKernelFunc(function(n,o){var a=n.log(t);return o([t]),a},{x:t},function(n,o){var a=o[0];return{x:function(){return n.div(a.toFloat())}}},"Log",{},e)}}),Hp=H({log1p_:function(r){var t=C(r,"x","log1p");return T.runKernelFunc(function(e,n){var o=e.log1p(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(o.add(1))}}})}}),Vp=H({logSigmoid_:function(r){var t=C(r,"x","logSigmoid");return T.runKernelFunc(function(e,n){var o=e.softplus(t.neg()).neg();return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),Y2=H({neg_:function(r){var t=C(r,"x","neg"),e=[t];return T.runKernelFunc(function(n){return n.neg(t)},{x:t},function(n){return{x:function(){return n.neg()}}},"Neg",{},e)}}),Tp=H({reciprocal_:function(r){var t=C(r,"x","reciprocal");return T.runKernelFunc(function(e,n){var o=e.reciprocal(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(o.square().neg())}}})}}),Lp=H({round_:function(r){var t=C(r,"x","round");return T.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),T5=H({rsqrt_:function(r){var t=C(r,"x","rsqrt"),e=[t];return T.runKernelFunc(function(n,o){var a=n.rsqrt(t);return o([t]),a},{x:t},function(n,o){var a=o[0];return{x:function(){return n.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),i6=H({sigmoid_:function(r){var t=C(r,"x","sigmoid");return T.runKernelFunc(function(e,n){var o=e.sigmoid(t);return n([o]),o},{x:t},function(e,n){var o=n[0];return{x:function(){return e.mul(o.mul(K(1).sub(o)))}}},"Sigmoid")}}),Fp=H({sign_:function(r){var t=C(r,"x","sign");return T.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),Ap=H({isNaN_:function(r){var t=C(r,"x","isNaN");return T.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),Dp=H({isInf_:function(r){var t=C(r,"x","isInf");return T.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),Ip=H({isFinite_:function(r){var t=C(r,"x","isFinite");return T.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ee(e)}}})}}),Bp=H({sin_:function(r){var t=C(r,"x","sin"),e=[t];return T.runKernelFunc(function(n,o){var a=n.sin(t);return o([t]),a},{x:t},function(n,o){var a=o[0];return{x:function(){return a.toFloat().cos().mul(n)}}},"Sin",{},e)}}),Rp=H({sinh_:function(r){var t=C(r,"x","sinh");return T.runKernelFunc(function(e,n){var o=e.sinh(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),Op=H({softplus_:function(r){var t=C(r,"x","softplus");return T.runKernelFunc(function(e,n){var o=e.softplus(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),Np=H({sqrt_:function(r){var t=C(r,"x","sqrt");return T.runKernelFunc(function(e,n){var o=e.sqrt(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),Pp=H({step_:function(r,t){t===void 0&&(t=0);var e=C(r,"x","step");return T.runKernelFunc(function(n){return n.step(e,t)},{$x:e},function(n){return{$x:function(){return Ee(n)}}})}}),Wp=H({tan_:function(r){var t=C(r,"x","tan");return T.runKernelFunc(function(e,n){var o=e.tan(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return e.div(o.cos().square())}}})}}),Up=H({tanh_:function(r){var t=C(r,"x","tanh");return T.runKernelFunc(function(e,n){var o=e.tanh(t);return n([o]),o},{x:t},function(e,n){var o=n[0];return{x:function(){return K(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function L5(r,t,e,n,o,a){var i,c,s=C(r,"x","batchNorm"),l=C(t,"mean","batchNorm"),u=C(e,"variance","batchNorm");return o!=null&&(i=C(o,"scale","batchNorm")),n!=null&&(c=C(n,"offset","batchNorm")),E(s.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."}),E(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),E(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."}),i!=null&&E(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),c!=null&&E(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+c.rank+"."}),Z2(s,l,u,c,i,a)}function F5(r,t,e,n,o,a){var i,c,s=C(r,"x","batchNorm"),l=C(t,"mean","batchNorm"),u=C(e,"variance","batchNorm");return o!=null&&(i=C(o,"scale","batchNorm")),n!=null&&(c=C(n,"offset","batchNorm")),E(s.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."}),E(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),E(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."}),i!=null&&E(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),c!=null&&E(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+c.rank+"."}),Z2(s,l,u,c,i,a)}function A5(r,t,e,n,o,a){var i,c,s=C(r,"x","batchNorm"),l=C(t,"mean","batchNorm"),u=C(e,"variance","batchNorm");return o!=null&&(i=C(o,"scale","batchNorm")),n!=null&&(c=C(n,"offset","batchNorm")),E(s.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+s.rank+"."}),E(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),E(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."}),i!=null&&E(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),c!=null&&E(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+c.rank+"."}),Z2(s,l,u,c,i,a)}function Z2(r,t,e,n,o,a){a==null&&(a=.001);var i,c,s,l=C(r,"x","batchNorm"),u=C(t,"mean","batchNorm"),h=C(e,"variance","batchNorm");o!=null&&(i=C(o,"scale","batchNorm")),n!=null&&(c=C(n,"offset","batchNorm")),E(u.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E(c==null||u.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E(i==null||u.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),s=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,u,h,i];return T.runKernelFunc(function(d,p){var v=d.batchNormalization(s,Kr(u),Kr(h),a,Kr(i),Kr(c));return p([l,u,h,i]),v},{x:l,mean:u,variance:h,scale:i,offset:c},function(d,p){var v=p,m=v[0],g=v[1],b=v[2],y=v[3],x=y??K(1),w=a1(g.shape,s.shape),z=[];if(g.rank===1){for(var M=0;M<s.shape.length-1;++M)z.push(s.shape[M]);z.push(1)}var _=m.sub(g),S=d.mul(x),k=T5(b.add(K(a))),L=k.mul(k).mul(k).mul(K(-.5));return{x:function(){return g.rank===1?d.mul(e4(k.as4D(1,1,1,g.shape[0]),z)).mul(x).reshape(m.shape):d.mul(k).mul(x).reshape(m.shape)},mean:function(){var V=k.mul(K(-1)).mul(S);return g.rank===1&&(V=V.sum(w)),V.reshape(g.shape)},variance:function(){var V=L.mul(_).mul(S);return g.rank===1&&(V=V.sum(w)),V.reshape(g.shape)},scale:function(){var V=_.mul(k),I=d.mul(V);return g.rank===1&&(I=I.sum(w)),I.reshape(g.shape)},offset:function(){var V=d;return g.rank===1&&(V=V.sum(w)),V.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:a},f).reshape(l.shape)}function Kr(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function H3(){Fs("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Gp=H({batchNormalization2d_:function(r,t,e,n,o,a){return n===void 0&&(n=.001),H3(),L5(r,t,e,a,o,n)}}),qp=H({batchNormalization3d_:function(r,t,e,n,o,a){return n===void 0&&(n=.001),H3(),F5(r,t,e,a,o,n)}}),jp=H({batchNormalization4d_:function(r,t,e,n,o,a){return n===void 0&&(n=.001),H3(),A5(r,t,e,a,o,n)}}),$p=H({batchNormalization_:function(r,t,e,n,o,a){return n===void 0&&(n=.001),H3(),Z2(r,t,e,a,o,n)}}),c6=H({batchNorm_:Z2}),Kp=H({batchNorm2d_:L5}),Xp=H({batchNorm3d_:F5}),Yp=H({batchNorm4d_:A5}),V3=H({logicalAnd_:function(r,t){var e=C(r,"a","logicalAnd","bool"),n=C(t,"b","logicalAnd","bool");return xe(e.shape,n.shape),T.runKernelFunc(function(o){return o.logicalAnd(e,n)},{a:e,b:n},null,"LogicalAnd")}}),Zp=H({logicalNot_:function(r){var t=C(r,"x","logicalNot","bool");return T.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),D5=H({logicalOr_:function(r,t){var e=C(r,"a","logicalOr","bool"),n=C(t,"b","logicalOr","bool");return xe(e.shape,n.shape),T.runKernelFunc(function(o){return o.logicalOr(e,n)},{$a:e,$b:n})}}),Qp=H({logicalXor_:function(r,t){var e=C(r,"a","logicalXor","bool"),n=C(t,"b","logicalXor","bool");return xe(e.shape,n.shape),D5(r,t).logicalAnd(V3(r,t).logicalNot())}}),o4=H({where_:function(r,t,e){var n=C(t,"a","where"),o=C(e,"b","where"),a=C(r,"condition","where","bool");return He(n.shape,o.shape,"Error in where: "),a.rank===1?E(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):He(a.shape,o.shape,"Error in where: "),T.runKernelFunc(function(i,c){var s=i.select(a,n,o);return c([a]),s},{$condition:a,$a:n,$b:o},function(i,c){var s=c[0];return{$condition:function(){return Ee(s).toFloat()},$a:function(){return i.mul(s.cast(i.dtype))},$b:function(){return i.mul(s.logicalNot().cast(i.dtype))}}})}}),I5=function(r){return Q(this,void 0,void 0,function(){var t,e,n;return J(this,function(o){switch(o.label){case 0:return[4,(t=C(r,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),n=n6(t.shape,e),r!==t&&t.dispose(),[2,n]}})})},ce=H({add_:function(r,t){var e,n=C(r,"a","add"),o=C(t,"b","add");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i){return i.add(n,o)},{a:n,b:o},function(i){return{a:function(){var c=i,s=a1(n.shape,a);return s.length>0&&(c=c.sum(s)),c.reshape(n.shape)},b:function(){var c=i,s=a1(o.shape,a);return s.length>0&&(c=c.sum(s)),c.reshape(o.shape)}}},"Add")}}),Jp=H({addN_:function(r){E(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),E(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var t=r.map(function(o,a){return C(o,"tensors"+a,"addN")}),e=t[0];t.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!o1(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=t;return T.runKernelFunc(function(o){return o.addN(t)},n,function(o){var a={};return t.forEach(function(i,c){a[c]=function(){return o.clone()}}),a},"AddN")}}),ev=H({addStrict_:function(r,t){var e=C(r,"a","addStrict"),n=C(t,"b","addStrict");return He(e.shape,n.shape,"Error in addStrict: "),e.add(n)}}),tv=H({atan2_:function(r,t){var e,n=C(r,"a","atan2"),o=C(t,"b","atan2");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i,c){var s=i.atan2(n,o);return c([n,o]),s},{$a:n,$b:o},function(i,c){var s=c[0],l=c[1];return{$a:function(){var u=ce(s.square(),l.square()),h=i.mul(l.div(u)),f=a1(s.shape,a);return f.length>0&&(h=h.sum(f)),h.reshape(s.shape)},$b:function(){var u=ce(s.square(),l.square()),h=Y2(i.mul(s.div(u))),f=a1(l.shape,a);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),ft=H({div_:function(r,t){var e,n=C(r,"a","div"),o=C(t,"b","div");if(e=Ge(n,o),n=e[0],o=e[1],n.dtype==="int32"&&o.dtype==="int32")return B5(n,o);var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i,c){var s=i.realDivide(n,o);return c([n,o]),s},{a:n,b:o},function(i,c){var s=c[0],l=c[1];return{a:function(){var u=i.div(l.toFloat()),h=a1(s.shape,a);return h.length>0?u.sum(h).reshape(s.shape):u},b:function(){var u=i.mul(s.toFloat()),h=a1(l.shape,a);h.length>0&&(u=u.sum(h).reshape(l.shape));var f=l.square();return u.div(f.toFloat()).neg()}}},"Div")}}),nv=H({divNoNan_:function(r,t){var e,n=C(r,"a","div"),o=C(t,"b","div");n=(e=Ge(n,o))[0],o=e[1];var a=ft(n,o),i=Ee(a),c=o.equal(i);return o4(c,i,a)}}),rv=H({divStrict_:function(r,t){var e=C(r,"a","div"),n=C(t,"b","div");return He(e.shape,n.shape,"Error in divideStrict: "),e.div(n)}}),B5=H({floorDiv_:function(r,t){var e,n=C(r,"a","floorDiv"),o=C(t,"b","floorDiv");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i,c){var s=i.floorDiv(n,o);return c([n,o]),s},{a:n,b:o},function(i,c){var s=c[0],l=c[1];return{a:function(){var u=i.div(l.toFloat()),h=a1(s.shape,a);return h.length>0?u.sum(h).reshape(s.shape):u},b:function(){var u=i.mul(s.toFloat()),h=a1(l.shape,a);h.length>0&&(u=u.sum(h).reshape(l.shape));var f=l.square();return u.div(f.toFloat()).neg()}}},"FloorDiv")}}),s6=H({maximum_:function(r,t){var e,n=C(r,"a","maximum"),o=C(t,"b","maximum");return e=Ge(n,o),n=e[0],o=e[1],n.dtype==="bool"&&(n=n.toInt(),o=o.toInt()),xe(n.shape,o.shape),T.runKernelFunc(function(a,i){var c=a.maximum(n,o);return i([n,o]),c},{a:n,b:o},function(a,i){var c=i[0],s=i[1];return{a:function(){return a.mul(c.greaterEqual(s).toFloat())},b:function(){return a.mul(c.less(s).toFloat())}}},"Maximum")}}),ov=H({maximumStrict_:function(r,t){var e=C(r,"a","maximumStrict"),n=C(t,"b","maximumStrict");return He(e.shape,n.shape,"Error in maximumStrict: "),e.maximum(n)}}),R5=H({minimum_:function(r,t){var e,n=C(r,"a","minimum"),o=C(t,"b","minimum");return e=Ge(n,o),n=e[0],o=e[1],n.dtype==="bool"&&(n=n.toInt(),o=o.toInt()),xe(n.shape,o.shape),T.runKernelFunc(function(a,i){var c=a.minimum(n,o);return i([n,o]),c},{a:n,b:o},function(a,i){var c=i[0],s=i[1];return{a:function(){return a.mul(c.lessEqual(s).toFloat())},b:function(){return a.mul(c.greater(s).toFloat())}}},"Minimum")}}),av=H({minimumStrict_:function(r,t){var e=C(r,"a","minimumStrict"),n=C(t,"b","minimumStrict");return He(e.shape,n.shape,"Error in minimumStrict: "),e.minimum(n)}}),iv=H({mod_:function(r,t){var e,n=C(r,"a","mod"),o=C(t,"b","mod");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i,c){var s=i.mod(n,o);return c([n,o]),s},{$a:n,$b:o},function(i,c){var s=c[0],l=c[1];return{$a:function(){var u=a1(s.shape,a);return u.length>0?i.sum(u).reshape(s.shape):i},$b:function(){var u=i.mul(s.div(l).floor().neg()),h=a1(l.shape,a);return h.length>0?u.sum(h).reshape(l.shape):u}}})}}),cv=H({modStrict_:function(r,t){var e=C(r,"a","modStrict"),n=C(t,"b","modStrict");return He(e.shape,n.shape,"Error in modStrict: "),e.mod(n)}}),$e=H({mul_:function(r,t){var e,n=C(r,"a","mul"),o=C(t,"b","mul");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i,c){var s=i.multiply(n,o);return c([n,o]),s},{a:n,b:o},function(i,c){var s=c[0],l=c[1];return{a:function(){var u=i.mul(l.toFloat()),h=a1(s.shape,a);return h.length>0?u.sum(h).reshape(s.shape):u},b:function(){var u=i.mul(s.toFloat()),h=a1(l.shape,a);return h.length>0?u.sum(h).reshape(l.shape):u}}},"Mul")}}),sv=H({mulStrict_:function(r,t){var e=C(r,"a","mul"),n=C(t,"b","mul");return He(e.shape,n.shape,"Error in multiplyStrict: "),e.mul(n)}}),x3=H({pow_:function(r,t){var e,n=C(r,"base","pow"),o=C(t,"exp","pow");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape),i=[n,o];return T.runKernelFunc(function(c,s){var l=c.pow(n,o);return s([n,o,l]),l},{a:n,b:o},function(c,s){var l=s[0],u=s[1],h=s[2];return{a:function(){var f=u.toFloat(),d=c.mul(f.mul(l.pow(f.sub(K(1))))),p=a1(l.shape,a);return p.length>0&&(d=d.sum(p)),d.reshape(l.shape)},b:function(){var f=l.greater(0),d=l.log().where(f,Ee(l)),p=c.mul(h.mul(d)),v=a1(u.shape,a);return v.length>0&&(p=p.sum(v)),p.reshape(u.shape)}}},"Pow",{},i,[!0])}}),lv=H({powStrict_:function(r,t){return He(r.shape,t.shape,"Error in powStrict: "),r.pow(t)}}),uv=H({squaredDifferenceStrict_:function(r,t){var e=C(r,"a","squaredDifferenceStrict"),n=C(t,"b","squaredDifferenceStrict");return He(e.shape,n.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(n)}}),Be=H({sub_:function(r,t){var e,n=C(r,"a","sub"),o=C(t,"b","sub");e=Ge(n,o),n=e[0],o=e[1];var a=xe(n.shape,o.shape);return T.runKernelFunc(function(i){return i.subtract(n,o)},{a:n,b:o},function(i){return{a:function(){var c=i,s=a1(n.shape,a);return s.length>0&&(c=c.sum(s)),c.reshape(n.shape)},b:function(){var c=i,s=a1(o.shape,a);return s.length>0&&(c=c.sum(s)),c.neg().reshape(o.shape)}}},"Sub")}}),hv=H({subStrict_:function(r,t){var e=C(r,"a","subStrict"),n=C(t,"b","subStrict");return He(e.shape,n.shape,"Error in subStrict: "),e.sub(n)}}),O5=H({equal_:function(r,t){var e,n=C(r,"a","equal"),o=C(t,"b","equal");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a){return a.equal(n,o)},{$a:n,$b:o})}}),fv=H({equalStrict_:function(r,t){var e=C(r,"a","equalStrict"),n=C(t,"b","equalStrict");return He(e.shape,n.shape,"Error in equalStrict: "),e.equal(n)}}),dv=H({greater_:function(r,t){var e,n=C(r,"a","greater"),o=C(t,"b","greater");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a){return a.greater(n,o)},{a:n,b:o},null,"Greater")}}),N5=H({greaterEqual_:function(r,t){var e,n=C(r,"a","greaterEqual"),o=C(t,"b","greaterEqual");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a,i){var c=a.greaterEqual(n,o);return i([n,o]),c},{a:n,b:o},function(a,i){var c=i[0],s=i[1];return{a:function(){return Ee(c)},b:function(){return Ee(s)}}},"GreaterEqual")}}),pv=H({greaterEqualStrict_:function(r,t){var e=C(r,"a","greaterEqualStrict"),n=C(t,"b","greaterEqualStrict");return He(e.shape,n.shape,"Error in greaterEqualStrict: "),e.greaterEqual(n)}}),vv=H({greaterStrict_:function(r,t){var e=C(r,"a","greaterStrict"),n=C(t,"b","greaterStrict");return He(e.shape,n.shape,"Error in greaterStrict: "),e.greater(n)}}),mv=H({less_:function(r,t){var e,n=C(r,"a","less"),o=C(t,"b","less");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a){return a.less(n,o)},{a:n,b:o},null,"Less")}}),gv=H({lessEqual_:function(r,t){var e,n=C(r,"a","lessEqual"),o=C(t,"b","lessEqual");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a,i){var c=a.lessEqual(n,o);return i([n,o]),c},{a:n,b:o},null,"LessEqual")}}),xv=H({lessEqualStrict_:function(r,t){var e=C(r,"a","lessEqualStrict"),n=C(t,"b","lessEqualStrict");return He(e.shape,n.shape,"Error in lessEqualStrict: "),e.lessEqual(n)}}),bv=H({lessStrict_:function(r,t){var e=C(r,"a","lessStrict"),n=C(t,"b","lessStrict");return He(e.shape,n.shape,"Error in lessStrict: "),e.less(n)}}),yv=H({notEqual_:function(r,t){var e,n=C(r,"a","notEqual"),o=C(t,"b","notEqual");return e=Ge(n,o),n=e[0],o=e[1],xe(n.shape,o.shape),T.runKernelFunc(function(a){return a.notEqual(n,o)},{a:n,b:o},null,"NotEqual")}}),wv=H({notEqualStrict_:function(r,t){var e=C(r,"a","notEqualStrict"),n=C(t,"b","notEqualStrict");return He(e.shape,n.shape,"Error in notEqualStrict: "),e.notEqual(n)}});function Vc(r,t){for(var e=[],n=r;n<t;++n)e.push(n);return e}function Tc(r){for(var t=[],e=0;e<r.length;++e)for(var n=0;n<r[e].length;++n)t.push(r[e][n]);return t}var l6=H({gather_:function(r,t,e){e===void 0&&(e=0);var n=C(r,"x","gather"),o=C(t,"indices","gather","int32");e=i1(e,n.shape)[0];var a=function(i,c,s){for(var l=i.shape[s],u=[],h=1,f=1,d=0;d<s;d++)u.push(i.shape[d]),h*=i.shape[d];for(d=0;d<c.rank;d++)u.push(c.shape[d]);for(d=s+1;d<i.rank;d++)u.push(i.shape[d]),f*=i.shape[d];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:u}}(n,o,e);return T.runKernelFunc(function(i,c){var s=i.gather(n,o.flatten(),e);return c([o]),s},{x:n,indices:o},function(i,c){var s=c[0];return{x:function(){var l=n.shape,u=s.size,h=l.slice(0,e),f=h.length,d=l.slice(e,l.length).slice(1),p=d.length,v=Vc(0,f),m=Vc(f+1,f+1+p),g=Tc([h,[u],d]),b=i.reshape(g),y=s.reshape([u]),x=Tc([[f],v,m]),w=b.transpose(x),z=P5(w,y,n.shape[e]),M=z3(x);return z=z.transpose(M)},indices:function(){return s}}},"Gather",{axis:e}).reshape(a.outputShape)}}),P5=H({unsortedSegmentSum_:function(r,t,e){var n=C(r,"x","unsortedSegmentSum"),o=C(t,"segmentIds","unsortedSegmentSum","int32");return E(Ke(e),function(){return"numSegments must be of dtype int"}),T.runKernelFunc(function(a,i){var c=a.unsortedSegmentSum(n,o,e);return i([o]),c},{$x:n},function(a,i){var c=i[0];return{$x:function(){return function(s,l){for(var u=s6(l,Ee(l)),h=l6(s,u),f=N5(l,K(0,"int32")),d=h.rank-f.rank,p=0;p<d;++p)f=I1(f,p+1);f=V3(f,W4(h.shape,"bool"));var v=Ee(h);return o4(f,h,v)}(a,c)}}})}}),zv=function(r,t,e){return Q(this,void 0,void 0,function(){var n,o,a,i,c,s,l,u,h,f,d,p,v;return J(this,function(m){switch(m.label){case 0:for(n=C(r,"tensor","boolMask"),o=C(t,"mask","boolMask","bool"),a=e??0,i=o.rank,c=n.shape,E(i>0,function(){return"mask cannot be scalar"}),He(c.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),s=1,l=a;l<a+i;l++)s*=c[l];return u=c.slice(0,a).concat([s],c.slice(a+i)),h=n.reshape(u),f=o.reshape([-1]),[4,I5(f)];case 1:return d=m.sent(),p=d.squeeze([1]),v=l6(h,p,a),r!==n&&n.dispose(),t!==o&&o.dispose(),p.dispose(),h.dispose(),f.dispose(),d.dispose(),[2,v]}})})};function W5(r,t,e,n,o,a,i){a===void 0&&(a="NHWC"),E(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var c=r,s=t,l=!1;t.rank===3&&(l=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),c=[1,r[0],r[1],r[2]]),E(c.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+c.length+"."}),E(s.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),E(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var u=a==="NHWC"?c[3]:c[1],h=a==="NHWC"?s.shape[3]:s.shape[1];E(u===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[2]+"."}),E(h===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+e.shape[3]+"."}),i!=null&&E(Ke(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=S3(a),d=Tn(c,e.shape,n,1,o,i,!1,f),p=T.runKernelFunc(function(v,m){var g=v.conv2dDerInput(s,e,d);return m([e,s]),g},{dy4D:s,filter:e},function(v,m){var g=m[0],b=m[1];return{dy4D:function(){return x1(v,g,n,o,a,1,i)},filter:function(){return u6(v,b,g.shape,n,o,a,i)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function oo(r){var t=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(r),e=t[0],n=t[1],o=t[2];return e===1&&n===1&&o===1}function U5(r,t,e,n,o){E(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var a=r,i=t,c=!1;t.rank===4&&(c=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,r[0],r[1],r[2],r[3]]);var s=a[4],l=i.shape[4];E(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),E(i.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),E(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),E(s===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+s+") must match input depth for filter "+e.shape[3]+"."}),E(l===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+e.shape[4]+"."});var u=q2(a,e.shape,n,1,o),h=T.runKernelFunc(function(f){return f.conv3dDerInput(i,e,u)},{dy5D:i});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Mv=H({conv1d_:function(r,t,e,n,o,a,i){o===void 0&&(o="NWC"),a===void 0&&(a=1);var c=C(r,"x","conv1d"),s=C(t,"filter","conv1d"),l=c,u=!1;c.rank===2&&(u=!0,l=c.as3D(1,c.shape[0],c.shape[1])),E(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),E(s.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+s.rank+"."}),i!=null&&E(Ke(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."}),E(l.shape[2]===s.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+s.shape[1]+"."}),E(U1(e,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+a+"'"}),E(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=x1(f,h,[1,e],n,"NHWC",[1,a],i);return u?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),x1=H({conv2d_:function(r,t,e,n,o,a,i){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]);var c=C(r,"x","conv2d"),s=C(t,"filter","conv2d"),l=c,u=!1;c.rank===3&&(u=!0,l=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),E(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),E(s.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+s.rank+"."}),i!=null&&E(Ke(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var h=o==="NHWC"?l.shape[3]:l.shape[1];E(h===s.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+s.shape[2]+"."}),E(U1(e,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"});var f=S3(o),d=Tn(l.shape,s.shape,e,a,n,i,!1,f),p=[s,l],v=T.runKernelFunc(function(m,g){var b=m.conv2d(l,s,d);return g([s,l]),b},{x:l,filter:s},function(m,g){var b=g,y=b[0],x=b[1];return E(r4(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return G5(x.shape,m,y,e,n,o)},filter:function(){return u6(x,m,y.shape,e,n,o)}}},"Conv2D",d,p);return u?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Cv=H({conv3d_:function(r,t,e,n,o,a){o===void 0&&(o="NDHWC"),a===void 0&&(a=[1,1,1]);var i=C(r,"x","conv3d"),c=C(t,"filter","conv3d"),s=i,l=!1;i.rank===4&&(l=!0,s=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),E(s.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+s.rank+"."}),E(c.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+c.rank+"."}),E(s.shape[4]===c.shape[3],function(){return"Error in conv3d: depth of input ("+s.shape[4]+") must match input depth for filter "+c.shape[3]+"."}),E(function(f,d){return oo(f)||oo(d)}(e,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),E(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var u=q2(s.shape,c.shape,e,a,n),h=T.runKernelFunc(function(f,d){var p=f.conv3d(s,c,u);return d([s,c]),p},{x:s,$filter:c},function(f,d){E(oo(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var p=d[0],v=d[1];return{x:function(){return U5(p.shape,f,v,e,n)},$filter:function(){return function(m,g,b,y,x){var w=m;m.rank===4&&(w=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var z=g;z.rank===4&&(z=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),E(w.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+w.shape+"."}),E(z.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+z.shape+"."}),E(b.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),E(w.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+w.shape[4]+") must match input depth in filter ("+b[3]+"."}),E(z.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+z.shape[4]+") must match output depth for filter ("+b[4]+")."});var M=q2(w.shape,b,y,1,x);return T.runKernelFunc(function(_){return _.conv3dDerFilter(w,z,M)},{x5D:w,dy5D:z})}(p,f,v.shape,e,n)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),u6=H({conv2dDerFilter_:function(r,t,e,n,o,a,i){a===void 0&&(a="NHWC");var c=r;r.rank===3&&(c=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t;s.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),E(c.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+c.shape+"."}),E(s.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),E(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var l=a==="NHWC"?c.shape[3]:c.shape[1],u=a==="NHWC"?s.shape[3]:s.shape[1];E(l===e[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+e[2]+"."}),E(u===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+u+") must match output depth for filter ("+e[3]+")."}),i!=null&&E(Ke(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var h=S3(a),f=Tn(c.shape,e,n,1,o,i,!1,h);return T.runKernelFunc(function(d){return d.conv2dDerFilter(c,s,f)},{x4D:c,dy4D:s})}}),G5=H({conv2dDerInput_:W5}),Q2=H({depthwiseConv2d_:function(r,t,e,n,o,a,i){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]);var c=C(r,"x","depthwiseConv2d"),s=C(t,"filter","depthwiseConv2d"),l=c,u=!1;c.rank===3&&(u=!0,l=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),E(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),E(s.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+s.rank+"."}),E(l.shape[3]===s.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+s.shape[2]+"."}),a==null&&(a=[1,1]),E(U1(e,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),i!=null&&E(Ke(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var h=Tn(l.shape,s.shape,e,a,n,i,!0),f=[l,s],d=T.runKernelFunc(function(p,v){var m=p.depthwiseConv2D(l,s,h);return v([l,s]),m},{x:l,filter:s},function(p,v){E(r4(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var m=v[0],g=v[1];return{x:function(){return q5(m.shape,p,g,h)},filter:function(){return j5(m,p,g.shape,h)}}},"DepthwiseConv2dNative",h,f);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),q5=H({depthwiseConv2dDerInput_:function(r,t,e,n){var o=t,a=!1;t.rank===3&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=T.runKernelFunc(function(c){return c.depthwiseConv2DDerInput(o,e,n)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),j5=H({depthwiseConv2dDerFilter_:function(r,t,e,n){var o=r;r.rank===3&&(o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t;return a.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),T.runKernelFunc(function(i){return i.depthwiseConv2DDerFilter(o,a,n)},{x4D:o,dy4D:a})}}),J2=H({separableConv2d_:function(r,t,e,n,o,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var c=C(r,"x","separableConv2d"),s=C(t,"depthwiseFilter","separableConv2d"),l=C(e,"pointwiseFilter","separableConv2d"),u=c,h=!1;if(c.rank===3&&(h=!0,u=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(u.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+u.rank+"."}),E(s.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+s.rank+"."}),E(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+s.rank+"."}),E(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),E(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=s.shape[2],d=s.shape[3];E(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var p=Q2(u,s,n,o,i,a),v=x1(p,l,1,"valid",i);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),_v=H({conv2dTranspose_:function(r,t,e,n,o,a){return W5(e,C(r,"x","conv2dTranspose"),C(t,"filter","conv2dTranspose"),n,o,"NHWC",a)}}),Ev=H({conv3dTranspose_:function(r,t,e,n,o){return U5(e,C(r,"x","conv3dTranspose"),C(t,"filter","conv3dTranspose"),n,o)}}),U4=H({matMul_:function(r,t,e,n){var o;e===void 0&&(e=!1),n===void 0&&(n=!1);var a=C(r,"a","matMul"),i=C(t,"b","matMul");o=Ge(a,i),a=o[0],i=o[1];var c=e?a.shape[a.rank-2]:a.shape[a.rank-1],s=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=e?a.shape[a.rank-1]:a.shape[a.rank-2],u=n?i.shape[i.rank-2]:i.shape[i.rank-1],h=a.shape.slice(0,-2),f=i.shape.slice(0,-2),d=te(h),p=te(f);E(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),E(o1(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),E(c===s,function(){return"Error in matMul: inner shapes ("+c+") and ("+s+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+e+" and transposeB="+n+" must match."});var v=a.shape.slice(0,-2).concat([l,u]),m=e?a.as3D(d,c,l):a.as3D(d,l,c),g=n?i.as3D(p,u,s):i.as3D(p,s,u),b={transposeA:e,transposeB:n};return T.runKernelFunc(function(y,x){var w=y.batchMatMul(m,g,e,n);return x([m,g]),w},{a:m,b:g},function(y,x){var w=x,z=w[0],M=w[1];return e||n?!e&&n?{a:function(){return y.matMul(M,!1,!1)},b:function(){return y.matMul(z,!0,!1)}}:e&&!n?{a:function(){return M.matMul(y,!1,!0)},b:function(){return z.matMul(y,!1,!1)}}:{a:function(){return M.matMul(y,!0,!0)},b:function(){return y.matMul(z,!0,!0)}}:{a:function(){return y.matMul(M,!1,!0)},b:function(){return z.matMul(y,!0,!1)}}},"BatchMatMul",b).reshape(v)}}),Sv=H({dot_:function(r,t){var e=C(r,"t1","dot"),n=C(t,"t2","dot");E(!(e.rank!==1&&e.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+n.rank+"."});var o=e.rank===1?e.size:e.shape[1],a=n.rank===1?n.size:n.shape[0];return E(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),e.rank===1&&n.rank===1?e.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():e.rank===1&&n.rank===2?e.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():e.rank===2&&n.rank===1?e.matMul(n.as2D(-1,1)).as1D():e.matMul(n.as2D(n.shape[0],n.shape[1]))}}),kv=H({outerProduct_:function(r,t){var e=C(r,"v1","outerProduct"),n=C(t,"v2","outerProduct");return E(e.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+n.rank+"."}),e.as2D(-1,1).matMul(n.as2D(1,-1))}}),er=H({reverse_:function(r,t){var e=C(r,"x","reverse");if(e.rank===0)return e.clone();var n=i1(t,e.shape);return T.runKernelFunc(function(o){return o.reverse(e,n)},{$x:e},function(o){return{$x:function(){return o.reverse(n)}}}).reshapeAs(e)}}),Hv=H({reverse1d_:function(r){var t=C(r,"x","reverse");return E(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),er(t,0)}}),Vv=H({reverse2d_:function(r,t){var e=C(r,"x","reverse");return E(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),er(e,t)}}),Tv=H({reverse3d_:function(r,t){var e=C(r,"x","reverse");return E(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),er(e,t)}}),Lv=H({reverse4d_:function(r,t){var e=C(r,"x","reverse");return E(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),er(e,t)}});function $5(r,t,e,n,o,a){var i=C(r,"x","maxPool"),c=i,s=!1;i.rank===3&&(s=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),n==null&&(n=[1,1]),E(c.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+c.rank+"."}),E(U1(e,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"}),a!=null&&E(Ke(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=O4(c.shape,t,e,n,o,a);if(l.filterWidth===1&&l.filterHeight===1&&o1(l.inShape,l.outShape))return i.clone();var u=[c],h=T.runKernelFunc(function(f,d){var p=f.maxPool(c,l);return d([c,p]),p},{x:c},function(f,d){var p=d[0],v=d[1];return{x:function(){return function(m,g,b,y,x,w,z,M){var _=C(m,"dy","maxPoolBackprop"),S=C(g,"input","maxPoolBackprop"),k=C(b,"output","maxPoolBackprop");E(S.rank===_.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+_.rank+")"}),w==null&&(w=[1,1]),E(U1(x,w),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+w+"'"}),E(_.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),E(S.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."}),M!=null&&E(Ke(z),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+z+"."});var L=O4(S.shape,y,x,w,z,M);return T.runKernelFunc(function(V){return V.maxPoolBackprop(_,S,k,L)},{$dy:_,$input:S})}(f,p,v,t,e,n,o)}}},"MaxPool",l,u);return s?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function K5(r,t,e,n,o,a){var i=C(r,"x","avgPool","float32");n==null&&(n=[1,1]),E(U1(e,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"});var c=i,s=!1;i.rank===3&&(s=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),E(c.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+c.rank+"."}),a!=null&&E(Ke(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=O4(c.shape,t,e,n,o,a);if(l.filterWidth===1&&l.filterHeight===1&&o1(l.inShape,l.outShape))return i.clone();var u=T.runKernelFunc(function(h){return h.avgPool(c,l)},{x:c},function(h){return{x:function(){return function(f,d,p,v,m,g){var b=C(f,"dy","avgPoolBackprop"),y=C(d,"input","avgPoolBackprop");E(y.rank===b.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+b.rank+")"}),m==null&&(m=[1,1]),E(U1(v,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"});var x=y,w=b,z=!1;y.rank===3&&(z=!0,x=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),E(w.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."}),E(x.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+x.rank+"."});var M=O4(x.shape,p,v,m,g),_=T.runKernelFunc(function(S){return S.avgPoolBackprop(w,x,M)},{dy4D:w,input4D:x});return z?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}(h,c,t,e,n,o)}}},"AvgPool",l);return u=u.cast(i.dtype),s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var Xe=H({maxPool_:function(r,t,e,n,o){return $5(r,t,e,1,n,o)}}),cn=H({avgPool_:function(r,t,e,n,o){return K5(r,t,e,1,n,o)}}),Fv=H({pool_:function(r,t,e,n,o,a){o==null&&(o=[1,1]),a==null&&(a=1),n===0&&(n="valid");var i=C(r,"x","maxPool"),c=i,s=!1;i.rank===3&&(s=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),E(U1(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,u=O4(c.shape,t,a,o,n),h=[u.dilationHeight,u.dilationWidth];l=n==="same"?function(x,w){var z=x.map(function(S,k){return S+(S-1)*(w[k]-1)}).map(function(S){return S-1}),M=z.map(function(S){return Math.floor(S/2)}),_=z.map(function(S,k){return S-M[k]});return z.map(function(S,k){return[M[k],_[k]]})}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,d=function(x,w,z){var M=z.map(function(D){return D[0]}),_=z.map(function(D){return D[1]}),S=x.concat(M,_),k=w.map(function(D,R){return(D-S[R]%D)%D}),L=_.map(function(D,R){return D+k[R]}),V=w.map(function(D,R){return[M[R],L[R]]}),I=w.map(function(D,R){return[0,k[R]]});return[V,I]}([u.inHeight,u.inWidth],h,l),p=d[0],v=d[1],m=f?n:"valid",g=f?c:Ns(c,h,p),b=(e==="avg"?function(){return K5(g,t,a,1,m)}:function(){return $5(g,t,a,1,m)})(),y=f?b:Bs(b,h,v);return s?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Av=H({maxPool3d_:function(r,t,e,n,o,a,i){a===void 0&&(a="NDHWC");var c=C(r,"x","maxPool3d"),s=c,l=!1;c.rank===4&&(l=!0,s=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),i==null&&(i=[1,1,1]),E(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),E(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),E(U1(e,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&E(Ke(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var u=G2(s.shape,t,e,i,n,o,a),h=T.runKernelFunc(function(f,d){var p=f.maxPool3d(s,u);return d([s,p]),p},{x:s},function(f,d){var p=d[0],v=d[1];return{x:function(){return function(m,g,b,y,x,w,z,M){var _=C(m,"dy","maxPool3dBackprop"),S=C(g,"input","maxPool3dBackprop"),k=C(b,"output","maxPool3dBackprop"),L=_,V=S,I=k,D=!1;S.rank===4&&(D=!0,L=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),V=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),I=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),E(L.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+L.rank+"."}),E(V.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+V.rank+"."}),E(I.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+I.rank+"."}),w==null&&(w=[1,1,1]),E(U1(x,w),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+w+"'"}),M!=null&&E(Ke(z),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+z+"."});var R=G2(V.shape,y,x,w,z,M),P=T.runKernelFunc(function(N){return N.maxPool3dBackprop(L,V,I,R)},{dy5D:L,input5D:V});return D?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(f,p,v,t,e,i,n,o)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Dv=H({avgPool3d_:function(r,t,e,n,o,a,i){a===void 0&&(a="NDHWC");var c=C(r,"x","avgPool3d","float32"),s=c,l=!1;c.rank===4&&(l=!0,s=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),i==null&&(i=[1,1,1]),E(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),E(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),E(U1(e,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&E(Ke(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var u=G2(s.shape,t,e,i,n,o,a),h=T.runKernelFunc(function(f){return f.avgPool3d(s,u)},{x:s},function(f){return{x:function(){return function(d,p,v,m,g,b,y){var x=C(d,"dy","avgPool3dBackprop"),w=C(p,"input","avgPool3dBackprop"),z=x,M=w,_=!1;w.rank===4&&(_=!0,z=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]),M=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),E(z.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+z.rank+"."}),E(M.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),g==null&&(g=[1,1,1]),E(U1(m,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"}),y!=null&&E(Ke(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+b+"."});var S=G2(M.shape,v,m,g,b,y),k=T.runKernelFunc(function(L){return L.avgPool3dBackprop(z,M,S)},{dy5D:z,input5D:M});return _?k.as4D(k.shape[1],k.shape[2],k.shape[3],k.shape[4]):k}(f,s,t,e,i,n,o)}}});return h=h.cast(s.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),wt=H({slice_:function(r,t,e){var n,o,a=C(r,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof t=="number"?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(s){E(s!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=e==null?new Array(a.rank).fill(-1):typeof e=="number"?[e].concat(new Array(a.rank-1).fill(-1)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(-1)):e).map(function(s,l){return s>=0?s:(E(s===-1,function(){return"Negative size values should be exactly -1 but got "+s+" for the slice() size at index "+l+"."}),a.shape[l]-n[l])}),js(a,n,o);var i=a.shape,c={begin:n,size:o};return T.runKernelFunc(function(s){return s.slice(a,n,o)},{x:a},function(s){for(var l=[],u=0;u<s.rank;u++)l.push([n[u],i[u]-n[u]-o[u]]);return{x:function(){return s.pad(l)}}},"Slice",c)}}),Iv=H({slice1d_:function(r,t,e){var n=C(r,"x","slice1d");return E(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),wt(n,[t],[e])}}),Bv=H({slice2d_:function(r,t,e){var n=C(r,"x","slice2d");return E(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),wt(n,t,e)}}),h6=H({slice3d_:function(r,t,e){var n=C(r,"x","slice3d");return E(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),wt(n,t,e)}}),Rv=H({slice4d_:function(r,t,e){var n=C(r,"x","slice4d");return E(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),wt(n,t,e)}});function X5(r,t,e,n,o){return t.rank<e.rank&&(t=t.reshape(W1(t.shape,n))),r.rank<e.rank&&(r=r.reshape(W1(r.shape,n))),{x:function(){var a=r.mul(e.equal(t).cast(r.dtype));return o==null?a:a.transpose(o)}}}var Ov=H({all_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","all","bool"),o=i1(t,n.shape),a=o,i=Mt(a,n.rank);i!=null&&(n=n.transpose(i),a=Ct(a.length,n.rank));var c=T.runKernelFunc(function(l){return l.all(n,a)},{$x:n});if(e){var s=W1(c.shape,o);return c.reshape(s)}return c}}),Nv=H({any_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","any","bool"),o=i1(t,n.shape),a=o,i=Mt(a,n.rank);i!=null&&(n=n.transpose(i),a=Ct(a.length,n.rank));var c=T.runKernelFunc(function(l){return l.any(n,a)},{$x:n});if(e){var s=W1(c.shape,o);return c.reshape(s)}return c}}),Pv=H({argMax_:function(r,t){t===void 0&&(t=0);var e=C(r,"x","argMax");t==null&&(t=0);var n=i1(t,e.shape),o=Mt(n,e.rank);o!=null&&(e=e.transpose(o),n=Ct(n.length,e.rank));var a={axis:n[0]},i=[e];return T.runKernelFunc(function(c,s){var l=c.argMax(e,n[0]);return s([e]),l},{x:e},function(c,s){var l=s[0];return{x:function(){return Ee(l)}}},"ArgMax",a,i)}}),Wv=H({argMin_:function(r,t){t===void 0&&(t=0);var e=C(r,"x","argMin");t==null&&(t=0);var n=i1(t,e.shape),o=Mt(n,e.rank);return o!=null&&(e=e.transpose(o),n=Ct(n.length,e.rank)),T.runKernelFunc(function(a,i){var c=a.argMin(e,n[0]);return i([e]),c},{$x:e},function(a,i){var c=i[0];return{$x:function(){return Ee(c)}}})}}),Uv=H({logSumExp_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","logSumExp"),o=i1(t,n.shape),a=n.max(o,!0),i=n.sub(a).exp().sum(o).log(),c=a.reshape(i.shape).add(i);if(e){var s=W1(c.shape,o);return c.reshape(s)}return c}}),c4=H({max_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","max"),o=n,a=i1(t,n.shape),i=a,c=Mt(i,n.rank);c!=null&&(n=n.transpose(c),i=Ct(i.length,n.rank));var s=[n],l=T.runKernelFunc(function(h,f){var d=h.max(n,i);return f([o,d]),d},{x:n},function(h,f){return X5(h,f[1],f[0],a,c)},"Max",{axes:i},s,[!0]);if(e){var u=W1(l.shape,a);l=l.reshape(u)}return l}}),Gv=H({mean_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","mean"),o=i1(t,n.shape),a=te(S1(n.shape,o)[1]);return E3(function(i){var c=K(a);return{value:(c.dtype===i.dtype?i:i.cast(c.dtype)).div(c).sum(t,e),gradFunc:function(s){var l=i.shape.slice();return o.forEach(function(u){l[u]=1}),s.reshape(l).mul(W4(i.shape,"float32")).div(a)}}})(n)}}),qv=H({min_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","min"),o=n,a=i1(t,n.shape),i=a,c=Mt(i,n.rank);c!=null&&(n=n.transpose(c),i=Ct(i.length,n.rank));var s=[n],l=T.runKernelFunc(function(h,f){var d=h.min(n,i);return f([o,d]),d},{x:n},function(h,f){return X5(h,f[1],f[0],a,c)},"Min",{axes:i},s,[!0]);if(e){var u=W1(l.shape,a);l=l.reshape(u)}return l}}),jv=H({moments_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=i1(t,(r=C(r,"x","moments")).shape),o=r.mean(n,e),a=o.shape;e||(a=W1(o.shape,n));var i=r.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(n,e)}}}),Y5=H({sum_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var o=i1(t,n.shape);return E3(function(a){var i=Mt(o,a.rank),c=o,s=a;i!=null&&(s=a.transpose(i),c=Ct(c.length,a.rank));var l=function(d){var p=a.shape.slice();return o.forEach(function(v){p[v]=1}),d.reshape(p).mul(W4(a.shape,"float32"))},u={axes:c},h=T.runKernelFunc(function(d){return d.sum(s,c)},{x:s},function(d){return{x:function(){return l(d)}}},"Sum",u);if(e){var f=W1(h.shape,o);h=h.reshape(f)}return{value:h,gradFunc:l}})(n)}}),$v=H({prod_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=C(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var o=i1(t,n.shape),a=Mt(o,n.rank),i=o,c=n;a!=null&&(c=n.transpose(a),i=Ct(i.length,n.rank));var s=T.runKernelFunc(function(u){return u.prod(c,i)},{permutedX:c});if(e){var l=W1(s.shape,o);s=s.reshape(l)}return s}}),Z5=H({elu_:function(r){var t=C(r,"x","elu");return T.runKernelFunc(function(e,n){var o=e.elu(t);return n([o]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){return T.runKernelFunc(function(a){return a.eluDer(e,o)},{dy:e,y:o})}}})}}),Kv=H({leakyRelu_:function(r,t){t===void 0&&(t=.2);var e=C(r,"x","leakyRelu");return s6(K(t).mul(e),e)}}),Q5=H({prelu_:function(r,t){var e=C(r,"x","prelu"),n=C(t,"alpha","prelu");return T.runKernelFunc(function(o,a){var i=o.prelu(e,n);return a([e,n]),i},{x:e,alpha:n},function(o,a){var i=a[0],c=a[1],s=i.greater(0);return{x:function(){return o4(s,o,o.mul(c))},alpha:function(){var l=o4(s,Ee(o),o.mul(i)),u=a1(c.shape,o.shape);return u.length>0&&(l=l.sum(u)),l.reshape(c.shape)}}},"Prelu")}}),Te=H({relu_:function(r){var t=C(r,"x","relu");return t.dtype==="bool"?t.toInt():T.runKernelFunc(function(e,n){var o=e.relu(t);return n([t]),o},{x:t},function(e,n){var o=n[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),J5=H({relu6_:function(r){var t=C(r,"x","relu6");return t.dtype==="bool"?t.toInt():T.runKernelFunc(function(e,n){var o=e.relu6(t);return n([t]),o},{x:t},function(e,n){var o=n[0],a=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(a.toFloat())}}},"Relu6")}}),Xv=H({selu_:function(r){var t=C(r,"x","selu");return T.runKernelFunc(function(e,n){var o=e.selu(t);return n([t]),o},{$x:t},function(e,n){var o=n[0];return{$x:function(){var a=o.greater(K(0)),i=K(o6),c=K(a6),s=e.mul(c),l=e.mul(i).mul(o.toFloat().exp());return o4(a,s,l)}}})}}),dt=H({transpose_:function(r,t){var e=C(r,"x","transpose");if(t==null&&(t=e.shape.map(function(o,a){return a}).reverse()),E(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(o){E(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1)return e.clone();var n={perm:t};return T.runKernelFunc(function(o){return o.transpose(e,t)},{x:e},function(o){var a=z3(t);return{x:function(){return o.transpose(a)}}},"Transpose",n)}}),Yv=H({localResponseNormalization_:function(r,t,e,n,o){t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=.5);var a=C(r,"x","localResponseNormalization");E(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),E(Ke(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,c=!1;a.rank===3&&(c=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var s=T.runKernelFunc(function(l,u){var h=l.localResponseNormalization4D(i,t,e,n,o);return u([i,h]),h},{x4D:i},function(l,u){var h=u[0],f=u[1];return{x4D:function(){return T.runKernelFunc(function(d){return d.LRNGrad(l,h,f,t,e,n,o)},{})}}});return c?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),e7=H({norm_:function(r,t,e,n){t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1);var o=function c(s,l,u){if(u===void 0&&(u=null),s.rank===0)return s.abs();if(s.rank!==1&&u===null)return c(s.reshape([-1]),l,u);if(s.rank===1||typeof u=="number"||Array.isArray(u)&&u.length===1){if(l===1)return s.abs().sum(u);if(l===1/0)return s.abs().max(u);if(l===-1/0)return s.abs().min(u);if(l==="euclidean"||l===2)return s.abs().pow(K(2,"int32")).sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(u)&&u.length===2){if(l===1)return s.abs().sum(u[0]).max(u[1]-1);if(l===1/0)return s.abs().sum(u[1]).max(u[0]);if(l===-1/0)return s.abs().sum(u[1]).min(u[0]);if(l==="fro"||l==="euclidean")return s.square().sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+u)}(r=C(r,"x","norm"),t,e),a=o.shape;if(n){var i=i1(e,r.shape);a=W1(o.shape,i)}return o.reshape(a)}}),Zv=H({basicLSTMCell_:function(r,t,e,n,o,a){var i=C(r,"forgetBias","basicLSTMCell"),c=C(t,"lstmKernel","basicLSTMCell"),s=C(e,"lstmBias","basicLSTMCell"),l=C(n,"data","basicLSTMCell"),u=C(o,"c","basicLSTMCell"),h=C(a,"h","basicLSTMCell"),f=l.concat(h,1).matMul(c).add(s),d=f.shape[0],p=f.shape[1]/4,v=[d,p],m=f.slice([0,0],v),g=f.slice([0,p],v),b=f.slice([0,2*p],v),y=f.slice([0,3*p],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(u.mulStrict(i.add(b).sigmoid())),w=x.tanh().mulStrict(y.sigmoid());return[x,w]}}),Qv=H({multiRNNCell_:function(r,t,e,n){for(var o=C(t,"data","multiRNNCell"),a=h3(e,"c","multiRNNCell"),i=h3(n,"h","multiRNNCell"),c=o,s=[],l=0;l<r.length;l++){var u=r[l](c,a[l],i[l]);s.push(u[0]),s.push(u[1]),c=u[1]}var h=[],f=[];for(l=0;l<s.length;l+=2)h.push(s[l]),f.push(s[l+1]);return[h,f]}}),Jv=H({movingAverage_:function(r,t,e,n,o){o===void 0&&(o=!0);var a=C(r,"v","movingAverage"),i=C(t,"x","movingAverage"),c=C(e,"decay","movingAverage");is(a,i),E(o1(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var s=K(1),l=s.sub(c),u=i.sub(a).mul(l);if(o){E(n!=null,function(){return"When using zeroDebias: true, step is required."});var h=C(n,"step","movingAverage");u=u.div(s.sub(x3(c,h)))}return a.add(u)}}),em=H({stridedSlice_:function(r,t,e,n,o,a,i,c,s){if(o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),c===void 0&&(c=0),s===void 0&&(s=0),n==null&&(n=new Array(t.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var l=C(r,"x","stridedSlice"),u=Ho(c),h=l.shape.slice();u.forEach(function(m){t[m]=0,e[m]=1,h.splice(m,0,1)}),l=l.reshape(h);for(var f=0;f<l.rank;f++)t[f]=$s(o,t,n,l.shape,f),e[f]=Ks(a,e,n,l.shape,f),n[f]=n[f]||1;var d=Ho(s);d.forEach(function(m){e[m]=t[m]+1,n[m]=1});var p=_3(t,e,n),v=p.filter(function(m,g){return d.indexOf(g)===-1});return n.every(function(m){return m===1})?wt(l,t,p).reshape(v):T.runKernelFunc(function(m){return m.stridedSlice(l,t,e,n)},{$x:l}).reshape(v)}}),tm=H({topk_:function(r,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var n=C(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=n.shape[n.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=T.runKernelFunc(function(i){return i.topk(n,t,e)},{$x:n});return{values:a[0],indices:a[1]}}}),nm=H({scatterND_:function(r,t,e){var n=C(r,"indices","scatterND","int32"),o=C(t,"updates","scatterND");return qs(o,n,e),T.runKernelFunc(function(a){return a.scatterND(n,o,e)},{indices:n,updates:o},null,"ScatterNd",{shape:e})}}),f6=H({fft_:function(r){E(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return T.runKernelFunc(function(o){return o.fft(n)},{input:r}).reshape(r.shape)}}),b3=H({ifft_:function(r){E(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return T.runKernelFunc(function(o){return o.ifft(n)},{input:r}).reshape(r.shape)}}),d6=H({rfft_:function(r,t){E(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var e,n=r.shape[r.shape.length-1],o=r.size/n;if(t!=null&&t<n){var a=r.shape.map(function(g){return 0}),i=r.shape.map(function(g){return g});i[r.shape.length-1]=t,e=r.slice(a,i),n=t}else if(t!=null&&t>n){var c=r.shape.map(function(g){return g});c[r.shape.length-1]=t-n,e=r.concat(Oe(c),r.shape.length-1),n=t}else e=r;var s=e.zerosLike(),l=E1(e,s).as2D(o,n),u=f6(l),h=Math.floor(n/2)+1,f=ht(u),d=It(u),p=f.split([h,n-h],f.shape.length-1),v=d.split([h,n-h],d.shape.length-1),m=e.shape.slice();return m[e.shape.length-1]=h,E1(p[0],v[0]).reshape(m)}}),t7=H({irfft_:function(r){var t=r.shape[r.shape.length-1],e=r.size/t;if(t<=2){var n=r.as2D(e,t),o=b3(n);return ht(o)}var a=[e,2*(t-1)],i=ht(r).as2D(e,t),c=It(r).as2D(e,t),s=i.slice([0,1],[e,t-2]).reverse(1),l=c.slice([0,1],[e,t-2]).reverse(1).mul(K(-1)),u=i.concat(s,1),h=c.concat(l,1);return n=E1(u,h).as2D(a[0],a[1]),o=b3(n),ht(o)}}),rm=Object.freeze({fft:f6,ifft:b3,rfft:d6,irfft:t7}),om=H({sparseToDense_:function(r,t,e,n){n===void 0&&(n=0);var o=C(r,"sparseIndices","sparseToDense","int32"),a=C(t,"sparseValues","sparseToDense"),i=C(n,"defaultValue","sparseToDense",a.dtype);return function(c,s,l,u){if(c.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+c.dtype+".");if(c.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+c.shape+".");var h=c.rank>0?c.shape[0]:1,f=c.rank>1?c.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=s.size;if(s.rank!==0&&(s.rank!==1||d!==h))throw new Error("sparseValues has incorrect shape "+s.shape+", should be [] or ["+h+"]");if(s.dtype!==u.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,e,i),T.runKernelFunc(function(c){return c.sparseToDense(o,a,e,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),am=H({gatherND_:function(r,t){var e=C(t,"indices","gatherND","int32"),n=C(r,"x","gatherND");return T.runKernelFunc(function(o){return o.gatherND(n,e)},{x:n,indices:e},null,"GatherNd")}}),im=H({diag_:function(r){var t=C(r,"x","diag").flatten(),e=r.shape.concat(r.shape);return T.runKernelFunc(function(n){return n.diag(t)},{$x:t}).reshape(e)}}),cm=H({dropout_:function(r,t,e,n){var o=C(r,"x","dropout");if(E(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),E(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return r instanceof Ie?o.clone():o;var a=function(s,l){if(l==null)return s.shape.slice();if(o1(s.shape,l))return l;if(s.shape.length===l.length){for(var u=[],h=0;h<s.shape.length;h++)l[h]==null&&s.shape[h]!=null?u.push(s.shape[h]):u.push(l[h]);return u}return l}(o,e),i=1-t,c=Os(a,0,1,"float32",n).add(i).floor().div(i);return o.mul(c)}});function n7(r,t,e){for(var n=1-r%2,o=new Float32Array(r),a=0;a<r;++a){var i=2*Math.PI*a/(r+n-1);o[a]=t-e*Math.cos(i)}return Re(o,"float32")}var p6=H({hannWindow_:function(r){return n7(r,.5,.5)}}),r7=H({hammingWindow_:function(r){return n7(r,.54,.46)}}),v6=H({frame_:function(r,t,e,n,o){n===void 0&&(n=!1),o===void 0&&(o=0);for(var a=0,i=[];a+t<=r.size;)i.push(wt(r,a,t)),a+=e;if(n)for(;a<r.size;){var c=a+t-r.size,s=Ue([wt(r,a,t-c),lt([c],o)]);i.push(s),a+=e}return i.length===0?Bt([],[0,t]):Ue(i).as2D(i.length,t)}}),o7=H({stft_:function(r,t,e,n,o){var a;o===void 0&&(o=p6),n==null&&(a=t,n=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=v6(r,t,e),c=$e(i,o(t)),s=[],l=0;l<i.shape[0];l++)s.push(d6(c.slice([l,0],[1,t]),n));return Ue(s)}}),sm=Object.freeze({hannWindow:p6,hammingWindow:r7,frame:v6,stft:o7}),R1,lm=function(r,t,e){return e===void 0&&(e=1),Q(this,void 0,void 0,function(){var n,o,a,i,c,s,l,u,h,f,d,p,v,m;return J(this,function(g){switch(g.label){case 0:return n=C(r,"predictions","inTopK"),o=C(t,"targets","inTopK"),E(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),E(n.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+o.rank}),He(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],E(e>0&&e<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+e}),[4,n.data()];case 1:return i=g.sent(),[4,o.data()];case 2:for(c=g.sent(),s=[i.length/a,a],u=s[1],h=R4("bool",l=s[0]),f=0;f<l;f++){for(d=f*u,p=i.subarray(d,d+u),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(b,y){return y.value-b.value}),h[f]=0,m=0;m<e;m++)if(v[m].index===c[f]){h[f]=1;break}}return r!==n&&n.dispose(),t!==o&&o.dispose(),[2,g1(h,o.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(R1||(R1={}));var um=H({absoluteDifference_:function(r,t,e,n){n===void 0&&(n=R1.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","absoluteDifference"),a=C(t,"predictions","absoluteDifference"),i=null;e!=null&&(i=C(e,"weights","absoluteDifference")),He(o.shape,a.shape,"Error in absoluteDifference: ");var c=o.sub(a).abs();return sn(c,i,n)}}),sn=H({computeWeightedLoss_:function(r,t,e){e===void 0&&(e=R1.SUM_BY_NONZERO_WEIGHTS);var n=C(r,"losses","computeWeightedLoss"),o=null;t!=null&&(o=C(t,"weights","computeWeightedLoss"));var a=o==null?n:n.mul(o);if(e===R1.NONE)return a;if(e===R1.SUM)return a.sum();if(e===R1.MEAN){if(o==null)return a.mean();var i=n.size/o.size,c=a.sum().div(o.sum());return i>1?c.div(K(i)):c}if(e===R1.SUM_BY_NONZERO_WEIGHTS){if(o==null)return a.sum().div(K(n.size));var s=o.mul(W4(n.shape)).notEqual(K(0)).sum().toFloat();return a.sum().div(s)}throw Error("Unknown reduction: "+e)}}),hm=H({cosineDistance_:function(r,t,e,n,o){o===void 0&&(o=R1.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","cosineDistance"),i=C(t,"predictions","cosineDistance"),c=null;n!=null&&(c=C(n,"weights","cosineDistance")),He(a.shape,i.shape,"Error in cosineDistance: ");var s=K(1).sub(a.mul(i).sum(e,!0));return sn(s,c,o)}}),fm=H({hingeLoss_:function(r,t,e,n){n===void 0&&(n=R1.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","hingeLoss"),a=C(t,"predictions","hingeLoss"),i=null;e!=null&&(i=C(e,"weights","hingeLoss")),He(o.shape,a.shape,"Error in hingeLoss: ");var c=K(1);o=K(2).mul(o).sub(c);var s=c.sub(o.mul(a)).relu();return sn(s,i,n)}}),dm=H({huberLoss_:function(r,t,e,n,o){n===void 0&&(n=1),o===void 0&&(o=R1.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","huberLoss"),i=C(t,"predictions","huberLoss"),c=null;e!=null&&(c=C(e,"weights","huberLoss")),He(a.shape,i.shape,"Error in huberLoss: ");var s=K(n),l=i.sub(a).abs(),u=R5(l,s),h=l.sub(u),f=K(.5).mul(u.square()).add(s.mul(h));return sn(f,c,o)}}),pm=H({logLoss_:function(r,t,e,n,o){n===void 0&&(n=1e-7),o===void 0&&(o=R1.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","logLoss"),i=C(t,"predictions","logLoss"),c=null;e!=null&&(c=C(e,"weights","logLoss")),He(a.shape,i.shape,"Error in logLoss: ");var s=K(1),l=K(n),u=a.mul(i.add(l).log()).neg().sub(s.sub(a).mul(s.sub(i).add(l).log()));return sn(u,c,o)}}),vm=H({meanSquaredError_:function(r,t,e,n){n===void 0&&(n=R1.SUM_BY_NONZERO_WEIGHTS);var o=C(r,"labels","meanSquaredError"),a=C(t,"predictions","meanSquaredError"),i=null;e!=null&&(i=C(e,"weights","meanSquaredError")),He(o.shape,a.shape,"Error in meanSquaredError: ");var c=o.squaredDifference(a);return sn(c,i,n)}}),mm=H({sigmoidCrossEntropy_:function(r,t,e,n,o){n===void 0&&(n=0),o===void 0&&(o=R1.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"multiClassLabels","sigmoidCrossEntropy"),i=C(t,"logits","sigmoidCrossEntropy"),c=null;if(e!=null&&(c=C(e,"weights","sigmoidCrossEntropy")),He(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),n>0){var s=K(n),l=K(1),u=K(.5);a=a.mul(l.sub(s)).add(u.mul(s))}var h=function(f,d){var p=C(f,"labels","sigmoidCrossEntropyWithLogits"),v=C(d,"logits","sigmoidCrossEntropyWithLogits");He(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=v.relu(),g=v.mul(p),b=v.abs().neg().exp().log1p();return m.sub(g).add(b)}(a,i);return sn(h,c,o)}}),gm=H({softmaxCrossEntropy_:function(r,t,e,n,o){n===void 0&&(n=0),o===void 0&&(o=R1.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"onehotLabels","softmaxCrossEntropy"),i=C(t,"logits","softmaxCrossEntropy"),c=null;if(e!=null&&(c=C(e,"weights","softmaxCrossEntropy")),He(a.shape,i.shape,"Error in softmaxCrossEntropy: "),n>0){var s=K(n),l=K(1),u=K(a.shape[1]);a=a.mul(l.sub(s)).add(s.div(u))}var h=function(f,d,p){if(p===void 0&&(p=-1),p===-1&&(p=d.rank-1),p!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+p);return E3(function(v,m,g){var b=m.logSumExp([p],!0),y=m.toFloat().sub(b);return g([v,y]),{value:y.mul(v).neg().sum([p]),gradFunc:function(x,w){var z=w[0],M=w[1],_=W1(x.shape,[p]);return[x.reshape(_).mul(z.toFloat().sub(M.exp())),x.reshape(_).mul(M.exp().sub(z.toFloat()))]}}})(f,d)}(a,i);return sn(h,c,o)}}),xm=Object.freeze({get Reduction(){return R1},absoluteDifference:um,computeWeightedLoss:sn,cosineDistance:hm,hingeLoss:fm,huberLoss:dm,logLoss:pm,meanSquaredError:vm,sigmoidCrossEntropy:mm,softmaxCrossEntropy:gm});function Lc(r,t){return t===void 0&&(t=!1),T.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],n=r.shape[1],o=Rs(e),a=r.clone(),i=Bt([[1]],[1,1]),c=i.clone(),s=e>=n?n:e,l=function(h){var f,d=a,p=c,v=o;f=T.tidy(function(){var m=a.slice([h,h],[e-h,1]),g=m.norm(),b=a.slice([h,h],[1,1]),y=Bt([[-1]]).where(b.greater(0),Bt([[1]])),x=b.sub(y.mul(g)),w=m.div(x);c=w.shape[0]===1?i.clone():i.concat(w.slice([1,0],[w.shape[0]-1,w.shape[1]]),0);var z=y.matMul(x).div(g).neg(),M=a.slice([h,0],[e-h,n]),_=z.mul(c);if(h===0)a=M.sub(_.matMul(c.transpose().matMul(M)));else{var S=M.sub(_.matMul(c.transpose().matMul(M)));a=a.slice([0,0],[h,n]).concat(S,0)}var k=o.slice([0,h],[e,o.shape[1]-h]);if(h===0)o=k.sub(k.matMul(c).matMul(_.transpose()));else{var L=k.sub(k.matMul(c).matMul(_.transpose()));o=o.slice([0,0],[e,h]).concat(L,1)}return[c,a,o]}),c=f[0],a=f[1],o=f[2],Z1([d,p,v])},u=0;u<s;++u)l(u);return!t&&e>n&&(o=o.slice([0,0],[e,n]),a=a.slice([0,0],[n,n])),[o,a]})}var bm=H({bandPart_:function(r,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var n=C(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var o=n.shape,a=n.shape.slice(-2),i=a[0],c=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(e<=c))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+c+").");t<0&&(t=i),e<0&&(e=c);var s=f3(0,i,1,"int32").reshape([-1,1]),l=f3(0,c,1,"int32"),u=Be(s,l),h=V3(u.lessEqual(K(+t,"int32")),u.greaterEqual(K(-e,"int32"))),f=Oe([i,c],n.dtype);return H1(Le(n.reshape([-1,i,c])).map(function(d){return o4(h,d,f)})).reshape(o)}}),ym=H({gramSchmidt_:function(r){var t;if(Array.isArray(r)){t=!1,E(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=r[0].shape[0],n=function(s){E(r[s].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[s].shape[0]+" vs. "+e+")"})},o=1;o<r.length;++o)n(o)}else t=!0,r=qo(r,r.shape[0],0).map(function(s){return Ps(s,[0])});E(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var a=[],i=r,c=function(s){a.push(T.tidy(function(){var l=i[s];if(s>0)for(var u=0;u<s;++u){var h=Y5(a[u].mulStrict(l)).mul(a[u]);l=l.sub(h)}return l.div(e7(l,"euclidean"))}))};for(o=0;o<r.length;++o)c(o);return t?H1(a,0):a}}),wm=H({qr_:function(r,t){if(t===void 0&&(t=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return Lc(r,t);var e=r.shape.slice(0,r.shape.length-2).reduce(function(i,c){return i*c}),n=Le(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],a=[];return n.forEach(function(i){var c=Lc(i,t),s=c[0],l=c[1];o.push(s),a.push(l)}),[H1(o,0).reshape(r.shape),H1(a,0).reshape(r.shape)]}}),zm=Object.freeze({bandPart:bm,gramSchmidt:ym,qr:wm});function T3(r,t,e,n,o,a){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);var i=r.shape[0];return e=Math.min(e,i),E(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),E(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),E(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),E(t.rank===1,function(){return"scores must be a 1D tensor"}),E(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),E(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:e,iouThreshold:n,scoreThreshold:o,softNmsSigma:a}}var Mm=H({resizeBilinear_:function(r,t,e){e===void 0&&(e=!1);var n=C(r,"images","resizeBilinear");E(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),E(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=n,a=!1;n.rank===3&&(a=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=t[0],c=t[1],s=T.runKernelFunc(function(l,u){return u([o]),l.resizeBilinear(o,i,c,e)},{x:o},function(l,u){return{x:function(){return T.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,u[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:i,newWidth:c});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Cm=H({resizeNearestNeighbor_:function(r,t,e){e===void 0&&(e=!1);var n=C(r,"images","resizeNearestNeighbor");E(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),E(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),E(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=n,a=!1;n.rank===3&&(a=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=t[0],c=t[1],s=T.runKernelFunc(function(l,u){return u([o]),l.resizeNearestNeighbor(o,i,c,e)},{batchImages:o},function(l,u){return{batchImages:function(){return T.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,u[0],e)},{})}}});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),_m=H({nonMaxSuppression_:function(r,t,e,n,o){n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var a=C(r,"boxes","nonMaxSuppression"),i=C(t,"scores","nonMaxSuppression"),c=T3(a,i,e,n,o);e=c.maxOutputSize,n=c.iouThreshold,o=c.scoreThreshold;var s={maxOutputSize:e,iouThreshold:n,scoreThreshold:o};return T.runKernelFunc(function(l){return l.nonMaxSuppression(a,i,e,n,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",s)}}),Em=function(r,t,e,n,o){return n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Q(this,void 0,void 0,function(){var a,i,c,s,l,u,h;return J(this,function(f){switch(f.label){case 0:return a=C(r,"boxes","nonMaxSuppressionAsync"),i=C(t,"scores","nonMaxSuppressionAsync"),c=T3(a,i,e,n,o),e=c.maxOutputSize,n=c.iouThreshold,o=c.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return s=f.sent(),l=s[0],u=s[1],h=e6(l,u,e,n,o),a!==r&&a.dispose(),i!==t&&i.dispose(),[2,h]}})})},Sm=H({nonMaxSuppressionWithScore_:function(r,t,e,n,o,a){n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var i=C(r,"boxes","nonMaxSuppression"),c=C(t,"scores","nonMaxSuppression"),s=T3(i,c,e,n,o,a),l={maxOutputSize:e=s.maxOutputSize,iouThreshold:n=s.iouThreshold,scoreThreshold:o=s.scoreThreshold,softNmsSigma:a=s.softNmsSigma},u=T.runKernel("NonMaxSuppressionV5",{boxes:i,scores:c},l);return{selectedIndices:u[0],selectedScores:u[1]}}}),km=function(r,t,e,n,o,a){return n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),Q(this,void 0,void 0,function(){var i,c,s,l,u,h,f;return J(this,function(d){switch(d.label){case 0:return i=C(r,"boxes","nonMaxSuppressionAsync"),c=C(t,"scores","nonMaxSuppressionAsync"),s=T3(i,c,e,n,o,a),e=s.maxOutputSize,n=s.iouThreshold,o=s.scoreThreshold,a=s.softNmsSigma,[4,Promise.all([i.data(),c.data()])];case 1:return l=d.sent(),u=l[0],h=l[1],f=t6(u,h,e,n,o,a),i!==r&&i.dispose(),c!==t&&c.dispose(),[2,f]}})})},Hm=H({cropAndResize_:function(r,t,e,n,o,a){var i=C(r,"image","cropAndResize"),c=C(t,"boxes","cropAndResize","float32"),s=C(e,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=c.shape[0];return E(i.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),E(c.rank===2&&c.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+c.shape+"."}),E(s.rank===1&&s.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+c.shape+"."}),E(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),E(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),E(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),T.runKernelFunc(function(u,h){return u.cropAndResize(i,c,s,n,o,a)},{images:i,boxes:c,boxInd:s},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:n})}}),tr=Object.freeze({resizeBilinear:Mm,resizeNearestNeighbor:Cm,nonMaxSuppression:_m,nonMaxSuppressionAsync:Em,nonMaxSuppressionWithScore:Sm,nonMaxSuppressionWithScoreAsync:km,cropAndResize:Hm}),m6=function(r,t){return!(r>0)||t==="linear"},g6=function(r,t,e){if(e==null||e==="linear")return r;if(e==="relu")return r.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},x6=function(r,t){var e=t,n=a1(r.shape,t.shape);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b6=function(r,t,e){if(t==="linear")return r;if(t==="relu")return Te(r);if(t==="elu")return Z5(r);if(t==="relu6")return J5(r);if(t==="prelu")return Q5(r,e);throw new Error("Unknown fused activation "+t+".")},Vm=H({fusedMatMul_:function(r){var t,e=r.a,n=r.b,o=r.transposeA,a=o!==void 0&&o,i=r.transposeB,c=i!==void 0&&i,s=r.bias,l=r.activation,u=l===void 0?"linear":l,h=r.preluActivationWeights;if(m6(T.state.gradientDepth,u)===!1){var f=U4(e,n,a,c);return s!=null&&(f=ce(f,s)),b6(f,u,h)}var d=C(e,"a","fused matMul"),p=C(n,"b","fused matMul");t=Ge(d,p),d=t[0],p=t[1];var v=a?d.shape[d.rank-2]:d.shape[d.rank-1],m=c?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?d.shape[d.rank-1]:d.shape[d.rank-2],b=c?p.shape[p.rank-2]:p.shape[p.rank-1],y=d.shape.slice(0,-2),x=p.shape.slice(0,-2),w=te(y),z=te(x);E(d.rank>=2&&p.rank>=2&&d.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."}),E(o1(y,x),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."}),E(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+c+" must match."});var M,_,S=d.shape.slice(0,-2).concat([g,b]),k=a?d.as3D(w,v,g):d.as3D(w,g,v),L=c?p.as3D(z,b,m):p.as3D(z,m,b);s!=null&&xe(S,(M=Ge(M=C(s,"bias","fused matMul"),d)[0]).shape),h!=null&&(_=C(h,"prelu weights","fused matMul"));var V={a:k,b:L};s!=null&&(V.bias=M),h!=null&&(V.preluActivationWeights=_);var I=[k,L];return T.runKernelFunc(function(D,R){var P=D.fusedBatchMatMul({a:k,b:L,transposeA:a,transposeB:c,bias:M,activation:u,preluActivationWeights:_});return R([k,L,P]),P},V,function(D,R){var P=R[0],N=R[1],O=R[2],G=g6(D,O,u),q={};return s!=null&&(q={bias:function(){return x6(M,G)}}),Object.assign(a||c?!a&&c?{a:function(){return G.matMul(N,!1,!1)},b:function(){return G.matMul(P,!0,!1)}}:a&&!c?{a:function(){return N.matMul(G,!1,!0)},b:function(){return P.matMul(G,!1,!1)}}:{a:function(){return N.matMul(G,!0,!0)},b:function(){return G.matMul(P,!0,!0)}}:{a:function(){return G.matMul(N,!1,!0)},b:function(){return P.matMul(G,!0,!1)}},q)},"_FusedMatMul",{transposeA:a,transposeB:c,activation:u},I,[!0]).reshape(S)}}),Tm=H({fusedConv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,o=r.pad,a=r.dataFormat,i=a===void 0?"NHWC":a,c=r.dilations,s=c===void 0?[1,1]:c,l=r.dimRoundingMode,u=r.bias,h=r.activation,f=h===void 0?"linear":h,d=r.preluActivationWeights;if(f=f||"linear",m6(T.state.gradientDepth,f)===!1){var p=x1(t,e,n,o,i,s,l);return u!=null&&(p=ce(p,u)),b6(p,f,d)}var v=C(t,"x","conv2d"),m=C(e,"filter","conv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),E(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),E(m.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),l!=null&&E(Ke(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),E(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),E(U1(n,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),E(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var y,x,w=Tn(g.shape,m.shape,n,s,o,l);u!=null&&(y=Ge(y=C(u,"bias","fused conv2d"),v)[0],xe(w.outShape,y.shape)),d!=null&&(x=C(d,"prelu weights","fused conv2d"));var z={x:g,filter:m};u!=null&&(z.bias=y),d!=null&&(z.preluActivationWeights=x);var M=[m,g],_=T.runKernelFunc(function(S,k){var L=S.fusedConv2d({input:g,filter:m,convInfo:w,bias:y,activation:f,preluActivationWeights:x});return k([m,g,L]),L},z,function(S,k){var L=k,V=L[0],I=L[1],D=L[2],R=g6(S,D,f);E(r4(s),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var P={};return u!=null&&(P={bias:function(){return x6(y,R)}}),Object.assign({x:function(){return G5(I.shape,R,V,n,o)},filter:function(){return u6(I,R,V.shape,n,o)}},P)},"FusedConv2D",{convInfo:w,activation:f},M,[!0]);return b?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),Lm=H({fusedDepthwiseConv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,o=r.pad,a=r.dataFormat,i=a===void 0?"NHWC":a,c=r.dilations,s=c===void 0?[1,1]:c,l=r.dimRoundingMode,u=r.bias,h=r.activation,f=h===void 0?"linear":h,d=r.preluActivationWeights;if(m6(T.state.gradientDepth,f)===!1){var p=Q2(t,e,n,o,i,s,l);return u!=null&&(p=ce(p,u)),b6(p,f,d)}var v=C(t,"x","depthwiseConv2d"),m=C(e,"filter","depthwiseConv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),E(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),E(m.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),E(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),s==null&&(s=[1,1]),E(U1(n,s),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),l!=null&&E(Ke(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var y,x,w=Tn(g.shape,m.shape,n,s,o,l,!0);u!=null&&(y=Ge(y=C(u,"bias","fused conv2d"),v)[0],xe(w.outShape,y.shape)),d!=null&&(x=C(d,"prelu weights","fused depthwiseConv2d"));var z={x:g,filter:m};u!=null&&(z.bias=y),d!=null&&(z.preluActivationWeights=x);var M=[m,g],_=T.runKernelFunc(function(S,k){var L=S.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:y,activation:f,preluActivationWeights:x});return k([m,g,L]),L},z,function(S,k){E(r4(s),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var L=k[0],V=k[1],I=k[2],D=g6(S,I,f),R={};return u!=null&&(R={bias:function(){return x6(y,D)}}),Object.assign({x:function(){return q5(V.shape,D,L,w)},filter:function(){return j5(V,D,L.shape,w)}},R)},"FusedDepthwiseConv2D",{convInfo:w,activation:f},M,[!0]);return b?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),Fm=Object.freeze({matMul:Vm,conv2d:Tm,depthwiseConv2d:Lm}),Am=Object.freeze({image:tr,linalg:zm,losses:xm,spectral:rm,fused:Fm,signal:sm,square:pp,squaredDifference:V5,conv1d:Mv,conv2d:x1,conv3d:Cv,depthwiseConv2d:Q2,separableConv2d:J2,conv2dTranspose:_v,conv3dTranspose:Ev,op:H,batchNormalization2d:Gp,batchNormalization3d:qp,batchNormalization4d:jp,batchNormalization:$p,batchNorm:c6,batchNorm2d:Kp,batchNorm3d:Xp,batchNorm4d:Yp,booleanMaskAsync:zv,complex:E1,real:ht,imag:It,concat:Ue,concat1d:ef,concat2d:tf,concat3d:nf,concat4d:rf,split:qo,matMul:U4,dot:Sv,outerProduct:kv,reverse:er,reverse1d:Hv,reverse2d:Vv,reverse3d:Tv,reverse4d:Lv,maxPool:Xe,avgPool:cn,pool:Fv,maxPool3d:Av,avgPool3d:Dv,slice:wt,slice1d:Iv,slice2d:Bv,slice3d:h6,slice4d:Rv,abs:vp,acos:mp,acosh:gp,asin:xp,asinh:bp,atan:yp,atanh:wp,ceil:zp,clipByValue:X2,cos:Mp,cosh:Cp,erf:_p,exp:k3,expm1:Ep,floor:Sp,log:kp,log1p:Hp,logSigmoid:Vp,neg:Y2,reciprocal:Tp,round:Lp,rsqrt:T5,sigmoid:i6,sign:Fp,isNaN:Ap,isInf:Dp,isFinite:Ip,sin:Bp,sinh:Rp,softplus:Op,sqrt:Np,step:Pp,tan:Wp,tanh:Up,all:Ov,any:Nv,argMax:Pv,argMin:Wv,logSumExp:Uv,max:c4,mean:Gv,min:qv,moments:jv,sum:Y5,prod:$v,equal:O5,equalStrict:fv,greater:dv,greaterEqual:N5,greaterEqualStrict:pv,greaterStrict:vv,less:mv,lessEqual:gv,lessEqualStrict:xv,lessStrict:bv,notEqual:yv,notEqualStrict:wv,add:ce,addN:Jp,addStrict:ev,atan2:tv,div:ft,divNoNan:nv,divStrict:rv,floorDiv:B5,maximum:s6,maximumStrict:ov,minimum:R5,minimumStrict:av,mod:iv,modStrict:cv,mul:$e,mulStrict:sv,pow:x3,powStrict:lv,squaredDifferenceStrict:uv,sub:Be,subStrict:hv,elu:Z5,leakyRelu:Kv,prelu:Q5,relu:Te,relu6:J5,selu:Xv,logicalAnd:V3,logicalNot:Zp,logicalOr:D5,logicalXor:Qp,where:o4,whereAsync:I5,buffer:he,print:df,batchToSpaceND:Bs,broadcastTo:pf,cast:vf,clone:mf,cumsum:gf,depthToSpace:xf,expandDims:I1,eye:Rs,multinomial:bf,oneHot:ko,pad:an,pad1d:yf,pad2d:wf,pad3d:zf,pad4d:Mf,rand:Cf,randomNormal:_f,randomGamma:Ef,randomUniform:Os,reshape:G1,spaceToBatchND:Ns,squeeze:Ps,stack:H1,tile:e4,truncatedNormal:Sf,unstack:Le,setdiff1dAsync:kf,fill:lt,linspace:Jh,ones:W4,range:f3,scalar:K,tensor:g1,tensor1d:Re,tensor2d:Bt,tensor3d:M3,tensor4d:f1,tensor5d:Yh,tensor6d:Zh,variable:Qh,zeros:Oe,onesLike:Is,zerosLike:Ee,transpose:dt,softmax:q1,logSoftmax:Vf,localResponseNormalization:Yv,norm:e7,gather:l6,unsortedSegmentSum:P5,basicLSTMCell:Zv,multiRNNCell:Qv,movingAverage:Jv,stridedSlice:em,topk:tm,scatterND:nm,fft:f6,ifft:b3,rfft:d6,irfft:t7,sparseToDense:om,gatherND:am,diag:im,dropout:cm,hannWindow:p6,hammingWindow:r7,frame:v6,stft:o7,inTopKAsync:lm});function W(r,t){Array.isArray(r)||(r=[r]),r.forEach(function(e){e!=null&&E(e.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function ao(r,t,e,n){if(e==="linear")return r.linear(t);if(e==="relu")return r.relu(t);if(e==="elu")return r.elu(t);if(e==="relu6")return r.relu6(t);if(e==="prelu")return r.prelu(t,n);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var Dm=function(r){function t(){var e=r.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Xs(e,T),e}return zt(t,r),t.prototype.write=function(e,n,o){this.firstUse&&(this.firstUse=!1,B().get("IS_NODE")&&u3(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:e,dtype:o}),a},t.prototype.move=function(e,n,o,a){this.data.set(e,{values:n,dtype:a})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var n=this.data.get(e),o=n.dtype,a=n.complexTensors;return o==="complex64"?To(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var n=this.readSync(e.dataId),o=n;if(e.dtype==="string")try{o=n.map(function(a){return R2(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return he(e.shape,e.dtype,o)},t.prototype.makeOutput=function(e,n,o){var a=this.write(e,n,o);return T.makeTensorFromDataId(a,n,o,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var n=this.data.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Q(this,void 0,void 0,function(){var n;return J(this,function(o){return n=bt(),e(),[2,{kernelMs:bt()-n}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,n){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:T.keep(e.clone()),imag:T.keep(n.clone())},o},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,o){if(W(e,"slice"),Xo(e.shape,n,o)){var a=Yo(n,e.strides),i=te(o);return g1(this.readSync(e.dataId).subarray(a,a+i),o,e.dtype)}for(var c=he(o,e.dtype),s=this.bufferSync(e),l=0;l<c.size;++l){var u=c.indexToLoc(l).map(function(h,f){return h+n[f]});c.values[l]=s.get.apply(s,u)}return c.toTensor()},t.prototype.stridedSlice=function(e,n,o,a){W(e,"stridedSlice");var i=_3(n,o,a);if(i.some(function(d){return d===0}))return g1([],i);for(var c=he(i,e.dtype),s=this.bufferSync(e),l=0;l<c.size;l++){for(var u=c.indexToLoc(l),h=new Array(u.length),f=0;f<h.length;f++)h[f]=u[f]*a[f]+n[f];c.set.apply(c,[s.get.apply(s,h)].concat(u))}return c.toTensor()},t.prototype.diag=function(e){for(var n=this.readSync(e.dataId),o=he([e.size,e.size],e.dtype),a=o.values,i=0;i<n.length;i++)a[i*e.size+i]=n[i];return o.toTensor()},t.prototype.unstack=function(e,n){for(var o=e.shape[n],a=new Array(e.rank-1),i=0,c=0;c<e.rank;c++)c!==n&&(a[i++]=e.shape[c]);var s=new Array(e.rank).fill(0),l=e.shape.slice();l[n]=1;var u=new Array(o);for(c=0;c<u.length;c++)s[n]=c,u[c]=this.slice(e,s,l).reshape(a);return u},t.prototype.reverse=function(e,n){W(e,"reverse");for(var o=he(e.shape,e.dtype),a=this.bufferSync(e),i=function(s){var l=o.indexToLoc(s),u=l.slice();n.forEach(function(h){return u[h]=e.shape[h]-1-u[h]}),o.set.apply(o,[a.get.apply(a,u)].concat(l))},c=0;c<o.size;c++)i(c);return o.toTensor()},t.prototype.concat=function(e,n){var o=this;if(e[0].dtype==="complex64"){var a=e.map(function(d){return ht(d)}),i=e.map(function(d){return It(d)});return E1(this.concat(a,n),this.concat(i,n))}var c=e.map(function(d){var p=te(d.shape.slice(n));return d.as2D(-1,p)}),s=n4(c.map(function(d){return d.shape}),1),l=he(s,e[0].dtype).values;if(c[0].shape[0]===1){var u=0;c.forEach(function(d){l.set(o.readSync(d.dataId),u),u+=d.size})}else{var h=0;c.forEach(function(d){for(var p=o.readSync(d.dataId),v=0,m=0;m<d.shape[0];++m)for(var g=m*s[1]+h,b=0;b<d.shape[1];++b)l[g+b]=p[v++];h+=d.shape[1]})}var f=n4(e.map(function(d){return d.shape}),n);return g1(l,f,e[0].dtype)},t.prototype.neg=function(e){return W(e,"neg"),this.multiply(K(-1),e)},t.prototype.add=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(o,a,i,c){return{real:o+i,imag:a+c}}):this.broadcastedBinaryOp(e,n,m1(e.dtype,n.dtype),function(o,a){return o+a})},t.prototype.addN=function(e){var n=this;W(e,"addN");for(var o=e.map(function(u){return n.readSync(u.dataId)}),a=he(e[0].shape,e[0].dtype),i=a.values,c=0;c<e.length;c++)for(var s=o[c],l=0;l<i.length;l++)i[l]+=s[l];return a.toTensor()},t.prototype.softmax=function(e,n){var o=i1([n],e.shape),a=this.max(e,o),i=W1(a.shape,o),c=this.subtract(e,a.reshape(i)),s=this.exp(c),l=this.sum(s,o).reshape(i);return this.realDivide(s,l)},t.prototype.subtract=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(o,a,i,c){return{real:o-i,imag:a-c}}):this.broadcastedBinaryOp(e,n,m1(e.dtype,n.dtype),function(o,a){return o-a})},t.prototype.pow=function(e,n){return W([e,n],"pow"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){return Math.pow(o,a)})},t.prototype.batchMatMul=function(e,n,o,a){W([e,n],"matMul");for(var i=o?e.shape[1]:e.shape[2],c=o?e.shape[2]:e.shape[1],s=a?n.shape[1]:n.shape[2],l=e.shape[0],u=this.readSync(e.dataId),h=this.readSync(n.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=f[0],p=f[1],v=f[2],m=a?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],g=m[0],b=m[1],y=m[2],x=c*s,w=he([l,c,s],e.dtype),z=w.values,M=this.blockSize,_=0;_<l;_++)for(var S=0;S<c;S+=M)for(var k=0;k<s;k+=M)for(var L=0;L<i;L+=M)for(var V=Math.min(S+M,c),I=Math.min(k+M,s),D=Math.min(L+M,i),R=S;R<V;R++)for(var P=k;P<I;P++){for(var N=0,O=L;O<D;O++)N+=u[_*d+R*p+O*v]*h[O*g+P*b+_*y];z[_*x+(R*s+P)]+=N}return w.toTensor()},t.prototype.fusedBatchMatMul=function(e){var n=e.a,o=e.b,a=e.transposeA,i=e.transposeB,c=e.bias,s=e.activation,l=e.preluActivationWeights,u=this.batchMatMul(n,o,a,i);return c&&(u=this.add(u,c)),s&&(u=ao(this,u,s,l)),u},t.prototype.multiply=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),function(o,a,i,c){return{real:o*i-a*c,imag:o*c+a*i}}):this.broadcastedBinaryOp(e,n,m1(e.dtype,n.dtype),function(o,a){return o*a})},t.prototype.realDivide=function(e,n){return W([e,n],"realDivide"),this.broadcastedBinaryOp(e,n,"float32",function(o,a){return o/a})},t.prototype.floorDiv=function(e,n){return W([e,n],"floorDiv"),this.broadcastedBinaryOp(e,n,"int32",function(o,a){return Math.floor(o/a)})},t.prototype.sum=function(e,n){W(e,"sum"),X1("sum",n,e.rank);for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,m1(e.dtype,"int32")),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=0,p=0;p<s;++p)d+=u[f+p];l[h]=d}return c},t.prototype.prod=function(e,n){W(e,"sum");for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,m1(e.dtype,"int32")),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=1,p=0;p<s;++p)d*=u[f+p];l[h]=d}return c},t.prototype.unsortedSegmentSum=function(e,n,o){W(e,"unsortedSegmentSum");for(var a=[],i=e.rank-n.rank,c=0;c<i;++c)n=n.expandDims(c+1);for(c=0;c<o;++c){var s=K(c,"int32"),l=O5(s,n).asType("float32").mul(e).sum(0);a.push(l)}return H1(a)},t.prototype.argMin=function(e,n){W(e,"argMin");var o=[n];X1("argMin",o,e.rank);for(var a=S1(e.shape,o),i=a[0],c=a[1],s=Oe(i,"int32"),l=te(c),u=this.readSync(s.dataId),h=this.readSync(e.dataId),f=0;f<u.length;++f){for(var d=f*l,p=h[d],v=0,m=0;m<l;++m){var g=h[d+m];g<p&&(p=g,v=m)}u[f]=v}return s},t.prototype.argMax=function(e,n){W(e,"argMax");var o=[n];X1("argMax",o,e.rank);for(var a=S1(e.shape,o),i=a[0],c=a[1],s=Oe(i,"int32"),l=te(c),u=this.readSync(s.dataId),h=this.readSync(e.dataId),f=0;f<u.length;++f){for(var d=f*l,p=h[d],v=0,m=0;m<l;++m){var g=h[d+m];g>p&&(p=g,v=m)}u[f]=v}return s},t.prototype.cumsum=function(e,n,o,a){if(W(e,"cumsum"),n!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+n);for(var i=m1(e.dtype,"int32"),c=Oe(e.shape,i),s=this.readSync(c.dataId),l=this.readSync(e.dataId),u=e.shape[e.rank-1],h=a?function(m,g){return m+u-g-1}:function(m,g){return m+g},f=0;f<l.length;f+=u)for(var d=0;d<u;d++){var p=h(f,d);if(d===0)s[p]=o?0:l[p];else{var v=h(f,d-1);s[p]=o?l[v]+s[v]:l[p]+s[v]}}return c},t.prototype.equal=function(e,n){return W([e,n],"equal"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o===a?1:0})},t.prototype.notEqual=function(e,n){return W([e,n],"notEqual"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o!==a?1:0})},t.prototype.less=function(e,n){return W([e,n],"less"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o<a?1:0})},t.prototype.lessEqual=function(e,n){return W([e,n],"lessEqual"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o<=a?1:0})},t.prototype.greater=function(e,n){return W([e,n],"greater"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o>a?1:0})},t.prototype.greaterEqual=function(e,n){return W([e,n],"greaterEqual"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o>=a?1:0})},t.prototype.logicalNot=function(e){W(e,"logicalNot");for(var n=this.readSync(e.dataId),o=new Uint8Array(n.length),a=0;a<n.length;++a)o[a]=n[a]?0:1;return this.makeOutput(o,e.shape,"bool")},t.prototype.logicalAnd=function(e,n){return W([e,n],"logicalAnd"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o&&a})},t.prototype.logicalOr=function(e,n){return W([e,n],"logicalOr"),this.broadcastedBinaryOp(e,n,"bool",function(o,a){return o||a})},t.prototype.select=function(e,n,o){W([e,n,o],"select");for(var a=this.readSync(e.dataId),i=this.readSync(n.dataId),c=this.readSync(o.dataId),s=Oe(n.shape,m1(n.dtype,o.dtype)),l=this.readSync(s.dataId),u=0,h=e.rank===0||e.rank>1||n.rank===1?1:te(n.shape.slice(1)),f=0;f<a.length;f++)for(var d=0;d<h;d++)a[f]===1?l[u++]=i[f]:l[u++]=c[f];return s},t.prototype.where=function(e){W([e],"where");var n=this.readSync(e.dataId);return n6(e.shape,n)},t.prototype.topk=function(e,n,o){return W(e,"topk"),e5(this.readSync(e.dataId),e.shape,e.dtype,n)},t.prototype.min=function(e,n){W(e,"min"),X1("min",n,e.rank);for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,e.dtype),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=u[f],p=0;p<s;++p){var v=u[f+p];v<d&&(d=v)}l[h]=d}return c},t.prototype.minimum=function(e,n){return W([e,n],"minimum"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){return Math.min(o,a)})},t.prototype.mod=function(e,n){return W([e,n],"mod"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){var i=o%a;return o<0&&a<0||o>=0&&a>=0?i:(i+a)%a})},t.prototype.max=function(e,n){W(e,"max"),X1("max",n,e.rank);for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,e.dtype),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=u[f],p=0;p<s;++p){var v=u[f+p];v>d&&(d=v)}l[h]=d}return c},t.prototype.maximum=function(e,n){return W([e,n],"maximum"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){return Math.max(o,a)})},t.prototype.all=function(e,n){W(e,"all"),X1("all",n,e.rank);for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,e.dtype),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=u[f],p=0;p<s;++p){var v=u[f+p];d=d&&v}l[h]=d}return c},t.prototype.any=function(e,n){W(e,"any"),X1("any",n,e.rank);for(var o=S1(e.shape,n),a=o[0],i=o[1],c=Oe(a,e.dtype),s=te(i),l=this.readSync(c.dataId),u=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*s,d=u[f],p=0;p<s;++p){var v=u[f+p];d=d||v}l[h]=d}return c},t.prototype.squaredDifference=function(e,n){return W([e,n],"squaredDifference"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){var i=o-a;return i*i})},t.prototype.ceil=function(e){W(e,"ceil");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)o[a]=Math.ceil(n[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.floor=function(e){W(e,"floor");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)o[a]=Math.floor(n[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.sign=function(e){W(e,"x");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)n[a]<0?o[a]=-1:n[a]>0?o[a]=1:o[a]=0;return this.makeOutput(o,e.shape,"float32")},t.prototype.isNaN=function(e){W(e,"x");for(var n=this.readSync(e.dataId),o=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isNaN(n[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isInf=function(e){W(e,"x");for(var n=this.readSync(e.dataId),o=new Uint8Array(n.length),a=0;a<n.length;++a)Math.abs(n[a])===1/0&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isFinite=function(e){W(e,"x");for(var n=this.readSync(e.dataId),o=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isFinite(n[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.round=function(e){W(e,"round");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a){var i=Math.floor(n[a]);n[a]-i<.5?o[a]=Math.floor(n[a]):n[a]-i>.5?o[a]=Math.ceil(n[a]):o[a]=i%2==0?i:i+1}return this.makeOutput(o,e.shape,"float32")},t.prototype.exp=function(e){W(e,"exp");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)o[a]=Math.exp(n[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.expm1=function(e){W(e,"expm1");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)o[a]=Math.expm1(n[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.log=function(e){W(e,"log");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a){var i=n[a];o[a]=Math.log(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.log1p=function(e){W(e,"log1p");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a){var i=n[a];o[a]=Math.log1p(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.sqrt=function(e){W(e,"sqrt");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a){var i=n[a];o[a]=Math.sqrt(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.rsqrt=function(e){W(e,"rsqrt");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a){var i=n[a];o[a]=1/Math.sqrt(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.reciprocal=function(e){W(e,"reciprocal");for(var n=this.readSync(e.dataId),o=new Float32Array(n.length),a=0;a<n.length;++a)o[a]=1/n[a];return this.makeOutput(o,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){W(e,"relu");for(var n=Oe(e.shape,e.dtype),o=this.readSync(n.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.max(0,a[i]);return n},t.prototype.relu6=function(e){W(e,"relu");for(var n=Oe(e.shape,e.dtype),o=this.readSync(n.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.min(Math.max(0,a[i]),6);return n},t.prototype.prelu=function(e,n){return W([e,n],"prelu"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){return o<0?a*o:o})},t.prototype.elu=function(e){W(e,"elu");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];n[a]=i>=0?i:Math.exp(i)-1}return this.makeOutput(n,e.shape,"float32")},t.prototype.eluDer=function(e,n){W([e,n],"eluDer");for(var o=new Float32Array(n.size),a=this.readSync(n.dataId),i=this.readSync(e.dataId),c=0;c<a.length;++c){var s=a[c];o[c]=s>=1?i[c]:i[c]*(s+1)}return this.makeOutput(o,n.shape,"float32")},t.prototype.selu=function(e){W(e,"selu");for(var n=o6,o=a6,a=new Float32Array(e.size),i=this.readSync(e.dataId),c=0;c<i.length;++c){var s=i[c];a[c]=s>=0?o*s:n*(Math.exp(s)-1)}return this.makeOutput(a,e.shape,"float32")},t.prototype.clip=function(e,n,o){W(e,"clip");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),c=0;c<i.length;++c){var s=i[c];a[c]=s>o?o:s<n?n:s}return this.makeOutput(a,e.shape,"float32")},t.prototype.abs=function(e){for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.abs(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<e.size;++a){var i=o[2*a],c=o[2*a+1];n[a]=Math.hypot(i,c)}return this.makeOutput(n,e.shape,"float32")},t.prototype.int=function(e){W(e,"int");for(var n=new Int32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=o[a];return this.makeOutput(n,e.shape,"int32")},t.prototype.sigmoid=function(e){W(e,"sigmoid");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=1/(1+Math.exp(-o[a]));return this.makeOutput(n,e.shape,"float32")},t.prototype.softplus=function(e){W(e,"softplus");for(var n=Math.log(11920928955078125e-23)+2,o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var c=a[i]>-n,s=a[i]<n,l=Math.exp(a[i]),u=void 0;u=s?l:c?a[i]:Math.log(1+l),o[i]=u}return this.makeOutput(o,e.shape,"float32")},t.prototype.sin=function(e){W(e,"sin");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.sin(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cos=function(e){W(e,"cos");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.cos(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tan=function(e){W(e,"tan");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.tan(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asin=function(e){W(e,"asin");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.asin(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acos=function(e){W(e,"acos");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.acos(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan=function(e){W(e,"atan");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.atan(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan2=function(e,n){return W([e,n],"atan2"),this.broadcastedBinaryOp(e,n,e.dtype,function(o,a){return Math.atan2(o,a)})},t.prototype.sinh=function(e){W(e,"sinh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.sinh(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cosh=function(e){W(e,"cosh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.cosh(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tanh=function(e){W(e,"tanh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Kc(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asinh=function(e){W(e,"asinh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.asinh(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acosh=function(e){W(e,"acosh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.acosh(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atanh=function(e){W(e,"atanh");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)n[a]=Math.atanh(o[a]);return this.makeOutput(n,e.shape,"float32")},t.prototype.erf=function(e){W(e,"erf");for(var n=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=Math.sign(o[a]),c=Math.abs(o[a]),s=1/(1+.3275911*c);n[a]=i*(1-((((1.061405429*s-1.453152027)*s+1.421413741)*s-.284496736)*s+.254829592)*s*Math.exp(-c*c))}return this.makeOutput(n,e.shape,"float32")},t.prototype.step=function(e,n){n===void 0&&(n=0),W(e,"step");for(var o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var c=a[i];isNaN(c)?o[i]=NaN:o[i]=c>0?1:n}return this.makeOutput(o,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var n=e.input,o=e.filter,a=e.convInfo,i=e.bias,c=e.activation,s=e.preluActivationWeights,l=this.conv2d(n,o,a);return i&&(l=this.add(l,i)),c&&(l=ao(this,l,c,s)),l},t.prototype.conv2d=function(e,n,o){W([e,n],"conv2d");for(var a=o.filterHeight,i=o.filterWidth,c=o.dilationHeight,s=o.dilationWidth,l=o.padInfo.left,u=o.padInfo.top,h=o.dataFormat==="channelsLast",f=he(o.outShape,e.dtype),d=e.strides[0],p=h?e.strides[1]:e.strides[2],v=h?e.strides[2]:1,m=h?1:e.strides[1],g=f.strides[0],b=h?f.strides[1]:f.strides[2],y=h?f.strides[2]:1,x=h?1:f.strides[1],w=this.readSync(e.dataId),z=this.readSync(n.dataId),M=f.values,_=0;_<o.batchSize;++_)for(var S=_*d,k=_*g,L=0;L<o.outHeight;++L)for(var V=k+L*b,I=L*o.strideHeight-u,D=0;D<a;D++){var R=I+D*c;if(!(R<0||R>=o.inHeight))for(var P=D*n.strides[0],N=S+R*p,O=0;O<o.outWidth;++O)for(var G=V+O*y,q=O*o.strideWidth-l,Y=0;Y<i;Y++){var ne=q+Y*s;if(!(ne<0||ne>=o.inWidth))for(var ae=N+ne*v,me=P+Y*n.strides[1],ge=0;ge<o.inChannels;++ge){for(var be=w[ae+ge*m],Ce=0;Ce<o.outChannels;++Ce)M[G+Ce*x]+=be*z[me+Ce];me+=o.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(e,n,o){for(var a=o.filterDepth,i=o.filterHeight,c=o.filterWidth,s=o.dilationDepth,l=o.dilationHeight,u=o.dilationWidth,h=o.padInfo.front,f=o.padInfo.left,d=o.padInfo.top,p=he(o.outShape,e.dtype),v=this.readSync(e.dataId),m=this.readSync(n.dataId),g=p.values,b=0;b<o.batchSize;++b)for(var y=b*e.strides[0],x=b*p.strides[0],w=0;w<o.outDepth;++w)for(var z=x+w*p.strides[1],M=w*o.strideDepth-h,_=0;_<a;_++){var S=M+_*s;if(!(S<0||S>=o.inDepth))for(var k=_*n.strides[0],L=y+S*e.strides[1],V=0;V<o.outHeight;++V)for(var I=z+V*p.strides[2],D=V*o.strideHeight-d,R=0;R<i;R++){var P=D+R*l;if(!(P<0||P>=o.inHeight))for(var N=k+R*n.strides[1],O=L+P*e.strides[2],G=0;G<o.outWidth;++G)for(var q=I+G*o.outChannels,Y=G*o.strideWidth-f,ne=0;ne<c;ne++){var ae=Y+ne*u;if(!(ae<0||ae>=o.inWidth))for(var me=N+ne*n.strides[2],ge=O+ae*o.inChannels,be=me,Ce=0;Ce<o.inChannels;++Ce){for(var ze=v[ge+Ce],_e=0;_e<o.outChannels;++_e)g[q+_e]+=ze*m[be+_e];be+=o.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,n,o){W([e,n],"conv2dDerInput");for(var a=he(o.inShape,"float32"),i=a.values,c=this.readSync(e.dataId),s=this.readSync(n.dataId),l=n.strides,u=l[0],h=l[1],f=l[2],d=o.batchSize,p=o.filterHeight,v=o.filterWidth,m=o.inChannels,g=o.inHeight,b=o.inWidth,y=o.outChannels,x=o.outHeight,w=o.outWidth,z=o.strideHeight,M=o.strideWidth,_=o.dataFormat,S=p-1-o.padInfo.top,k=v-1-o.padInfo.left,L=_==="channelsLast",V=a.strides[0],I=L?a.strides[1]:a.strides[2],D=L?a.strides[2]:1,R=L?1:a.strides[1],P=e.strides[0],N=L?e.strides[1]:e.strides[2],O=L?e.strides[2]:1,G=L?1:e.strides[1],q=0;q<d;++q)for(var Y=0;Y<m;++Y)for(var ne=0;ne<g;++ne)for(var ae=ne-S,me=Math.max(0,Math.ceil(ae/z)),ge=Math.min(x,(p+ae)/z),be=0;be<b;++be){for(var Ce=be-k,ze=Math.max(0,Math.ceil(Ce/M)),_e=Math.min(w,(v+Ce)/M),Qe=0,Me=me;Me<ge;++Me)for(var Ae=Me*z-ae,ke=ze;ke<_e;++ke)for(var Ye=P*q+N*Me+O*ke,qe=u*(p-1-Ae)+h*(v-1-(ke*M-Ce))+f*Y,je=0;je<y;++je)Qe+=c[Ye+G*je]*s[qe+je];i[V*q+I*ne+D*be+R*Y]=Qe}return a.toTensor()},t.prototype.conv3dDerInput=function(e,n,o){for(var a=he(o.inShape,"float32"),i=a.values,c=a.strides,s=c[0],l=c[1],u=c[2],h=c[3],f=this.readSync(e.dataId),d=e.strides,p=d[0],v=d[1],m=d[2],g=d[3],b=this.readSync(n.dataId),y=n.strides,x=y[0],w=y[1],z=y[2],M=y[3],_=o.batchSize,S=o.filterDepth,k=o.filterHeight,L=o.filterWidth,V=o.inChannels,I=o.inDepth,D=o.inHeight,R=o.inWidth,P=o.outChannels,N=o.outDepth,O=o.outHeight,G=o.outWidth,q=o.strideDepth,Y=o.strideHeight,ne=o.strideWidth,ae=S-1-o.padInfo.front,me=k-1-o.padInfo.top,ge=L-1-o.padInfo.left,be=0;be<_;++be)for(var Ce=0;Ce<V;++Ce)for(var ze=0;ze<I;++ze)for(var _e=ze-ae,Qe=Math.max(0,Math.ceil(_e/q)),Me=Math.min(N,(S+_e)/q),Ae=0;Ae<D;++Ae)for(var ke=Ae-me,Ye=Math.max(0,Math.ceil(ke/Y)),qe=Math.min(O,(k+ke)/Y),je=0;je<R;++je){for(var kt=je-ge,Ht=Math.max(0,Math.ceil(kt/ne)),J1=Math.min(G,(L+kt)/ne),g4=0,Gt=Qe;Gt<Me;++Gt)for(var vn=Gt*q-_e,qt=Ye;qt<qe;++qt)for(var x4=qt*Y-ke,jt=Ht;jt<J1;++jt)for(var i0=p*be+v*Gt+m*qt+g*jt,b4=x*(S-1-vn)+w*(k-1-x4)+z*(L-1-(jt*ne-kt))+M*Ce,Vt=0;Vt<P;++Vt)g4+=f[i0+Vt]*b[b4+Vt];i[s*be+l*ze+u*Ae+h*je+Ce]=g4}return a.toTensor()},t.prototype.conv2dDerFilter=function(e,n,o){W([e,n],"conv2dDerFilter");for(var a=o.strideHeight,i=o.strideWidth,c=o.filterHeight,s=o.filterWidth,l=o.dataFormat==="channelsLast",u=he(o.filterShape,"float32"),h=o.padInfo.left,f=o.padInfo.top,d=this.bufferSync(e),p=this.bufferSync(n),v=0;v<c;++v)for(var m=Math.max(0,Math.ceil((f-v)/a)),g=Math.min(o.outHeight,(o.inHeight+f-v)/a),b=0;b<s;++b)for(var y=Math.max(0,Math.ceil((h-b)/i)),x=Math.min(o.outWidth,(o.inWidth+h-b)/i),w=0;w<o.inChannels;++w)for(var z=0;z<o.outChannels;++z){for(var M=0,_=0;_<o.batchSize;++_)for(var S=m;S<g;++S)for(var k=v+S*a-f,L=y;L<x;++L){var V=b+L*i-h;M+=l?d.get(_,k,V,w)*p.get(_,S,L,z):d.get(_,w,k,V)*p.get(_,z,S,L)}u.set(M,v,b,w,z)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,n,o){for(var a=o.strideDepth,i=o.strideHeight,c=o.strideWidth,s=o.filterDepth,l=o.filterHeight,u=o.filterWidth,h=he(o.filterShape,"float32"),f=h.values,d=h.strides,p=d[0],v=d[1],m=d[2],g=d[3],b=this.readSync(n.dataId),y=n.strides,x=y[0],w=y[1],z=y[2],M=y[3],_=this.readSync(e.dataId),S=e.strides,k=S[0],L=S[1],V=S[2],I=S[3],D=o.padInfo.front,R=o.padInfo.left,P=o.padInfo.top,N=0;N<s;++N)for(var O=Math.max(0,Math.ceil((D-N)/a)),G=Math.min(o.outDepth,(o.inDepth+D-N)/a),q=N*p,Y=0;Y<l;++Y)for(var ne=Math.max(0,Math.ceil((P-Y)/i)),ae=Math.min(o.outHeight,(o.inHeight+P-Y)/i),me=Y*v+q,ge=0;ge<u;++ge)for(var be=Math.max(0,Math.ceil((R-ge)/c)),Ce=Math.min(o.outWidth,(o.inWidth+R-ge)/c),ze=ge*m+me,_e=0;_e<o.inChannels;++_e)for(var Qe=_e*g+ze,Me=0;Me<o.outChannels;++Me){for(var Ae=0,ke=0;ke<o.batchSize;++ke)for(var Ye=ke*k,qe=ke*x,je=O;je<G;++je)for(var kt=(N+je*a-D)*L+Ye,Ht=je*w+qe,J1=ne;J1<ae;++J1)for(var g4=(Y+J1*i-P)*V+kt,Gt=J1*z+Ht,vn=be;vn<Ce;++vn){var qt=vn*M+Gt;Ae+=_[(ge+vn*c-R)*I+g4+_e]*b[qt+Me]}f[Qe+Me]=Ae}return h.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var n=e.input,o=e.filter,a=e.convInfo,i=e.bias,c=e.activation,s=e.preluActivationWeights,l=this.depthwiseConv2D(n,o,a);return i&&(l=this.add(l,i)),c&&(l=ao(this,l,c,s)),l},t.prototype.depthwiseConv2D=function(e,n,o){W([e,n],"depthwiseConv2D");for(var a=o.filterHeight,i=o.filterWidth,c=o.dilationHeight,s=o.dilationWidth,l=o.padInfo.left,u=o.padInfo.top,h=o.outChannels/o.inChannels,f=he(o.outShape,e.dtype),d=this.readSync(e.dataId),p=this.readSync(n.dataId),v=f.values,m=0;m<o.batchSize;++m)for(var g=m*e.strides[0],b=m*f.strides[0],y=0;y<o.outHeight;++y)for(var x=b+y*f.strides[1],w=y*o.strideHeight-l,z=0;z<a;++z){var M=w+z*c;if(!(M<0||M>=o.inHeight))for(var _=z*n.strides[0],S=g+M*e.strides[1],k=0;k<o.outWidth;++k)for(var L=x+k*f.strides[2],V=k*o.strideWidth-u,I=0;I<i;++I){var D=V+I*s;if(!(D<0||D>=o.inWidth))for(var R=_+I*n.strides[1],P=S+D*o.inChannels,N=L,O=R,G=0;G<o.inChannels;++G){for(var q=d[P+G],Y=0;Y<h;++Y)v[N+Y]+=q*p[O+Y];N+=h,O+=h}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,n,o){W([e,n],"depthwiseConv2DDerInput");for(var a=he(o.inShape,"float32"),i=a.values,c=a.strides,s=c[0],l=c[1],u=c[2],h=this.readSync(e.dataId),f=e.strides,d=f[0],p=f[1],v=f[2],m=this.readSync(n.dataId),g=n.strides,b=g[0],y=g[1],x=g[2],w=o.batchSize,z=o.filterHeight,M=o.filterWidth,_=o.inChannels,S=o.inHeight,k=o.inWidth,L=o.outChannels,V=o.outHeight,I=o.outWidth,D=o.strideHeight,R=o.strideWidth,P=z-1-o.padInfo.top,N=M-1-o.padInfo.left,O=L/_,G=0;G<w;++G)for(var q=0;q<_;++q)for(var Y=0;Y<S;++Y)for(var ne=Y-P,ae=Math.max(0,Math.ceil(ne/D)),me=Math.min(V,(z+ne)/D),ge=0;ge<k;++ge){for(var be=ge-N,Ce=Math.max(0,Math.ceil(be/R)),ze=Math.min(I,(M+be)/R),_e=0,Qe=ae;Qe<me;++Qe)for(var Me=Qe*D-ne,Ae=Ce;Ae<ze;++Ae)for(var ke=d*G+p*Qe+v*Ae,Ye=b*(z-1-Me)+y*(M-1-(Ae*R-be))+x*q,qe=0;qe<O;++qe)_e+=h[ke+(q*O+qe)]*m[Ye+qe];i[s*G+l*Y+u*ge+q]=_e}return a.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,n,o){W([e,n],"depthwiseConv2DDerFilter");for(var a=o.strideHeight,i=o.strideWidth,c=o.filterHeight,s=o.filterWidth,l=he(o.filterShape,"float32"),u=o.padInfo.left,h=o.padInfo.top,f=o.outChannels/o.inChannels,d=this.bufferSync(e),p=this.bufferSync(n),v=0;v<c;++v)for(var m=Math.max(0,Math.ceil((h-v)/a)),g=Math.min(o.outHeight,(o.inHeight+h-v)/a),b=0;b<s;++b)for(var y=Math.max(0,Math.ceil((u-b)/i)),x=Math.min(o.outWidth,(o.inWidth+u-b)/i),w=0;w<o.outChannels;++w){for(var z=Math.trunc(w/f),M=w%f,_=0,S=0;S<o.batchSize;++S)for(var k=m;k<g;++k)for(var L=v+k*a-h,V=y;V<x;++V){var I=b+V*i-u;_+=d.get(S,L,I,z)*p.get(S,k,V,w)}l.set(_,v,b,z,M)}return l.toTensor()},t.prototype.tile=function(e,n){return W(e,"tile"),Js(this.bufferSync(e),n)},t.prototype.pad=function(e,n,o){W(e,"pad");var a=n.map(function(f,d){return f[0]+e.shape[d]+f[1]}),i=n.map(function(f){return f[0]}),c=this.bufferSync(e),s=he(a,e.dtype);o!==0&&s.values.fill(o);for(var l=0;l<e.size;l++){var u=c.indexToLoc(l),h=u.map(function(f,d){return f+i[d]});s.set.apply(s,[c.get.apply(c,u)].concat(h))}return s.toTensor()},t.prototype.transpose=function(e,n){W(e,"transpose");for(var o=new Array(e.rank),a=0;a<o.length;a++)o[a]=e.shape[n[a]];var i=this.readSync(e.dataId),c=he(o,e.dtype),s=this.bufferSync(e);for(a=0;a<e.size;++a){for(var l=s.indexToLoc(a),u=new Array(l.length),h=0;h<u.length;h++)u[h]=l[n[h]];var f=c.locToIndex(u);c.values[f]=i[a]}return c.toTensor()},t.prototype.gather=function(e,n,o){W([e,n],"gather");var a=e.shape.slice(),i=this.readSync(n.dataId);a[o]=i.length;for(var c=he(a,e.dtype),s=this.bufferSync(e),l=0;l<c.size;++l){var u=c.indexToLoc(l),h=u.slice();h[o]=i[u[o]];var f=s.locToIndex(h);c.values[l]=s.values[f]}return c.toTensor()},t.prototype.batchToSpaceND=function(e,n,o){W([e],"batchToSpaceND");var a=n.reduce(function(h,f){return h*f}),i=d3(e.shape,n,a),c=p3(i.length,n.length),s=v3(e.shape,n,a),l=Ws(o,n.length),u=Us(s,o,n.length);return e.reshape(i).transpose(c).reshape(s).slice(l,u)},t.prototype.spaceToBatchND=function(e,n,o){W([e],"spaceToBatchND");var a=n.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,o);for(var c=1+n.length;c<e.shape.length;++c)i.push([0,0]);var s=e.pad(i),l=d3(s.shape,n,a,!1),u=p3(l.length,n.length,!1),h=v3(s.shape,n,a,!1);return s.reshape(l).transpose(u).reshape(h)},t.prototype.pool=function(e,n,o){W(e,"pool");for(var a=n.strideHeight,i=n.strideWidth,c=n.dilationHeight,s=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,h=n.padInfo.top,f=n.padInfo.left,d=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),v=he(n.outShape,e.dtype),m=v.values,g=n.outShape[1]*n.outShape[2]*n.outShape[3],b=n.outShape[2]*n.outShape[3],y=n.outShape[3],x=0;x<n.batchSize;++x)for(var w=x*g,z=x*e.strides[0],M=0;M<n.inChannels;++M)for(var _=0;_<n.outHeight;++_)for(var S=_*a-h,k=Math.max(0,S),L=Math.min(n.inHeight,l+S),V=w+_*b,I=0;I<n.outWidth;++I){for(var D=I*i-f,R=Math.max(0,D),P=Math.min(n.inWidth,u+D),N=d,O=0,G=0,q=k;q<L;q+=c){for(var Y=z+q*e.strides[1],ne=R;ne<P;ne+=s){var ae=p[Y+ne*e.strides[2]+M];o==="max"&&ae>N?N=ae:o==="avg"&&(O+=ae,G++)}if(isNaN(N))break}m[V+I*y+M]=o==="avg"?O/G:N}return v.toTensor()},t.prototype.maxPool=function(e,n){return this.pool(e,n,"max")},t.prototype.maxPoolPositions=function(e,n){for(var o=he(n.outShape,"int32"),a=n.strideHeight,i=n.strideWidth,c=n.dilationHeight,s=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,h=n.padInfo.top,f=n.padInfo.left,d=this.bufferSync(e),p=0;p<n.batchSize;++p)for(var v=0;v<n.inChannels;++v)for(var m=0;m<n.outHeight;++m){for(var g=m*a-h,b=g;b<0;)b+=c;for(var y=Math.min(n.inHeight,l+g),x=0;x<n.outWidth;++x){for(var w=x*i-f,z=w;z<0;)z+=s;for(var M=Math.min(n.inWidth,u+w),_=Number.NEGATIVE_INFINITY,S=-1,k=b;k<y;k+=c)for(var L=k-g,V=z;V<M;V+=s){var I=V-w,D=d.get(p,k,V,v);D>_&&(_=D,S=L*u+I)}o.set(S,p,m,x,v)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(e,n,o,a){W([n,o],"maxPoolBackprop");for(var i=this.maxPoolPositions(n,a),c=a.strideHeight,s=a.strideWidth,l=a.dilationHeight,u=a.dilationWidth,h=a.effectiveFilterHeight,f=a.effectiveFilterWidth,d=f-1-a.padInfo.left,p=h-1-a.padInfo.top,v=he(n.shape,"float32"),m=this.bufferSync(i),g=this.bufferSync(e),b=0;b<a.batchSize;++b)for(var y=0;y<a.inChannels;++y)for(var x=0;x<a.inHeight;++x)for(var w=0;w<a.inWidth;++w){for(var z=x-p,M=w-d,_=0,S=0;S<h;S+=l){var k=(z+S)/c;if(!(k<0||k>=a.outHeight||Math.floor(k)!==k))for(var L=0;L<f;L+=u){var V=(M+L)/s;if(!(V<0||V>=a.outWidth||Math.floor(V)!==V)){var I=h*f-1-m.get(b,k,V,y)===S*f+L?1:0;I!==0&&(_+=g.get(b,k,V,y)*I)}}}v.set(_,b,x,w,y)}return v.toTensor()},t.prototype.avgPoolBackprop=function(e,n,o){W([e,n],"avgPoolBackprop");for(var a=o.strideHeight,i=o.strideWidth,c=o.filterHeight,s=o.filterWidth,l=o.dilationHeight,u=o.dilationWidth,h=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=f-1-o.padInfo.left,p=h-1-o.padInfo.top,v=he(n.shape,"float32"),m=1/(c*s),g=this.bufferSync(e),b=0;b<o.batchSize;++b)for(var y=0;y<o.inChannels;++y)for(var x=0;x<o.inHeight;++x)for(var w=0;w<o.inWidth;++w){for(var z=x-p,M=w-d,_=0,S=0;S<h;S+=l){var k=(z+S)/a;if(!(k<0||k>=o.outHeight||Math.floor(k)!==k))for(var L=0;L<f;L+=u){var V=(M+L)/i;V<0||V>=o.outWidth||Math.floor(V)!==V||(_+=g.get(b,k,V,y))}}v.set(_*m,b,x,w,y)}return v.toTensor()},t.prototype.pool3d=function(e,n,o){W(e,"pool3d");for(var a=n.strideDepth,i=n.strideHeight,c=n.strideWidth,s=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,v=n.padInfo.top,m=n.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),y=he(n.outShape,e.dtype),x=y.values,w=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],z=n.outShape[2]*n.outShape[3]*n.outShape[4],M=n.outShape[3]*n.outShape[4],_=n.outShape[4],S=0;S<n.batchSize;++S)for(var k=S*w,L=S*e.strides[0],V=0;V<n.inChannels;++V)for(var I=0;I<n.outDepth;++I){for(var D=I*a-p,R=D;R<0;)R+=s;for(var P=Math.min(n.inDepth,h+D),N=k+I*z,O=0;O<n.outHeight;++O){for(var G=O*i-v,q=G;q<0;)q+=l;for(var Y=Math.min(n.inHeight,f+G),ne=N+O*M,ae=0;ae<n.outWidth;++ae){for(var me=ae*c-m,ge=me;ge<0;)ge+=u;for(var be=Math.min(n.inWidth,d+me),Ce=ne+ae*_,ze=g,_e=0,Qe=0,Me=R;Me<P;Me+=s){for(var Ae=L+Me*e.strides[1],ke=q;ke<Y;ke+=l){for(var Ye=Ae+ke*e.strides[2],qe=ge;qe<be;qe+=u){var je=b[Ye+qe*e.strides[3]+V];if(o==="max"&&je>ze?ze=je:o==="avg"&&(_e+=je,Qe++),isNaN(ze))break}if(isNaN(ze))break}if(isNaN(ze))break}x[Ce+V]=o==="avg"?_e/Qe:ze}}}return y.toTensor()},t.prototype.avgPool3d=function(e,n){return W(e,"avgPool3d"),this.pool3d(e,n,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,n,o){W([e,n],"avgPool3dBackprop");for(var a=o.strideDepth,i=o.strideHeight,c=o.strideWidth,s=o.filterDepth,l=o.filterHeight,u=o.filterWidth,h=o.dilationDepth,f=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=p-1-o.padInfo.front,b=m-1-o.padInfo.left,y=v-1-o.padInfo.top,x=he(n.shape,"float32"),w=1/(s*l*u),z=this.bufferSync(e),M=0;M<o.batchSize;++M)for(var _=0;_<o.inChannels;++_)for(var S=0;S<o.inDepth;++S)for(var k=0;k<o.inHeight;++k)for(var L=0;L<o.inWidth;++L){for(var V=S-g,I=k-y,D=L-b,R=0,P=0;P<p;P+=h){var N=(V+P)/a;if(!(N<0||N>=o.outDepth||Math.floor(N)!==N))for(var O=0;O<v;O+=f){var G=(I+O)/i;if(!(G<0||G>=o.outHeight||Math.floor(G)!==G))for(var q=0;q<m;q+=d){var Y=(D+q)/c;Y<0||Y>=o.outWidth||Math.floor(Y)!==Y||(R+=z.get(M,N,G,Y,_))}}}x.set(R*w,M,S,k,L,_)}return x.toTensor()},t.prototype.maxPool3d=function(e,n){return W(e,"maxPool3d"),this.pool3d(e,n,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,n){for(var o=he(n.outShape,"int32"),a=n.strideDepth,i=n.strideHeight,c=n.strideWidth,s=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,v=n.padInfo.top,m=n.padInfo.left,g=this.bufferSync(e),b=0;b<n.batchSize;++b)for(var y=0;y<n.inChannels;++y)for(var x=0;x<n.outDepth;++x){for(var w=x*a-p,z=w;z<0;)z+=s;for(var M=Math.min(n.inDepth,h+w),_=0;_<n.outHeight;++_){for(var S=_*i-v,k=S;k<0;)k+=l;for(var L=Math.min(n.inHeight,f+S),V=0;V<n.outWidth;++V){for(var I=V*c-m,D=I;D<0;)D+=u;for(var R=Math.min(n.inWidth,d+I),P=Number.NEGATIVE_INFINITY,N=-1,O=z;O<M;O+=s)for(var G=O-w,q=k;q<L;q+=l)for(var Y=q-S,ne=D;ne<R;ne+=u){var ae=ne-I,me=g.get(b,O,q,ne,y);me>=P&&(P=me,N=G*f*d+Y*f+ae)}o.set(N,b,x,_,V,y)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(e,n,o,a){W([n,o],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(n,a),c=a.strideDepth,s=a.strideHeight,l=a.strideWidth,u=a.dilationDepth,h=a.dilationHeight,f=a.dilationWidth,d=a.effectiveFilterDepth,p=a.effectiveFilterHeight,v=a.effectiveFilterWidth,m=d-1-a.padInfo.front,g=v-1-a.padInfo.left,b=p-1-a.padInfo.top,y=he(n.shape,"float32"),x=this.bufferSync(i),w=this.bufferSync(e),z=0;z<a.batchSize;++z)for(var M=0;M<a.inChannels;++M)for(var _=0;_<a.inDepth;++_)for(var S=0;S<a.inHeight;++S)for(var k=0;k<a.inWidth;++k){for(var L=_-m,V=S-b,I=k-g,D=0,R=0;R<d;R+=u){var P=(L+R)/c;if(!(P<0||P>=a.outDepth||Math.floor(P)!==P))for(var N=0;N<p;N+=h){var O=(V+N)/s;if(!(O<0||O>=a.outHeight||Math.floor(O)!==O))for(var G=0;G<v;G+=f){var q=(I+G)/l;if(!(q<0||q>=a.outWidth||Math.floor(q)!==q)){var Y=d*p*v-1-x.get(z,P,O,q,M)===R*p*v+N*v+G?1:0;Y!==0&&(D+=w.get(z,P,O,q,M)*Y)}}}}y.set(D,z,_,S,k,M)}return y.toTensor()},t.prototype.cast=function(e,n){return Qo(e,n,this)},t.prototype.reshape=function(e,n){return g3(e,n)},t.prototype.avgPool=function(e,n){return W(e,"avgPool"),this.pool(e,n,"avg").toFloat()},t.prototype.resizeBilinear=function(e,n,o,a){W(e,"resizeBilinear");for(var i=e.shape,c=i[0],s=i[1],l=i[2],u=i[3],h=this.readSync(e.dataId),f=new Float32Array(te([c,n,o,u])),d=[a&&n>1?s-1:s,a&&o>1?l-1:l],p=[a&&n>1?n-1:n,a&&o>1?o-1:o],v=0,m=d[0]/p[0],g=d[1]/p[1],b=0;b<c;b++)for(var y=0;y<n;y++)for(var x=m*y,w=Math.floor(x),z=x-w,M=Math.min(s-1,Math.ceil(x)),_=b*e.strides[0]+w*e.strides[1],S=b*e.strides[0]+M*e.strides[1],k=0;k<o;k++)for(var L=g*k,V=Math.floor(L),I=L-V,D=Math.min(l-1,Math.ceil(L)),R=_+V*e.strides[2],P=S+V*e.strides[2],N=_+D*e.strides[2],O=S+D*e.strides[2],G=0;G<u;G++){var q=h[R+G],Y=h[P+G],ne=q+(h[N+G]-q)*I,ae=ne+(Y+(h[O+G]-Y)*I-ne)*z;f[v++]=ae}return g1(f,[c,n,o,u])},t.prototype.resizeBilinearBackprop=function(e,n,o){W([e,n],"resizeBilinearBackprop");for(var a=n.shape,i=a[0],c=a[1],s=a[2],l=a[3],u=e.shape,h=u[1],f=u[2],d=new Float32Array(i*c*s*l),p=[o&&h>1?c-1:c,o&&f>1?s-1:s],v=[o&&h>1?h-1:h,o&&f>1?f-1:f],m=p[0]/v[0],g=p[1]/v[1],b=this.readSync(e.dataId),y=0,x=0;x<i;x++)for(var w=x*n.strides[0],z=0;z<h;z++)for(var M=z*m,_=Math.floor(M),S=Math.min(Math.ceil(M),c-1),k=w+_*n.strides[1],L=w+S*n.strides[1],V=M-_,I=1-V,D=0;D<f;D++)for(var R=D*g,P=Math.floor(R),N=Math.min(Math.ceil(R),s-1),O=R-P,G=1-O,q=k+P*n.strides[2],Y=k+N*n.strides[2],ne=L+P*n.strides[2],ae=L+N*n.strides[2],me=I*G,ge=I*O,be=V*G,Ce=V*O,ze=0;ze<l;ze++){var _e=b[y++];d[q+ze]+=_e*me,d[Y+ze]+=_e*ge,d[ne+ze]+=_e*be,d[ae+ze]+=_e*Ce}return f1(d,[i,s,c,l],n.dtype)},t.prototype.resizeNearestNeighbor=function(e,n,o,a){W(e,"resizeNearestNeighbor");for(var i=e.shape,c=i[0],s=i[1],l=i[2],u=i[3],h=this.readSync(e.dataId),f=new Float32Array(c*n*o*u),d=[a&&n>1?s-1:s,a&&o>1?l-1:l],p=[a&&n>1?n-1:n,a&&o>1?o-1:o],v=d[0]/p[0],m=d[1]/p[1],g=0,b=0;b<c;b++)for(var y=b*e.strides[0],x=0;x<n;x++)for(var w=v*x,z=y+Math.min(s-1,a?Math.round(w):Math.floor(w))*e.strides[1],M=0;M<o;M++)for(var _=m*M,S=z+Math.min(l-1,a?Math.round(_):Math.floor(_))*e.strides[2],k=0;k<u;k++){var L=h[S+k];f[g++]=L}return g1(f,[c,n,o,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,n,o){W([e,n],"resizeNearestNeighborBackprop");for(var a=n.shape,i=a[0],c=a[1],s=a[2],l=a[3],u=e.shape,h=u[1],f=u[2],d=new Float32Array(i*c*s*l),p=this.readSync(e.dataId),v=[o&&h>1?c-1:c,o&&f>1?s-1:s],m=[o&&h>1?h-1:h,o&&f>1?f-1:f],g=v[0]/m[0],b=v[1]/m[1],y=1/g,x=1/b,w=2*Math.ceil(y)+2,z=2*Math.ceil(x)+2,M=0;M<i;M++)for(var _=M*n.strides[0],S=0;S<c;S++)for(var k=_+S*n.strides[1],L=Math.floor(S*y),V=Math.floor(L-w/2),I=0;I<s;I++)for(var D=k+I*n.strides[2],R=Math.floor(I*x),P=Math.floor(R-z/2),N=0;N<l;N++){for(var O=0,G=0;G<w;G++){var q=G+V;if(!(q<0||q>=h)){var Y=_+q*e.strides[1],ne=q*g;if(S===Math.min(c-1,o?Math.round(ne):Math.floor(ne)))for(var ae=0;ae<z;ae++){var me=ae+P;if(!(me<0||me>=f)){var ge=Y+me*e.strides[2],be=me*b;I===Math.min(s-1,o?Math.round(be):Math.floor(be))&&(O+=p[ge+N])}}}}d[D+N]=O}return f1(d,n.shape,n.dtype)},t.prototype.batchNormalization=function(e,n,o,a,i,c){W([e,n,o,i,c],"batchNorm");for(var s=this.readSync(e.dataId),l=this.readSync(n.dataId),u=this.readSync(o.dataId),h=i?this.readSync(i.dataId):new Float32Array([1]),f=c?this.readSync(c.dataId):new Float32Array([0]),d=new Float32Array(s.length),p=f.length,v=h.length,m=u.length,g=l.length,b=0,y=0,x=0,w=0,z=0;z<s.length;++z)d[z]=f[b++]+(s[z]-l[y++])*h[x++]/Math.sqrt(u[w++]+a),b>=p&&(b=0),y>=g&&(y=0),x>=v&&(x=0),w>=m&&(w=0);return f1(d,e.shape)},t.prototype.localResponseNormalization4D=function(e,n,o,a,i){W(e,"localResponseNormalization4D");var c=e.shape[3],s=c-1,l=this.readSync(e.dataId),u=e.size,h=new Float32Array(u);function f(m){for(var g=m%c,b=m-g+Math.max(0,g-n),y=m-g+Math.min(g+n,s),x=0;b<=y;b++){var w=l[b];x+=w*w}return x}for(var d=0;d<u;d++){var p=f(d),v=l[d]*Math.pow(o+a*p,-i);h[d]=v}return f1(h,e.shape)},t.prototype.LRNGrad=function(e,n,o,a,i,c,s){W(e,"LRNGrad");for(var l=e.shape[3],u=this.readSync(e.dataId),h=this.readSync(n.dataId),f=this.readSync(o.dataId),d=new Float32Array(e.size),p=e.size,v=0;v<p;v++){for(var m=v%l,g=v-m+Math.max(0,m-a),b=v-m+Math.min(l,m+a+1),y=0,x=g;x<b;x++)y+=Math.pow(h[x],2);for(y=c*y+i,x=g;x<b;x++){var w=-2*c*s*h[x]*f[v]/y;v===x&&(w+=Math.pow(y,-s)),w*=u[v],d[x]+=w}}return f1(d,e.shape)},t.prototype.multinomial=function(e,n,o,a){W(e,"multinomial");for(var i=n?e:q1(e),c=i.shape[0],s=i.shape[1],l=Oe([c,o],"int32"),u=this.readSync(l.dataId),h=this.readSync(i.dataId),f=0;f<c;++f){var d=f*s,p=new Float32Array(s-1);p[0]=h[d];for(var v=1;v<p.length;++v)p[v]=p[v-1]+h[d+v];for(var m=C3(a.toString()),g=f*o,b=0;b<o;++b){var y=m();u[g+b]=p.length;for(var x=0;x<p.length;x++)if(y<p[x]){u[g+b]=x;break}}}return l},t.prototype.oneHot=function(e,n,o,a){W(e,"oneHot");var i=new Float32Array(e.size*n);i.fill(a);for(var c=this.readSync(e.dataId),s=0;s<e.size;++s)c[s]>=0&&c[s]<n&&(i[s*n+c[s]]=o);return Bt(i,[e.size,n],"int32")},t.prototype.nonMaxSuppression=function(e,n,o,a,i){return W(e,"nonMaxSuppression"),e6(this.readSync(e.dataId),this.readSync(n.dataId),o,a,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,n){for(var o=e.shape[0],a=e.shape[1],i=he(e.shape,"float32"),c=he(e.shape,"float32"),s=ht(e).as2D(o,a),l=It(e).as2D(o,a),u=0;u<o;u++)for(var h=s.slice([u,0],[1,a]),f=l.slice([u,0],[1,a]),d=E1(h,f),p=this.readSync(this.fftImpl(d,n).dataId),v=0;v<a;v++){var m=hc(p,v);i.values[u*a+v]=m.real,c.values[u*a+v]=m.imag}return E1(i.toTensor(),c.toTensor()).as2D(o,a)},t.prototype.fftImpl=function(e,n){var o=e.as1D(),a=o.size;if(this.isExponentOf2(a)){var i=this.fftRadix2(o,a,n).as2D(e.shape[0],e.shape[1]);return n&&(i=E1(ht(i).div(K(a)),It(i).div(K(a)))),i}var c=this.readSync(e.dataId),s=function(l){for(var u=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)u[f/2]=l[f],h[f/2]=l[f+1];return{real:u,imag:h}}(this.fourierTransformByMatmul(c,a,n));return E1(s.real,s.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,n,o){if(n===1)return e;var a=this.readSync(e.dataId),i=n/2,c=function(g){for(var b=Math.ceil(g.length/4),y=new Float32Array(b),x=new Float32Array(b),w=0;w<g.length;w+=4)y[Math.floor(w/4)]=g[w],x[Math.floor(w/4)]=g[w+1];return{real:y,imag:x}}(a),s=E1(c.real,c.imag).as1D(),l=function(g){for(var b=Math.floor(g.length/4),y=new Float32Array(b),x=new Float32Array(b),w=2;w<g.length;w+=4)y[Math.floor(w/4)]=g[w],x[Math.floor(w/4)]=g[w+1];return{real:y,imag:x}}(a),u=E1(l.real,l.imag).as1D();s=this.fftRadix2(s,i,o),u=this.fftRadix2(u,i,o);var h=function(g,b){for(var y=new Float32Array(g/2),x=new Float32Array(g/2),w=0;w<Math.ceil(g/2);w++){var z=(b?2:-2)*Math.PI*(w/g);y[w]=Math.cos(z),x[w]=Math.sin(z)}return{real:y,imag:x}}(n,o),f=E1(h.real,h.imag).mul(u),d=s.add(f),p=s.sub(f),v=ht(d).concat(ht(p)),m=It(d).concat(It(p));return E1(v,m).as1D()},t.prototype.fourierTransformByMatmul=function(e,n,o){for(var a=new Float32Array(2*n),i=0;i<n;i++){for(var c=0,s=0,l=0;l<n;l++){var u=Lf(i*l,n,o),h=hc(e,l);c+=h.real*u.real-h.imag*u.imag,s+=h.real*u.imag+h.imag*u.real}o&&(c/=n,s/=n),Tf(a,c,s,i)}return a},t.prototype.depthToSpace=function(e,n,o){E(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),E(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var a=e.shape[0],i=e.shape[1],c=e.shape[2],s=e.shape[3],l=i*n,u=c*n,h=s/(n*n),f=this.readSync(e.dataId),d=new Float32Array(a*l*u*h),p=0,v=0;v<a;++v)for(var m=0;m<l;++m)for(var g=Math.floor(m/n),b=m%n,y=0;y<u;++y)for(var x=Math.floor(y/n),w=(b*n+y%n)*h,z=0;z<h;++z){var M=z+w+s*(x+c*(g+i*v));d[p++]=f[M]}return f1(d,[a,l,u,h])},t.prototype.broadcastedBinaryOp=function(e,n,o,a){var i=xe(e.shape,n.shape),c=he(i,o),s=this.readSync(e.dataId),l=this.readSync(n.dataId),u=nn(e.shape,i),h=nn(n.shape,i),f=c.values;if(u.length+h.length===0)for(var d=0;d<f.length;++d)f[d]=a(s[d%s.length],l[d%l.length]);else{var p=this.bufferSync(e),v=this.bufferSync(n),m=function(g){var b=c.indexToLoc(g),y=b.slice(-e.rank);u.forEach(function(M){return y[M]=0});var x=p.locToIndex(y),w=b.slice(-n.rank);h.forEach(function(M){return w[M]=0});var z=v.locToIndex(w);f[g]=a(s[x],l[z])};for(d=0;d<f.length;++d)m(d)}return c.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,n,o){var a=xe(e.shape,n.shape),i=he(a,"float32"),c=he(a,"float32"),s=this.readSync(e.dataId),l=this.readSync(n.dataId),u=nn(e.shape,a),h=nn(n.shape,a),f=i.values,d=c.values;if(u.length+h.length===0)for(var p=0;p<f.length;p++){var v=p%s.length,m=p%l.length,g=o(s[2*v],s[2*v+1],l[2*m],l[2*m+1]);f[p]=g.real,d[p]=g.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(n.dataId).complexTensors.real),x=function(w){var z=i.indexToLoc(w),M=z.slice(-e.rank);u.forEach(function(V){return M[V]=0});var _=b.locToIndex(M),S=z.slice(-n.rank);h.forEach(function(V){return S[V]=0});var k=y.locToIndex(S),L=o(s[2*_],s[2*_+1],l[2*k],l[2*k+1]);f[w]=L.real,d[w]=L.imag};for(p=0;p<f.length;p++)x(p)}return this.complex(i.toTensor(),c.toTensor())},t.prototype.split=function(e,n,o){return Qs(e,n,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,n,o,a,i,c){for(var s=e.shape,l=s[0],u=s[1],h=s[2],f=s[3],d=n.shape[0],p=a[0],v=a[1],m=he([d,p,v,f],"float32"),g=this.readSync(n.dataId),b=this.readSync(o.dataId),y=this.readSync(e.dataId),x=e.strides,w=m.strides,z=0;z<d;z++){var M=4*z,_=g[M],S=g[M+1],k=g[M+2],L=g[M+3],V=b[z];if(!(V>=l))for(var I=p>1?(k-_)*(u-1)/(p-1):0,D=v>1?(L-S)*(h-1)/(v-1):0,R=0;R<p;R++){var P=p>1?_*(u-1)+R*I:.5*(_+k)*(u-1);if(P<0||P>u-1)for(var N=0;N<v;N++)for(var O=0;O<f;O++){var G=O+N*w[2]+R*w[1]+z*w[0];m.values[G]=c}else if(i==="bilinear"){var q=Math.floor(P),Y=Math.ceil(P),ne=P-q;for(N=0;N<v;N++)if((Me=v>1?S*(h-1)+N*D:.5*(S+L)*(h-1))<0||Me>h-1)for(O=0;O<f;O++)G=O+N*w[2]+R*w[1]+z*w[0],m.values[G]=c;else{var ae=Math.floor(Me),me=Math.ceil(Me),ge=Me-ae;for(O=0;O<f;O++){var be=y[G=O+ae*x[2]+q*x[1]+V*x[0]],Ce=y[G=O+me*x[2]+q*x[1]+V*x[0]],ze=y[G=O+ae*x[2]+Y*x[1]+V*x[0]],_e=be+(Ce-be)*ge,Qe=ze+(y[G=O+me*x[2]+Y*x[1]+V*x[0]]-ze)*ge;G=O+N*w[2]+R*w[1]+z*w[0],m.values[G]=_e+(Qe-_e)*ne}}}else for(N=0;N<v;++N){var Me;if((Me=v>1?S*(h-1)+N*D:.5*(S+L)*(h-1))<0||Me>h-1)for(O=0;O<f;O++)G=O+N*w[2]+R*w[1]+z*w[0],m.values[G]=c;else{var Ae=Math.round(Me),ke=Math.round(P);for(O=0;O<f;O++){var Ye=O+Ae*x[2]+ke*x[1]+V*x[0],qe=O+N*w[2]+R*w[1]+z*w[0];m.values[qe]=y[Ye]}}}}}return m.toTensor()},t.prototype.sparseToDense=function(e,n,o,a){var i=U2(0,e,o),c=i.sliceRank,s=i.numUpdates,l=i.sliceSize,u=i.strides,h=i.outputSize;return this.scatter(e,n,o,h,l,s,c,u,a,!1)},t.prototype.gatherND=function(e,n){var o=n.shape,a=o[o.length-1],i=$o(e,n),c=i[0],s=i[1],l=i[2],u=i[3];if(s===0)return g1([],c,e.dtype);for(var h=new O2([s,l],e.dtype),f=this.readSync(n.dataId),d=this.readSync(e.dataId),p=0;p<s;p++){for(var v=[],m=0,g=0;g<a;g++){var b=f[p*a+g];m+=b*u[g],v.push(b)}if(m<0||m>=e.size/l)throw new Error("Invalid indices: "+v+" does not index into "+e.shape);for(var y=0;y<l;y++)h.values[p*l+y]=d[m*l+y]}return h.toTensor().reshape(c)},t.prototype.scatterND=function(e,n,o){var a=U2(0,e,o),i=a.sliceRank,c=a.numUpdates,s=a.sliceSize,l=a.strides,u=a.outputSize,h=K(0);return this.scatter(e,n,o,u,s,c,i,l,h,!0)},t.prototype.fill=function(e,n,o){var a=B2(o=o||N4(n),te(e));return a.fill(n),T.makeTensor(a,e,o,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var n=B2(e.dtype,te(e.shape));return this.makeOutput(n,e.shape,e.dtype)},t.prototype.linspace=function(e,n,o){return Jo(e,n,o)},t.prototype.scatter=function(e,n,o,a,i,c,s,l,u,h){var f=[a/i,i],d=this.readSync(e.dataId),p=this.readSync(n.dataId);if(a===0)return g1([],o,n.dtype);var v=new O2(f,n.dtype);v.values.fill(this.readSync(u.dataId)[0]);for(var m=0;m<c;m++){for(var g=[],b=0,y=0;y<s;y++){var x=d[m*s+y];g.push(x),b+=x*l[y]}if(b<0||b>=a/i)throw new Error("Invalid indices: "+g+" does not index into "+o);for(var w=0;w<i;w++)h?v.values[b*i+w]+=p[m*i+w]:v.values[b*i+w]=n.rank===0?p[0]:p[m*i+w]}return v.toTensor().reshape(o)},t}(Ys);T.registerBackend("cpu",function(){return new Dm},1);for(Xr=0,io=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs,o=t,a=o.boxes,i=o.scores,c=n,s=c.maxOutputSize,l=c.iouThreshold,u=c.scoreThreshold,h=c.softNmsSigma,f=e;W(a,"NonMaxSuppressionWithScore");var d=t6(f.data.get(a.dataId).values,f.data.get(i.dataId).values,s,l,u,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,o=e;W(n,"square");for(var a=o.data.get(n.dataId).values,i=new Float32Array(a.length),c=0;c<a.length;++c){var s=a[c];i[c]=s*s}return{dataId:o.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:j2,backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t,o=n.a,a=n.b,i=e;W([o,a],j2);var c=i.data.get(o.dataId).values,s=i.data.get(a.dataId).values,l=function(f,d,p,v,m,g){var b=xe(f,d),y=b.length,x=yt(b),w=R4(m,te(b)),z=f.length,M=d.length,_=yt(f),S=yt(d),k=nn(f,b),L=nn(d,b);if(k.length+L.length===0)for(var V=0;V<w.length;++V)w[V]=g(p[V%p.length],v[V%v.length]);else{var I=function(D){var R=rs(D,y,x),P=R.slice(-z);k.forEach(function(q){return P[q]=0});var N=bo(P,z,_),O=R.slice(-M);L.forEach(function(q){return O[q]=0});var G=bo(O,M,S);w[D]=g(p[N],v[G])};for(V=0;V<w.length;++V)I(V)}return[w,b]}(o.shape,a.shape,c,s,o.dtype,function(f,d){var p=f-d;return p*p}),u=l[0],h=l[1];return{dataId:i.write(u,h,o.dtype),shape:h,dtype:o.dtype}}}];Xr<io.length;Xr++)qc(io[Xr]);var Xr,io,k4,Im=function(r){this.variableNames=["A"];var t=B1(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},Bm=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=B1(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(Yr=0,co=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs,o=t.pixels,a=n.numChannels,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,c=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,s=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=s[0],u=s[1],h=[u,l],f=[u,l,a];(c||i)&&(k4==null&&(k4=document.createElement("canvas").getContext("2d")),k4.canvas.width=l,k4.canvas.height=u,k4.drawImage(o,0,0,l,u),o=k4.canvas);var d=e.makeTensorInfo(h,"int32");e.texData.get(d.dataId).usage=it.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(d.dataId),o);var p=B().getBool("WEBGL_PACK")?new Bm(f):new Im(f),v=e.runWebGLProgram(p,[d],"int32");return e.disposeData(d.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs;u3("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,c=n,s=c.maxOutputSize,l=c.iouThreshold,u=c.scoreThreshold,h=c.softNmsSigma,f=e,d=t6(f.readSync(a.dataId),f.readSync(i.dataId),s,l,u,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,o=e,a=new de(n.shape,"return x * x;");return o.runWebGLProgram(a,[n],n.dtype)}},{kernelName:j2,backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t,o=n.a,a=n.b,i=e,c=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new en("return (a - b) * (a - b);",o.shape,a.shape):new Ze("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(c,[o,a])}}];Yr<co.length;Yr++)qc(co[Yr]);var Yr,co;for(Zr=0,so=[{kernelName:"Square",gradFunc:function(r,t){var e=t[0];return{x:function(){return r.mul(e.toFloat().mul(2))}}}},{kernelName:j2,gradFunc:function(r,t){var e=t[0],n=t[1],o=K(2);return{a:function(){return $e(r,$e(o,Be(e,n)))},b:function(){return $e(r,$e(o,Be(n,e)))}}}}];Zr<so.length;Zr++)Oh(so[Zr]);var Zr,so,Rm=function(){function r(){}return r.prototype.fetch=function(t,e){return fetch(t,e)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},r}();B().get("IS_BROWSER")&&B().setPlatform("browser",new Rm);var lo,Om=function(){return rc()},Nm=function(){function r(){this.util=oc(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(t,e){return B().global.fetch!=null?B().global.fetch(t,e):(lo==null&&(lo=Om()),lo(t,e))},r.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},r}();B().get("IS_NODE")&&B().setPlatform("node",new Nm);var Lo={float32:4,int32:4,uint16:2,uint8:1,bool:1},y3=4;function a7(r,t){for(var e={},n=0,o=function(c){var s=c.name,l=c.dtype,u=c.shape,h=te(u),f=void 0;if("quantization"in c){var d=c.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+c.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Lo[d.dtype],v=r.slice(n,n+h*p),m=d.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(l==="float32")f=Float32Array.from(m,function(z){return z*d.scale+d.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+s+"': "+l);f=Int32Array.from(m,function(z){return Math.round(z*d.scale+d.min)})}n+=h*p}else if(l==="string"){var g=te(c.shape);f=[];for(var b=0;b<g;b++){var y=new Uint32Array(r.slice(n,n+y3))[0];n+=y3;var x=new Uint8Array(r.slice(n,n+y));f.push(x),n+=y}}else{var w=Lo[l];if(v=r.slice(n,n+h*w),l==="float32")f=new Float32Array(v);else if(l==="int32")f=new Int32Array(v);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+s+"': "+l);f=new Uint8Array(v)}n+=h*w}e[s]=g1(f,u,l)},a=0,i=t;a<i.length;a++)o(i[a]);return e}function Pm(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var t=0,e=[];r.forEach(function(a){if(t+=a.byteLength,e.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(t),o=0;return e.forEach(function(a){n.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),n.buffer}var Fo=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Fc(r){return Fo?Buffer.byteLength(r):new Blob([r]).size}function y6(r){var t=0;r.forEach(function(o){t+=o.byteLength});var e=new Uint8Array(t),n=0;return r.forEach(function(o){e.set(new Uint8Array(o),n),n+=o.byteLength}),e.buffer}function Ac(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var t=r.split("/");return t[t.length-1]}function nr(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:Fc(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:Fc(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var st=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(t){r.getInstance().saveRouters.push(t)},r.registerLoadRouter=function(t){r.getInstance().loadRouters.push(t)},r.getSaveHandlers=function(t){return r.getHandlers(t,"save")},r.getLoadHandlers=function(t,e){return r.getHandlers(t,"load",e)},r.getHandlers=function(t,e,n){var o=[];return(e==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(a){var i=a(t,n);i!==null&&o.push(i)}),o},r}(),D4="://",Hn=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(t,e){E(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(D4)&&(t=t.slice(0,t.indexOf(D4))),E(t.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();E(n.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),n.managers[t]=e},r.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function o3(r){if(r.indexOf(D4)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Hn.getSchemes().join(","));return{scheme:r.split(D4)[0],path:r.split(D4)[1]}}function Dc(r,t,e){return e===void 0&&(e=!1),Q(this,void 0,void 0,function(){var n,o,a,i,c,s,l,u,h;return J(this,function(f){switch(f.label){case 0:return E(r!==t,function(){return"Old path and new path are the same: '"+r+"'"}),E((n=st.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),E(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),o=n[0],E((a=st.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),E(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."}),i=a[0],c=o3(r).scheme,s=o3(r).path,l=c===o3(r).scheme,[4,o.load()];case 1:return u=f.sent(),e&&l?[4,Hn.getManager(c).removeModel(s)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(u)];case 4:return h=f.sent(),!e||l?[3,6]:[4,Hn.getManager(c).removeModel(s)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Qn="models_store",kn="model_info_store";function i7(){if(!B().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Ao(r){var t=r.result;t.createObjectStore(Qn,{keyPath:"modelPath"}),t.createObjectStore(kn,{keyPath:"modelPath"})}var I4=function(){function r(t){if(this.indexedDB=i7(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return r.prototype.save=function(t){return Q(this,void 0,void 0,function(){return J(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},r.prototype.load=function(){return Q(this,void 0,void 0,function(){return J(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(o,a){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Ao(i)},i.onsuccess=function(){var c=i.result;if(e==null){var s=c.transaction(Qn,"readonly"),l=s.objectStore(Qn).get(n.modelPath);l.onsuccess=function(){if(l.result==null)return c.close(),a(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(v){return c.close(),a(l.error)},s.oncomplete=function(){return c.close()}}else{var u,h=nr(e),f=c.transaction(kn,"readwrite"),d=f.objectStore(kn),p=d.put({modelPath:n.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var v=(u=c.transaction(Qn,"readwrite")).objectStore(Qn).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:h});v.onsuccess=function(){return o({modelArtifactsInfo:h})},v.onerror=function(m){var g=(d=f.objectStore(kn)).delete(n.modelPath);g.onsuccess=function(){return c.close(),a(v.error)},g.onerror=function(b){return c.close(),a(v.error)}}},p.onerror=function(v){return c.close(),a(p.error)},f.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}}},i.onerror=function(c){return a(i.error)}})},r.URL_SCHEME="indexeddb://",r}(),Ic=function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(I4.URL_SCHEME)?(t=r.slice(I4.URL_SCHEME.length),new I4(t)):null;var t};st.registerSaveRouter(Ic),st.registerLoadRouter(Ic);var Wm=function(){function r(){this.indexedDB=i7()}return r.prototype.listModels=function(){return Q(this,void 0,void 0,function(){var t=this;return J(this,function(e){return[2,new Promise(function(n,o){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Ao(a)},a.onsuccess=function(){var i=a.result,c=i.transaction(kn,"readonly"),s=c.objectStore(kn).getAll();s.onsuccess=function(){for(var l={},u=0,h=s.result;u<h.length;u++){var f=h[u];l[f.modelPath]=f.modelArtifactsInfo}n(l)},s.onerror=function(l){return i.close(),o(s.error)},c.oncomplete=function(){return i.close()}},a.onerror=function(i){return o(a.error)}})]})})},r.prototype.removeModel=function(t){return Q(this,void 0,void 0,function(){var e=this;return J(this,function(n){var o;return t=(o=t).startsWith(I4.URL_SCHEME)?o.slice(I4.URL_SCHEME.length):o,[2,new Promise(function(a,i){var c=e.indexedDB.open("tensorflowjs",1);c.onupgradeneeded=function(){return Ao(c)},c.onsuccess=function(){var s,l=c.result,u=l.transaction(kn,"readwrite"),h=u.objectStore(kn),f=h.get(t);f.onsuccess=function(){if(f.result==null)return l.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var d=h.delete(t),p=function(){var v=(s=l.transaction(Qn,"readwrite")).objectStore(Qn).delete(t);v.onsuccess=function(){return a(f.result.modelArtifactsInfo)},v.onerror=function(m){return i(f.error)}};d.onsuccess=p,d.onerror=function(v){return p(),l.close(),i(f.error)}},f.onerror=function(d){return l.close(),i(f.error)},u.oncomplete=function(){s==null?l.close():s.oncomplete=function(){return l.close()}}},c.onerror=function(s){return i(c.error)}})]})})},r}();if(B().getBool("IS_BROWSER"))try{Hn.registerManager(I4.URL_SCHEME,new Wm)}catch{}var tn="/",F4="tensorflowjs_models",c7="info",Um="model_topology",Gm="weight_specs",qm="weight_data",jm="model_metadata";function s7(r){return{info:[F4,r,c7].join(tn),topology:[F4,r,Um].join(tn),weightSpecs:[F4,r,Gm].join(tn),weightData:[F4,r,qm].join(tn),modelMetadata:[F4,r,jm].join(tn)}}function $m(r){var t=r.split(tn);if(t.length<3)throw new Error("Invalid key format: "+r);return t.slice(1,t.length-1).join(tn)}var B4=function(){function r(t){if(!B().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=s7(this.modelPath)}return r.prototype.save=function(t){return Q(this,void 0,void 0,function(){var e,n,o;return J(this,function(a){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),o=nr(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(i){if(Fo)return Buffer.from(i).toString("base64");for(var c=new Uint8Array(i),s="",l=0,u=c.length;l<u;l++)s+=String.fromCharCode(c[l]);return btoa(s)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return Q(this,void 0,void 0,function(){var t,e,n,o,a,i,c;return J(this,function(s){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),(c=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(l){if(Fo){var u=Buffer.from(l,"base64");return u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),d=0;d<h.length;++d)f.set([h.charCodeAt(d)],d);return f.buffer}(c),[2,e]})})},r.URL_SCHEME="localstorage://",r}(),Bc=function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(B4.URL_SCHEME)?(t=r.slice(B4.URL_SCHEME.length),new B4(t)):null;var t};st.registerSaveRouter(Bc),st.registerLoadRouter(Bc);var Km=function(){function r(){E(B().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),E(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Q(this,void 0,void 0,function(){var t,e,n,o,a,i;return J(this,function(c){for(t={},e=F4+tn,n=tn+c7,o=0;o<this.LS.length;++o)(a=this.LS.key(o)).startsWith(e)&&a.endsWith(n)&&(i=$m(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]})})},r.prototype.removeModel=function(t){return Q(this,void 0,void 0,function(){var e,n;return J(this,function(o){var a;if(t=(a=t).startsWith(B4.URL_SCHEME)?a.slice(B4.URL_SCHEME.length):a,e=s7(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},r}();if(B().getBool("IS_BROWSER"))try{Hn.registerManager(B4.URL_SCHEME,new Km)}catch{}var Xm="model",Ym=".json",Zm=".weights.bin";function Rc(r){return new Promise(function(t){return setTimeout(t)}).then(r)}var uo=function(){function r(t){if(!B().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(r.URL_SCHEME)&&(t=t.slice(r.URL_SCHEME.length)),t!=null&&t.length!==0||(t=Xm),this.modelTopologyFileName=t+Ym,this.weightDataFileName=t+Zm}return r.prototype.save=function(t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c;return J(this,function(s){switch(s.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,Rc(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),t.weightData==null?[3,4]:((c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,c.href=e,[4,Rc(function(){return c.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:nr(t)}]}})})},r.URL_SCHEME="downloads://",r}(),Qm=function(){function r(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return r.prototype.load=function(){return Q(this,void 0,void 0,function(){var t,e,n=this;return J(this,function(o){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(a,i){var c=new FileReader;c.onload=function(s){var l=JSON.parse(s.target.result),u=l.modelTopology;if(u!=null){e.length===0&&a({modelTopology:u});var h=l.weightsManifest;if(h!=null){var f;try{f=n.checkManifestAndWeightFiles(h,e)}catch(m){return void i(m)}var d=[],p=[],v=[];h.forEach(function(m){m.paths.forEach(function(g){p.push(g),v.push(null)}),d.push.apply(d,m.weights)}),h.forEach(function(m){m.paths.forEach(function(g){var b=new FileReader;b.onload=function(y){var x=y.target.result,w=p.indexOf(g);v[w]=x,v.indexOf(null)===-1&&a({modelTopology:u,weightSpecs:d,weightData:y6(v),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},b.onerror=function(y){return i("Failed to weights data from file of path '"+g+"'.")},b.readAsArrayBuffer(f[g])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},c.onerror=function(s){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},c.readAsText(t)})]})})},r.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],o=e.map(function(s){return Ac(s.name)}),a={},i=0,c=t;i<c.length;i++)c[i].paths.forEach(function(s){var l=Ac(s);if(n.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(n.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");a[s]=e[o.indexOf(l)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return a},r}();function Oc(r,t,e,n){(function(a){E(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(r),function(a,i){E(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),E(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),E(i>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+i})}(e=e??0,n=n??1);var o=0;return Promise.all(r.map(function(a){return a.then(function(i){var c=e+ ++o/r.length*(n-e);return t(c),i}),a}))}function l7(r,t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c,s,l,u;return J(this,function(h){switch(h.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?B().platform.fetch:t.fetchFunc,n=r.map(function(f){return e(f,t.requestInit,{isBinary:!0})}),o=0,a=.5,t.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return i=h.sent(),[3,4];case 2:return[4,Oc(n,t.onProgress,o,a)];case 3:i=h.sent(),h.label=4;case 4:return c=i.map(function(f){return f.arrayBuffer()}),s=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(c)];case 5:return u=h.sent(),[3,8];case 6:return[4,Oc(c,t.onProgress,s,l)];case 7:u=h.sent(),h.label=8;case 8:return[2,u]}})})}function Nc(r){var t=this;return function(e,n,o){return n===void 0&&(n=""),Q(t,void 0,void 0,function(){var a,i,c,s,l,u,h,f,d,p;return J(this,function(v){switch(v.label){case 0:if(a=e.map(function(){return!1}),i={},c=o!=null?o.map(function(){return!1}):[],s=[],e.forEach(function(m,g){var b=0;m.weights.forEach(function(y){var x="quantization"in y?y.quantization.dtype:y.dtype,w=Lo[x]*te(y.shape),z=function(){a[g]=!0,i[g]==null&&(i[g]=[]),i[g].push({manifestEntry:y,groupOffset:b,sizeBytes:w})};o!=null?o.forEach(function(M,_){M===y.name&&(z(),c[_]=!0)}):z(),s.push(y.name),b+=w})}),!c.every(function(m){return m}))throw l=o.filter(function(m,g){return!c[g]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+s.join(", ")+".");return u=a.reduce(function(m,g,b){return g&&m.push(b),m},[]),h=[],u.forEach(function(m){e[m].paths.forEach(function(g){var b=n+(n.endsWith("/")?"":"/")+g;h.push(b)})}),[4,r(h)];case 1:return f=v.sent(),d={},p=0,u.forEach(function(m){for(var g=e[m].paths.length,b=0,y=0;y<g;y++)b+=f[p+y].byteLength;for(var x=new ArrayBuffer(b),w=new Uint8Array(x),z=0,M=0;M<g;M++){var _=new Uint8Array(f[p+M]);w.set(_,z),z+=_.byteLength}i[m].forEach(function(S){var k=a7(x.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var L in k)d[L]=k[L]}),p+=g}),[2,d]}})})}}st.registerSaveRouter(function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(uo.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new uo(t)}(r.slice(uo.URL_SCHEME.length)):null});var u7=function(){function r(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(E(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=B().platform.fetch,E(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&E(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(t){return Q(this,void 0,void 0,function(){var e,n,o,a;return J(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:nr(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},r.prototype.load=function(){return Q(this,void 0,void 0,function(){var t,e,n,o,a,i,c,s,l,u,h,f;return J(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return e=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(o=e.modelTopology,a=e.weightsManifest,i=e.generatedBy,c=e.convertedBy,s=e.format,l=e.userDefinedMetadata,o==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:f=d.sent(),u=f[0],h=f[1],d.label=7;case 7:return[2,{modelTopology:o,weightSpecs:u,weightData:h,userDefinedMetadata:l,generatedBy:i,convertedBy:c,format:s}]}})})},r.prototype.loadWeights=function(t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c,s,l,u,h,f;return J(this,function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(p){var v=p.lastIndexOf("/"),m=p.lastIndexOf("?"),g=p.substring(0,v),b=m>v?p.substring(m):"";return[g+"/",b]}(e),o=n[0],a=n[1],i=this.weightPathPrefix||o,c=[],s=0,l=t;s<l.length;s++)u=l[s],c.push.apply(c,u.weights);return h=[],t.forEach(function(p){p.paths.forEach(function(v){h.push(i+v+a)})}),[4,l7(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[c,y6(f)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function Do(r){return r.match(u7.URL_SCHEME_REGEX)!=null}var Pc=function(r,t){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(e){return Do(e)}):Do(r))?Io(r,{onProgress:t}):null};function Io(r,t){return new u7(r,t)}st.registerSaveRouter(Pc),st.registerLoadRouter(Pc);var ho=function(){function r(t){this.modelArtifacts=t}return r.prototype.load=function(){return Q(this,void 0,void 0,function(){return J(this,function(t){return[2,this.modelArtifacts]})})},r}(),Jm=function(){function r(t){this.saveHandler=t}return r.prototype.save=function(t){return Q(this,void 0,void 0,function(){return J(this,function(e){return[2,this.saveHandler(t)]})})},r}(),L3=Object.freeze({browserFiles:function(r){return new Qm(r)},browserHTTPRequest:function(r,t){return Io(r,t)},concatenateArrayBuffers:y6,decodeWeights:a7,encodeWeights:function(r,t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c=this;return J(this,function(s){switch(s.label){case 0:for(e=[],n=[],o=Array.isArray(r)?r.map(function(l){return l.name}):Object.keys(r),a=function(l){var u=o[l],h=Array.isArray(r)?r[l].tensor:r[u];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+u+"': "+h.dtype);var f={name:u,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(p){return Q(c,void 0,void 0,function(){var v,m,g,b,y,x,w;return J(this,function(z){switch(z.label){case 0:return[4,h.bytes()];case 1:for(v=z.sent(),m=v.reduce(function(M,_){return M+_.length},0)+y3*v.length,g=new Uint8Array(m),b=0,y=0;y<v.length;y++)x=v[y],w=new Uint8Array(new Uint32Array([x.length]).buffer),g.set(w,b),b+=y3,g.set(x,b),b+=x.length;return p(g),[2]}})})});n.push(d)}else n.push(h.data());t!=null&&(f.group=t),e.push(f)},i=0;i<o.length;++i)a(i);return[4,Promise.all(n)];case 1:return[2,{data:Pm(s.sent()),specs:e}]}})})},fromMemory:function(r,t,e,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new ho(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ho({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ho({modelTopology:r,weightSpecs:t,weightData:e,trainingConfig:n}))},getLoadHandlers:function(r,t){return st.getLoadHandlers(r,t)},getModelArtifactsInfoForJSON:nr,getSaveHandlers:function(r){return st.getSaveHandlers(r)},http:Io,isHTTPScheme:Do,loadWeights:function(r,t,e,n){return t===void 0&&(t=""),Q(this,void 0,void 0,function(){return J(this,function(o){return[2,Nc(function(a){return l7(a,{requestInit:n})})(r,t,e)]})})},registerLoadRouter:function(r){return st.registerLoadRouter(r)},registerSaveRouter:function(r){return st.registerSaveRouter(r)},weightsLoaderFactory:Nc,withSaveHandler:function(r){return new Jm(r)},copyModel:function(r,t){return Q(this,void 0,void 0,function(){return J(this,function(e){return[2,Dc(r,t,!1)]})})},listModels:function(){return Q(this,void 0,void 0,function(){var r,t,e,n,o,a,i;return J(this,function(c){switch(c.label){case 0:r=Hn.getSchemes(),t={},e=0,n=r,c.label=1;case 1:return e<n.length?(o=n[e],[4,Hn.getManager(o).listModels()]):[3,4];case 2:for(i in a=c.sent())t[o+D4+i]=a[i];c.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(r,t){return Q(this,void 0,void 0,function(){return J(this,function(e){return[2,Dc(r,t,!0)]})})},removeModel:function(r){return Q(this,void 0,void 0,function(){var t;return J(this,function(e){return t=o3(r),[2,Hn.getManager(t.scheme).removeModel(t.path)]})})}}),H4,eg=H({confusionMatrix_:function(r,t,e){var n=C(r,"labels","confusionMatrix"),o=C(t,"predictions","confusionMatrix");E(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),E(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),E(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),E(n.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),E(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var a=ko(n.asType("int32"),e),i=ko(o.asType("int32"),e);return a.transpose().matMul(i).asType("int32")}}),Kw=Object.freeze({confusionMatrix:eg}),tg=H({fromPixels_:function(r,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,n=!1,o=!1,a=!1,i=!1;if(r.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)a=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);i=!0}if(o&&o&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Gc("FromPixels",T.backendName)!=null)return T.runKernel("FromPixels",{pixels:r},{numChannels:t});var c,s,l=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=l[0],h=l[1];if(i?c=r.getContext("2d").getImageData(0,0,u,h).data:n||e?c=r.data:(a||o)&&(H4==null&&(H4=document.createElement("canvas").getContext("2d")),H4.canvas.width=u,H4.canvas.height=h,H4.drawImage(r,0,0,u,h),c=H4.getImageData(0,0,u,h).data),t===4)s=new Int32Array(c);else{var f=u*h;s=new Int32Array(f*t);for(var d=0;d<f;d++)for(var p=0;p<t;++p)s[d*t+p]=c[4*d+p]}return M3(s,[h,u,t],"int32")}}),G4=Object.freeze({toPixels:function(r,t){return Q(this,void 0,void 0,function(){var e,n,o,a,i,c,s,l,u,h,f,d,p,v,m,g,b,y,x,w,z,M,_;return J(this,function(S){switch(S.label){case 0:if(e=C(r,"img","toPixels"),r instanceof Ie||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(n=e.shape.slice(0,2),o=n[0],a=n[1],(i=e.rank===2?1:e.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,e.data()];case 1:return c=S.sent(),s=e.min(),l=e.max(),[4,Promise.all([s.data(),l.data()])];case 2:if(u=S.sent(),h=u[0],f=u[1],d=h[0],p=f[0],s.dispose(),l.dispose(),e.dtype==="float32"){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(v=e.dtype==="float32"?255:1,m=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)b=void 0,y=void 0,x=void 0,w=void 0,i===1?(b=c[g]*v,y=c[g]*v,x=c[g]*v,w=255):i===3?(b=c[3*g]*v,y=c[3*g+1]*v,x=c[3*g+2]*v,w=255):i===4&&(b=c[4*g]*v,y=c[4*g+1]*v,x=c[4*g+2]*v,w=c[4*g+3]*v),m[(z=4*g)+0]=Math.round(b),m[z+1]=Math.round(y),m[z+2]=Math.round(x),m[z+3]=Math.round(w);return t!=null&&(t.width=a,t.height=o,M=t.getContext("2d"),_=new ImageData(m,a,o),M.putImageData(_,0,0)),e!==r&&e.dispose(),[2,m]}})})},fromPixels:tg}),h7=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(t,e){return new t(e)},r}(),f7=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(t){r.getMap().classNameMap[t.className]=[t,t.fromConfig]},r}();function Ln(r){E(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),E(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),E(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),f7.register(r)}var Xw=Object.freeze({Serializable:h7,SerializationMap:f7,registerClass:Ln}),ng=.001,d7=.1;function fo(){return T.backend.floatPrecision()===32?ng:d7}function po(r,t,e){var n=!0;if((k1(r)||k1(t))&&(n=!1),k1(r)&&k1(t)&&(n=!0),n){var o=r.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(r)&&Array.isArray(t)){var i=Rt(r),c=Rt(t);if(!o1(i,c))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+c+"]")}var s=k1(r)?r:rn(r),l=k1(t)?t:rn(t);if(s.length!==l.length)throw new Error("Arrays have different lengths actual: "+s.length+" vs expected: "+l.length+`.
Actual:   `+s+`.
Expected: `+l+".");for(var u=0;u<l.length;++u){var h=s[u],f=l[u];if(!e(h,f))throw new Error("Arrays differ: actual["+u+"] = "+h+", expected["+u+"] = "+f+`.
Actual:   `+s+`.
Expected: `+l+".")}}function vo(r,t,e){return!isFinite(r)&&!isFinite(t)||!(isNaN(r)||isNaN(t)||Math.abs(r-t)>e)}var Yw=Object.freeze({TEST_EPSILON_FLOAT16:d7,expectArraysClose:function(r,t,e){return e==null&&(e=fo()),po(r,t,function(n,o){return vo(n,o,e)})},testEpsilon:fo,expectPromiseToFail:function(r,t){r().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(r,t){var e=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return Sn(r)||Sn(r[0])||Sn(t)||Sn(t[0])?po(r,e,function(n,o){return n==o}):po(r,t,function(n,o){return vo(n,o,0)})},expectNumbersClose:function(r,t,e){if(e==null&&(e=fo()),!vo(r,t,e))throw new Error("Numbers differ: actual === "+r+", expected === "+t)},expectValuesInRange:function(r,t,e){for(var n=0;n<r.length;n++)if(r[n]<t||r[n]>e)throw new Error("Value out of range:"+r[n]+" low: "+t+", high: "+e)},expectArrayBuffersEqual:function(r,t){expect(new Float32Array(r)).toEqual(new Float32Array(t))}});var Zw=Object.freeze({gpgpu_util:_d,webgl_util:Kh,forceHalfFloat:function(){B().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:H5,setWebGLContext:ss,GPGPUContext:z5}),s4=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return zt(t,r),t.prototype.minimize=function(e,n,o){n===void 0&&(n=!1);var a=this.computeGradients(e,o),i=a.value,c=a.grads;if(o!=null){var s=o.map(function(l){return{name:l.name,tensor:c[l.name]}});this.applyGradients(s)}else this.applyGradients(c);return Z1(c),n?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,n){return Hf(e,n)},t.prototype.dispose=function(){this.iterations_!=null&&Z1(this.iterations_)},t.prototype.saveIterations=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:K(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Q(this,void 0,void 0,function(){var n;return J(this,function(o){switch(o.label){case 0:return n=this,[4,e[0].tensor.data()];case 1:return n.iterations_=o.sent()[0],[2,e.slice(1)]}})})},t}(h7);Object.defineProperty(s4,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var p7=function(r){function t(e,n,o){o===void 0&&(o=null);var a=r.call(this)||this;return a.learningRate=e,a.rho=n,a.epsilon=o,a.accumulatedGrads=[],a.accumulatedUpdates=[],o==null&&(a.epsilon=T.backend.epsilon()),a}return zt(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=T.registeredVariables[o];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:o+"/accum_grad",variable:U(function(){return Ee(i).variable(!1)})}),n.accumulatedUpdates[a]==null&&(n.accumulatedUpdates[a]={originalName:o+"/accum_var",variable:U(function(){return Ee(i).variable(!1)})});var c=Array.isArray(e)?e[a].tensor:e[o];if(c!=null){var s=n.accumulatedGrads[a].variable,l=n.accumulatedUpdates[a].variable;U(function(){var u=s.mul(n.rho).add(c.square().mul(1-n.rho)),h=l.add(n.epsilon).sqrt().div(s.add(n.epsilon).sqrt()).mul(c),f=l.mul(n.rho).add(h.square().mul(1-n.rho));s.assign(u),l.assign(f);var d=h.mul(-n.learningRate).add(i);i.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Z1(this.accumulatedGrads.map(function(e){return e.variable})),Z1(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){var e;return J(this,function(n){switch(n.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){var n;return J(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),n=e.length/2,this.accumulatedGrads=e.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.rho,n.epsilon)},t.className="Adadelta",t}(s4);Ln(p7);var v7=function(r){function t(e,n){n===void 0&&(n=.1);var o=r.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=n,o.accumulatedGrads=[],o}return zt(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=T.registeredVariables[o];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:o+"/accumulator",variable:U(function(){return lt(i.shape,n.initialAccumulatorValue).variable(!1)})});var c=Array.isArray(e)?e[a].tensor:e[o];if(c!=null){var s=n.accumulatedGrads[a].variable;U(function(){var l=s.add(c.square());s.assign(l);var u=c.div(l.add(T.backend.epsilon()).sqrt()).mul(-n.learningRate).add(i);i.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&Z1(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,n){return new e(n.learningRate,n.initialAccumulatorValue)},t.className="Adagrad",t}(s4);Ln(v7);var m7=function(r){function t(e,n,o,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=o,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],U(function(){i.accBeta1=K(n).variable(),i.accBeta2=K(o).variable()}),a==null&&(i.epsilon=T.backend.epsilon()),i}return zt(t,r),t.prototype.applyGradients=function(e){var n=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);U(function(){var a=Be(1,n.accBeta1),i=Be(1,n.accBeta2);o.forEach(function(c,s){var l=T.registeredVariables[c];n.accumulatedFirstMoment[s]==null&&(n.accumulatedFirstMoment[s]={originalName:c+"/m",variable:U(function(){return Ee(l).variable(!1)})}),n.accumulatedSecondMoment[s]==null&&(n.accumulatedSecondMoment[s]={originalName:c+"/v",variable:U(function(){return Ee(l).variable(!1)})});var u=Array.isArray(e)?e[s].tensor:e[c];if(u!=null){var h=n.accumulatedFirstMoment[s].variable,f=n.accumulatedSecondMoment[s].variable,d=h.mul(n.beta1).add(u.mul(1-n.beta1)),p=f.mul(n.beta2).add(u.square().mul(1-n.beta2)),v=d.div(a),m=p.div(i);h.assign(d),f.assign(p);var g=v.div(m.sqrt().add(n.epsilon)).mul(-n.learningRate).add(l);l.assign(g)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Z1(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&Z1(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){var e;return J(this,function(n){switch(n.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){var n,o=this;return J(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),U(function(){o.accBeta1.assign(x3(o.beta1,o.iterations_+1)),o.accBeta2.assign(x3(o.beta2,o.iterations_+1))}),n=e.length/2,this.accumulatedFirstMoment=e.slice(0,n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(n,2*n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)},t.className="Adam",t}(s4);Ln(m7);var g7=function(r){function t(e,n,o,a,i){a===void 0&&(a=null),i===void 0&&(i=0);var c=r.call(this)||this;return c.learningRate=e,c.beta1=n,c.beta2=o,c.epsilon=a,c.decay=i,c.accumulatedFirstMoment=[],c.accumulatedWeightedInfNorm=[],U(function(){c.iteration=K(0).variable(),c.accBeta1=K(n).variable()}),a==null&&(c.epsilon=T.backend.epsilon()),c}return zt(t,r),t.prototype.applyGradients=function(e){var n=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);U(function(){var a=Be(1,n.accBeta1),i=ft(-n.learningRate,n.iteration.mul(n.decay).add(1));o.forEach(function(c,s){var l=T.registeredVariables[c];n.accumulatedFirstMoment[s]==null&&(n.accumulatedFirstMoment[s]={originalName:c+"/m",variable:Ee(l).variable(!1)}),n.accumulatedWeightedInfNorm[s]==null&&(n.accumulatedWeightedInfNorm[s]={originalName:c+"/v",variable:Ee(l).variable(!1)});var u=Array.isArray(e)?e[s].tensor:e[c];if(u!=null){var h=n.accumulatedFirstMoment[s].variable,f=n.accumulatedWeightedInfNorm[s].variable,d=h.mul(n.beta1).add(u.mul(1-n.beta1)),p=f.mul(n.beta2),v=u.abs(),m=p.maximum(v);h.assign(d),f.assign(m);var g=i.div(a).mul(d.div(m.add(n.epsilon))).add(l);l.assign(g)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Z1(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&Z1(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},t.className="Adamax",t}(s4);Ln(g7);var w6=function(r){function t(e){var n=r.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return zt(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=Array.isArray(e)?e[a].tensor:e[o];if(i!=null){var c=T.registeredVariables[o];U(function(){var s=n.c.mul(i).add(c);c.assign(s)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Xh(K(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,n){return new e(n.learningRate)},t.className="SGD",t}(s4);Ln(w6);var x7=function(r){function t(e,n,o){o===void 0&&(o=!1);var a=r.call(this,e)||this;return a.learningRate=e,a.momentum=n,a.useNesterov=o,a.accumulations=[],a.m=K(a.momentum),a}return zt(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=T.registeredVariables[o];n.accumulations[a]==null&&(n.accumulations[a]={originalName:o+"/momentum",variable:U(function(){return Ee(i).variable(!1)})});var c=n.accumulations[a].variable,s=Array.isArray(e)?e[a].tensor:e[o];s!=null&&U(function(){var l,u=n.m.mul(c).add(s);l=n.useNesterov?n.c.mul(s.add(u.mul(n.m))).add(i):n.c.mul(u).add(i),c.assign(u),i.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Z1(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){return J(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)},t.className="Momentum",t}(w6);Ln(x7);var b7=function(r){function t(e,n,o,a,i){n===void 0&&(n=.9),o===void 0&&(o=0),a===void 0&&(a=null),i===void 0&&(i=!1);var c=r.call(this)||this;if(c.learningRate=e,c.decay=n,c.momentum=o,c.epsilon=a,c.accumulatedMeanSquares=[],c.accumulatedMoments=[],c.accumulatedMeanGrads=[],c.centered=i,a==null&&(c.epsilon=T.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return c}return zt(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=T.registeredVariables[o];n.accumulatedMeanSquares[a]==null&&(n.accumulatedMeanSquares[a]={originalName:o+"/rms",variable:U(function(){return Ee(i).variable(!1)})}),n.accumulatedMoments[a]==null&&(n.accumulatedMoments[a]={originalName:o+"/momentum",variable:U(function(){return Ee(i).variable(!1)})}),n.accumulatedMeanGrads[a]==null&&n.centered&&(n.accumulatedMeanGrads[a]={originalName:o+"/mg",variable:U(function(){return Ee(i).variable(!1)})});var c=Array.isArray(e)?e[a].tensor:e[o];if(c!=null){var s=n.accumulatedMeanSquares[a].variable,l=n.accumulatedMoments[a].variable;U(function(){var u=s.mul(n.decay).add(c.square().mul(1-n.decay));if(n.centered){var h=n.accumulatedMeanGrads[a].variable,f=h.mul(n.decay).add(c.mul(1-n.decay)),d=l.mul(n.momentum).add(c.mul(n.learningRate).div(u.sub(f.square().add(n.epsilon)).sqrt()));s.assign(u),h.assign(f),l.assign(d);var p=i.sub(d);i.assign(p)}else{var v=s.mul(n.decay).add(c.square().mul(1-n.decay));d=l.mul(n.momentum).add(c.mul(n.learningRate).div(v.add(n.epsilon).sqrt())),s.assign(v),l.assign(d),p=i.sub(d),i.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Z1(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Z1(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&Z1(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Q(this,void 0,void 0,function(){var e;return J(this,function(n){switch(n.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Q(this,void 0,void 0,function(){var n;return J(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),n=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*n,3*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},t.className="RMSProp",t}(s4);Ln(b7);var Kn=function(){function r(){}return r.sgd=function(t){return new w6(t)},r.momentum=function(t,e,n){return n===void 0&&(n=!1),new x7(t,e,n)},r.rmsprop=function(t,e,n,o,a){return e===void 0&&(e=.9),n===void 0&&(n=0),o===void 0&&(o=null),a===void 0&&(a=!1),new b7(t,e,n,o,a)},r.adam=function(t,e,n,o){return t===void 0&&(t=.001),e===void 0&&(e=.9),n===void 0&&(n=.999),o===void 0&&(o=null),new m7(t,e,n,o)},r.adadelta=function(t,e,n){return t===void 0&&(t=.001),e===void 0&&(e=.95),n===void 0&&(n=null),new p7(t,e,n)},r.adamax=function(t,e,n,o,a){return t===void 0&&(t=.002),e===void 0&&(e=.9),n===void 0&&(n=.999),o===void 0&&(o=null),a===void 0&&(a=0),new g7(t,e,n,o,a)},r.adagrad=function(t,e){return e===void 0&&(e=.1),new v7(t,e)},r}(),Qw={sgd:Kn.sgd,momentum:Kn.momentum,adadelta:Kn.adadelta,adagrad:Kn.adagrad,rmsprop:Kn.rmsprop,adamax:Kn.adamax,adam:Kn.adam};Ie.prototype.squaredDifference=function(r){return V5(this,r)},A=Am;function Fn(r,t,e){if(e===void 0&&(e=!1),r.beginPath(),t.slice(1).forEach(function(a,i){var c=a.x,s=a.y,l=t[i];r.moveTo(l.x,l.y),r.lineTo(c,s)}),e){var n=t[t.length-1],o=t[0];if(!n||!o)return;r.moveTo(n.x,n.y),r.lineTo(o.x,o.y)}r.stroke()}var z6=function(r,t){return z6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])},z6(r,t)};function X(r,t){z6(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var c1=function(){return c1=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},c1.apply(this,arguments)};function j(r,t,e,n){function o(a){return a instanceof e?a:new e(function(i){i(a)})}return new(e||(e=Promise))(function(a,i){function c(u){try{l(n.next(u))}catch(h){i(h)}}function s(u){try{l(n.throw(u))}catch(h){i(h)}}function l(u){u.done?a(u.value):o(u.value).then(c,s)}l((n=n.apply(r,t||[])).next())})}function $(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,o,a,i;return i={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(l){return function(u){return s([l,u])}}function s(l){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,o&&(a=l[0]&2?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,o=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){e.label=l[1];break}if(l[0]===6&&e.label<a[1]){e.label=a[1],a=l;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(l);break}a[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(r,e)}catch(u){l=[6,u],o=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function l4(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var n=Array(r),o=0,t=0;t<e;t++)for(var a=arguments[t],i=0,c=a.length;i<c;i++,o++)n[o]=a[i];return n}var Et=function(){function r(t,e){if(!Nt(t)||!Nt(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function rr(r,t){return r instanceof Ie&&r.shape.length===t}function y7(r){return rr(r,2)}function An(r){return rr(r,3)}function pt(r){return rr(r,4)}function w7(r){return r%1!==0}function M6(r){return r%2===0}function F3(r,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(r*e)/e}function C6(r){return r&&r.width&&r.height}function z7(r,t){var e=r.width,n=r.height,o=t/Math.max(n,e);return new Et(Math.round(e*o),Math.round(n*o))}function q4(r){return r.reduce(function(t,e){return t.add(e)},new pe(0,0)).div(new pe(r.length,r.length))}function ln(r,t,e){return Array(r).fill(0).map(function(n,o){return t+o*e})}function Nt(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function A3(r){return Nt(r)&&0<=r&&r<=1}var pe=function(){function r(t,e){this._x=t,this._y=e}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.sub=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.mul=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.div=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}();var V1=function(){function r(t,e){e===void 0&&(e=!0);var n=t||{},o=[n.left,n.top,n.right,n.bottom].every(Nt),a=[n.x,n.y,n.width,n.height].every(Nt);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var i=a?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],c=i[0],s=i[1],l=i[2],u=i[3];r.assertIsValidBox({x:c,y:s,width:l,height:u},"Box.constructor",e),this._x=c,this._y=s,this._width=l,this._height=u}return r.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Nt)},r.assertIsValidBox=function(t,e,n){if(n===void 0&&(n=!1),!r.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!n&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new pe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new pe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new pe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new pe(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),e=t[0],n=t[1],o=t[2],a=t[3];return new r({x:e,y:n,width:o,height:a})},r.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),e=t[0],n=t[1],o=t[2],a=t[3];return new r({x:e,y:n,width:o,height:a})},r.prototype.toSquare=function(){var t=this,e=t.x,n=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(e-=i/2,o+=i),a<o&&(n-=i/2,a+=i),new r({x:e,y:n,width:o,height:a})},r.prototype.rescale=function(t){var e=C6(t)?t.width:t,n=C6(t)?t.height:t;return new r({x:this.x*e,y:this.y*n,width:this.width*e,height:this.height*n})},r.prototype.pad=function(t,e){var n=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],o=n[0],a=n[1],i=n[2],c=n[3];return new r({x:o,y:a,width:i,height:c})},r.prototype.clipAtImageBorders=function(t,e){var n=this,o=n.x,a=n.y,i=n.right,c=n.bottom,s=Math.max(o,0),l=Math.max(a,0),u=i-s,h=c-l,f=Math.min(u,t-s),d=Math.min(h,e-l);return new r({x:s,y:l,width:f,height:d}).floor()},r.prototype.shift=function(t,e){var n=this,o=n.width,a=n.height,i=this.x+t,c=this.y+e;return new r({x:i,y:c,width:o,height:a})},r.prototype.padAtBorders=function(t,e){var n=this.width+1,o=this.height+1,a=1,i=1,c=n,s=o,l=this.left,u=this.top,h=this.right,f=this.bottom;return h>e&&(c=-h+e+n,h=e),f>t&&(s=-f+t+o,f=t),l<1&&(s=2-l,l=1),u<1&&(s=2-u,u=1),{dy:i,edy:s,dx:a,edx:c,y:u,ey:f,x:l,ex:h,w:n,h:o}},r.prototype.calibrate=function(t){return new r({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},r}();var u4=function(r){X(t,r);function t(e,n,o,a,i){return i===void 0&&(i=!1),r.call(this,{left:e,top:n,right:o,bottom:a},i)||this}return t}(V1);var D3=function(){function r(t,e,n,o,a){this._imageDims=new Et(a.width,a.height),this._score=t,this._classScore=e,this._className=n,this._box=new V1(o).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new V1(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},r}();var e1=function(r){X(t,r);function t(e,n,o){return r.call(this,e,e,"",n,o)||this}return t.prototype.forSize=function(e,n){var o=r.prototype.forSize.call(this,e,n),a=o.score,i=o.relativeBox,c=o.imageDims;return new t(a,i,c)},t}(D3);function M7(r,t,e){e===void 0&&(e=!0);var n=Math.max(0,Math.min(r.right,t.right)-Math.max(r.left,t.left)),o=Math.max(0,Math.min(r.bottom,t.bottom)-Math.max(r.top,t.top)),a=n*o;return e?a/(r.area+t.area-a):a/Math.min(r.area,t.area)}function C7(r){var t=r.map(function(c){return c.x}),e=r.map(function(c){return c.y}),n=t.reduce(function(c,s){return s<c?s:c},1/0),o=e.reduce(function(c,s){return s<c?s:c},1/0),a=t.reduce(function(c,s){return c<s?s:c},0),i=e.reduce(function(c,s){return c<s?s:c},0);return new u4(n,o,a,i)}function un(r,t,e,n){n===void 0&&(n=!0);for(var o=t.map(function(c,s){return{score:c,boxIndex:s}}).sort(function(c,s){return c.score-s.score}).map(function(c){return c.boxIndex}),a=[],i=function(){var c=o.pop();a.push(c);for(var s=o,l=[],u=0;u<s.length;u++){var h=s[u],f=r[c],d=r[h];l.push(M7(f,d,n))}o=o.filter(function(p,v){return l[v]<=e})};o.length>0;)i();return a}function Pt(r,t){return U(function(){var e=t[0],n=t[1],o=t[2],a=lt(l4(r.shape.slice(0,3),[1]),e),i=lt(l4(r.shape.slice(0,3),[1]),n),c=lt(l4(r.shape.slice(0,3),[1]),o),s=Ue([a,i,c],3);return Be(r,s)})}function _7(r,t){return t===void 0&&(t=!1),U(function(){var e=r.shape.slice(1),n=e[0],o=e[1];if(n===o)return r;var a=Math.abs(n-o),i=Math.round(a*(t?.5:1)),c=n>o?2:1,s=function(d){var p=r.shape.slice();return p[c]=d,lt(p,0)},l=s(i),u=a-l.shape[c],h=t&&u?s(u):null,f=[h,r,l].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return Ue(f,c)})}function I3(r){return 1/(1+Math.exp(-r))}var j4=function(r){X(t,r);function t(e,n,o,a,i){return i===void 0&&(i=!1),r.call(this,{x:e,y:n,width:o,height:a},i)||this}return t}(V1);var og=.5,ag=.43,ig=.45,hn=function(){function r(t,e,n){n===void 0&&(n=new pe(0,0));var o=e.width,a=e.height;this._imgDims=new Et(o,a),this._shift=n,this._positions=t.map(function(i){return i.mul(new pe(o,a)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new pe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new pe(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},r.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new pe(t,e))},r.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},r.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var n=t instanceof e1?t.box.floor():new V1(t);return this.shiftBy(n.x,n.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.useDlibAlignment,i=o.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},r.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],o=t[2],a=function(h){return o.sub(h).magnitude()},i=(a(e)+a(n))/2,c=Math.floor(i/ig),s=q4(t),l=Math.floor(Math.max(0,s.x-og*c)),u=Math.floor(Math.max(0,s.y-ag*c));return new j4(l,u,Math.min(c,this.imageWidth+l),Math.min(c,this.imageHeight+u))},r.prototype.alignMinBbox=function(t){var e=C7(this.positions);return e.pad(e.width*t,e.height*t)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}();var E7=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],q4([e[3],e[4]])]},t}(hn);var B3=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(q4)},t}(hn);var _6=function(){function r(t,e){this._label=t,this._distance=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+F3(this.distance)+")":"")},r}();var E6=function(r){X(t,r);function t(e,n){var o=r.call(this,e)||this;return o._label=n,o}return t.assertIsValidLabeledBox=function(e,n){if(V1.assertIsValidBox(e,n),!Nt(e.label))throw new Error(n+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(V1);var or=function(){function r(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},r.fromJSON=function(t){var e=t.descriptors.map(function(n){return new Float32Array(n)});return new r(t.label,e)},r}();var lM=function(r){X(t,r);function t(e,n,o,a){var i=r.call(this,e,n)||this;return i._score=o,i._classScore=a,i}return t.assertIsValidPredictedBox=function(e,n){if(E6.assertIsValidLabeledBox(e,n),!A3(e.score)||!A3(e.classScore))throw new Error(n+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t}(E6);function ar(r){return r.detection instanceof e1}function $4(r,t){var e={detection:t};return Object.assign({},r,e)}function S6(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:t}}function R3(r){var t="";if(!r)try{r=h0("fs")}catch(n){t=n.toString()}var e=r?function(n){return new Promise(function(o,a){r.readFile(n,function(i,c){return i?a(i):o(c)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function k6(){var r=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=R3();return c1({Canvas:r||function(){function i(){}return i}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function i(){}return i}(),Image:t||function(){function i(){}return i}(),ImageData:global.ImageData||function(){function i(){}return i}(),Video:global.HTMLVideoElement||function(){function i(){}return i}(),createCanvasElement:e,createImageElement:n,fetch:o},a)}function H6(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function V6(){return typeof global=="object"&&typeof h0=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var d1;function cg(){if(!d1)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return d1}function T6(r){d1=r}function L6(){H6()&&T6(S6()),V6()&&T6(k6())}function sg(r){if(d1||L6(),!d1)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=r.Canvas,e=t===void 0?d1.Canvas:t,n=r.Image,o=n===void 0?d1.Image:n;d1.Canvas=e,d1.Image=o,d1.createCanvasElement=r.createCanvasElement||function(){return new e},d1.createImageElement=r.createImageElement||function(){return new o},d1.ImageData=r.ImageData||d1.ImageData,d1.Video=r.Video||d1.Video,d1.fetch=r.fetch||d1.fetch,d1.readFile=r.readFile||d1.readFile}var Ve={getEnv:cg,setEnv:T6,initialize:L6,createBrowserEnv:S6,createFileSystem:R3,createNodejsEnv:k6,monkeyPatch:sg,isBrowser:H6,isNodejs:V6};L6();function K4(r){return!Ve.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function T1(r){var t=Ve.getEnv(),e=t.Canvas,n=t.CanvasRenderingContext2D;if(r instanceof n)return r;var o=K4(r);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=o.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var Dn=function(r){return r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r}(Dn||{}),F6=function(){function r(t){t===void 0&&(t={});var e=t.anchorPosition,n=t.backgroundColor,o=t.fontColor,a=t.fontSize,i=t.fontStyle,c=t.padding;this.anchorPosition=e||Dn.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=i||"Georgia",this.padding=c||4}return r}();var A6=function(){function r(t,e,n){n===void 0&&(n={}),this.text=typeof t=="string"?[t]:t instanceof r?t.text:t,this.anchor=e,this.options=new F6(n)}return r.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(n){return t.measureText(n).width}).reduce(function(n,o){return n<o?o:n},0)+2*e},r.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},r.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,o=n===Dn.BOTTOM_RIGHT||n===Dn.TOP_RIGHT,a=n===Dn.BOTTOM_LEFT||n===Dn.BOTTOM_RIGHT,i=this.measureWidth(t),c=this.measureHeight(),s=o?this.anchor.x-i:this.anchor.x,l=a?this.anchor.y-c:this.anchor.y;if(e){var u=e.width,h=e.height,f=Math.max(Math.min(s,u-i),0),d=Math.max(Math.min(l,h-c),0);return{x:f,y:d}}return{x:s,y:l}},r.prototype.draw=function(t){var e=K4(t),n=T1(e),o=this.options,a=o.backgroundColor,i=o.fontColor,c=o.fontSize,s=o.fontStyle,l=o.padding;n.font=c+"px "+s;var u=this.measureWidth(n),h=this.measureHeight();n.fillStyle=a;var f=this.getUpperLeft(n,e);n.fillRect(f.x,f.y,u,h),n.fillStyle=i,this.text.forEach(function(d,p){var v=l+f.x,m=l+f.y+(p+1)*c;n.fillText(d,v,m)})},r}();var lg=function(){function r(t){t===void 0&&(t={});var e=t.boxColor,n=t.lineWidth,o=t.label,a=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=o;var i={anchorPosition:Dn.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new F6(Object.assign({},i,a))}return r}();var ug=function(){function r(t,e){e===void 0&&(e={}),this.box=new V1(t),this.options=new lg(e)}return r.prototype.draw=function(t){var e=T1(t),n=this.options,o=n.boxColor,a=n.lineWidth,i=this.box,c=i.x,s=i.y,l=i.width,u=i.height;e.strokeStyle=o,e.lineWidth=a,e.strokeRect(c,s,l,u);var h=this.options.label;h&&new A6([h],{x:c-a/2,y:s},this.options.drawLabelOptions).draw(t)},r}();function O3(r){var t=Ve.getEnv(),e=t.Image,n=t.Video;return r instanceof e&&r.complete||r instanceof n&&r.readyState>=3}function S7(r){return new Promise(function(t,e){if(r instanceof Ve.getEnv().Canvas||O3(r))return t();function n(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",o),t(a))}function o(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",o),e(a))}r.addEventListener("load",n),r.addEventListener("error",o)})}function ir(r){var t=Ve.getEnv(),e=t.Image,n=t.Video;return r instanceof e?new Et(r.naturalWidth,r.naturalHeight):r instanceof n?new Et(r.videoWidth,r.videoHeight):new Et(r.width,r.height)}function h4(r){var t=r.width,e=r.height,n=Ve.getEnv().createCanvasElement,o=n();return o.width=t,o.height=e,o}function X4(r,t){var e=Ve.getEnv().ImageData;if(!(r instanceof e)&&!O3(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=t||ir(r),o=n.width,a=n.height,i=h4({width:o,height:a});return r instanceof e?T1(i).putImageData(r,0,0):T1(i).drawImage(r,0,0,o,a),i}function k7(r,t){return j(this,void 0,void 0,function(){var e,n,o,a,i,c;return $(this,function(s){switch(s.label){case 0:return e=t||Ve.getEnv().createCanvasElement(),n=r.shape.slice(pt(r)?1:0),o=n[0],a=n[1],i=n[2],c=U(function(){return r.as3D(o,a,i).toInt()}),[4,G4.toPixels(c,e)];case 1:return s.sent(),c.dispose(),[2,e]}})})}function D6(r){var t=Ve.getEnv(),e=t.Image,n=t.Canvas,o=t.Video;return r instanceof e||r instanceof n||r instanceof o}function H7(r,t,e){e===void 0&&(e=!1);var n=Ve.getEnv(),o=n.Image,a=n.Canvas;if(!(r instanceof o||r instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=ir(r),c=t/Math.max(i.height,i.width),s=c*i.width,l=c*i.height,u=h4({width:t,height:t}),h=r instanceof a?r:X4(r),f=Math.abs(s-l)/2,d=e&&s<l?f:0,p=e&&l<s?f:0;return T1(u).drawImage(h,d,p,s,l),u}var f4=function(){function r(t,e){var n=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(o,a){if(An(o)){n._imageTensors[a]=o,n._inputDimensions[a]=o.shape;return}if(pt(o)){var i=o.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");n._imageTensors[a]=o,n._inputDimensions[a]=o.shape.slice(1);return}var c=o instanceof Ve.getEnv().Canvas?o:X4(o);n._canvases[a]=c,n._inputDimensions[a]=[c.height,c.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var t=this;return ln(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},r.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},r.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},r.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},r.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),n=this.getInputHeight(t);return z7({width:e,height:n},this.inputSize)},r.prototype.toBatchTensor=function(t,e){var n=this;return e===void 0&&(e=!0),this._inputSize=t,U(function(){var o=ln(n.batchSize,0,1).map(function(i){var c=n.getInput(i);if(c instanceof Ie){var s=pt(c)?c:c.expandDims();return s=_7(s,e),(s.shape[1]!==t||s.shape[2]!==t)&&(s=tr.resizeBilinear(s,[t,t])),s.as3D(t,t,3)}if(c instanceof Ve.getEnv().Canvas)return G4.fromPixels(H7(c,t,e));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+c)}),a=H1(o.map(function(i){return i.toFloat()})).as4D(n.batchSize,t,t,3);return a})},r}();function Fe(r){return j(this,void 0,void 0,function(){var t,e,n;return $(this,function(o){switch(o.label){case 0:if(r instanceof f4)return[2,r];if(t=Array.isArray(r)?r:[r],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(a){return Array.isArray(r)?" at input index "+a+":":""},n=t.map(K4),n.forEach(function(a,i){if(!D6(a)&&!An(a)&&!pt(a))throw typeof t[i]=="string"?new Error("toNetInput -"+e(i)+" string passed, but could not resolve HTMLElement for element id "+t[i]):new Error("toNetInput -"+e(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(pt(a)){var c=a.shape[0];if(c!==1)throw new Error("toNetInput -"+e(i)+" tf.Tensor4D with batchSize "+c+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(a){return D6(a)&&S7(a)}))];case 1:return o.sent(),[2,new f4(n,Array.isArray(r))]}})})}function cr(r,t){return j(this,void 0,void 0,function(){var e,n,o,a,i,c,s;return $(this,function(l){switch(l.label){case 0:return e=Ve.getEnv().Canvas,n=r,r instanceof e?[3,5]:[4,Fe(r)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=o.getInput(0),a instanceof e?(i=a,[3,4]):[3,2];case 2:return[4,k7(a)];case 3:i=l.sent(),l.label=4;case 4:n=i,l.label=5;case 5:return c=T1(n),s=t.map(function(u){return u instanceof e1?u.forSize(n.width,n.height).box.floor():u}).map(function(u){return u.clipAtImageBorders(n.width,n.height)}),[2,s.map(function(u){var h=u.x,f=u.y,d=u.width,p=u.height,v=h4({width:d,height:p});return T1(v).putImageData(c.getImageData(h,f,d,p),0,0),v})]}})})}function sr(r,t){return j(this,void 0,void 0,function(){return $(this,function(e){if(!An(r)&&!pt(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(pt(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,U(function(){var n=r.shape.slice(pt(r)?1:0),o=n[0],a=n[1],i=n[2],c=t.map(function(l){return l instanceof e1?l.forSize(a,o).box:l}).map(function(l){return l.clipAtImageBorders(a,o)}),s=c.map(function(l){var u=l.x,h=l.y,f=l.width,d=l.height;return h6(r.as3D(o,a,i),[h,u,0],[d,f,i])});return s})]})})}function N3(r,t){return j(this,void 0,void 0,function(){var e,n;return $(this,function(o){switch(o.label){case 0:return e=Ve.getEnv().fetch,[4,e(r,t)];case 1:if(n=o.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function V7(r){return j(this,void 0,void 0,function(){return $(this,function(t){switch(t.label){case 0:return[4,N3(r)];case 1:return[2,t.sent().json()]}})})}function P3(r,t){var e=t+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:e};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var o=r.split("/").filter(function(c){return c}),a=r.endsWith(".json")?o[o.length-1]:e,i=n+(r.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return i=r.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+a:i+"/"+a}}function T7(r,t){return j(this,void 0,void 0,function(){var e,n,o,a;return $(this,function(i){switch(i.label){case 0:return e=P3(r,t),n=e.manifestUri,o=e.modelBaseUri,[4,V7(n)];case 1:return a=i.sent(),[2,L3.loadWeights(a,o)]}})})}var b1=function(){function r(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),n=e.obj,o=e.objProp;return n[o]},r.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),o=n.obj,a=n.objProp;o[a].dispose(),o[a]=e},r.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof t4})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof t4)})},r.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,o=e.tensor;t.reassignParamFromPath(n,o.variable())})},r.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,o=e.tensor,a=g1(o.dataSync());o.dispose(),t.reassignParamFromPath(n,a)})},r.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},r.prototype.load=function(t){return j(this,void 0,void 0,function(){return $(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},r.prototype.loadFromUri=function(t){return j(this,void 0,void 0,function(){var e;return $(this,function(n){switch(n.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,T7(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},r.prototype.loadFromDisk=function(t){return j(this,void 0,void 0,function(){var e,n,o,a,i,c,s,l,u,h;return $(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=Ve.getEnv().readFile,n=P3(t,this.getDefaultModelName()),o=n.manifestUri,a=n.modelBaseUri,i=function(d){return Promise.all(d.map(function(p){return e(p).then(function(v){return v.buffer})}))},c=L3.weightsLoaderFactory(i),u=(l=JSON).parse,[4,e(o)];case 1:return s=u.apply(l,[f.sent().toString()]),[4,c(s,a)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},r.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,o=e.params;this._paramMappings=n,this._params=o},r.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,o=e.params;this._paramMappings=n,this._params=o},r.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(a,i){if(!a.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+t);return{obj:a.nextObj,objProp:i,nextObj:a.nextObj[i]}},{nextObj:this.params}),n=e.obj,o=e.objProp;if(!n||!o||!(n[o]instanceof Ie))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:o}},r}();function j1(r,t,e){return U(function(){var n=J2(r,t.depthwise_filter,t.pointwise_filter,e,"same");return n=ce(n,t.bias),n})}function W3(r,t,e){return e===void 0&&(e=!1),U(function(){var n=Te(e?ce(x1(r,t.conv0.filters,[2,2],"same"),t.conv0.bias):j1(r,t.conv0,[2,2])),o=j1(n,t.conv1,[1,1]),a=Te(ce(n,o)),i=j1(a,t.conv2,[1,1]);return Te(ce(n,ce(o,i)))})}function lr(r,t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!0),U(function(){var o=Te(e?ce(x1(r,t.conv0.filters,n?[2,2]:[1,1],"same"),t.conv0.bias):j1(r,t.conv0,n?[2,2]:[1,1])),a=j1(o,t.conv1,[1,1]),i=Te(ce(o,a)),c=j1(i,t.conv2,[1,1]),s=Te(ce(o,ce(a,c))),l=j1(s,t.conv3,[1,1]);return Te(ce(o,ce(a,ce(c,l))))})}function O1(r,t,e,n){return e===void 0&&(e="same"),n===void 0&&(n=!1),U(function(){var o=ce(x1(r,t.filters,[1,1],e),t.bias);return n?Te(o):o})}function y1(r,t){Object.keys(r).forEach(function(e){t.some(function(n){return n.originalPath===e})||r[e].dispose()})}function In(r,t){return function(e,n,o,a){var i=f1(r(e*n*o*o),[o,o,e,n]),c=Re(r(n));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:c}}}function Y4(r,t){return function(e,n,o){var a=Bt(r(e*n),[e,n]),i=Re(r(n));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var I6=function(){function r(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}return r}();function Z4(r,t){return function(e,n,o){var a=f1(r(9*e),[3,3,e,1]),i=f1(r(e*n),[1,1,e,n]),c=Re(r(n));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new I6(a,i,c)}}function Q4(r){return function(t){var e=r(t+"/depthwise_filter",4),n=r(t+"/pointwise_filter",4),o=r(t+"/bias",1);return new I6(e,n,o)}}function N1(r,t){return function(e,n,o){var a=r[e];if(!rr(a,n))throw new Error("expected weightMap["+e+"] to be a Tensor"+n+"D, instead have "+a);return t.push({originalPath:e,paramPath:o||e}),a}}function w1(r){var t=r;function e(o){var a=t.slice(0,o);return t=t.slice(o),a}function n(){return t}return{extractWeights:e,getRemainingWeights:n}}function U3(r,t){var e=In(r,t),n=Z4(r,t);function o(i,c,s,l){l===void 0&&(l=!1);var u=l?e(i,c,3,s+"/conv0"):n(i,c,s+"/conv0"),h=n(c,c,s+"/conv1"),f=n(c,c,s+"/conv2");return{conv0:u,conv1:h,conv2:f}}function a(i,c,s,l){l===void 0&&(l=!1);var u=o(i,c,s,l),h=u.conv0,f=u.conv1,d=u.conv2,p=n(c,c,s+"/conv3");return{conv0:h,conv1:f,conv2:d,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function L7(r){var t=[],e=w1(r),n=e.extractWeights,o=e.getRemainingWeights,a=U3(n,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),c=a(32,64,"dense1"),s=a(64,128,"dense2"),l=a(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:c,dense2:s,dense3:l}}}function G3(r){return function(t){var e=r(t+"/filters",4),n=r(t+"/bias",1);return{filters:e,bias:n}}}function q3(r,t){var e=N1(r,t),n=G3(e),o=Q4(e);function a(c,s){s===void 0&&(s=!1);var l=s?n(c+"/conv0"):o(c+"/conv0"),u=o(c+"/conv1"),h=o(c+"/conv2");return{conv0:l,conv1:u,conv2:h}}function i(c,s){s===void 0&&(s=!1);var l=s?n(c+"/conv0"):o(c+"/conv0"),u=o(c+"/conv1"),h=o(c+"/conv2"),f=o(c+"/conv3");return{conv0:l,conv1:u,conv2:h,conv3:f}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:i}}function F7(r){var t=[],e=q3(r,t).extractDenseBlock4Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return y1(r,t),{params:n,paramMappings:t}}var j3=function(r){X(t,r);function t(){return r.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return U(function(){var o=e.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=Pt(o,a).div(K(255)),c=lr(i,n.dense0,!0);return c=lr(c,n.dense1),c=lr(c,n.dense2),c=lr(c,n.dense3),c=cn(c,[7,7],[2,2],"valid"),c})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return F7(e)},t.prototype.extractParams=function(e){return L7(e)},t}(b1);function Q1(r,t){return U(function(){return ce(U4(r,t.weights),t.bias)})}function A7(r,t,e){var n=[],o=w1(r),a=o.extractWeights,i=o.getRemainingWeights,c=Y4(a,n),s=c(t,e,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{fc:s}}}function D7(r){var t=[],e=N1(r,t);function n(a){var i=e(a+"/weights",2),c=e(a+"/bias",1);return{weights:i,bias:c}}var o={fc:n("fc")};return y1(r,t),{params:o,paramMappings:t}}function $3(r){var t={},e={};return Object.keys(r).forEach(function(n){var o=n.startsWith("fc")?e:t;o[n]=r[n]}),{featureExtractorMap:t,classifierMap:e}}var K3=function(r){X(t,r);function t(e,n){var o=r.call(this,e)||this;return o._faceFeatureExtractor=n,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return U(function(){var a=e instanceof f4?n.faceFeatureExtractor.forwardInput(e):e;return Q1(a.as2D(a.shape[0],-1),o.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),o=n.params,a=n.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(e){return A7(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var n=$3(e),o=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),D7(a)},t.prototype.extractParams=function(e){var n=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),a=o*n+o,i=e.slice(0,e.length-a),c=e.slice(e.length-a);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(c)},t}(b1);var I7=["neutral","happy","sad","angry","fearful","disgusted","surprised"],X3=function(){function r(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);I7.forEach(function(n,o){e[n]=t[o]})}return r.prototype.asSortedArray=function(){var t=this;return I7.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,n){return n.probability-e.probability})},r}();var B7=function(r){X(t,r);function t(e){return e===void 0&&(e=new j3),r.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var n=this;return U(function(){return q1(n.runNet(e))})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(e){return j(this,void 0,void 0,function(){var n,o,a,i,c=this;return $(this,function(s){switch(s.label){case 0:return[4,Fe(e)];case 1:return n=s.sent(),[4,this.forwardInput(n)];case 2:return o=s.sent(),[4,Promise.all(Le(o).map(function(l){return j(c,void 0,void 0,function(){var u;return $(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return u=h.sent(),l.dispose(),[2,u]}})})}))];case 3:return a=s.sent(),o.dispose(),i=a.map(function(l){return new X3(l)}),[2,n.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(K3);function B6(r,t){var e={expressions:t};return Object.assign({},r,e)}function Y3(r){return ar(r)&&r.landmarks instanceof hn&&r.unshiftedLandmarks instanceof hn&&r.alignedRect instanceof e1}function J4(r,t){var e=r.detection.box,n=t.shiftBy(e.x,e.y),o=n.align(),a=r.detection.imageDims,i=new e1(r.detection.score,o.rescale(a.reverse()),a),c={landmarks:n,unshiftedLandmarks:t,alignedRect:i};return Object.assign({},r,c)}var hg=function(){function r(t){t===void 0&&(t={});var e=t.drawLines,n=e===void 0?!0:e,o=t.drawPoints,a=o===void 0?!0:o,i=t.lineWidth,c=t.lineColor,s=t.pointSize,l=t.pointColor;this.drawLines=n,this.drawPoints=a,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=c||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return r}();var SS=function(){function r(t,e){e===void 0&&(e={}),this.faceLandmarks=t,this.options=new hg(e)}return r.prototype.draw=function(t){var e=T1(t),n=this.options,o=n.drawLines,a=n.drawPoints,i=n.lineWidth,c=n.lineColor,s=n.pointSize,l=n.pointColor;if(o&&this.faceLandmarks instanceof B3&&(e.strokeStyle=c,e.lineWidth=i,Fn(e,this.faceLandmarks.getJawOutline()),Fn(e,this.faceLandmarks.getLeftEyeBrow()),Fn(e,this.faceLandmarks.getRightEyeBrow()),Fn(e,this.faceLandmarks.getNose()),Fn(e,this.faceLandmarks.getLeftEye(),!0),Fn(e,this.faceLandmarks.getRightEye(),!0),Fn(e,this.faceLandmarks.getMouth(),!0)),a){e.strokeStyle=l,e.fillStyle=l;var u=function(h){e.beginPath(),e.arc(h.x,h.y,s,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(u)}},r}();function dg(r,t){var e=In(r,t),n=Z4(r,t);function o(i,c,s){var l=n(i,c,s+"/separable_conv0"),u=n(c,c,s+"/separable_conv1"),h=e(i,c,1,s+"/expansion_conv");return{separable_conv0:l,separable_conv1:u,expansion_conv:h}}function a(i,c){var s=n(i,i,c+"/separable_conv0"),l=n(i,i,c+"/separable_conv1"),u=n(i,i,c+"/separable_conv2");return{separable_conv0:s,separable_conv1:l,separable_conv2:u}}return{extractConvParams:e,extractSeparableConvParams:n,extractReductionBlockParams:o,extractMainBlockParams:a}}function R7(r,t){var e=[],n=w1(r),o=n.extractWeights,a=n.getRemainingWeights,i=dg(o,e),c=i.extractConvParams,s=i.extractSeparableConvParams,l=i.extractReductionBlockParams,u=i.extractMainBlockParams,h=c(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),d=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:f,reduction_block_1:d},v={};ln(t,0,1).forEach(function(y){v["main_block_"+y]=u(128,"middle_flow/main_block_"+y)});var m=l(128,256,"exit_flow/reduction_block"),g=s(256,512,"exit_flow/separable_conv"),b={reduction_block:m,separable_conv:g};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:v,exit_flow:b}}}function pg(r,t){var e=N1(r,t),n=G3(e),o=Q4(e);function a(c){var s=o(c+"/separable_conv0"),l=o(c+"/separable_conv1"),u=n(c+"/expansion_conv");return{separable_conv0:s,separable_conv1:l,expansion_conv:u}}function i(c){var s=o(c+"/separable_conv0"),l=o(c+"/separable_conv1"),u=o(c+"/separable_conv2");return{separable_conv0:s,separable_conv1:l,separable_conv2:u}}return{extractConvParams:n,extractSeparableConvParams:o,extractReductionBlockParams:a,extractMainBlockParams:i}}function O7(r,t){var e=[],n=pg(r,e),o=n.extractConvParams,a=n.extractSeparableConvParams,i=n.extractReductionBlockParams,c=n.extractMainBlockParams,s=o("entry_flow/conv_in"),l=i("entry_flow/reduction_block_0"),u=i("entry_flow/reduction_block_1"),h={conv_in:s,reduction_block_0:l,reduction_block_1:u},f={};ln(t,0,1).forEach(function(m){f["main_block_"+m]=c("middle_flow/main_block_"+m)});var d=i("exit_flow/reduction_block"),p=a("exit_flow/separable_conv"),v={reduction_block:d,separable_conv:p};return y1(r,e),{params:{entry_flow:h,middle_flow:f,exit_flow:v},paramMappings:e}}function N7(r,t,e){return ce(x1(r,t.filters,e,"same"),t.bias)}function R6(r,t,e){e===void 0&&(e=!0);var n=e?Te(r):r;return n=j1(n,t.separable_conv0,[1,1]),n=j1(Te(n),t.separable_conv1,[1,1]),n=Xe(n,[3,3],[2,2],"same"),n=ce(n,N7(r,t.expansion_conv,[2,2])),n}function vg(r,t){var e=j1(Te(r),t.separable_conv0,[1,1]);return e=j1(Te(e),t.separable_conv1,[1,1]),e=j1(Te(e),t.separable_conv2,[1,1]),e=ce(e,r),e}var P7=function(r){X(t,r);function t(e){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return t.prototype.forwardInput=function(e){var n=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return U(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],c=Pt(a,i).div(K(256)),s=Te(N7(c,o.entry_flow.conv_in,[2,2]));return s=R6(s,o.entry_flow.reduction_block_0,!1),s=R6(s,o.entry_flow.reduction_block_1),ln(n._numMainBlocks,0,1).forEach(function(l){s=vg(s,o.middle_flow["main_block_"+l])}),s=R6(s,o.exit_flow.reduction_block),s=Te(j1(s,o.exit_flow.separable_conv,[1,1])),s})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return O7(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return R7(e,this._numMainBlocks)},t}(b1);function W7(r){var t=[],e=w1(r),n=e.extractWeights,o=e.getRemainingWeights,a=Y4(n,t),i=a(512,1,"fc/age"),c=a(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:c}}}}function U7(r){var t=[],e=N1(r,t);function n(a){var i=e(a+"/weights",2),c=e(a+"/bias",1);return{weights:i,bias:c}}var o={fc:{age:n("fc/age"),gender:n("fc/gender")}};return y1(r,t),{params:o,paramMappings:t}}var ur=function(r){return r.FEMALE="female",r.MALE="male",r}(ur||{});var G7=function(r){X(t,r);function t(e){e===void 0&&(e=new P7(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return U(function(){var a=e instanceof f4?n.faceFeatureExtractor.forwardInput(e):e,i=cn(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),c=Q1(i,o.fc.age).as1D(),s=Q1(i,o.fc.gender);return{age:c,gender:s}})},t.prototype.forwardInput=function(e){var n=this;return U(function(){var o=n.runNet(e),a=o.age,i=o.gender;return{age:a,gender:q1(i)}})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return j(this,void 0,void 0,function(){var n,o,a,i,c,s,l=this;return $(this,function(u){switch(u.label){case 0:return[4,Fe(e)];case 1:return n=u.sent(),[4,this.forwardInput(n)];case 2:return o=u.sent(),a=Le(o.age),i=Le(o.gender),c=a.map(function(h,f){return{ageTensor:h,genderTensor:i[f]}}),[4,Promise.all(c.map(function(h){var f=h.ageTensor,d=h.genderTensor;return j(l,void 0,void 0,function(){var p,v,m,g,b;return $(this,function(y){switch(y.label){case 0:return[4,f.data()];case 1:return p=y.sent()[0],[4,d.data()];case 2:return v=y.sent()[0],m=v>.5,g=m?ur.MALE:ur.FEMALE,b=m?v:1-v,f.dispose(),d.dispose(),[2,{age:p,gender:g,genderProbability:b}]}})})}))];case 3:return s=u.sent(),o.age.dispose(),o.gender.dispose(),[2,n.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),o=n.params,a=n.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(e){return W7(e)},t.prototype.extractParamsFromWeigthMap=function(e){var n=$3(e),o=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),U7(a)},t.prototype.extractParams=function(e){var n=1539,o=e.slice(0,e.length-n),a=e.slice(e.length-n);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(b1);var Z3=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.postProcess=function(e,n,o){var a=o.map(function(c){var s=c.width,l=c.height,u=n/Math.max(l,s);return{width:s*u,height:l*u}}),i=a.length;return U(function(){var c=function(f,d){return H1([lt([68],f),lt([68],d)],1).as2D(1,136).as1D()},s=function(f,d){var p=a[f],v=p.width,m=p.height;return d(v,m)?Math.abs(v-m)/2:0},l=function(f){return s(f,function(d,p){return d<p})},u=function(f){return s(f,function(d,p){return p<d})},h=e.mul(lt([i,136],n)).sub(H1(Array.from(Array(i),function(f,d){return c(l(d),u(d))}))).div(H1(Array.from(Array(i),function(f,d){return c(a[d].width,a[d].height)})));return h})},t.prototype.forwardInput=function(e){var n=this;return U(function(){var o=n.runNet(e);return n.postProcess(o,e.inputSize,e.inputDimensions.map(function(a){var i=a[0],c=a[1];return{height:i,width:c}}))})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(e){return j(this,void 0,void 0,function(){var n,o,a,i=this;return $(this,function(c){switch(c.label){case 0:return[4,Fe(e)];case 1:return n=c.sent(),o=U(function(){return Le(i.forwardInput(n))}),[4,Promise.all(o.map(function(s,l){return j(i,void 0,void 0,function(){var u,h,f,d,p;return $(this,function(v){switch(v.label){case 0:return f=(h=Array).from,[4,s.data()];case 1:return u=f.apply(h,[v.sent()]),d=u.filter(function(m,g){return M6(g)}),p=u.filter(function(m,g){return!M6(g)}),[2,new B3(Array(68).fill(0).map(function(m,g){return new pe(d[g],p[g])}),{height:n.getInputHeight(l),width:n.getInputWidth(l)})]}})})}))];case 2:return a=c.sent(),o.forEach(function(s){return s.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(K3);var Q3=function(r){X(t,r);function t(e){return e===void 0&&(e=new j3),r.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Z3);function q7(r){var t=[],e=q3(r,t).extractDenseBlock3Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return y1(r,t),{params:n,paramMappings:t}}function j7(r){var t=[],e=w1(r),n=e.extractWeights,o=e.getRemainingWeights,a=U3(n,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),c=a(32,64,"dense1"),s=a(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:c,dense2:s}}}var $7=function(r){X(t,r);function t(){return r.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return U(function(){var o=e.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=Pt(o,a).div(K(255)),c=W3(i,n.dense0,!0);return c=W3(c,n.dense1),c=W3(c,n.dense2),c=cn(c,[14,14],[2,2],"valid"),c})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return q7(e)},t.prototype.extractParams=function(e){return j7(e)},t}(b1);var K7=function(r){X(t,r);function t(e){return e===void 0&&(e=new $7),r.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Z3);var jk=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(Q3);function X7(r,t){return ce($e(r,t.weights),t.biases)}function O6(r,t,e,n,o){o===void 0&&(o="same");var a=t.conv,i=a.filters,c=a.bias,s=x1(r,i,e,o);return s=ce(s,c),s=X7(s,t.scale),n?Te(s):s}function Y7(r,t){return O6(r,t,[1,1],!0)}function N6(r,t){return O6(r,t,[1,1],!1)}function J3(r,t){return O6(r,t,[2,2],!0,"valid")}function mg(r,t){function e(c,s,l){var u=r(c),h=u.length/(s*l*l);if(w7(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+u.length+", numFilters: "+s+", filterSize: "+l);return U(function(){return dt(f1(u,[s,h,l,l]),[2,3,1,0])})}function n(c,s,l,u){var h=e(c,s,l),f=Re(r(s));return t.push({paramPath:u+"/filters"},{paramPath:u+"/bias"}),{filters:h,bias:f}}function o(c,s){var l=Re(r(c)),u=Re(r(c));return t.push({paramPath:s+"/weights"},{paramPath:s+"/biases"}),{weights:l,biases:u}}function a(c,s,l,u){var h=n(c,s,l,u+"/conv"),f=o(s,u+"/scale");return{conv:h,scale:f}}function i(c,s,l,u,h){h===void 0&&(h=!1);var f=a((h?.5:1)*c,s,l,u+"/conv1"),d=a(c,s,l,u+"/conv2");return{conv1:f,conv2:d}}return{extractConvLayerParams:a,extractResidualLayerParams:i}}function Z7(r){var t=w1(r),e=t.extractWeights,n=t.getRemainingWeights,o=[],a=mg(e,o),i=a.extractConvLayerParams,c=a.extractResidualLayerParams,s=i(4704,32,7,"conv32_down"),l=c(9216,32,3,"conv32_1"),u=c(9216,32,3,"conv32_2"),h=c(9216,32,3,"conv32_3"),f=c(36864,64,3,"conv64_down",!0),d=c(36864,64,3,"conv64_1"),p=c(36864,64,3,"conv64_2"),v=c(36864,64,3,"conv64_3"),m=c(147456,128,3,"conv128_down",!0),g=c(147456,128,3,"conv128_1"),b=c(147456,128,3,"conv128_2"),y=c(589824,256,3,"conv256_down",!0),x=c(589824,256,3,"conv256_1"),w=c(589824,256,3,"conv256_2"),z=c(589824,256,3,"conv256_down_out"),M=U(function(){return dt(Bt(e(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var _={conv32_down:s,conv32_1:l,conv32_2:u,conv32_3:h,conv64_down:f,conv64_1:d,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:b,conv256_down:y,conv256_1:x,conv256_2:w,conv256_down_out:z,fc:M};return{params:_,paramMappings:o}}function gg(r,t){var e=N1(r,t);function n(i){var c=e(i+"/scale/weights",1),s=e(i+"/scale/biases",1);return{weights:c,biases:s}}function o(i){var c=e(i+"/conv/filters",4),s=e(i+"/conv/bias",1),l=n(i);return{conv:{filters:c,bias:s},scale:l}}function a(i){return{conv1:o(i+"/conv1"),conv2:o(i+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function Q7(r){var t=[],e=gg(r,t),n=e.extractConvLayerParams,o=e.extractResidualLayerParams,a=n("conv32_down"),i=o("conv32_1"),c=o("conv32_2"),s=o("conv32_3"),l=o("conv64_down"),u=o("conv64_1"),h=o("conv64_2"),f=o("conv64_3"),d=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),b=o("conv256_2"),y=o("conv256_down_out"),x=r.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!y7(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:i,conv32_2:c,conv32_3:s,conv64_down:l,conv64_1:u,conv64_2:h,conv64_3:f,conv128_down:d,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:b,conv256_down_out:y,fc:x};return y1(r,t),{params:w,paramMappings:t}}function St(r,t){var e=Y7(r,t.conv1);return e=N6(e,t.conv2),e=ce(e,r),e=Te(e),e}function hr(r,t){var e=J3(r,t.conv1);e=N6(e,t.conv2);var n=cn(r,2,2,"valid"),o=Oe(n.shape),a=n.shape[3]!==e.shape[3],i=n.shape[1]!==e.shape[1]||n.shape[2]!==e.shape[2];if(i){var c=l4(e.shape);c[1]=1;var s=Oe(c);e=Ue([e,s],1);var l=l4(e.shape);l[2]=1;var u=Oe(l);e=Ue([e,u],2)}return n=a?Ue([n,o],3):n,e=ce(n,e),e=Te(e),e}var P6=function(r){X(t,r);function t(){return r.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return U(function(){var o=e.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],i=Pt(o,a).div(K(256)),c=J3(i,n.conv32_down);c=Xe(c,3,2,"valid"),c=St(c,n.conv32_1),c=St(c,n.conv32_2),c=St(c,n.conv32_3),c=hr(c,n.conv64_down),c=St(c,n.conv64_1),c=St(c,n.conv64_2),c=St(c,n.conv64_3),c=hr(c,n.conv128_down),c=St(c,n.conv128_1),c=St(c,n.conv128_2),c=hr(c,n.conv256_down),c=St(c,n.conv256_1),c=St(c,n.conv256_2),c=hr(c,n.conv256_down_out);var s=c.mean([1,2]),l=U4(s,n.fc);return l})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return j(this,void 0,void 0,function(){var n,o,a,i=this;return $(this,function(c){switch(c.label){case 0:return[4,Fe(e)];case 1:return n=c.sent(),o=U(function(){return Le(i.forwardInput(n))}),[4,Promise.all(o.map(function(s){return s.data()}))];case 2:return a=c.sent(),o.forEach(function(s){return s.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Q7(e)},t.prototype.extractParams=function(e){return Z7(e)},t}(b1);function W6(r,t){var e={descriptor:t};return Object.assign({},r,e)}function U6(r,t){var e={age:t};return Object.assign({},r,e)}function G6(r,t,e){var n={gender:t,genderProbability:e};return Object.assign({},r,n)}var fr=function(){function r(t){var e=t===void 0?{}:t,n=e.minFaceSize,o=e.scaleFactor,a=e.maxNumScales,i=e.scoreThresholds,c=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=o||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=c,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(s){return typeof s!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(s){return typeof s!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function xg(r,t){function e(s,l){var u=f1(r(9*s),[3,3,s,1]),h=Re(r(s)),f=Re(r(s)),d=Re(r(s)),p=Re(r(s));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:u,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:d,batch_norm_variance:p}}function n(s,l,u,h,f){var d=f1(r(s*l*u*u),[u,u,s,l]),p=Re(r(l));return t.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:d,bias:p}}function o(s,l,u,h){var f=n(s,l,u,h,!0),d=f.filters,p=f.bias;return{filters:d,batch_norm_offset:p}}function a(s,l,u){var h=e(s,u+"/depthwise_conv"),f=o(s,l,1,u+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function i(){var s=o(3,32,3,"mobilenetv1/conv_0"),l=a(32,64,"mobilenetv1/conv_1"),u=a(64,128,"mobilenetv1/conv_2"),h=a(128,128,"mobilenetv1/conv_3"),f=a(128,256,"mobilenetv1/conv_4"),d=a(256,256,"mobilenetv1/conv_5"),p=a(256,512,"mobilenetv1/conv_6"),v=a(512,512,"mobilenetv1/conv_7"),m=a(512,512,"mobilenetv1/conv_8"),g=a(512,512,"mobilenetv1/conv_9"),b=a(512,512,"mobilenetv1/conv_10"),y=a(512,512,"mobilenetv1/conv_11"),x=a(512,1024,"mobilenetv1/conv_12"),w=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:s,conv_1:l,conv_2:u,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:v,conv_8:m,conv_9:g,conv_10:b,conv_11:y,conv_12:x,conv_13:w}}function c(){var s=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),u=o(512,128,1,"prediction_layer/conv_2"),h=o(128,256,3,"prediction_layer/conv_3"),f=o(256,128,1,"prediction_layer/conv_4"),d=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),v=o(64,128,3,"prediction_layer/conv_7"),m=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),y=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),x=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),w=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),z=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),M=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),_=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),S=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),k=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),L=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),V={box_encoding_predictor:m,class_predictor:g},I={box_encoding_predictor:b,class_predictor:y},D={box_encoding_predictor:x,class_predictor:w},R={box_encoding_predictor:z,class_predictor:M},P={box_encoding_predictor:_,class_predictor:S},N={box_encoding_predictor:k,class_predictor:L};return{conv_0:s,conv_1:l,conv_2:u,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:v,box_predictor_0:V,box_predictor_1:I,box_predictor_2:D,box_predictor_3:R,box_predictor_4:P,box_predictor_5:N}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:c}}function J7(r){var t=[],e=w1(r),n=e.extractWeights,o=e.getRemainingWeights,a=xg(n,t),i=a.extractMobilenetV1Params,c=a.extractPredictionLayerParams,s=i(),l=c(),u=M3(n(5118*4),[1,5118,4]),h={extra_dim:u};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:s,prediction_layer:l,output_layer:h},paramMappings:t}}function bg(r,t){var e=N1(r,t);function n(l,u,h){var f=e(l+"/Conv2d_"+u+"_pointwise/weights",4,h+"/filters"),d=e(l+"/Conv2d_"+u+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:d}}function o(l){var u="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=u+"/depthwise_conv",d=u+"/pointwise_conv",p=e(h+"/depthwise_weights",4,f+"/filters"),v=e(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),m=e(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),g=e(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),b=e(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:b},pointwise_conv:n("MobilenetV1",l,d)}}function a(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function i(l,u){var h=e(l+"/weights",4,u+"/filters"),f=e(l+"/biases",1,u+"/bias");return{filters:h,bias:f}}function c(l){var u=i("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=i("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:u,class_predictor:h}}function s(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:c(0),box_predictor_1:c(1),box_predictor_2:c(2),box_predictor_3:c(3),box_predictor_4:c(4),box_predictor_5:c(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function el(r){var t=[],e=bg(r,t),n=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,a=r["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!An(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:n(),prediction_layer:o(),output_layer:{extra_dim:a}};return y1(r,t),{params:i,paramMappings:t}}function vt(r,t,e){return U(function(){var n=x1(r,t.filters,e,"same");return n=ce(n,t.batch_norm_offset),X2(n,0,6)})}var yg=.0010000000474974513;function wg(r,t,e){return U(function(){var n=Q2(r,t.filters,e,"same");return n=c6(n,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,yg),X2(n,0,6)})}function zg(r){return[2,4,6,12].some(function(t){return t===r})?[2,2]:[1,1]}function tl(r,t){return U(function(){var e=null,n=vt(r,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(a,i){var c=i+1,s=zg(c);n=wg(n,a.depthwise_conv,s),n=vt(n,a.pointwise_conv,[1,1]),c===11&&(e=n)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:e}})}function nl(r,t,e,n,o){var a=r.shape[0],i=Math.min(e,a),c=t.map(function(u,h){return{score:u,boxIndex:h}}).filter(function(u){return u.score>o}).sort(function(u,h){return h.score-u.score}),s=function(u){return u<=n?1:0},l=[];return c.forEach(function(u){if(!(l.length>=i)){for(var h=u.score,f=l.length-1;f>=0;--f){var d=Mg(r,u.boxIndex,l[f]);if(d!==0&&(u.score*=s(d),u.score<=o))break}h===u.score&&l.push(u.boxIndex)}}),l}function Mg(r,t,e){var n=r.arraySync(),o=Math.min(n[t][0],n[t][2]),a=Math.min(n[t][1],n[t][3]),i=Math.max(n[t][0],n[t][2]),c=Math.max(n[t][1],n[t][3]),s=Math.min(n[e][0],n[e][2]),l=Math.min(n[e][1],n[e][3]),u=Math.max(n[e][0],n[e][2]),h=Math.max(n[e][1],n[e][3]),f=(i-o)*(c-a),d=(u-s)*(h-l);if(f<=0||d<=0)return 0;var p=Math.max(o,s),v=Math.max(a,l),m=Math.min(i,u),g=Math.min(c,h),b=Math.max(m-p,0)*Math.max(g-v,0);return b/(f+d-b)}function Cg(r){var t=Le(dt(r,[1,0])),e=[Be(t[2],t[0]),Be(t[3],t[1])],n=[ce(t[0],ft(e[0],K(2))),ce(t[1],ft(e[1],K(2)))];return{sizes:e,centers:n}}function _g(r,t){var e=Cg(r),n=e.sizes,o=e.centers,a=Le(dt(t,[1,0])),i=ft($e(k3(ft(a[2],K(5))),n[0]),K(2)),c=ce($e(ft(a[0],K(10)),n[0]),o[0]),s=ft($e(k3(ft(a[3],K(5))),n[1]),K(2)),l=ce($e(ft(a[1],K(10)),n[1]),o[1]);return dt(H1([Be(c,i),Be(l,s),ce(c,i),ce(l,s)]),[1,0])}function rl(r,t,e){return U(function(){var n=r.shape[0],o=_g(G1(e4(e.extra_dim,[n,1,1]),[-1,4]),G1(r,[-1,4]));o=G1(o,[n,o.shape[0]/n,4]);var a=i6(wt(t,[0,0,1],[-1,-1,-1])),i=wt(a,[0,0,0],[-1,-1,1]);i=G1(i,[n,i.shape[1]]);var c=Le(o),s=Le(i);return{boxes:c,scores:s}})}function d4(r,t){return U(function(){var e=r.shape[0],n=G1(O1(r,t.box_encoding_predictor),[e,-1,1,4]),o=G1(O1(r,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:n,classPrediction:o}})}function ol(r,t,e){return U(function(){var n=vt(r,e.conv_0,[1,1]),o=vt(n,e.conv_1,[2,2]),a=vt(o,e.conv_2,[1,1]),i=vt(a,e.conv_3,[2,2]),c=vt(i,e.conv_4,[1,1]),s=vt(c,e.conv_5,[2,2]),l=vt(s,e.conv_6,[1,1]),u=vt(l,e.conv_7,[2,2]),h=d4(t,e.box_predictor_0),f=d4(r,e.box_predictor_1),d=d4(o,e.box_predictor_2),p=d4(i,e.box_predictor_3),v=d4(s,e.box_predictor_4),m=d4(u,e.box_predictor_5),g=Ue([h.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),b=Ue([h.classPrediction,f.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1);return{boxPredictions:g,classPredictions:b}})}var Wt=function(){function r(t){var e=t===void 0?{}:t,n=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}();var e0=function(r){X(t,r);function t(){return r.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return U(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=Be($e(o,K(.007843137718737125)),K(1)),i=tl(a,n.mobilenetv1),c=ol(i.out,i.conv11,n.prediction_layer),s=c.boxPredictions,l=c.classPredictions;return rl(s,l,n.output_layer)})},t.prototype.forward=function(e){return j(this,void 0,void 0,function(){var n;return $(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,Fe(e)];case 1:return[2,n.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(e,n){return n===void 0&&(n={}),j(this,void 0,void 0,function(){var o,a,i,c,s,l,u,h,f,d,p,v,m,g,b,y,x,w,z,M,_;return $(this,function(S){switch(S.label){case 0:return o=new Wt(n),a=o.maxResults,i=o.minConfidence,[4,Fe(e)];case 1:for(c=S.sent(),s=this.forwardInput(c),l=s.boxes,u=s.scores,h=l[0],f=u[0],d=1;d<l.length;d++)l[d].dispose(),u[d].dispose();return m=(v=Array).from,[4,f.data()];case 2:return p=m.apply(v,[S.sent()]),g=.5,b=nl(h,p,a,g,i),y=c.getReshapedInputDimensions(0),x=c.inputSize,w=x/y.width,z=x/y.height,M=h.arraySync(),_=b.map(function(k){var L=[Math.max(0,M[k][0]),Math.min(1,M[k][2])].map(function(N){return N*z}),V=L[0],I=L[1],D=[Math.max(0,M[k][1]),Math.min(1,M[k][3])].map(function(N){return N*w}),R=D[0],P=D[1];return new e1(p[k],new j4(R,V,P-R,I-V),{height:c.getInputHeight(0),width:c.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,_]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return el(e)},t.prototype.extractParams=function(e){return J7(e)},t}(b1);var uV=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(e0);var al=.4,il=[new pe(.738768,.874946),new pe(2.42204,2.65704),new pe(4.30971,7.04493),new pe(10.246,4.59428),new pe(12.6868,11.8741)],cl=[new pe(1.603231,2.094468),new pe(6.041143,7.080126),new pe(2.882459,3.518061),new pe(4.266906,5.178857),new pe(9.041765,10.66308)],sl=[117.001,114.697,97.404],ll="tiny_yolov2_model",ul="tiny_yolov2_separable_conv_model";var t0=function(r){return typeof r=="number"};function hl(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!t0(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(t){return t||{}}).every(function(t){return t0(t.x)&&t0(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(t0)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function e2(r){return U(function(){var t=$e(r,K(.10000000149011612));return ce(Te(Be(r,t)),t)})}function fn(r,t){return U(function(){var e=an(r,[[0,0],[1,1],[1,1],[0,0]]);return e=x1(e,t.conv.filters,[1,1],"valid"),e=Be(e,t.bn.sub),e=$e(e,t.bn.truediv),e=ce(e,t.conv.bias),e2(e)})}function dn(r,t){return U(function(){var e=an(r,[[0,0],[1,1],[1,1],[0,0]]);return e=J2(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=ce(e,t.bias),e2(e)})}function Eg(r,t){var e=In(r,t);function n(i,c){var s=Re(r(i)),l=Re(r(i));return t.push({paramPath:c+"/sub"},{paramPath:c+"/truediv"}),{sub:s,truediv:l}}function o(i,c,s){var l=e(i,c,3,s+"/conv"),u=n(c,s+"/bn");return{conv:l,bn:u}}var a=Z4(r,t);return{extractConvParams:e,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function fl(r,t,e,n){var o=w1(r),a=o.extractWeights,i=o.getRemainingWeights,c=[],s=Eg(a,c),l=s.extractConvParams,u=s.extractConvWithBatchNormParams,h=s.extractSeparableConvParams,f;if(t.withSeparableConvs){var d=n[0],p=n[1],v=n[2],m=n[3],g=n[4],b=n[5],y=n[6],x=n[7],w=n[8],z=t.isFirstLayerConv2d?l(d,p,3,"conv0"):h(d,p,"conv0"),M=h(p,v,"conv1"),_=h(v,m,"conv2"),S=h(m,g,"conv3"),k=h(g,b,"conv4"),L=h(b,y,"conv5"),V=x?h(y,x,"conv6"):void 0,I=w?h(x,w,"conv7"):void 0,D=l(w||x||y,5*e,1,"conv8");f={conv0:z,conv1:M,conv2:_,conv3:S,conv4:k,conv5:L,conv6:V,conv7:I,conv8:D}}else{var d=n[0],p=n[1],v=n[2],m=n[3],g=n[4],b=n[5],y=n[6],x=n[7],w=n[8],z=u(d,p,"conv0"),M=u(p,v,"conv1"),_=u(v,m,"conv2"),S=u(m,g,"conv3"),k=u(g,b,"conv4"),L=u(b,y,"conv5"),V=u(y,x,"conv6"),I=u(x,w,"conv7"),D=l(w,5*e,1,"conv8");f={conv0:z,conv1:M,conv2:_,conv3:S,conv4:k,conv5:L,conv6:V,conv7:I,conv8:D}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:c}}function Sg(r,t){var e=N1(r,t);function n(c){var s=e(c+"/sub",1),l=e(c+"/truediv",1);return{sub:s,truediv:l}}function o(c){var s=e(c+"/filters",4),l=e(c+"/bias",1);return{filters:s,bias:l}}function a(c){var s=o(c+"/conv"),l=n(c+"/bn");return{conv:s,bn:l}}var i=Q4(e);return{extractConvParams:o,extractConvWithBatchNormParams:a,extractSeparableConvParams:i}}function dl(r,t){var e=[],n=Sg(r,e),o=n.extractConvParams,a=n.extractConvWithBatchNormParams,i=n.extractSeparableConvParams,c;if(t.withSeparableConvs){var s=t.filterSizes&&t.filterSizes.length||9;c={conv0:t.isFirstLayerConv2d?o("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:s>7?i("conv6"):void 0,conv7:s>8?i("conv7"):void 0,conv8:o("conv8")}}else c={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return y1(r,e),{params:c,paramMappings:e}}var p4=function(){function r(t){var e=t===void 0?{}:t,n=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}();var n0=function(r){X(t,r);function t(e){var n=r.call(this,"TinyYolov2")||this;return hl(e),n._config=e,n}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,n){var o=fn(e,n.conv0);return o=Xe(o,[2,2],[2,2],"same"),o=fn(o,n.conv1),o=Xe(o,[2,2],[2,2],"same"),o=fn(o,n.conv2),o=Xe(o,[2,2],[2,2],"same"),o=fn(o,n.conv3),o=Xe(o,[2,2],[2,2],"same"),o=fn(o,n.conv4),o=Xe(o,[2,2],[2,2],"same"),o=fn(o,n.conv5),o=Xe(o,[2,2],[1,1],"same"),o=fn(o,n.conv6),o=fn(o,n.conv7),O1(o,n.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,n){var o=this.config.isFirstLayerConv2d?e2(O1(e,n.conv0,"valid",!1)):dn(e,n.conv0);return o=Xe(o,[2,2],[2,2],"same"),o=dn(o,n.conv1),o=Xe(o,[2,2],[2,2],"same"),o=dn(o,n.conv2),o=Xe(o,[2,2],[2,2],"same"),o=dn(o,n.conv3),o=Xe(o,[2,2],[2,2],"same"),o=dn(o,n.conv4),o=Xe(o,[2,2],[2,2],"same"),o=dn(o,n.conv5),o=Xe(o,[2,2],[1,1],"same"),o=n.conv6?dn(o,n.conv6):o,o=n.conv7?dn(o,n.conv7):o,O1(o,n.conv8,"valid",!1)},t.prototype.forwardInput=function(e,n){var o=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return U(function(){var i=e.toBatchTensor(n,!1).toFloat();return i=o.config.meanRgb?Pt(i,o.config.meanRgb):i,i=i.div(K(256)),o.config.withSeparableConvs?o.runMobilenet(i,a):o.runTinyYolov2(i,a)})},t.prototype.forward=function(e,n){return j(this,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Fe(e)];case 1:return[4,o.apply(this,[a.sent(),n])];case 2:return[2,a.sent()]}})})},t.prototype.detect=function(e,n){return n===void 0&&(n={}),j(this,void 0,void 0,function(){var o,a,i,c,s,l,u,h,f,d,p,v,m,g,b=this;return $(this,function(y){switch(y.label){case 0:return o=new p4(n),a=o.inputSize,i=o.scoreThreshold,[4,Fe(e)];case 1:return c=y.sent(),[4,this.forwardInput(c,a)];case 2:return s=y.sent(),l=U(function(){return Le(s)[0].expandDims()}),u={width:c.getInputWidth(0),height:c.getInputHeight(0)},[4,this.extractBoxes(l,c.getReshapedInputDimensions(0),i)];case 3:return h=y.sent(),s.dispose(),l.dispose(),f=h.map(function(x){return x.box}),d=h.map(function(x){return x.score}),p=h.map(function(x){return x.classScore}),v=h.map(function(x){return b.config.classes[x.label]}),m=un(f.map(function(x){return x.rescale(a)}),d,this.config.iouThreshold,!0),g=m.map(function(x){return new D3(d[x],p[x],v[x],f[x],u)}),[2,g]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return dl(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=n?n.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return fl(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,n,o){return j(this,void 0,void 0,function(){var a,i,c,s,l,u,h,f,d,p,v,m,g,b,y,x,w,z,M,_,S,k,L,V,I,D,R,P,N,O=this;return $(this,function(G){switch(G.label){case 0:return a=n.width,i=n.height,c=Math.max(a,i),s=c/a,l=c/i,u=e.shape[1],h=this.config.anchors.length,f=U(function(){var q=e.reshape([u,u,h,O.boxEncodingSize]),Y=q.slice([0,0,0,0],[u,u,h,4]),ne=q.slice([0,0,0,4],[u,u,h,1]),ae=O.withClassScores?q1(q.slice([0,0,0,5],[u,u,h,O.config.classes.length]),3):K(0);return[Y,ne,ae]}),d=f[0],p=f[1],v=f[2],m=[],[4,p.array()];case 1:return g=G.sent(),[4,d.array()];case 2:b=G.sent(),y=0,G.label=3;case 3:if(!(y<u))return[3,12];x=0,G.label=4;case 4:if(!(x<u))return[3,11];w=0,G.label=5;case 5:return w<h?(z=I3(g[y][x][w][0]),!o||z>o?(M=(x+I3(b[y][x][w][0]))/u*s,_=(y+I3(b[y][x][w][1]))/u*l,S=Math.exp(b[y][x][w][2])*this.config.anchors[w].x/u*s,k=Math.exp(b[y][x][w][3])*this.config.anchors[w].y/u*l,L=M-S/2,V=_-k/2,I={row:y,col:x,anchor:w},this.withClassScores?[4,this.extractPredictedClass(v,I)]:[3,7]):[3,9]):[3,10];case 6:return N=G.sent(),[3,8];case 7:N={classScore:1,label:0},G.label=8;case 8:D=N,R=D.classScore,P=D.label,m.push(c1({box:new u4(L,V,L+S,V+k),score:z,classScore:z*R,label:P},I)),G.label=9;case 9:return w++,[3,5];case 10:return x++,[3,4];case 11:return y++,[3,3];case 12:return d.dispose(),p.dispose(),v.dispose(),[2,m]}})})},t.prototype.extractPredictedClass=function(e,n){return j(this,void 0,void 0,function(){var o,a,i,c;return $(this,function(s){switch(s.label){case 0:return o=n.row,a=n.col,i=n.anchor,[4,e.array()];case 1:return c=s.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,u){return c[o][a][i][u]}).map(function(l,u){return{classScore:l,label:u}}).reduce(function(l,u){return l.classScore>u.classScore?l:u})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(b1);var q6=function(r){X(t,r);function t(e){e===void 0&&(e=!0);var n=this,o=Object.assign({},{withSeparableConvs:e,iouThreshold:al,classes:["face"]},e?{anchors:cl,meanRgb:sl}:{anchors:il,withClassScores:!0});return n=r.call(this,o)||this,n}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return j(this,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return[4,this.detect(e,n)];case 1:return o=a.sent(),[2,o.map(function(i){return new e1(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?ul:ll},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t}(n0);var pl=function(r){X(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t}(p4);var Ut=function(){function r(){}return r.prototype.then=function(t){return j(this,void 0,void 0,function(){var e;return $(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return j(this,void 0,void 0,function(){return $(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},r}();function v4(r,t,e,n,o){return o===void 0&&(o=function(a){var i=a.alignedRect;return i}),j(this,void 0,void 0,function(){var a,i,c,s,l;return $(this,function(u){switch(u.label){case 0:return a=r.map(function(h){return Y3(h)?o(h):h.detection}),c=n,c?[3,5]:t instanceof Ie?[4,sr(t,a)]:[3,2];case 1:return s=u.sent(),[3,4];case 2:return[4,cr(t,a)];case 3:s=u.sent(),u.label=4;case 4:c=s,u.label=5;case 5:return i=c,[4,e(i)];case 6:return l=u.sent(),i.forEach(function(h){return h instanceof Ie&&h.dispose()}),[2,l]}})})}function t2(r,t,e,n,o){return j(this,void 0,void 0,function(){var a=this;return $(this,function(i){return[2,v4([r],t,function(c){return j(a,void 0,void 0,function(){return $(this,function(s){return[2,e(c[0])]})})},n,o)]})})}function vl(r){return U(function(){return H1(Le(r,3).reverse(),3)})}var dr=2,m4=12;function kg(r,t){var e=In(r,t),n=Y4(r,t);function o(l,u){var h=Re(r(l));return t.push({paramPath:u}),h}function a(l,u,h){h===void 0&&(h=!1);var f=e(l[0],l[1],3,u+"/conv1"),d=o(l[1],u+"/prelu1_alpha"),p=e(l[1],l[2],3,u+"/conv2"),v=o(l[2],u+"/prelu2_alpha"),m=e(l[2],l[3],h?2:3,u+"/conv3"),g=o(l[3],u+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:p,prelu2_alpha:v,conv3:m,prelu3_alpha:g}}function i(){var l=a([3,10,16,32],"pnet"),u=e(32,2,1,"pnet/conv4_1"),h=e(32,4,1,"pnet/conv4_2");return c1(c1({},l),{conv4_1:u,conv4_2:h})}function c(){var l=a([3,28,48,64],"rnet",!0),u=n(576,128,"rnet/fc1"),h=o(128,"rnet/prelu4_alpha"),f=n(128,2,"rnet/fc2_1"),d=n(128,4,"rnet/fc2_2");return c1(c1({},l),{fc1:u,prelu4_alpha:h,fc2_1:f,fc2_2:d})}function s(){var l=a([3,32,64,64],"onet"),u=e(64,128,2,"onet/conv4"),h=o(128,"onet/prelu4_alpha"),f=n(1152,256,"onet/fc1"),d=o(256,"onet/prelu5_alpha"),p=n(256,2,"onet/fc2_1"),v=n(256,4,"onet/fc2_2"),m=n(256,10,"onet/fc2_3");return c1(c1({},l),{conv4:u,prelu4_alpha:h,fc1:f,prelu5_alpha:d,fc2_1:p,fc2_2:v,fc2_3:m})}return{extractPNetParams:i,extractRNetParams:c,extractONetParams:s}}function ml(r){var t=w1(r),e=t.extractWeights,n=t.getRemainingWeights,o=[],a=kg(e,o),i=a.extractPNetParams,c=a.extractRNetParams,s=a.extractONetParams,l=i(),u=c(),h=s();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:l,rnet:u,onet:h},paramMappings:o}}function Hg(r,t){var e=N1(r,t);function n(u){var h=e(u+"/weights",4,u+"/filters"),f=e(u+"/bias",1);return{filters:h,bias:f}}function o(u){var h=e(u+"/weights",2),f=e(u+"/bias",1);return{weights:h,bias:f}}function a(u){return e(u,1)}function i(u){var h=n(u+"/conv1"),f=a(u+"/prelu1_alpha"),d=n(u+"/conv2"),p=a(u+"/prelu2_alpha"),v=n(u+"/conv3"),m=a(u+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:d,prelu2_alpha:p,conv3:v,prelu3_alpha:m}}function c(){var u=i("pnet"),h=n("pnet/conv4_1"),f=n("pnet/conv4_2");return c1(c1({},u),{conv4_1:h,conv4_2:f})}function s(){var u=i("rnet"),h=o("rnet/fc1"),f=a("rnet/prelu4_alpha"),d=o("rnet/fc2_1"),p=o("rnet/fc2_2");return c1(c1({},u),{fc1:h,prelu4_alpha:f,fc2_1:d,fc2_2:p})}function l(){var u=i("onet"),h=n("onet/conv4"),f=a("onet/prelu4_alpha"),d=o("onet/fc1"),p=a("onet/prelu5_alpha"),v=o("onet/fc2_1"),m=o("onet/fc2_2"),g=o("onet/fc2_3");return c1(c1({},u),{conv4:h,prelu4_alpha:f,fc1:d,prelu5_alpha:p,fc2_1:v,fc2_2:m,fc2_3:g})}return{extractPNetParams:c,extractRNetParams:s,extractONetParams:l}}function gl(r){var t=[],e=Hg(r,t),n=e.extractPNetParams,o=e.extractRNetParams,a=e.extractONetParams,i=n(),c=o(),s=a();return y1(r,t),{params:{pnet:i,rnet:c,onet:s},paramMappings:t}}function pr(r,t){var e=t[0],n=t[1];return{height:Math.floor(e*r),width:Math.floor(n*r)}}function xl(r,t,e){for(var n=e[0],o=e[1],a=m4/r,i=[],c=Math.min(n,o)*a,s=0;c>=12;)i.push(a*Math.pow(t,s)),c=c*t,s+=1;return i}var n2=function(r){X(t,r);function t(e,n,o,a){return r.call(this,{left:e,top:n,right:o,bottom:a},!0)||this}return t}(V1);function r0(r){return U(function(){return $e(Be(r,K(127.5)),K(.0078125))})}function pn(r,t){return U(function(){return ce(Te(r),$e(t,Y2(Te(Y2(r)))))})}function r2(r,t,e){return e===void 0&&(e=!1),U(function(){var n=O1(r,t.conv1,"valid");return n=pn(n,t.prelu1_alpha),n=Xe(n,e?[2,2]:[3,3],[2,2],"same"),n=O1(n,t.conv2,"valid"),n=pn(n,t.prelu2_alpha),n=e?n:Xe(n,[3,3],[2,2],"valid"),n=O1(n,t.conv3,"valid"),n=pn(n,t.prelu3_alpha),n})}function bl(r,t){return U(function(){var e=r2(r,t,!0),n=O1(e,t.conv4_1,"valid"),o=I1(c4(n,3),3),a=q1(Be(n,o),3),i=O1(e,t.conv4_2,"valid");return{prob:a,regions:i}})}function Vg(r,t){return U(function(){var e=pr(t,r.shape.slice(1)),n=e.height,o=e.width,a=tr.resizeBilinear(r,[n,o]),i=r0(a);return dt(i,[0,2,1,3])})}function Tg(r,t,e,n){for(var o=[],a=r.arraySync(),i=0;i<r.shape[0];i++)for(var c=0;c<r.shape[1];c++)a[i][c]>=n&&o.push(new pe(c,i));var s=o.map(function(l){var u=new u4(Math.round((l.y*dr+1)/e),Math.round((l.x*dr+1)/e),Math.round((l.y*dr+m4)/e),Math.round((l.x*dr+m4)/e)),h=a[l.y][l.x],f=t.arraySync(),d=new n2(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:u,score:h,region:d}});return s}function yl(r,t,e,n,o){o.stage1=[];var a=t.map(function(f){return U(function(){var d={scale:f},p=Vg(r,f),v=Date.now(),m=bl(p,n),g=m.prob,b=m.regions;d.pnet=Date.now()-v;var y=Le(Le(g,3)[1])[0],x=Le(b)[0];return{scoresTensor:y,regionsTensor:x,scale:f,statsForScale:d}})}),i=a.map(function(f){var d=f.scoresTensor,p=f.regionsTensor,v=f.scale,m=f.statsForScale,g=Tg(d,p,v,e);if(d.dispose(),p.dispose(),!g.length)return o.stage1.push(m),[];var b=Date.now(),y=un(g.map(function(x){return x.cell}),g.map(function(x){return x.score}),.5);return m.nms=Date.now()-b,m.numBoxes=y.length,o.stage1.push(m),y.map(function(x){return g[x]})}),c=i.reduce(function(f,d){return f.concat(d)},[]),s=[],l=[];if(c.length>0){var u=Date.now(),h=un(c.map(function(f){return f.cell}),c.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-u,l=h.map(function(f){return c[f].score}),s=h.map(function(f){return c[f]}).map(function(f){var d=f.cell,p=f.region;return new u4(d.left+p.left*d.width,d.top+p.top*d.height,d.right+p.right*d.width,d.bottom+p.bottom*d.height).toSquare().round()})}return{boxes:s,scores:l}}function o0(r,t,e){var n=e.width,o=e.height;return j(this,void 0,void 0,function(){var a,i,c,s=this;return $(this,function(l){switch(l.label){case 0:return a=T1(r),[4,Promise.all(t.map(function(u){return j(s,void 0,void 0,function(){var h,f,d,p,v,m,g,b;return $(this,function(y){return h=u.padAtBorders(r.height,r.width),f=h.y,d=h.ey,p=h.x,v=h.ex,m=p-1,g=f-1,b=a.getImageData(m,g,v-m,d-g),[2,Ve.isNodejs()?X4(b):createImageBitmap(b)]})})}))];case 1:return i=l.sent(),c=[],i.forEach(function(u){var h=h4({width:n,height:o}),f=T1(h);f.drawImage(u,0,0,n,o);for(var d=f.getImageData(0,0,n,o).data,p=[],v=0;v<d.length;v+=4)p.push(d[v+2]),p.push(d[v+1]),p.push(d[v]);c.push(p)}),[2,c.map(function(u){var h=U(function(){var f=dt(f1(u,[1,n,o,3]),[0,2,1,3]).toFloat();return r0(f)});return h})]}})})}function wl(r,t){return U(function(){var e=r2(r,t),n=G1(e,[e.shape[0],t.fc1.weights.shape[0]]),o=Q1(n,t.fc1),a=pn(o,t.prelu4_alpha),i=Q1(a,t.fc2_1),c=I1(c4(i,1),1),s=q1(Be(i,c),1),l=Q1(a,t.fc2_2),u=Le(s,1)[1];return{scores:u,regions:l}})}function zl(r,t,e,n,o){return j(this,void 0,void 0,function(){var a,i,c,s,l,u,h,f,d,p,v,m,g,b;return $(this,function(y){switch(y.label){case 0:return a=Date.now(),[4,o0(r,t,{width:24,height:24})];case 1:return i=y.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),c=i.map(function(x){var w=wl(x,n);return x.dispose(),w}),o.stage2_rnet=Date.now()-a,s=c.length>1?Ue(c.map(function(x){return x.scores})):c[0].scores,h=(u=Array).from,[4,s.data()];case 2:return l=h.apply(u,[y.sent()]),s.dispose(),f=l.map(function(x,w){return{score:x,idx:w}}).filter(function(x){return x.score>e}).map(function(x){var w=x.idx;return w}),d=f.map(function(x){return t[x]}),p=f.map(function(x){return l[x]}),v=[],m=[],d.length>0&&(a=Date.now(),g=un(d,p,.7),o.stage2_nms=Date.now()-a,b=g.map(function(x){var w=c[f[x]].regions.arraySync();return new n2(w[0][0],w[0][1],w[0][2],w[0][3])}),m=g.map(function(x){return p[x]}),v=g.map(function(x,w){return d[x].calibrate(b[w])})),c.forEach(function(x){x.regions.dispose(),x.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function Ml(r,t){return U(function(){var e=r2(r,t);e=Xe(e,[2,2],[2,2],"same"),e=O1(e,t.conv4,"valid"),e=pn(e,t.prelu4_alpha);var n=G1(e,[e.shape[0],t.fc1.weights.shape[0]]),o=Q1(n,t.fc1),a=pn(o,t.prelu5_alpha),i=Q1(a,t.fc2_1),c=I1(c4(i,1),1),s=q1(Be(i,c),1),l=Q1(a,t.fc2_2),u=Q1(a,t.fc2_3),h=Le(s,1)[1];return{scores:h,regions:l,points:u}})}function Cl(r,t,e,n,o){return j(this,void 0,void 0,function(){var a,i,c,s,l,u,h,f,d,p,v,m,g,b,y;return $(this,function(x){switch(x.label){case 0:return a=Date.now(),[4,o0(r,t,{width:48,height:48})];case 1:return i=x.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),c=i.map(function(w){var z=Ml(w,n);return w.dispose(),z}),o.stage3_onet=Date.now()-a,s=c.length>1?Ue(c.map(function(w){return w.scores})):c[0].scores,h=(u=Array).from,[4,s.data()];case 2:return l=h.apply(u,[x.sent()]),s.dispose(),f=l.map(function(w,z){return{score:w,idx:z}}).filter(function(w){return w.score>e}).map(function(w){var z=w.idx;return z}),d=f.map(function(w){var z=c[w].regions.arraySync();return new n2(z[0][0],z[0][1],z[0][2],z[0][3])}),p=f.map(function(w,z){return t[w].calibrate(d[z])}),v=f.map(function(w){return l[w]}),m=[],g=[],b=[],p.length>0&&(a=Date.now(),y=un(p,v,.7,!1),o.stage3_nms=Date.now()-a,m=y.map(function(w){return p[w]}),g=y.map(function(w){return v[w]}),b=y.map(function(w,z){return Array(5).fill(0).map(function(M,_){var S=c[w].points.arraySync();return new pe(S[0][_]*(m[z].width+1)+m[z].left,S[0][_+5]*(m[z].height+1)+m[z].top)})})),c.forEach(function(w){w.regions.dispose(),w.scores.dispose(),w.points.dispose()}),[2,{boxes:m,scores:g,points:b}]}})})}var j6=function(r){X(t,r);function t(){return r.call(this,"Mtcnn")||this}return t.prototype.load=function(e){return j(this,void 0,void 0,function(){return $(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return j(this,void 0,void 0,function(){return $(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,n){return n===void 0&&(n={}),j(this,void 0,void 0,function(){var o,a,i,c,s,l,u,h,f,d,p,v,m,g,b,y,x,w,z,M,_;return $(this,function(S){switch(S.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(a=e.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},c=Date.now(),s=U(function(){return vl(I1(G4.fromPixels(a)).toFloat())}),l=function(k){return s.dispose(),i.total=Date.now()-c,k},u=s.shape.slice(1),h=u[0],f=u[1],d=new fr(n),p=d.minFaceSize,v=d.scaleFactor,m=d.maxNumScales,g=d.scoreThresholds,b=d.scaleSteps,y=(b||xl(p,v,[h,f])).filter(function(k){var L=pr(k,[h,f]);return Math.min(L.width,L.height)>m4}).slice(0,m),i.scales=y,i.pyramid=y.map(function(k){return pr(k,[h,f])}),x=Date.now(),[4,yl(s,y,g[0],o.pnet,i)];case 1:return w=S.sent(),i.total_stage1=Date.now()-x,w.boxes.length?(i.stage2_numInputBoxes=w.boxes.length,x=Date.now(),[4,zl(a,w.boxes,g[1],o.rnet,i)]):[2,l({results:[],stats:i})];case 2:return z=S.sent(),i.total_stage2=Date.now()-x,z.boxes.length?(i.stage3_numInputBoxes=z.boxes.length,x=Date.now(),[4,Cl(a,z.boxes,g[2],o.onet,i)]):[2,l({results:[],stats:i})];case 3:return M=S.sent(),i.total_stage3=Date.now()-x,_=M.boxes.map(function(k,L){return J4($4({},new e1(M.scores[L],new j4(k.left/f,k.top/h,k.width/f,k.height/h),{height:h,width:f})),new E7(M.points[L].map(function(V){return V.sub(new pe(k.left,k.top)).div(new pe(k.width,k.height))}),{width:k.width,height:k.height}))}),[2,l({results:_,stats:i})]}})})},t.prototype.forward=function(e,n){return n===void 0&&(n={}),j(this,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Fe(e)];case 1:return[4,o.apply(this,[a.sent(),n])];case 2:return[2,a.sent().results]}})})},t.prototype.forwardWithStats=function(e,n){return n===void 0&&(n={}),j(this,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Fe(e)];case 1:return[2,o.apply(this,[a.sent(),n])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return gl(e)},t.prototype.extractParams=function(e){return ml(e)},t}(b1);var _l=.4,El=[new pe(1.603231,2.094468),new pe(6.041143,7.080126),new pe(2.882459,3.518061),new pe(4.266906,5.178857),new pe(9.041765,10.66308)],Sl=[117.001,114.697,97.404];var $6=function(r){X(t,r);function t(){var e=this,n={withSeparableConvs:!0,iouThreshold:_l,classes:["face"],anchors:El,meanRgb:Sl,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=r.call(this,n)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return j(this,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return[4,this.detect(e,n)];case 1:return o=a.sent(),[2,o.map(function(i){return new e1(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t}(n0);var p1={ssdMobilenetv1:new e0,tinyFaceDetector:new $6,tinyYolov2:new q6,mtcnn:new j6,faceLandmark68Net:new Q3,faceLandmark68TinyNet:new K7,faceRecognitionNet:new P6,faceExpressionNet:new B7,ageGenderNet:new G7};var kl=function(r){X(t,r);function t(e,n,o){var a=r.call(this)||this;return a.parentTask=e,a.input=n,a.extractedFaces=o,a}return t}(Ut);var vr=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o=this;return $(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,v4(e,this.input,function(i){return j(o,void 0,void 0,function(){return $(this,function(c){switch(c.label){case 0:return[4,Promise.all(i.map(function(s){return p1.faceExpressionNet.predictExpressions(s)}))];case 1:return[2,c.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,e.map(function(i,c){return B6(i,n[c])})]}})})},t.prototype.withAgeAndGender=function(){return new gr(this,this.input)},t}(kl);var mr=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n;return $(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,t2(e,this.input,function(a){return p1.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return n=o.sent(),[2,B6(e,n)]}})})},t.prototype.withAgeAndGender=function(){return new xr(this,this.input)},t}(kl);var o2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new i2(this,this.input)},t.prototype.withFaceDescriptors=function(){return new s2(this,this.input)},t}(vr);var a2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new c2(this,this.input)},t.prototype.withFaceDescriptor=function(){return new l2(this,this.input)},t}(mr);var Hl=function(r){X(t,r);function t(e,n,o){var a=r.call(this)||this;return a.parentTask=e,a.input=n,a.extractedFaces=o,a}return t}(Ut);var gr=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o=this;return $(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,v4(e,this.input,function(i){return j(o,void 0,void 0,function(){return $(this,function(c){switch(c.label){case 0:return[4,Promise.all(i.map(function(s){return p1.ageGenderNet.predictAgeAndGender(s)}))];case 1:return[2,c.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,e.map(function(i,c){var s=n[c],l=s.age,u=s.gender,h=s.genderProbability;return U6(G6(i,u,h),l)})]}})})},t.prototype.withFaceExpressions=function(){return new vr(this,this.input)},t}(Hl);var xr=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o,a,i;return $(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return e=c.sent(),e?[4,t2(e,this.input,function(s){return p1.ageGenderNet.predictAgeAndGender(s)},this.extractedFaces)]:[2];case 2:return n=c.sent(),o=n.age,a=n.gender,i=n.genderProbability,[2,U6(G6(e,a,i),o)]}})})},t.prototype.withFaceExpressions=function(){return new mr(this,this.input)},t}(Hl);var i2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new o2(this,this.input)},t.prototype.withFaceDescriptors=function(){return new s2(this,this.input)},t}(gr);var c2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new a2(this,this.input)},t.prototype.withFaceDescriptor=function(){return new l2(this,this.input)},t}(xr);var Vl=function(r){X(t,r);function t(e,n){var o=r.call(this)||this;return o.parentTask=e,o.input=n,o}return t}(Ut);var s2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n;return $(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,v4(e,this.input,function(a){return Promise.all(a.map(function(i){return p1.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=o.sent(),[2,n.map(function(a,i){return W6(e[i],a)})]}})})},t.prototype.withFaceExpressions=function(){return new o2(this,this.input)},t.prototype.withAgeAndGender=function(){return new i2(this,this.input)},t}(Vl);var l2=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n;return $(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,t2(e,this.input,function(a){return p1.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=o.sent(),[2,W6(e,n)]}})})},t.prototype.withFaceExpressions=function(){return new a2(this,this.input)},t.prototype.withAgeAndGender=function(){return new c2(this,this.input)},t}(Vl);var Tl=function(r){X(t,r);function t(e,n,o){var a=r.call(this)||this;return a.parentTask=e,a.input=n,a.useTinyLandmarkNet=o,a}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?p1.faceLandmark68TinyNet:p1.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Ut);var Ll=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o,a,i,c=this;return $(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),n=e.map(function(l){return l.detection}),this.input instanceof Ie?[4,sr(this.input,n)]:[3,3];case 2:return a=s.sent(),[3,5];case 3:return[4,cr(this.input,n)];case 4:a=s.sent(),s.label=5;case 5:return o=a,[4,Promise.all(o.map(function(l){return c.landmarkNet.detectLandmarks(l)}))];case 6:return i=s.sent(),o.forEach(function(l){return l instanceof Ie&&l.dispose()}),[2,e.map(function(l,u){return J4(l,i[u])})]}})})},t.prototype.withFaceExpressions=function(){return new o2(this,this.input)},t.prototype.withAgeAndGender=function(){return new i2(this,this.input)},t.prototype.withFaceDescriptors=function(){return new s2(this,this.input)},t}(Tl);var Fl=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o,a,i;return $(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return e=c.sent(),e?(n=e.detection,this.input instanceof Ie?[4,sr(this.input,[n])]:[3,3]):[2];case 2:return a=c.sent(),[3,5];case 3:return[4,cr(this.input,[n])];case 4:a=c.sent(),c.label=5;case 5:return o=a,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return i=c.sent(),o.forEach(function(s){return s instanceof Ie&&s.dispose()}),[2,J4(e,i)]}})})},t.prototype.withFaceExpressions=function(){return new a2(this,this.input)},t.prototype.withAgeAndGender=function(){return new c2(this,this.input)},t.prototype.withFaceDescriptor=function(){return new l2(this,this.input)},t}(Tl);var Al=function(r){X(t,r);function t(e,n){n===void 0&&(n=new Wt);var o=r.call(this)||this;return o.input=e,o.options=n,o}return t}(Ut);var K6=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n,o,a;return $(this,function(i){switch(i.label){case 0:return e=this,n=e.input,o=e.options,o instanceof fr?[4,p1.mtcnn.forward(n,o)]:[3,2];case 1:return[2,i.sent().map(function(c){return c.detection})];case 2:if(a=o instanceof pl?function(c){return p1.tinyFaceDetector.locateFaces(c,o)}:o instanceof Wt?function(c){return p1.ssdMobilenetv1.locateFaces(c,o)}:o instanceof p4?function(c){return p1.tinyYolov2.locateFaces(c,o)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(n)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(n){return j(e,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,n(o.map(function(i){return $4({},i)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Ll(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new vr(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new gr(this.runAndExtendWithFaceDetections(),this.input)},t}(Al);var Lg=function(r){X(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return j(this,void 0,void 0,function(){var e,n;return $(this,function(o){switch(o.label){case 0:return[4,new K6(this.input,this.options)];case 1:return e=o.sent(),n=e[0],e.forEach(function(a){a.score>n.score&&(n=a)}),[2,n]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(n){return j(e,void 0,void 0,function(){var o;return $(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,n(o?$4({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Fl(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new mr(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new xr(this.runAndExtendWithFaceDetection(),this.input)},t}(Al);function X6(r,t){return t===void 0&&(t=new Wt),new K6(r,t)}function Dl(r,t){if(r.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(r),n=Array.from(t);return Math.sqrt(e.map(function(o,a){return o-n[a]}).reduce(function(o,a){return o+Math.pow(a,2)},0))}var eA=function(){function r(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,a=function(){return"person "+o++};this._labeledDescriptors=n.map(function(i){if(i instanceof or)return i;if(i instanceof Float32Array)return new or(a(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new or(a(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(t,e){return e.map(function(n){return Dl(n,t)}).reduce(function(n,o){return n+o},0)/(e.length||1)},r.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var o=n.descriptors,a=n.label;return new _6(a,e.computeMeanDistance(t,o))}).reduce(function(n,o){return n.distance<o.distance?n:o})},r.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new _6("unknown",e.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},r.fromJSON=function(t){var e=t.labeledDescriptors.map(function(n){return or.fromJSON(n)});return new r(e,t.distanceThreshold)},r}();var a0=class r{progressPreview=P1(null);progress=P1(0);rebuild=P1(0);fps=30;loadModels(){return tt(this,null,function*(){console.log("[VIDEO-PROCESSING] Load models...");try{yield p1.ssdMobilenetv1.loadFromUri("assets/models/ssd_mobilenetv1"),console.log("[VIDEO-PROCESSING] Models loaded")}catch(t){console.error("[VIDEO-PROCESSING] Model loading failed:",t)}})}blurryFaces(t){return tt(this,null,function*(){return console.log("[VIDEO-PROCESSING] Blurry faces!"),new Promise((e,n)=>tt(this,null,function*(){this.progress.set(0);let o=yield this.initSource(t),[a,i]=this.createCanvas(o.videoWidth,o.videoHeight);var c=[],s=0;let l=Math.floor(o.duration*this.fps);console.log("[VIDEO-PROCESSING] totalFrames: "+l);let u=[],h=()=>tt(this,null,function*(){i.drawImage(o,0,0,a.width,a.height);let f=yield this.detectFaces(a);f=f.length?f:c,f.length&&(c=f),f.forEach(p=>this.applyBlur(i,p));let d=a.toDataURL("image/png");if(this.progressPreview.set(d),u.push(d),s++,this.progress.set(Math.floor(s/l*100)),console.log("[VIDEO-PROCESSING] Process frame "+s+" "+this.progress()+"%"),this.progress()<2)yield this.seekToTime(o,s/this.fps),yield h();else{let p=u.length/this.fps;console.log(`[HOME] Rebuild video duration: ${p} | frames: ${u.length} `);let v=yield this.extractAudioTracks(o),m=yield this.rebuildVideo(u,o.videoWidth,o.videoHeight,v,this.fps);e(m)}});h()}))})}initSource(t){return tt(this,null,function*(){let e=document.createElement("video");return e.src=t,yield e.play(),e.pause(),e})}retrieveFPS(t){return tt(this,null,function*(){return new Promise(e=>{console.log("retrieveFPS...");let n=performance.now(),o=[];t.requestVideoFrameCallback(function a(i,c){console.log("metadata: ",c);let s=i-n;if(n=i,o.push(s),o.length<100)t.requestVideoFrameCallback(a);else{let u=1e3/(o.reduce((h,f)=>h+f)/o.length);console.log("Estimated FPS:",u.toFixed(2)),t.currentTime=0,t.pause(),e(u)}}),t.muted=!0,t.play()})})}createCanvas(t,e){let n=document.createElement("canvas");return n.width=t,n.height=e,[n,n.getContext("2d",{willReadFrequently:!0})]}extractAudioTracks(t){return tt(this,null,function*(){let e=new AudioContext,n=e.createMediaElementSource(t),o=e.createMediaStreamDestination();return n.connect(o),n.connect(e.destination),t.currentTime=0,yield t.play(),o.stream.getAudioTracks()})}seekToTime(t,e){return new Promise(n=>{t.onseeked=()=>n(),t.currentTime=e})}sleep(t){return new Promise(e=>setTimeout(e,t))}detectFaces(t){return tt(this,null,function*(){return yield X6(t,new Wt({minConfidence:.2}))})}applyBlur(t,e){let{x:n,y:o,width:a,height:i}=e.box;t.filter="blur(20px)",t.drawImage(t.canvas,n,o,a,i,n,o,a,i),t.filter="blur(5px)",t.drawImage(t.canvas,n,o,a,i,n,o,a,i),t.filter="none"}rebuildVideo(t,e,n,o,a){return tt(this,null,function*(){console.log("[VIDEO-PROCESSING] Rebuild video... fps:"+a);let i=document.createElement("canvas");i.width=e,i.height=n;let c=i.getContext("2d",{willReadFrequently:!0}),s=i.captureStream(a);o.forEach(v=>{console.log("[VIDEO-PROCESSING] add audio track ",v),s.addTrack(v)});let l=new MediaRecorder(s,{mimeType:"video/webm;codecs=vp9,opus"}),u=[];l.ondataavailable=v=>{console.log("[VIDEO-PROCESSING] chunk: "+v.data.size),v.data.size>0&&u.push(v.data)},l.start();let h=1e3/a;var f=0;this.rebuild.set(0);let d=t.length;for(console.log("[VIDEO-PROCESSING] totalFrames: "+d);t.length;){var p=performance.now();let v=t.shift(),m=yield createImageBitmap(yield fetch(v).then(y=>y.blob()));c.drawImage(m,0,0,e,n);let g=performance.now()-p;f++,yield this.sleep(Math.max(1,h-g));let b=Math.floor(f/d*100);console.log("[VIDEO-PROCESSING] Draw frame "+f+" "+b+"%"),this.rebuild.set(b)}return console.log("[VIDEO-PROCESSING] No more frames! "),l.requestData(),yield this.sleep(500),l.stop(),new Promise(v=>{l.onstop=()=>tt(this,null,function*(){let m=new Blob(u,{type:"video/webm"});v(URL.createObjectURL(m))})})})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=M1({token:r,factory:r.\u0275fac,providedIn:"root"})};function Dg(r,t){if(r&1){let e=_r();ue(0,"nz-result",2)(1,"div",3)(2,"button",4),p2("click",function(){f2(e);let o=C4(6);return d2(o.click())}),we(3,"nz-icon",5),_1(4," Sfoglia"),se(),ue(5,"input",6,0),p2("change",function(o){f2(e);let a=re();return d2(a.onFileSelected(o))}),se()()()}}function Ig(r,t){if(r&1&&we(0,"img",8),r&2){let e=re(2);Se("src",e.VideoProcessing.progressPreview(),m0)}}function Bg(r,t){if(r&1&&we(0,"video",9,1),r&2){let e=re(2);Se("src",e.resultUrl()||e.sourceUrl(),m0)}}function Rg(r,t){if(r&1){let e=_r();ue(0,"button",4),p2("click",function(){f2(e);let o=re(2);return d2(o.downloadProcessedVideo())}),we(1,"nz-icon",12),_1(2," Scarica"),se()}}function Og(r,t){if(r&1&&we(0,"nz-progress",13),r&2){let e=re(3);Se("nzPercent",e.percentage())("nzWidth",80)}}function Ng(r,t){if(r&1){let e=_r();ue(0,"button",4),p2("click",function(){f2(e);let o=re(3);return d2(o.processVideo())}),we(1,"nz-icon",14),_1(2," Elabora"),se()}}function Pg(r,t){if(r&1&&ie(0,Og,1,2,"nz-progress",13)(1,Ng,3,0,"button",11),r&2){let e=re(2);fe(e.processing()?0:1)}}function Wg(r,t){if(r&1&&(ue(0,"nz-card",7),ie(1,Ig,1,1,"img",8)(2,Bg,2,1,"video",9),se(),ue(3,"footer",10),ie(4,Rg,3,0,"button",11)(5,Pg,2,1),se()),r&2){let e=re();ee(),fe(e.VideoProcessing.progressPreview()&&!e.resultUrl()?1:2),ee(3),fe(e.resultUrl()?4:5)}}var Il=class r{constructor(t){this.VideoProcessing=t;this.VideoProcessing.loadModels()}processing=P1(!1);sourceUrl=P1(null);resultUrl=P1(null);percentage=wn(()=>Math.round((this.VideoProcessing.rebuild()+this.VideoProcessing.progress())/2));onFileSelected(t){let e=t.target.files[0];if(e){let n=URL.createObjectURL(e);console.log("[LAB] Selected source: "+n),this.sourceUrl.set(n)}}processVideo(){return tt(this,null,function*(){this.processing.set(!0);let t=yield this.VideoProcessing.blurryFaces(this.sourceUrl());this.resultUrl.set(t),this.processing.set(!1)})}downloadProcessedVideo(){let t=document.createElement("a");t.href=this.resultUrl(),t.download=`blurry-faces-${Date.now()}.webm`,t.click()}static \u0275fac=function(e){return new(e||r)(ve(a0))};static \u0275cmp=Je({type:r,selectors:[["view-lab"]],hostAttrs:[1,"flex","min-h-full","items-center","justify-center","p-2"],decls:2,vars:1,consts:[["fileInput",""],["videoPlayer",""],["nzStatus","info","nzTitle","Carica un video per iniziare"],["nz-result-extra",""],["nz-button","","nzType","primary","nzSize","large","nzShape","round",3,"click"],["nzType","folder"],["type","file","accept","video/*","hidden","",3,"change"],[1,"max-h-[80cqh]","!flex"],[1,"max-h-full","max-w-full","m-auto","rounded-lg",3,"src"],["controls","",1,"max-h-full","max-w-full","m-auto","rounded-lg",3,"src"],[1,"absolute","bottom-6","right-6","flex","justify-end","items-end"],["nz-button","","nzType","primary","nzSize","large","nzShape","round"],["nzType","download"],["nzType","circle",3,"nzPercent","nzWidth"],["nzType","play-circle"]],template:function(e,n){e&1&&ie(0,Dg,7,0,"nz-result",2)(1,Wg,6,2),e&2&&fe(n.sourceUrl()?1:0)},dependencies:[b8,Ui,W0,Ii,Ni,Zi,q0,Yi,Ki,G0,ec,$0,Wr,At],styles:["[_nghost-%COMP%]{container-type:normal}"]})};export{Il as LabComponent};
